exports.id=722,exports.ids=[722],exports.modules={5302:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(8450),a=r(9614),l=r(829),d=r(9458),c=r(41),u=r(7511),p=r(6412),h=r(4950),f=r(605),g=r(8544),m=r(8635),y=r(4114),b=r(9179),v=r(4348),S=r(2864);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"createPopoverScope",()=>_),$parcel$export(e.exports,"Popover",()=>$7d632c09314cddaf$export$5b6b19405a83ff9d),$parcel$export(e.exports,"PopoverAnchor",()=>k),$parcel$export(e.exports,"PopoverTrigger",()=>I),$parcel$export(e.exports,"PopoverPortal",()=>$7d632c09314cddaf$export$dd679ffb4362d2d4),$parcel$export(e.exports,"PopoverContent",()=>D),$parcel$export(e.exports,"PopoverClose",()=>O),$parcel$export(e.exports,"PopoverArrow",()=>L),$parcel$export(e.exports,"Root",()=>F),$parcel$export(e.exports,"Anchor",()=>N),$parcel$export(e.exports,"Trigger",()=>z),$parcel$export(e.exports,"Portal",()=>B),$parcel$export(e.exports,"Content",()=>U),$parcel$export(e.exports,"Close",()=>H),$parcel$export(e.exports,"Arrow",()=>G);let x="Popover",[w,_]=l.createContextScope(x,[h.createPopperScope]),P=h.createPopperScope(),[E,C]=w(x),$7d632c09314cddaf$export$5b6b19405a83ff9d=e=>{let{__scopePopover:t,children:r,open:n,defaultOpen:o,onOpenChange:a,modal:l=!1}=e,d=P(t),c=i.useRef(null),[u,f]=i.useState(!1),[g=!1,m]=b.useControllableState({prop:n,defaultProp:o,onChange:a});return i.createElement(h.Root,d,i.createElement(E,{scope:t,contentId:p.useId(),triggerRef:c,open:g,onOpenChange:m,onOpenToggle:i.useCallback(()=>m(e=>!e),[m]),hasCustomAnchor:u,onCustomAnchorAdd:i.useCallback(()=>f(!0),[]),onCustomAnchorRemove:i.useCallback(()=>f(!1),[]),modal:l},r))},k=i.forwardRef((e,t)=>{let{__scopePopover:r,...o}=e,a=C("PopoverAnchor",r),l=P(r),{onCustomAnchorAdd:d,onCustomAnchorRemove:c}=a;return i.useEffect(()=>(d(),()=>c()),[d,c]),i.createElement(h.Anchor,$parcel$interopDefault(n)({},l,o,{ref:t}))}),I=i.forwardRef((e,t)=>{let{__scopePopover:r,...l}=e,d=C("PopoverTrigger",r),c=P(r),u=a.useComposedRefs(t,d.triggerRef),p=i.createElement(m.Primitive.button,$parcel$interopDefault(n)({type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":$7d632c09314cddaf$var$getState(d.open)},l,{ref:u,onClick:o.composeEventHandlers(e.onClick,d.onOpenToggle)}));return d.hasCustomAnchor?p:i.createElement(h.Anchor,$parcel$interopDefault(n)({asChild:!0},c),p)}),T="PopoverPortal",[A,$]=w(T,{forceMount:void 0}),$7d632c09314cddaf$export$dd679ffb4362d2d4=e=>{let{__scopePopover:t,forceMount:r,children:n,container:o}=e,a=C(T,t);return i.createElement(A,{scope:t,forceMount:r},i.createElement(g.Presence,{present:r||a.open},i.createElement(f.Portal,{asChild:!0,container:o},n)))},M="PopoverContent",D=i.forwardRef((e,t)=>{let r=$(M,e.__scopePopover),{forceMount:o=r.forceMount,...a}=e,l=C(M,e.__scopePopover);return i.createElement(g.Presence,{present:o||l.open},l.modal?i.createElement(V,$parcel$interopDefault(n)({},a,{ref:t})):i.createElement(R,$parcel$interopDefault(n)({},a,{ref:t})))}),V=i.forwardRef((e,t)=>{let r=C(M,e.__scopePopover),l=i.useRef(null),d=a.useComposedRefs(t,l),c=i.useRef(!1);return i.useEffect(()=>{let e=l.current;if(e)return v.hideOthers(e)},[]),i.createElement(S.RemoveScroll,{as:y.Slot,allowPinchZoom:!0},i.createElement(j,$parcel$interopDefault(n)({},e,{ref:d,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:o.composeEventHandlers(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),c.current||null===(t=r.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:o.composeEventHandlers(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;c.current=n},{checkForDefaultPrevented:!1}),onFocusOutside:o.composeEventHandlers(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})))}),R=i.forwardRef((e,t)=>{let r=C(M,e.__scopePopover),o=i.useRef(!1),a=i.useRef(!1);return i.createElement(j,$parcel$interopDefault(n)({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,i;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),t.defaultPrevented||(o.current||null===(i=r.triggerRef.current)||void 0===i||i.focus(),t.preventDefault()),o.current=!1,a.current=!1},onInteractOutside:t=>{var n,i;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||(o.current=!0,"pointerdown"!==t.detail.originalEvent.type||(a.current=!0));let l=t.target,d=null===(i=r.triggerRef.current)||void 0===i?void 0:i.contains(l);d&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&a.current&&t.preventDefault()}}))}),j=i.forwardRef((e,t)=>{let{__scopePopover:r,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:p,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:m,onInteractOutside:y,...b}=e,v=C(M,r),S=P(r);return c.useFocusGuards(),i.createElement(u.FocusScope,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:a,onUnmountAutoFocus:l},i.createElement(d.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:p,onInteractOutside:y,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:m,onDismiss:()=>v.onOpenChange(!1)},i.createElement(h.Content,$parcel$interopDefault(n)({"data-state":$7d632c09314cddaf$var$getState(v.open),role:"dialog",id:v.contentId},S,b,{ref:t,style:{...b.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),O=i.forwardRef((e,t)=>{let{__scopePopover:r,...a}=e,l=C("PopoverClose",r);return i.createElement(m.Primitive.button,$parcel$interopDefault(n)({type:"button"},a,{ref:t,onClick:o.composeEventHandlers(e.onClick,()=>l.onOpenChange(!1))}))}),L=i.forwardRef((e,t)=>{let{__scopePopover:r,...o}=e,a=P(r);return i.createElement(h.Arrow,$parcel$interopDefault(n)({},a,o,{ref:t}))});function $7d632c09314cddaf$var$getState(e){return e?"open":"closed"}let F=$7d632c09314cddaf$export$5b6b19405a83ff9d,N=k,z=I,B=$7d632c09314cddaf$export$dd679ffb4362d2d4,U=D,H=O,G=L},2264:(e,t,r)=>{"use strict";function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getMainAxisFromPlacement(e){return["top","bottom"].includes(getSide(e))?"x":"y"}function getLengthFromAxis(e){return"y"===e?"height":"width"}function computeCoordsFromPlacement(e,t,r){let n,{reference:i,floating:o}=e,a=i.x+i.width/2-o.width/2,l=i.y+i.height/2-o.height/2,d=getMainAxisFromPlacement(t),c=getLengthFromAxis(d),u=i[c]/2-o[c]/2,p=getSide(t),h="x"===d;switch(p){case"top":n={x:a,y:i.y-o.height};break;case"bottom":n={x:a,y:i.y+i.height};break;case"right":n={x:i.x+i.width,y:l};break;case"left":n={x:i.x-o.width,y:l};break;default:n={x:i.x,y:i.y}}switch(getAlignment(t)){case"start":n[d]-=u*(r&&h?-1:1);break;case"end":n[d]+=u*(r&&h?-1:1)}return n}r.r(t),r.d(t,{arrow:()=>floating_ui_react_dom_esm_arrow,autoPlacement:()=>autoPlacement,autoUpdate:()=>autoUpdate,computePosition:()=>floating_ui_dom_computePosition,detectOverflow:()=>detectOverflow,flip:()=>flip,getOverflowAncestors:()=>getOverflowAncestors,hide:()=>hide,inline:()=>inline,limitShift:()=>limitShift,offset:()=>offset,shift:()=>shift,size:()=>size,useFloating:()=>useFloating});let computePosition=async(e,t,r)=>{let{placement:n="bottom",strategy:i="absolute",middleware:o=[],platform:a}=r,l=await (null==a.isRTL?void 0:a.isRTL(t)),d=await a.getElementRects({reference:e,floating:t,strategy:i}),{x:c,y:u}=computeCoordsFromPlacement(d,n,l),p=n,h={},f=0;for(let r=0;r<o.length;r++){let{name:g,fn:m}=o[r],{x:y,y:b,data:v,reset:S}=await m({x:c,y:u,initialPlacement:n,placement:p,strategy:i,middlewareData:h,rects:d,platform:a,elements:{reference:e,floating:t}});if(c=null!=y?y:c,u=null!=b?b:u,h={...h,[g]:{...h[g],...v}},S&&f<=50){f++,"object"==typeof S&&(S.placement&&(p=S.placement),S.rects&&(d=!0===S.rects?await a.getElementRects({reference:e,floating:t,strategy:i}):S.rects),{x:c,y:u}=computeCoordsFromPlacement(d,p,l)),r=-1;continue}}return{x:c,y:u,placement:p,strategy:i,middlewareData:h}};function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getSideObjectFromPadding(e){return"number"!=typeof e?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}async function detectOverflow(e,t){var r;void 0===t&&(t={});let{x:n,y:i,platform:o,rects:a,elements:l,strategy:d}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:h=!1,padding:f=0}=t,g=getSideObjectFromPadding(f),m=l[h?"floating"===p?"reference":"floating":p],y=rectToClientRect(await o.getClippingRect({element:null==(r=await (null==o.isElement?void 0:o.isElement(m)))||r?m:m.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(l.floating)),boundary:c,rootBoundary:u,strategy:d})),b=rectToClientRect(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:"floating"===p?{...a.floating,x:n,y:i}:a.reference,offsetParent:await (null==o.getOffsetParent?void 0:o.getOffsetParent(l.floating)),strategy:d}):a[p]);return{top:y.top-b.top+g.top,bottom:b.bottom-y.bottom+g.bottom,left:y.left-b.left+g.left,right:b.right-y.right+g.right}}let n=Math.min,i=Math.max,arrow=e=>({name:"arrow",options:e,async fn(t){let{element:r,padding:o=0}=null!=e?e:{},{x:a,y:l,placement:d,rects:c,platform:u}=t;if(null==r)return{};let p=getSideObjectFromPadding(o),h={x:a,y:l},f=getMainAxisFromPlacement(d),g=getAlignment(d),m=getLengthFromAxis(f),y=await u.getDimensions(r),b="y"===f?"top":"left",v="y"===f?"bottom":"right",S=c.reference[m]+c.reference[f]-h[f]-c.floating[m],x=h[f]-c.reference[f],w=await (null==u.getOffsetParent?void 0:u.getOffsetParent(r)),_=w?"y"===f?w.clientHeight||0:w.clientWidth||0:0;0===_&&(_=c.floating[m]);let P=p[b],E=_-y[m]-p[v],C=_/2-y[m]/2+(S/2-x/2),k=i(P,n(C,E)),I="start"===g?p[b]:p[v],T=I>0&&C!==k&&c.reference[m]<=c.floating[m],A=T?C<P?P-C:E-C:0;return{[f]:h[f]-A,data:{[f]:k,centerOffset:C-k}}}}),o={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,e=>o[e])}function getAlignmentSides(e,t,r){void 0===r&&(r=!1);let n=getAlignment(e),i=getMainAxisFromPlacement(e),o=getLengthFromAxis(i),a="x"===i?n===(r?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[o]>t.floating[o]&&(a=getOppositePlacement(a)),{main:a,cross:getOppositePlacement(a)}}let a={start:"end",end:"start"};function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,e=>a[e])}let l=["top","right","bottom","left"],d=l.reduce((e,t)=>e.concat(t,t+"-start",t+"-end"),[]);function getPlacementList(e,t,r){let n=e?[...r.filter(t=>getAlignment(t)===e),...r.filter(t=>getAlignment(t)!==e)]:r.filter(e=>getSide(e)===e);return n.filter(r=>!e||getAlignment(r)===e||!!t&&getOppositeAlignmentPlacement(r)!==r)}let autoPlacement=function(e){return void 0===e&&(e={}),{name:"autoPlacement",options:e,async fn(t){var r,n,i,o,a;let{x:l,y:c,rects:u,middlewareData:p,placement:h,platform:f,elements:g}=t,{alignment:m=null,allowedPlacements:y=d,autoAlignment:b=!0,...v}=e,S=getPlacementList(m,b,y),x=await detectOverflow(t,v),w=null!=(r=null==(n=p.autoPlacement)?void 0:n.index)?r:0,_=S[w];if(null==_)return{};let{main:P,cross:E}=getAlignmentSides(_,u,await (null==f.isRTL?void 0:f.isRTL(g.floating)));if(h!==_)return{x:l,y:c,reset:{placement:S[0]}};let C=[x[getSide(_)],x[P],x[E]],k=[...null!=(i=null==(o=p.autoPlacement)?void 0:o.overflows)?i:[],{placement:_,overflows:C}],I=S[w+1];if(I)return{data:{index:w+1,overflows:k},reset:{placement:I}};let T=k.slice().sort((e,t)=>e.overflows[0]-t.overflows[0]),A=null==(a=T.find(e=>{let{overflows:t}=e;return t.every(e=>e<=0)}))?void 0:a.placement,$=null!=A?A:T[0].placement;return $!==h?{data:{index:w+1,overflows:k},reset:{placement:$}}:{}}}};function getExpandedPlacements(e){let t=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),t,getOppositeAlignmentPlacement(t)]}let flip=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,n,i,o;let{placement:a,middlewareData:l,rects:d,initialPlacement:c,platform:u,elements:p}=t,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:g,fallbackStrategy:m="bestFit",flipAlignment:y=!0,...b}=e,v=getSide(a),S=v===c,x=g||(S||!y?[getOppositePlacement(c)]:getExpandedPlacements(c)),w=[c,...x],_=await detectOverflow(t,b),P=[],E=(null==(r=l.flip)?void 0:r.overflows)||[];if(h&&P.push(_[v]),f){let{main:e,cross:t}=getAlignmentSides(a,d,await (null==u.isRTL?void 0:u.isRTL(p.floating)));P.push(_[e],_[t])}if(E=[...E,{placement:a,overflows:P}],!P.every(e=>e<=0)){let e=(null!=(n=null==(i=l.flip)?void 0:i.index)?n:0)+1,t=w[e];if(t)return{data:{index:e,overflows:E},reset:{placement:t}};let r="bottom";switch(m){case"bestFit":{let e=null==(o=E.map(e=>[e,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:o[0].placement;e&&(r=e);break}case"initialPlacement":r=c}if(a!==r)return{reset:{placement:r}}}return{}}}};function getSideOffsets(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function isAnySideFullyClipped(e){return l.some(t=>e[t]>=0)}let hide=function(e){let{strategy:t="referenceHidden",...r}=void 0===e?{}:e;return{name:"hide",async fn(e){let{rects:n}=e;switch(t){case"referenceHidden":{let t=await detectOverflow(e,{...r,elementContext:"reference"}),i=getSideOffsets(t,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:isAnySideFullyClipped(i)}}}case"escaped":{let t=await detectOverflow(e,{...r,altBoundary:!0}),i=getSideOffsets(t,n.floating);return{data:{escapedOffsets:i,escaped:isAnySideFullyClipped(i)}}}default:return{}}}}};async function convertValueToCoords(e,t){let{placement:r,platform:n,elements:i}=e,o=await (null==n.isRTL?void 0:n.isRTL(i.floating)),a=getSide(r),l=getAlignment(r),d="x"===getMainAxisFromPlacement(r),c=["left","top"].includes(a)?-1:1,u=o&&d?-1:1,p="function"==typeof t?t(e):t,{mainAxis:h,crossAxis:f,alignmentAxis:g}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return l&&"number"==typeof g&&(f="end"===l?-1*g:g),d?{x:f*u,y:h*c}:{x:h*c,y:f*u}}let offset=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){let{x:r,y:n}=t,i=await convertValueToCoords(t,e);return{x:r+i.x,y:n+i.y,data:i}}}};function getCrossAxis(e){return"x"===e?"y":"x"}let shift=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:r,y:o,placement:a}=t,{mainAxis:l=!0,crossAxis:d=!1,limiter:c={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...u}=e,p={x:r,y:o},h=await detectOverflow(t,u),f=getMainAxisFromPlacement(getSide(a)),g=getCrossAxis(f),m=p[f],y=p[g];if(l){let e="y"===f?"top":"left",t="y"===f?"bottom":"right",r=m+h[e],o=m-h[t];m=i(r,n(m,o))}if(d){let e=y+h["y"===g?"top":"left"],t=y-h["y"===g?"bottom":"right"];y=i(e,n(y,t))}let b=c.fn({...t,[f]:m,[g]:y});return{...b,data:{x:b.x-r,y:b.y-o}}}}},limitShift=function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:r,y:n,placement:i,rects:o,middlewareData:a}=t,{offset:l=0,mainAxis:d=!0,crossAxis:c=!0}=e,u={x:r,y:n},p=getMainAxisFromPlacement(i),h=getCrossAxis(p),f=u[p],g=u[h],m="function"==typeof l?l({...o,placement:i}):l,y="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(d){let e="y"===p?"height":"width",t=o.reference[p]-o.floating[e]+y.mainAxis,r=o.reference[p]+o.reference[e]-y.mainAxis;f<t?f=t:f>r&&(f=r)}if(c){var b,v,S,x;let e="y"===p?"width":"height",t=["top","left"].includes(getSide(i)),r=o.reference[h]-o.floating[e]+(t&&null!=(b=null==(v=a.offset)?void 0:v[h])?b:0)+(t?0:y.crossAxis),n=o.reference[h]+o.reference[e]+(t?0:null!=(S=null==(x=a.offset)?void 0:x[h])?S:0)-(t?y.crossAxis:0);g<r?g=r:g>n&&(g=n)}return{[p]:f,[h]:g}}}},size=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){let r,n;let{placement:o,rects:a,platform:l,elements:d}=t,{apply:c,...u}=e,p=await detectOverflow(t,u),h=getSide(o),f=getAlignment(o);"top"===h||"bottom"===h?(r=h,n=f===(await (null==l.isRTL?void 0:l.isRTL(d.floating))?"start":"end")?"left":"right"):(n=h,r="end"===f?"top":"bottom");let g=i(p.left,0),m=i(p.right,0),y=i(p.top,0),b=i(p.bottom,0),v={availableHeight:a.floating.height-(["left","right"].includes(o)?2*(0!==y||0!==b?y+b:i(p.top,p.bottom)):p[r]),availableWidth:a.floating.width-(["top","bottom"].includes(o)?2*(0!==g||0!==m?g+m:i(p.left,p.right)):p[n])},S=await l.getDimensions(d.floating);null==c||c({...t,...v});let x=await l.getDimensions(d.floating);return S.width!==x.width||S.height!==x.height?{reset:{rects:!0}}:{}}}},inline=function(e){return void 0===e&&(e={}),{name:"inline",options:e,async fn(t){var r;let{placement:o,elements:a,rects:l,platform:d,strategy:c}=t,{padding:u=2,x:p,y:h}=e,f=rectToClientRect(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({rect:l.reference,offsetParent:await (null==d.getOffsetParent?void 0:d.getOffsetParent(a.floating)),strategy:c}):l.reference),g=null!=(r=await (null==d.getClientRects?void 0:d.getClientRects(a.reference)))?r:[],m=getSideObjectFromPadding(u);function getBoundingClientRect(){if(2===g.length&&g[0].left>g[1].right&&null!=p&&null!=h){var e;return null!=(e=g.find(e=>p>e.left-m.left&&p<e.right+m.right&&h>e.top-m.top&&h<e.bottom+m.bottom))?e:f}if(g.length>=2){if("x"===getMainAxisFromPlacement(o)){let e=g[0],t=g[g.length-1],r="top"===getSide(o),n=e.top,i=t.bottom,a=r?e.left:t.left,l=r?e.right:t.right;return{top:n,bottom:i,left:a,right:l,width:l-a,height:i-n,x:a,y:n}}let e="left"===getSide(o),t=i(...g.map(e=>e.right)),r=n(...g.map(e=>e.left)),a=g.filter(n=>e?n.left===r:n.right===t),l=a[0].top,d=a[a.length-1].bottom,c=t-r;return{top:l,bottom:d,left:r,right:t,width:c,height:d-l,x:r,y:l}}return f}let y=await d.getElementRects({reference:{getBoundingClientRect},floating:a.floating,strategy:c});return l.reference.x!==y.reference.x||l.reference.y!==y.reference.y||l.reference.width!==y.reference.width||l.reference.height!==y.reference.height?{reset:{rects:y}}:{}}}};function isWindow(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function getWindow(e){if(null==e)return window;if(!isWindow(e)){let t=e.ownerDocument;return t&&t.defaultView||window}return e}function getComputedStyle$1(e){return getWindow(e).getComputedStyle(e)}function getNodeName(e){return isWindow(e)?"":e?(e.nodeName||"").toLowerCase():""}function getUAString(){let e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map(e=>e.brand+"/"+e.version).join(" "):navigator.userAgent}function isHTMLElement(e){return e instanceof getWindow(e).HTMLElement}function isElement(e){return e instanceof getWindow(e).Element}function isNode(e){return e instanceof getWindow(e).Node}function isShadowRoot(e){if("undefined"==typeof ShadowRoot)return!1;let t=getWindow(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function isOverflowElement(e){let{overflow:t,overflowX:r,overflowY:n}=getComputedStyle$1(e);return/auto|scroll|overlay|hidden/.test(t+n+r)}function isTableElement(e){return["table","td","th"].includes(getNodeName(e))}function isContainingBlock(e){let t=/firefox/i.test(getUAString()),r=getComputedStyle$1(e);return"none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||["transform","perspective"].includes(r.willChange)||t&&"filter"===r.willChange||t&&!!r.filter&&"none"!==r.filter}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}let c=Math.min,u=Math.max,p=Math.round;function getBoundingClientRect(e,t,r){var n,i,o,a;void 0===t&&(t=!1),void 0===r&&(r=!1);let l=e.getBoundingClientRect(),d=1,c=1;t&&isHTMLElement(e)&&(d=e.offsetWidth>0&&p(l.width)/e.offsetWidth||1,c=e.offsetHeight>0&&p(l.height)/e.offsetHeight||1);let u=isElement(e)?getWindow(e):window,h=!isLayoutViewport()&&r,f=(l.left+(h&&null!=(n=null==(i=u.visualViewport)?void 0:i.offsetLeft)?n:0))/d,g=(l.top+(h&&null!=(o=null==(a=u.visualViewport)?void 0:a.offsetTop)?o:0))/c,m=l.width/d,y=l.height/c;return{width:m,height:y,top:g,right:f+m,bottom:g+y,left:f,x:f,y:g}}function getDocumentElement(e){return((isNode(e)?e.ownerDocument:e.document)||window.document).documentElement}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function getWindowScrollBarX(e){return getBoundingClientRect(getDocumentElement(e)).left+getNodeScroll(e).scrollLeft}function isScaled(e){let t=getBoundingClientRect(e);return p(t.width)!==e.offsetWidth||p(t.height)!==e.offsetHeight}function getRectRelativeToOffsetParent(e,t,r){let n=isHTMLElement(t),i=getDocumentElement(t),o=getBoundingClientRect(e,n&&isScaled(t),"fixed"===r),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};if(n||!n&&"fixed"!==r){if(("body"!==getNodeName(t)||isOverflowElement(i))&&(a=getNodeScroll(t)),isHTMLElement(t)){let e=getBoundingClientRect(t,!0);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=getWindowScrollBarX(i))}return{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function getParentNode(e){return"html"===getNodeName(e)?e:e.assignedSlot||e.parentNode||(isShadowRoot(e)?e.host:null)||getDocumentElement(e)}function getTrueOffsetParent(e){return isHTMLElement(e)&&"fixed"!==getComputedStyle(e).position?e.offsetParent:null}function getContainingBlock(e){let t=getParentNode(e);for(isShadowRoot(t)&&(t=t.host);isHTMLElement(t)&&!["html","body"].includes(getNodeName(t));){if(isContainingBlock(t))return t;t=t.parentNode}return null}function getOffsetParent(e){let t=getWindow(e),r=getTrueOffsetParent(e);for(;r&&isTableElement(r)&&"static"===getComputedStyle(r).position;)r=getTrueOffsetParent(r);return r&&("html"===getNodeName(r)||"body"===getNodeName(r)&&"static"===getComputedStyle(r).position&&!isContainingBlock(r))?t:r||getContainingBlock(e)||t}function getDimensions(e){if(isHTMLElement(e))return{width:e.offsetWidth,height:e.offsetHeight};let t=getBoundingClientRect(e);return{width:t.width,height:t.height}}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{rect:t,offsetParent:r,strategy:n}=e,i=isHTMLElement(r),o=getDocumentElement(r);if(r===o)return t;let a={scrollLeft:0,scrollTop:0},l={x:0,y:0};if((i||!i&&"fixed"!==n)&&(("body"!==getNodeName(r)||isOverflowElement(o))&&(a=getNodeScroll(r)),isHTMLElement(r))){let e=getBoundingClientRect(r,!0);l.x=e.x+r.clientLeft,l.y=e.y+r.clientTop}return{...t,x:t.x-a.scrollLeft+l.x,y:t.y-a.scrollTop+l.y}}function getViewportRect(e,t){let r=getWindow(e),n=getDocumentElement(e),i=r.visualViewport,o=n.clientWidth,a=n.clientHeight,l=0,d=0;if(i){o=i.width,a=i.height;let e=isLayoutViewport();(e||!e&&"fixed"===t)&&(l=i.offsetLeft,d=i.offsetTop)}return{width:o,height:a,x:l,y:d}}function getDocumentRect(e){var t;let r=getDocumentElement(e),n=getNodeScroll(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=u(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=u(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),l=-n.scrollLeft+getWindowScrollBarX(e),d=-n.scrollTop;return"rtl"===getComputedStyle$1(i||r).direction&&(l+=u(r.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:l,y:d}}function getNearestOverflowAncestor(e){let t=getParentNode(e);return["html","body","#document"].includes(getNodeName(t))?e.ownerDocument.body:isHTMLElement(t)&&isOverflowElement(t)?t:getNearestOverflowAncestor(t)}function getOverflowAncestors(e,t){var r;void 0===t&&(t=[]);let n=getNearestOverflowAncestor(e),i=n===(null==(r=e.ownerDocument)?void 0:r.body),o=getWindow(n),a=i?[o].concat(o.visualViewport||[],isOverflowElement(n)?n:[]):n,l=t.concat(a);return i?l:l.concat(getOverflowAncestors(a))}function contains(e,t){let r=null==t.getRootNode?void 0:t.getRootNode();if(e.contains(t))return!0;if(r&&isShadowRoot(r)){let r=t;do{if(r&&e===r)return!0;r=r.parentNode||r.host}while(r)}return!1}function getInnerBoundingClientRect(e,t){let r=getBoundingClientRect(e,!1,"fixed"===t),n=r.top+e.clientTop,i=r.left+e.clientLeft;return{top:n,left:i,x:i,y:n,right:i+e.clientWidth,bottom:n+e.clientHeight,width:e.clientWidth,height:e.clientHeight}}function getClientRectFromClippingAncestor(e,t,r){return"viewport"===t?rectToClientRect(getViewportRect(e,r)):isElement(t)?getInnerBoundingClientRect(t,r):rectToClientRect(getDocumentRect(getDocumentElement(e)))}function getClippingAncestors(e){let t=getOverflowAncestors(e),r=["absolute","fixed"].includes(getComputedStyle$1(e).position),n=r&&isHTMLElement(e)?getOffsetParent(e):e;return isElement(n)?t.filter(e=>isElement(e)&&contains(e,n)&&"body"!==getNodeName(e)):[]}function getClippingRect(e){let{element:t,boundary:r,rootBoundary:n,strategy:i}=e,o="clippingAncestors"===r?getClippingAncestors(t):[].concat(r),a=[...o,n],l=a[0],d=a.reduce((e,r)=>{let n=getClientRectFromClippingAncestor(t,r,i);return e.top=u(n.top,e.top),e.right=c(n.right,e.right),e.bottom=c(n.bottom,e.bottom),e.left=u(n.left,e.left),e},getClientRectFromClippingAncestor(t,l,i));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}let h={getClippingRect,convertOffsetParentRelativeRectToViewportRelativeRect,isElement,getDimensions,getOffsetParent,getDocumentElement,getElementRects:e=>{let{reference:t,floating:r,strategy:n}=e;return{reference:getRectRelativeToOffsetParent(t,getOffsetParent(r),n),floating:{...getDimensions(r),x:0,y:0}}},getClientRects:e=>Array.from(e.getClientRects()),isRTL:e=>"rtl"===getComputedStyle$1(e).direction};function autoUpdate(e,t,r,n){let i;void 0===n&&(n={});let{ancestorScroll:o=!0,ancestorResize:a=!0,elementResize:l=!0,animationFrame:d=!1}=n,c=o&&!d,u=a&&!d,p=c||u?[...isElement(e)?getOverflowAncestors(e):[],...getOverflowAncestors(t)]:[];p.forEach(e=>{c&&e.addEventListener("scroll",r,{passive:!0}),u&&e.addEventListener("resize",r)});let h=null;if(l){let n=!0;h=new ResizeObserver(()=>{n||r(),n=!1}),isElement(e)&&!d&&h.observe(e),h.observe(t)}let f=d?getBoundingClientRect(e):null;function frameLoop(){let t=getBoundingClientRect(e);f&&(t.x!==f.x||t.y!==f.y||t.width!==f.width||t.height!==f.height)&&r(),f=t,i=requestAnimationFrame(frameLoop)}return d&&frameLoop(),r(),()=>{var e;p.forEach(e=>{c&&e.removeEventListener("scroll",r),u&&e.removeEventListener("resize",r)}),null==(e=h)||e.disconnect(),h=null,d&&cancelAnimationFrame(i)}}let floating_ui_dom_computePosition=(e,t,r)=>computePosition(e,t,{platform:h,...r});var f=r(9885),g=r(8908),m="undefined"!=typeof document?f.useLayoutEffect:f.useEffect;function deepEqual(e,t){let r,n,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!deepEqual(e[n],t[n]))return!1;return!0}if((r=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=r;0!=n--;){let r=i[n];if(("_owner"!==r||!e.$$typeof)&&!deepEqual(e[r],t[r]))return!1}return!0}return e!=e&&t!=t}function useLatestRef(e){let t=f.useRef(e);return m(()=>{t.current=e}),t}function useFloating(e){let{middleware:t,placement:r="bottom",strategy:n="absolute",whileElementsMounted:i}=void 0===e?{}:e,o=f.useRef(null),a=f.useRef(null),l=useLatestRef(i),d=f.useRef(null),[c,u]=f.useState({x:null,y:null,strategy:n,placement:r,middlewareData:{}}),[p,h]=f.useState(t);deepEqual(null==p?void 0:p.map(e=>{let{options:t}=e;return t}),null==t?void 0:t.map(e=>{let{options:t}=e;return t}))||h(t);let y=f.useCallback(()=>{o.current&&a.current&&floating_ui_dom_computePosition(o.current,a.current,{middleware:p,placement:r,strategy:n}).then(e=>{b.current&&g.flushSync(()=>{u(e)})})},[p,r,n]);m(()=>{b.current&&y()},[y]);let b=f.useRef(!1);m(()=>(b.current=!0,()=>{b.current=!1}),[]);let v=f.useCallback(()=>{if("function"==typeof d.current&&(d.current(),d.current=null),o.current&&a.current){if(l.current){let e=l.current(o.current,a.current,y);d.current=e}else y()}},[y,l]),S=f.useCallback(e=>{o.current=e,v()},[v]),x=f.useCallback(e=>{a.current=e,v()},[v]),w=f.useMemo(()=>({reference:o,floating:a}),[]);return f.useMemo(()=>({...c,update:y,refs:w,reference:S,floating:x}),[c,y,w,S,x])}let floating_ui_react_dom_esm_arrow=e=>{let{element:t,padding:r}=e;function isRef(e){return Object.prototype.hasOwnProperty.call(e,"current")}return{name:"arrow",options:e,fn(e){if(isRef(t)){if(null!=t.current)return arrow({element:t.current,padding:r}).fn(e)}else if(t)return arrow({element:t,padding:r}).fn(e);return{}}}}},8450:e=>{function $1a6a90a521dcd173$export$b9ecd428b558ff10(e,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(null==e||e(n),!1===r||!n.defaultPrevented)return null==t?void 0:t(n)}}Object.defineProperty(e.exports,"composeEventHandlers",{get:()=>$1a6a90a521dcd173$export$b9ecd428b558ff10,set:void 0,enumerable:!0,configurable:!0})},7460:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(8635);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"Arrow",()=>a),$parcel$export(e.exports,"Root",()=>l);let a=i.forwardRef((e,t)=>{let{children:r,width:a=10,height:l=5,...d}=e;return i.createElement(o.Primitive.svg,$parcel$interopDefault(n)({},d,{ref:t,width:a,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?r:i.createElement("polygon",{points:"0,0 30,0 15,10"}))}),l=a},9614:(e,t,r)=>{var n=r(9885);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $9c2aaba23466b352$var$setRef(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function $9c2aaba23466b352$export$43e446d32b3d21af(...e){return t=>e.forEach(e=>$9c2aaba23466b352$var$setRef(e,t))}function $9c2aaba23466b352$export$c7b2cbe3552a0d05(...e){return n.useCallback($9c2aaba23466b352$export$43e446d32b3d21af(...e),e)}$parcel$export(e.exports,"composeRefs",()=>$9c2aaba23466b352$export$43e446d32b3d21af),$parcel$export(e.exports,"useComposedRefs",()=>$9c2aaba23466b352$export$c7b2cbe3552a0d05)},829:(e,t,r)=>{var n=r(9885);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $dec3cc0142d4f286$export$fd42f52fd3ae1109(e,t){let r=n.createContext(t);function Provider(e){let{children:t,...i}=e,o=n.useMemo(()=>i,Object.values(i));return n.createElement(r.Provider,{value:o},t)}function useContext(i){let o=n.useContext(r);if(o)return o;if(void 0!==t)return t;throw Error(`\`${i}\` must be used within \`${e}\``)}return Provider.displayName=e+"Provider",[Provider,useContext]}function $dec3cc0142d4f286$export$50c7b4e9d9f19c1(e,t=[]){let r=[];function $dec3cc0142d4f286$export$fd42f52fd3ae1109(t,i){let o=n.createContext(i),a=r.length;function Provider(t){let{scope:r,children:i,...l}=t,d=(null==r?void 0:r[e][a])||o,c=n.useMemo(()=>l,Object.values(l));return n.createElement(d.Provider,{value:c},i)}function useContext(r,l){let d=(null==l?void 0:l[e][a])||o,c=n.useContext(d);if(c)return c;if(void 0!==i)return i;throw Error(`\`${r}\` must be used within \`${t}\``)}return r=[...r,i],Provider.displayName=t+"Provider",[Provider,useContext]}let createScope=()=>{let t=r.map(e=>n.createContext(e));return function(r){let i=(null==r?void 0:r[e])||t;return n.useMemo(()=>({[`__scope${e}`]:{...r,[e]:i}}),[r,i])}};return createScope.scopeName=e,[$dec3cc0142d4f286$export$fd42f52fd3ae1109,$dec3cc0142d4f286$var$composeContextScopes(createScope,...t)]}function $dec3cc0142d4f286$var$composeContextScopes(...e){let t=e[0];if(1===e.length)return t;let createScope1=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=r.reduce((t,{useScope:r,scopeName:n})=>{let i=r(e),o=i[`__scope${n}`];return{...t,...o}},{});return n.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return createScope1.scopeName=t.scopeName,createScope1}$parcel$export(e.exports,"createContext",()=>$dec3cc0142d4f286$export$fd42f52fd3ae1109),$parcel$export(e.exports,"createContextScope",()=>$dec3cc0142d4f286$export$50c7b4e9d9f19c1)},9458:(e,t,r)=>{let n;var i=r(3259),o=r(9885),a=r(8450),l=r(8635),d=r(9614),c=r(9606),u=r(5674);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"DismissableLayer",()=>f),$parcel$export(e.exports,"DismissableLayerBranch",()=>g),$parcel$export(e.exports,"Root",()=>m),$parcel$export(e.exports,"Branch",()=>y);let p="dismissableLayer.update",h=o.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),f=o.forwardRef((e,t)=>{var r;let{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:m,onInteractOutside:y,onDismiss:b,...v}=e,S=o.useContext(h),[x,w]=o.useState(null),_=null!==(r=null==x?void 0:x.ownerDocument)&&void 0!==r?r:null==globalThis?void 0:globalThis.document,[,P]=o.useState({}),E=d.useComposedRefs(t,e=>w(e)),C=Array.from(S.layers),[k]=[...S.layersWithOutsidePointerEventsDisabled].slice(-1),I=C.indexOf(k),T=x?C.indexOf(x):-1,A=S.layersWithOutsidePointerEventsDisabled.size>0,$=T>=I,M=$d715e0554b679f1f$var$usePointerDownOutside(e=>{let t=e.target,r=[...S.branches].some(e=>e.contains(t));!$||r||(null==g||g(e),null==y||y(e),e.defaultPrevented||null==b||b())},_),D=$d715e0554b679f1f$var$useFocusOutside(e=>{let t=e.target,r=[...S.branches].some(e=>e.contains(t));r||(null==m||m(e),null==y||y(e),e.defaultPrevented||null==b||b())},_);return u.useEscapeKeydown(e=>{let t=T===S.layers.size-1;t&&(null==f||f(e),!e.defaultPrevented&&b&&(e.preventDefault(),b()))},_),o.useEffect(()=>{if(x)return c&&(0===S.layersWithOutsidePointerEventsDisabled.size&&(n=_.body.style.pointerEvents,_.body.style.pointerEvents="none"),S.layersWithOutsidePointerEventsDisabled.add(x)),S.layers.add(x),$d715e0554b679f1f$var$dispatchUpdate(),()=>{c&&1===S.layersWithOutsidePointerEventsDisabled.size&&(_.body.style.pointerEvents=n)}},[x,_,c,S]),o.useEffect(()=>()=>{x&&(S.layers.delete(x),S.layersWithOutsidePointerEventsDisabled.delete(x),$d715e0554b679f1f$var$dispatchUpdate())},[x,S]),o.useEffect(()=>{let handleUpdate=()=>P({});return document.addEventListener(p,handleUpdate),()=>document.removeEventListener(p,handleUpdate)},[]),o.createElement(l.Primitive.div,$parcel$interopDefault(i)({},v,{ref:E,style:{pointerEvents:A?$?"auto":"none":void 0,...e.style},onFocusCapture:a.composeEventHandlers(e.onFocusCapture,D.onFocusCapture),onBlurCapture:a.composeEventHandlers(e.onBlurCapture,D.onBlurCapture),onPointerDownCapture:a.composeEventHandlers(e.onPointerDownCapture,M.onPointerDownCapture)}))}),g=o.forwardRef((e,t)=>{let r=o.useContext(h),n=o.useRef(null),a=d.useComposedRefs(t,n);return o.useEffect(()=>{let e=n.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),o.createElement(l.Primitive.div,$parcel$interopDefault(i)({},e,{ref:a}))});function $d715e0554b679f1f$var$usePointerDownOutside(e,t=null==globalThis?void 0:globalThis.document){let r=c.useCallbackRef(e),n=o.useRef(!1),i=o.useRef(()=>{});return o.useEffect(()=>{let handlePointerDown=e=>{if(e.target&&!n.current){let n={originalEvent:e};function handleAndDispatchPointerDownOutsideEvent(){$d715e0554b679f1f$var$handleAndDispatchCustomEvent("dismissableLayer.pointerDownOutside",r,n,{discrete:!0})}"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=handleAndDispatchPointerDownOutsideEvent,t.addEventListener("click",i.current,{once:!0})):handleAndDispatchPointerDownOutsideEvent()}n.current=!1},e=window.setTimeout(()=>{t.addEventListener("pointerdown",handlePointerDown)},0);return()=>{window.clearTimeout(e),t.removeEventListener("pointerdown",handlePointerDown),t.removeEventListener("click",i.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function $d715e0554b679f1f$var$useFocusOutside(e,t=null==globalThis?void 0:globalThis.document){let r=c.useCallbackRef(e),n=o.useRef(!1);return o.useEffect(()=>{let handleFocus=e=>{e.target&&!n.current&&$d715e0554b679f1f$var$handleAndDispatchCustomEvent("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",handleFocus),()=>t.removeEventListener("focusin",handleFocus)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function $d715e0554b679f1f$var$dispatchUpdate(){let e=new CustomEvent(p);document.dispatchEvent(e)}function $d715e0554b679f1f$var$handleAndDispatchCustomEvent(e,t,r,{discrete:n}){let i=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),n?l.dispatchDiscreteCustomEvent(i,o):i.dispatchEvent(o)}let m=f,y=g},41:(e,t,r)=>{var n=r(9885);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}$parcel$export(e.exports,"FocusGuards",()=>$71476a6ed7dbbaf3$export$ac5b58043b79449b),$parcel$export(e.exports,"Root",()=>o),$parcel$export(e.exports,"useFocusGuards",()=>$71476a6ed7dbbaf3$export$b7ece24a22aeda8c);let i=0;function $71476a6ed7dbbaf3$export$ac5b58043b79449b(e){return $71476a6ed7dbbaf3$export$b7ece24a22aeda8c(),e.children}function $71476a6ed7dbbaf3$export$b7ece24a22aeda8c(){n.useEffect(()=>{var e,t;let r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=r[0])&&void 0!==e?e:$71476a6ed7dbbaf3$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",null!==(t=r[1])&&void 0!==t?t:$71476a6ed7dbbaf3$var$createFocusGuard()),i++,()=>{1===i&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),i--}},[])}function $71476a6ed7dbbaf3$var$createFocusGuard(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}let o=$71476a6ed7dbbaf3$export$ac5b58043b79449b},7511:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(9614),a=r(8635),l=r(9606);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"FocusScope",()=>p),$parcel$export(e.exports,"Root",()=>f);let d="focusScope.autoFocusOnMount",c="focusScope.autoFocusOnUnmount",u={bubbles:!1,cancelable:!0},p=i.forwardRef((e,t)=>{let{loop:r=!1,trapped:p=!1,onMountAutoFocus:f,onUnmountAutoFocus:g,...m}=e,[y,b]=i.useState(null),v=l.useCallbackRef(f),S=l.useCallbackRef(g),x=i.useRef(null),w=o.useComposedRefs(t,e=>b(e)),_=i.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;i.useEffect(()=>{if(p){function handleFocusIn(e){if(_.paused||!y)return;let t=e.target;y.contains(t)?x.current=t:$2bc01e66e04aa9ed$var$focus(x.current,{select:!0})}function handleFocusOut(e){_.paused||!y||y.contains(e.relatedTarget)||$2bc01e66e04aa9ed$var$focus(x.current,{select:!0})}return document.addEventListener("focusin",handleFocusIn),document.addEventListener("focusout",handleFocusOut),()=>{document.removeEventListener("focusin",handleFocusIn),document.removeEventListener("focusout",handleFocusOut)}}},[p,y,_.paused]),i.useEffect(()=>{if(y){h.add(_);let e=document.activeElement,t=y.contains(e);if(!t){let t=new CustomEvent(d,u);y.addEventListener(d,v),y.dispatchEvent(t),t.defaultPrevented||($2bc01e66e04aa9ed$var$focusFirst($2bc01e66e04aa9ed$var$removeLinks($2bc01e66e04aa9ed$var$getTabbableCandidates(y)),{select:!0}),document.activeElement===e&&$2bc01e66e04aa9ed$var$focus(y))}return()=>{y.removeEventListener(d,v),setTimeout(()=>{let t=new CustomEvent(c,u);y.addEventListener(c,S),y.dispatchEvent(t),t.defaultPrevented||$2bc01e66e04aa9ed$var$focus(null!=e?e:document.body,{select:!0}),y.removeEventListener(c,S),h.remove(_)},0)}}},[y,v,S,_]);let P=i.useCallback(e=>{if(!r&&!p||_.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){let t=e.currentTarget,[i,o]=$2bc01e66e04aa9ed$var$getTabbableEdges(t),a=i&&o;a?e.shiftKey||n!==o?e.shiftKey&&n===i&&(e.preventDefault(),r&&$2bc01e66e04aa9ed$var$focus(o,{select:!0})):(e.preventDefault(),r&&$2bc01e66e04aa9ed$var$focus(i,{select:!0})):n===t&&e.preventDefault()}},[r,p,_.paused]);return i.createElement(a.Primitive.div,$parcel$interopDefault(n)({tabIndex:-1},m,{ref:w,onKeyDown:P}))});function $2bc01e66e04aa9ed$var$focusFirst(e,{select:t=!1}={}){let r=document.activeElement;for(let n of e)if($2bc01e66e04aa9ed$var$focus(n,{select:t}),document.activeElement!==r)return}function $2bc01e66e04aa9ed$var$getTabbableEdges(e){let t=$2bc01e66e04aa9ed$var$getTabbableCandidates(e),r=$2bc01e66e04aa9ed$var$findVisible(t,e),n=$2bc01e66e04aa9ed$var$findVisible(t.reverse(),e);return[r,n]}function $2bc01e66e04aa9ed$var$getTabbableCandidates(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function $2bc01e66e04aa9ed$var$findVisible(e,t){for(let r of e)if(!$2bc01e66e04aa9ed$var$isHidden(r,{upTo:t}))return r}function $2bc01e66e04aa9ed$var$isHidden(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function $2bc01e66e04aa9ed$var$isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function $2bc01e66e04aa9ed$var$focus(e,{select:t=!1}={}){if(e&&e.focus){let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&$2bc01e66e04aa9ed$var$isSelectableInput(e)&&t&&e.select()}}let h=$2bc01e66e04aa9ed$var$createFocusScopesStack();function $2bc01e66e04aa9ed$var$createFocusScopesStack(){let e=[];return{add(t){let r=e[0];t!==r&&(null==r||r.pause()),(e=$2bc01e66e04aa9ed$var$arrayRemove(e,t)).unshift(t)},remove(t){var r;null===(r=(e=$2bc01e66e04aa9ed$var$arrayRemove(e,t))[0])||void 0===r||r.resume()}}}function $2bc01e66e04aa9ed$var$arrayRemove(e,t){let r=[...e],n=r.indexOf(t);return -1!==n&&r.splice(n,1),r}function $2bc01e66e04aa9ed$var$removeLinks(e){return e.filter(e=>"A"!==e.tagName)}let f=p},6412:(e,t,r)=>{var n=r(9885),i=r(6520);Object.defineProperty(e.exports,"useId",{get:()=>$dc478e4659f630c5$export$f680877a34711e37,set:void 0,enumerable:!0,configurable:!0});let o=n["useId".toString()]||(()=>void 0),a=0;function $dc478e4659f630c5$export$f680877a34711e37(e){let[t,r]=n.useState(o());return i.useLayoutEffect(()=>{e||r(e=>null!=e?e:String(a++))},[e]),e||(t?`radix-${t}`:"")}},4950:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(2264),a=r(7460),l=r(9614),d=r(829),c=r(8635),u=r(9606),p=r(6520),h=r(4762);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"createPopperScope",()=>b),$parcel$export(e.exports,"Popper",()=>$34310caa050a8d63$export$badac9ada3a0bdf9),$parcel$export(e.exports,"PopperAnchor",()=>x),$parcel$export(e.exports,"PopperContent",()=>k),$parcel$export(e.exports,"PopperArrow",()=>T),$parcel$export(e.exports,"Root",()=>A),$parcel$export(e.exports,"Anchor",()=>$),$parcel$export(e.exports,"Content",()=>M),$parcel$export(e.exports,"Arrow",()=>D),$parcel$export(e.exports,"SIDE_OPTIONS",()=>f),$parcel$export(e.exports,"ALIGN_OPTIONS",()=>g);let f=["top","right","bottom","left"],g=["start","center","end"],m="Popper",[y,b]=d.createContextScope(m),[v,S]=y(m),$34310caa050a8d63$export$badac9ada3a0bdf9=e=>{let{__scopePopper:t,children:r}=e,[n,o]=i.useState(null);return i.createElement(v,{scope:t,anchor:n,onAnchorChange:o},r)},x=i.forwardRef((e,t)=>{let{__scopePopper:r,virtualRef:o,...a}=e,d=S("PopperAnchor",r),u=i.useRef(null),p=l.useComposedRefs(t,u);return i.useEffect(()=>{d.onAnchorChange((null==o?void 0:o.current)||u.current)}),o?null:i.createElement(c.Primitive.div,$parcel$interopDefault(n)({},a,{ref:p}))}),w="PopperContent",[_,P]=y(w),[E,C]=y(w,{hasParent:!1,positionUpdateFns:new Set}),k=i.forwardRef((e,t)=>{var r,n,a,d,f,g,m,y;let{__scopePopper:b,side:v="bottom",sideOffset:x=0,align:P="center",alignOffset:k=0,arrowPadding:I=0,collisionBoundary:T=[],collisionPadding:A=0,sticky:$="partial",hideWhenDetached:M=!1,avoidCollisions:D=!0,onPlaced:V,...R}=e,j=S(w,b),[O,L]=i.useState(null),F=l.useComposedRefs(t,e=>L(e)),[N,z]=i.useState(null),B=h.useSize(N),U=null!==(r=null==B?void 0:B.width)&&void 0!==r?r:0,H=null!==(n=null==B?void 0:B.height)&&void 0!==n?n:0,G="number"==typeof A?A:{top:0,right:0,bottom:0,left:0,...A},W=Array.isArray(T)?T:[T],K=W.length>0,q={padding:G,boundary:W.filter($34310caa050a8d63$var$isNotNull),altBoundary:K},{reference:Y,floating:X,strategy:Z,x:Q,y:J,placement:ee,middlewareData:et,update:er}=o.useFloating({strategy:"fixed",placement:v+("center"!==P?"-"+P:""),whileElementsMounted:o.autoUpdate,middleware:[o.offset({mainAxis:x+H,alignmentAxis:k}),D?o.shift({mainAxis:!0,crossAxis:!1,limiter:"partial"===$?o.limitShift():void 0,...q}):void 0,D?o.flip({...q}):void 0,o.size({...q,apply:({elements:e,rects:t,availableWidth:r,availableHeight:n})=>{let{width:i,height:o}=t.reference,a=e.floating.style;a.setProperty("--radix-popper-available-width",`${r}px`),a.setProperty("--radix-popper-available-height",`${n}px`),a.setProperty("--radix-popper-anchor-width",`${i}px`),a.setProperty("--radix-popper-anchor-height",`${o}px`)}}),N?o.arrow({element:N,padding:I}):void 0,$34310caa050a8d63$var$transformOrigin({arrowWidth:U,arrowHeight:H}),M?o.hide({strategy:"referenceHidden"}):void 0].filter($34310caa050a8d63$var$isDefined)});p.useLayoutEffect(()=>{Y(j.anchor)},[Y,j.anchor]);let en=null!==Q&&null!==J,[ei,eo]=$34310caa050a8d63$var$getSideAndAlignFromPlacement(ee),ea=u.useCallbackRef(V);p.useLayoutEffect(()=>{en&&(null==ea||ea())},[en,ea]);let es=null===(a=et.arrow)||void 0===a?void 0:a.x,el=null===(d=et.arrow)||void 0===d?void 0:d.y,ed=(null===(f=et.arrow)||void 0===f?void 0:f.centerOffset)!==0,[ec,eu]=i.useState();p.useLayoutEffect(()=>{O&&eu(window.getComputedStyle(O).zIndex)},[O]);let{hasParent:ep,positionUpdateFns:eh}=C(w,b),ef=!ep;i.useLayoutEffect(()=>{if(!ef)return eh.add(er),()=>{eh.delete(er)}},[ef,eh,er]),p.useLayoutEffect(()=>{ef&&en&&Array.from(eh).reverse().forEach(e=>requestAnimationFrame(e))},[ef,en,eh]);let eg={"data-side":ei,"data-align":eo,...R,ref:F,style:{...R.style,animation:en?void 0:"none",opacity:null!==(g=et.hide)&&void 0!==g&&g.referenceHidden?0:void 0}};return i.createElement("div",{ref:X,"data-radix-popper-content-wrapper":"",style:{position:Z,left:0,top:0,transform:en?`translate3d(${Math.round(Q)}px, ${Math.round(J)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:ec,"--radix-popper-transform-origin":[null===(m=et.transformOrigin)||void 0===m?void 0:m.x,null===(y=et.transformOrigin)||void 0===y?void 0:y.y].join(" ")},dir:e.dir},i.createElement(_,{scope:b,placedSide:ei,onArrowChange:z,arrowX:es,arrowY:el,shouldHideArrow:ed},ef?i.createElement(E,{scope:b,hasParent:!0,positionUpdateFns:eh},i.createElement(c.Primitive.div,eg)):i.createElement(c.Primitive.div,eg)))}),I={top:"bottom",right:"left",bottom:"top",left:"right"},T=i.forwardRef(function(e,t){let{__scopePopper:r,...o}=e,l=P("PopperArrow",r),d=I[l.placedSide];return i.createElement("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[d]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0}},i.createElement(a.Root,$parcel$interopDefault(n)({},o,{ref:t,style:{...o.style,display:"block"}})))});function $34310caa050a8d63$var$isDefined(e){return void 0!==e}function $34310caa050a8d63$var$isNotNull(e){return null!==e}let $34310caa050a8d63$var$transformOrigin=e=>({name:"transformOrigin",options:e,fn(t){var r,n,i,o,a;let{placement:l,rects:d,middlewareData:c}=t,u=(null===(r=c.arrow)||void 0===r?void 0:r.centerOffset)!==0,p=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[f,g]=$34310caa050a8d63$var$getSideAndAlignFromPlacement(l),m={start:"0%",center:"50%",end:"100%"}[g],y=(null!==(n=null===(i=c.arrow)||void 0===i?void 0:i.x)&&void 0!==n?n:0)+p/2,b=(null!==(o=null===(a=c.arrow)||void 0===a?void 0:a.y)&&void 0!==o?o:0)+h/2,v="",S="";return"bottom"===f?(v=u?m:`${y}px`,S=`${-h}px`):"top"===f?(v=u?m:`${y}px`,S=`${d.floating.height+h}px`):"right"===f?(v=`${-h}px`,S=u?m:`${b}px`):"left"===f&&(v=`${d.floating.width+h}px`,S=u?m:`${b}px`),{data:{x:v,y:S}}}});function $34310caa050a8d63$var$getSideAndAlignFromPlacement(e){let[t,r="center"]=e.split("-");return[t,r]}let A=$34310caa050a8d63$export$badac9ada3a0bdf9,$=x,M=k,D=T},605:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(8908),a=r(8635);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"Portal",()=>l),$parcel$export(e.exports,"Root",()=>d);let l=i.forwardRef((e,t)=>{var r;let{container:l=null==globalThis?void 0:null===(r=globalThis.document)||void 0===r?void 0:r.body,...d}=e;return l?$parcel$interopDefault(o).createPortal(i.createElement(a.Primitive.div,$parcel$interopDefault(n)({},d,{ref:t})),l):null}),d=l},8544:(e,t,r)=>{var n=r(9885),i=r(8908),o=r(9614),a=r(6520);function $8f63844556d0d3cd$export$3e6543de14f8614f(e,t){return n.useReducer((e,r)=>{let n=t[e][r];return null!=n?n:e},e)}Object.defineProperty(e.exports,"Presence",{get:()=>$a2fa0214bb2735a1$export$99c2b779aa4e8b8b,set:void 0,enumerable:!0,configurable:!0});let $a2fa0214bb2735a1$export$99c2b779aa4e8b8b=e=>{let{present:t,children:r}=e,i=$a2fa0214bb2735a1$var$usePresence(t),a="function"==typeof r?r({present:i.isPresent}):n.Children.only(r),l=o.useComposedRefs(i.ref,a.ref),d="function"==typeof r;return d||i.isPresent?n.cloneElement(a,{ref:l}):null};function $a2fa0214bb2735a1$var$usePresence(e){let[t,r]=n.useState(),o=n.useRef({}),l=n.useRef(e),d=n.useRef("none"),c=e?"mounted":"unmounted",[u,p]=$8f63844556d0d3cd$export$3e6543de14f8614f(c,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return n.useEffect(()=>{let e=$a2fa0214bb2735a1$var$getAnimationName(o.current);d.current="mounted"===u?e:"none"},[u]),a.useLayoutEffect(()=>{let t=o.current,r=l.current,n=r!==e;if(n){let n=d.current,i=$a2fa0214bb2735a1$var$getAnimationName(t);e?p("MOUNT"):"none"===i||(null==t?void 0:t.display)==="none"?p("UNMOUNT"):r&&n!==i?p("ANIMATION_OUT"):p("UNMOUNT"),l.current=e}},[e,p]),a.useLayoutEffect(()=>{if(t){let handleAnimationEnd=e=>{let r=$a2fa0214bb2735a1$var$getAnimationName(o.current),n=r.includes(e.animationName);e.target===t&&n&&i.flushSync(()=>p("ANIMATION_END"))},handleAnimationStart=e=>{e.target===t&&(d.current=$a2fa0214bb2735a1$var$getAnimationName(o.current))};return t.addEventListener("animationstart",handleAnimationStart),t.addEventListener("animationcancel",handleAnimationEnd),t.addEventListener("animationend",handleAnimationEnd),()=>{t.removeEventListener("animationstart",handleAnimationStart),t.removeEventListener("animationcancel",handleAnimationEnd),t.removeEventListener("animationend",handleAnimationEnd)}}p("ANIMATION_END")},[t,p]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:n.useCallback(e=>{e&&(o.current=getComputedStyle(e)),r(e)},[])}}function $a2fa0214bb2735a1$var$getAnimationName(e){return(null==e?void 0:e.animationName)||"none"}$a2fa0214bb2735a1$export$99c2b779aa4e8b8b.displayName="Presence"},8635:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(8908),a=r(4114);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"Primitive",()=>l),$parcel$export(e.exports,"Root",()=>d),$parcel$export(e.exports,"dispatchDiscreteCustomEvent",()=>$c3def6332c2749a6$export$6d1a0317bde7de7f);let l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=i.forwardRef((e,r)=>{let{asChild:o,...l}=e,d=o?a.Slot:t;return i.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),i.createElement(d,$parcel$interopDefault(n)({},l,{ref:r}))});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function $c3def6332c2749a6$export$6d1a0317bde7de7f(e,t){e&&o.flushSync(()=>e.dispatchEvent(t))}let d=l},4114:(e,t,r)=>{var n=r(3259),i=r(9885),o=r(9614);function $parcel$export(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function $parcel$interopDefault(e){return e&&e.__esModule?e.default:e}$parcel$export(e.exports,"Slot",()=>a),$parcel$export(e.exports,"Slottable",()=>$82dc8d030dec7549$export$d9f1ccf0bdb05d45),$parcel$export(e.exports,"Root",()=>d);let a=i.forwardRef((e,t)=>{let{children:r,...o}=e,a=i.Children.toArray(r),d=a.find($82dc8d030dec7549$var$isSlottable);if(d){let e=d.props.children,r=a.map(t=>t!==d?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return i.createElement(l,$parcel$interopDefault(n)({},o,{ref:t}),i.isValidElement(e)?i.cloneElement(e,void 0,r):null)}return i.createElement(l,$parcel$interopDefault(n)({},o,{ref:t}),r)});a.displayName="Slot";let l=i.forwardRef((e,t)=>{let{children:r,...n}=e;return i.isValidElement(r)?i.cloneElement(r,{...$82dc8d030dec7549$var$mergeProps(n,r.props),ref:o.composeRefs(t,r.ref)}):i.Children.count(r)>1?i.Children.only(null):null});l.displayName="SlotClone";let $82dc8d030dec7549$export$d9f1ccf0bdb05d45=({children:e})=>i.createElement(i.Fragment,null,e);function $82dc8d030dec7549$var$isSlottable(e){return i.isValidElement(e)&&e.type===$82dc8d030dec7549$export$d9f1ccf0bdb05d45}function $82dc8d030dec7549$var$mergeProps(e,t){let r={...t};for(let n in t){let i=e[n],o=t[n],a=/^on[A-Z]/.test(n);a?i&&o?r[n]=(...e)=>{o(...e),i(...e)}:i&&(r[n]=i):"style"===n?r[n]={...i,...o}:"className"===n&&(r[n]=[i,o].filter(Boolean).join(" "))}return{...e,...r}}let d=a},9606:(e,t,r)=>{var n=r(9885);function $28e03942f763e819$export$25bec8c6f54ee79a(e){let t=n.useRef(e);return n.useEffect(()=>{t.current=e}),n.useMemo(()=>(...e)=>{var r;return null===(r=t.current)||void 0===r?void 0:r.call(t,...e)},[])}Object.defineProperty(e.exports,"useCallbackRef",{get:()=>$28e03942f763e819$export$25bec8c6f54ee79a,set:void 0,enumerable:!0,configurable:!0})},9179:(e,t,r)=>{var n=r(9885),i=r(9606);function $b84d42d44371bff7$export$6f32135080cb4c3({prop:e,defaultProp:t,onChange:r=()=>{}}){let[o,a]=$b84d42d44371bff7$var$useUncontrolledState({defaultProp:t,onChange:r}),l=void 0!==e,d=l?e:o,c=i.useCallbackRef(r),u=n.useCallback(t=>{if(l){let r="function"==typeof t?t(e):t;r!==e&&c(r)}else a(t)},[l,e,a,c]);return[d,u]}function $b84d42d44371bff7$var$useUncontrolledState({defaultProp:e,onChange:t}){let r=n.useState(e),[o]=r,a=n.useRef(o),l=i.useCallbackRef(t);return n.useEffect(()=>{a.current!==o&&(l(o),a.current=o)},[o,a,l]),r}Object.defineProperty(e.exports,"useControllableState",{get:()=>$b84d42d44371bff7$export$6f32135080cb4c3,set:void 0,enumerable:!0,configurable:!0})},5674:(e,t,r)=>{var n=r(9885),i=r(9606);function $24c84e9f83c4454f$export$3a72a57244d6e765(e,t=null==globalThis?void 0:globalThis.document){let r=i.useCallbackRef(e);n.useEffect(()=>{let handleKeyDown=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",handleKeyDown),()=>t.removeEventListener("keydown",handleKeyDown)},[r,t])}Object.defineProperty(e.exports,"useEscapeKeydown",{get:()=>$24c84e9f83c4454f$export$3a72a57244d6e765,set:void 0,enumerable:!0,configurable:!0})},6520:(e,t,r)=>{var n=r(9885);Object.defineProperty(e.exports,"useLayoutEffect",{get:()=>i,set:void 0,enumerable:!0,configurable:!0});let i=(null==globalThis?void 0:globalThis.document)?n.useLayoutEffect:()=>{}},4762:(e,t,r)=>{var n=r(9885),i=r(6520);function $d2c1d285af17635b$export$1ab7ae714698c4b8(e){let[t,r]=n.useState(void 0);return i.useLayoutEffect(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;r({width:n,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}Object.defineProperty(e.exports,"useSize",{get:()=>$d2c1d285af17635b$export$1ab7ae714698c4b8,set:void 0,enumerable:!0,configurable:!0})},5129:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ConfigResolverMap:()=>n.C,EngineMap:()=>n.E,dragAction:()=>n.e,hoverAction:()=>n.h,moveAction:()=>n.m,pinchAction:()=>n.f,registerAction:()=>n.r,scrollAction:()=>n.s,wheelAction:()=>n.w});var n=r(4237)},4237:(e,t,r)=>{"use strict";r.d(t,{C:()=>x,E:()=>S,S:()=>h,_:()=>_objectSpread2,a:()=>_defineProperty,b:()=>touchIds,c:()=>chain,d:()=>toHandlerProp,e:()=>w,f:()=>E,h:()=>_,i:()=>isTouch,m:()=>P,p:()=>parseProp,r:()=>registerAction,s:()=>C,t:()=>toDomEventType,w:()=>k});var n=r(7313);function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let i={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(e){return e?e[0].toUpperCase()+e.slice(1):""}let o=["enter","leave"];function hasCapture(e=!1,t){return e&&!o.includes(t)}function toHandlerProp(e,t="",r=!1){let n=i[e],o=n&&n[t]||t;return"on"+capitalize(e)+capitalize(o)+(hasCapture(r,o)?"Capture":"")}let a=["gotpointercapture","lostpointercapture"];function parseProp(e){let t=e.substring(2).toLowerCase(),r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));let n=a.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(n);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:r}}function toDomEventType(e,t=""){let r=i[e],n=r&&r[t]||t;return e+n}function isTouch(e){return"touches"in e}function getPointerType(e){return isTouch(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function getCurrentTargetTouchList(e){return Array.from(e.touches).filter(t=>{var r,n;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(n=r.contains)||void 0===n?void 0:n.call(r,t.target))})}function getTouchList(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}function getValueEvent(e){return isTouch(e)?getTouchList(e)[0]:e}function distanceAngle(e,t){try{let r=t.clientX-e.clientX,n=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(r,n))/Math.PI,distance:Math.hypot(r,n),origin:[i,o]}}catch(e){}return null}function touchIds(e){return getCurrentTargetTouchList(e).map(e=>e.identifier)}function touchDistanceAngle(e,t){let[r,n]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return distanceAngle(r,n)}function pointerId(e){let t=getValueEvent(e);return isTouch(e)?t.identifier:t.pointerId}function pointerValues(e){let t=getValueEvent(e);return[t.clientX,t.clientY]}function wheelValues(e){let{deltaX:t,deltaY:r,deltaMode:n}=e;return 1===n?(t*=40,r*=40):2===n&&(t*=800,r*=800),[t,r]}function scrollValues(e){var t,r;let{scrollX:n,scrollY:i,scrollLeft:o,scrollTop:a}=e.currentTarget;return[null!==(t=null!=n?n:o)&&void 0!==t?t:0,null!==(r=null!=i?i:a)&&void 0!==r?r:0]}function getEventDetails(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:r,altKey:n,metaKey:i,ctrlKey:o})}return t}function call(e,...t){return"function"==typeof e?e(...t):e}function noop(){}function chain(...e){return 0===e.length?noop:1===e.length?e[0]:function(){let t;for(let r of e)t=r.apply(this,arguments)||t;return t}}function assignDefault(e,t){return Object.assign({},t,e||{})}let Engine=class Engine{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:r,args:n}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=n,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?call(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:r,shared:i}=this;t.args=this.args;let o=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,getEventDetails(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);n.V.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[a,l]=t._movement,[d,c]=r.threshold,{_step:u,values:p}=t;if(r.hasCustomTransform?(!1===u[0]&&(u[0]=Math.abs(a)>=d&&p[0]),!1===u[1]&&(u[1]=Math.abs(l)>=c&&p[1])):(!1===u[0]&&(u[0]=Math.abs(a)>=d&&Math.sign(a)*d),!1===u[1]&&(u[1]=Math.abs(l)>=c&&Math.sign(l)*c)),t.intentional=!1!==u[0]||!1!==u[1],!t.intentional)return;let h=[0,0];if(r.hasCustomTransform){let[e,t]=p;h[0]=!1!==u[0]?e-u[0]:0,h[1]=!1!==u[1]?t-u[1]:0}else h[0]=!1!==u[0]?a-u[0]:0,h[1]=!1!==u[1]?l-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);let f=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=call(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));let[m,y]=t.offset,[[b,v],[S,x]]=t._bounds;t.overflow=[m<b?-1:m>v?1:0,y<S?-1:y>x?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let w=t._active&&r.rubberband||[0,0];if(t.offset=(0,n.c)(t._bounds,t.offset,w),t.delta=n.V.sub(t.offset,f),this.computeMovement(),g&&(!t.last||o>32)){t.delta=n.V.sub(t.offset,f);let e=t.delta.map(Math.abs);n.V.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[e[0]/o,e[1]/o],t.timeDelta=o)}}emit(){let e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;let n=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},t),e),{},{[this.aliasKey]:e.values}));void 0!==n&&(e.memo=n)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function selectAxis([e,t],r){let n=Math.abs(e),i=Math.abs(t);return n>i&&n>r?"x":i>n&&i>r?"y":void 0}let CoordinatesEngine=class CoordinatesEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=n.V.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=n.V.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,r=this.config;if(!t.axis&&e){let n="object"==typeof r.axisThreshold?r.axisThreshold[getPointerType(e)]:r.axisThreshold;t.axis=selectAxis(t._movement,n)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}};let identity=e=>e,l={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>_objectSpread2(_objectSpread2({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return n.V.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?n.V.toVector(e):void 0,transform(e,t,r){let n=e||r.shared.transform;return this.hasCustomTransform=!!n,n||identity},threshold:e=>n.V.toVector(e,0)},d=0,c=_objectSpread2(_objectSpread2({},l),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=d)=>e,bounds(e={}){if("function"==typeof e)return t=>c.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:r=1/0,top:n=-1/0,bottom:i=1/0}=e;return[[t,r],[n,i]]}}),u={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};let DragEngine=class DragEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","dragging")}reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),n={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=c.bounds(n)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let n=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),n&&n.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=pointerId(e),r._pointerActive=!0,this.computeValues(pointerValues(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==getPointerType(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,r=this.config;if(!t._pointerActive)return;let i=pointerId(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;let o=pointerValues(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=n.V.sub(o,t._values),this.computeValues(o)),n.V.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll){if(!t.axis)return;if(t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis){t._active=!1,this.clean();return}this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}let t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;let n=pointerId(e);if(void 0!==t._pointerId&&n!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[i,o]=t._distance;if(t.tap=i<=r.tapsThreshold&&o<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{let[e,n]=t._delta,[i,o]=t._movement,[a,l]=r.swipe.velocity,[d,c]=r.swipe.distance,u=r.swipe.duration;if(t.elapsedTime<u){let r=Math.abs(e/t.timeDelta),u=Math.abs(n/t.timeDelta);r>a&&Math.abs(i)>d&&(t.swipe[0]=Math.sign(e)),u>l&&Math.abs(o)>c&&(t.swipe[1]=Math.sign(n))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,persistEvent(e);let t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=u[e.key];if(t){let r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,n.V.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in u&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}};function persistEvent(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}let p="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return p&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||p&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return p&&"onpointerdown"in window}function supportsPointerLock(){return p&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch(e){return!1}}let h={isBrowser:p,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},f=10,g={mouse:0,touch:0,pen:8},m=_objectSpread2(_objectSpread2({},c),{},{device(e,t,{pointer:{touch:r=!1,lock:n=!1,mouse:i=!1}={}}){return(this.pointerLock=n&&h.pointerLock,h.touch&&r)?"touch":this.pointerLock?"mouse":h.pointer&&!i?"pointer":h.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,h.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:n=1,keys:i=!0}={}}){return this.pointerButtons=n,this.keys=i,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:i=3,axis:o}){let a=n.V.toVector(e,r?i:o?1:0);return this.filterTaps=r,this.tapsThreshold=i,a},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(n.V.toVector(e)),distance:this.transform(n.V.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?_objectSpread2(_objectSpread2({},g),e):g,keyboardDisplacement:(e=f)=>e});function clampStateInternalMovementToBounds(e){let[t,r]=e.overflow,[n,i]=e._delta,[o,a]=e._direction;(t<0&&n>0&&o<0||t>0&&n<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&i>0&&a<0||r>0&&i<0&&a>0)&&(e._movement[1]=e._movementBound[1])}let PinchEngine=class PinchEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"ingKey","pinching"),_defineProperty(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:r}=this.state;"wheel"===e?this.state.offset=n.V.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,r]=e._movement;if(!e.axis){let n=30*Math.abs(t)-Math.abs(r);n<0?e.axis="angle":n>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);let n=touchDistanceAngle(e,t._touchIds);n&&this.pinchStart(e,n)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,r=t._pointerEvents,n=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>n.has(e))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=distanceAngle(...Array.from(r.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){let r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=touchDistanceAngle(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let r=distanceAngle(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){let r=this.state,n=r._values[1],i=t.angle-n,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),r.origin=t.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=n.V.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){let t="uv"in e;!t&&e.cancelable&&e.preventDefault();let r=this.state;r._delta=[-wheelValues(e)[1]/100*r.offset[0],0],n.V.addTo(r._movement,r._delta),clampStateInternalMovementToBounds(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}};let y=_objectSpread2(_objectSpread2({},l),{},{device(e,t,{shared:r,pointer:{touch:n=!1}={}}){if(r.target&&!h.touch&&h.gesture)return"gesture";if(h.touch&&n)return"touch";if(h.touchscreen){if(h.pointer)return"pointer";if(h.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:n={}}){let _scaleBounds=e=>{let t=assignDefault(call(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},_angleBounds=e=>{let t=assignDefault(call(n,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof n?[_scaleBounds(),_angleBounds()]:e=>[_scaleBounds(e),_angleBounds(e)]},threshold(e,t,r){this.lockDirection="lock"===r.axis;let i=n.V.toVector(e,this.lockDirection?[.1,3]:0);return i},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});let MoveEngine=class MoveEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(pointerValues(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=pointerValues(e),r=this.state;r._delta=n.V.sub(t,r._values),n.V.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}};let b=_objectSpread2(_objectSpread2({},c),{},{mouseOnly:(e=!0)=>e});let ScrollEngine=class ScrollEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,r=scrollValues(e);t._delta=n.V.sub(r,t._values),n.V.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}};let WheelEngine=class WheelEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=wheelValues(e),n.V.addTo(t._movement,t._delta),clampStateInternalMovementToBounds(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}};let HoverEngine=class HoverEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(pointerValues(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let r=pointerValues(e);t._movement=t._delta=n.V.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}};let v=_objectSpread2(_objectSpread2({},c),{},{mouseOnly:(e=!0)=>e}),S=new Map,x=new Map;function registerAction(e){S.set(e.key,e.engine),x.set(e.key,e.resolver)}let w={key:"drag",engine:DragEngine,resolver:m},_={key:"hover",engine:HoverEngine,resolver:v},P={key:"move",engine:MoveEngine,resolver:b},E={key:"pinch",engine:PinchEngine,resolver:y},C={key:"scroll",engine:ScrollEngine,resolver:c},k={key:"wheel",engine:WheelEngine,resolver:c}},7313:(e,t,r)=>{"use strict";function clamp(e,t,r){return Math.max(t,Math.min(e,r))}r.d(t,{V:()=>n,c:()=>computeRubberband,r:()=>rubberbandIfOutOfBounds});let n={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function rubberband(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function rubberbandIfOutOfBounds(e,t,r,n=.15){return 0===n?clamp(e,t,r):e<t?-rubberband(t-e,r-t,n)+t:e>r?+rubberband(e-r,r-t,n)+r:e}function computeRubberband(e,[t,r],[n,i]){let[[o,a],[l,d]]=e;return[rubberbandIfOutOfBounds(t,o,a,n),rubberbandIfOutOfBounds(r,l,d,i)]}},3114:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Controller:()=>Controller,parseMergedHandlers:()=>parseMergedHandlers});var n=r(4237);function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}let i={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=n.S.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},o=["target","eventOptions","window","enabled","transform"];function resolveWith(e={},t){let r={};for(let[n,i]of Object.entries(t))switch(typeof i){case"function":r[n]=i.call(r,e[n],n,e);break;case"object":r[n]=resolveWith(e[n],i);break;case"boolean":i&&(r[n]=e[n])}return r}function parse(e,t,r={}){let{target:a,eventOptions:l,window:d,enabled:c,transform:u}=e,p=_objectWithoutProperties(e,o);if(r.shared=resolveWith({target:a,eventOptions:l,window:d,enabled:c,transform:u},i),t){let e=n.C.get(t);r[t]=resolveWith((0,n._)({shared:r.shared},p),e)}else for(let e in p){let t=n.C.get(e);t&&(r[e]=resolveWith((0,n._)({shared:r.shared},p[e]),t))}return r}let EventStore=class EventStore{constructor(e,t){(0,n.a)(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,o){let a=this._listeners,l=(0,n.t)(t,r),d=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=(0,n._)((0,n._)({},d),o);e.addEventListener(l,i,c);let remove=()=>{e.removeEventListener(l,i,c),a.delete(remove)};return a.add(remove),remove}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}};let TimeoutStore=class TimeoutStore{constructor(){(0,n.a)(this,"_timeouts",new Map)}add(e,t,r=140,...n){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...n))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}};let Controller=class Controller{constructor(e){(0,n.a)(this,"gestures",new Set),(0,n.a)(this,"_targetEventStore",new EventStore(this)),(0,n.a)(this,"gestureEventStores",{}),(0,n.a)(this,"gestureTimeoutStores",{}),(0,n.a)(this,"handlers",{}),(0,n.a)(this,"config",{}),(0,n.a)(this,"pointerIds",new Set),(0,n.a)(this,"touchIds",new Set),(0,n.a)(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,e)}setEventIds(e){return(0,n.i)(e)?(this.touchIds=new Set((0,n.b)(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=parse(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let r=this.config.shared,i={};if(!r.target||(t=r.target())){if(r.enabled){for(let r of this.gestures){let o=this.config[r],a=bindToProps(i,o.eventOptions,!!t);if(o.enabled){let t=n.E.get(r);new t(this,e,r).bind(a)}}let o=bindToProps(i,r.eventOptions,!!t);for(let t in this.nativeHandlers)o(t,"",r=>this.nativeHandlers[t]((0,n._)((0,n._)({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(let e in i)i[e]=(0,n.c)(...i[e]);if(!t)return i;for(let e in i){let{device:r,capture:o,passive:a}=(0,n.p)(e);this._targetEventStore.add(t,r,"",i[e],{capture:o,passive:a})}}}};function setupGesture(e,t){e.gestures.add(t),e.gestureEventStores[t]=new EventStore(e,t),e.gestureTimeoutStores[t]=new TimeoutStore}function resolveGestures(e,t){t.drag&&setupGesture(e,"drag"),t.wheel&&setupGesture(e,"wheel"),t.scroll&&setupGesture(e,"scroll"),t.move&&setupGesture(e,"move"),t.pinch&&setupGesture(e,"pinch"),t.hover&&setupGesture(e,"hover")}let bindToProps=(e,t,r)=>(i,o,a,l={},d=!1)=>{var c,u;let p=null!==(c=l.capture)&&void 0!==c?c:t.capture,h=null!==(u=l.passive)&&void 0!==u?u:t.passive,f=d?i:(0,n.d)(i,o,p);r&&h&&(f+="Passive"),e[f]=e[f]||[],e[f].push(a)},a=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sortHandlers(e){let t={},r={},n=new Set;for(let i in e)a.test(i)?(n.add(RegExp.lastMatch),r[i]=e[i]):t[i]=e[i];return[r,t,n]}function registerGesture(e,t,r,i,o,a){if(!e.has(r)||!n.E.has(i))return;let l=r+"Start",d=r+"End";o[i]=e=>{let n;return e.first&&l in t&&t[l](e),r in t&&(n=t[r](e)),e.last&&d in t&&t[d](e),n},a[i]=a[i]||{}}function parseMergedHandlers(e,t){let[r,n,i]=sortHandlers(e),o={};return registerGesture(i,r,"onDrag","drag",o,t),registerGesture(i,r,"onWheel","wheel",o,t),registerGesture(i,r,"onScroll","scroll",o,t),registerGesture(i,r,"onPinch","pinch",o,t),registerGesture(i,r,"onMove","move",o,t),registerGesture(i,r,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:n}}},9642:()=>{},6960:(e,t,r)=>{"use strict";r.r(t),r.d(t,{rubberbandIfOutOfBounds:()=>n.r});var n=r(7313)},51:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5129),i=r(9885),o=r(3114),a=r(6960),l=r(9642),d=function(e){return e&&e.__esModule?e:{default:e}}(i);function useRecognizers(e,t={},r,n){let i=d.default.useMemo(()=>new o.Controller(e),[]);if(i.applyHandlers(e,n),i.applyConfig(t,r),d.default.useEffect(i.effect.bind(i)),d.default.useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}function useDrag(e,t){return n.registerAction(n.dragAction),useRecognizers({drag:e},t||{},"drag")}function usePinch(e,t){return n.registerAction(n.pinchAction),useRecognizers({pinch:e},t||{},"pinch")}function useWheel(e,t){return n.registerAction(n.wheelAction),useRecognizers({wheel:e},t||{},"wheel")}function useScroll(e,t){return n.registerAction(n.scrollAction),useRecognizers({scroll:e},t||{},"scroll")}function useMove(e,t){return n.registerAction(n.moveAction),useRecognizers({move:e},t||{},"move")}function useHover(e,t){return n.registerAction(n.hoverAction),useRecognizers({hover:e},t||{},"hover")}function createUseGesture(e){return e.forEach(n.registerAction),function(e,t){let{handlers:r,nativeHandlers:n,config:i}=o.parseMergedHandlers(e,t||{});return useRecognizers(r,i,void 0,n)}}function useGesture(e,t){let r=createUseGesture([n.dragAction,n.pinchAction,n.scrollAction,n.wheelAction,n.moveAction,n.hoverAction]);return r(e,t||{})}t.createUseGesture=createUseGesture,t.useDrag=useDrag,t.useGesture=useGesture,t.useHover=useHover,t.useMove=useMove,t.usePinch=usePinch,t.useScroll=useScroll,t.useWheel=useWheel,Object.keys(n).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}),Object.keys(a).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}),Object.keys(l).forEach(function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},4348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.suppressOthers=t.supportsInert=t.inertOthers=t.hideOthers=void 0;var getDefaultParent=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},r=new WeakMap,n=new WeakMap,i={},o=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},applyAttributeToOthers=function(e,t,a,l){var d=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var r=unwrapHost(e);return r&&t.contains(r)?r:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});i[a]||(i[a]=new WeakMap);var c=i[a],u=[],p=new Set,h=new Set(d),keep=function(e){!e||p.has(e)||(p.add(e),keep(e.parentNode))};d.forEach(keep);var deep=function(e){!e||h.has(e)||Array.prototype.forEach.call(e.children,function(e){if(p.has(e))deep(e);else{var t=e.getAttribute(l),i=null!==t&&"false"!==t,o=(r.get(e)||0)+1,d=(c.get(e)||0)+1;r.set(e,o),c.set(e,d),u.push(e),1===o&&i&&n.set(e,!0),1===d&&e.setAttribute(a,"true"),i||e.setAttribute(l,"true")}})};return deep(t),p.clear(),o++,function(){u.forEach(function(e){var t=r.get(e)-1,i=c.get(e)-1;r.set(e,t),c.set(e,i),t||(n.has(e)||e.removeAttribute(l),n.delete(e)),i||e.removeAttribute(a)}),--o||(r=new WeakMap,r=new WeakMap,n=new WeakMap,i={})}};t.hideOthers=function(e,t,r){void 0===r&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),i=t||getDefaultParent(e);return i?(n.push.apply(n,Array.from(i.querySelectorAll("[aria-live]"))),applyAttributeToOthers(n,i,r,"aria-hidden")):function(){return null}},t.inertOthers=function(e,t,r){void 0===r&&(r="data-inert-ed");var n=t||getDefaultParent(e);return n?applyAttributeToOthers(e,n,r,"inert"):function(){return null}},t.supportsInert=function(){return"undefined"!=typeof HTMLElement&&HTMLElement.prototype.hasOwnProperty("inert")},t.suppressOthers=function(e,r,n){return void 0===n&&(n="data-suppressed"),((0,t.supportsInert)()?t.inertOthers:t.hideOthers)(e,r,n)}},7687:(e,t,r)=>{"use strict";/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],d=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;d=!1}else for(;!(d=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);d=!0);}catch(e){c=!0,i=e}finally{try{if(!d&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function canvasTest(e){var t,r,n=e.sizes.shift(),i=Math.max(Math.ceil(n[0]),1),o=Math.max(Math.ceil(n[1]),1),a=[i-1,o-1,1,1],l=Date.now(),d="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;d?(t=new OffscreenCanvas(1,1),r=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(r=document.createElement("canvas")).width=i,r.height=o);var c=t.getContext("2d"),u=r.getContext("2d");u&&(u.fillRect.apply(u,a),c.drawImage(r,i-1,o-1,1,1,0,0,1,1));var p=c&&0!==c.getImageData(0,0,1,1).data[3],h=Date.now()-l;return[t,r].forEach(function(e){e.height=0,e.width=0}),d?(postMessage({width:i,height:o,benchmark:h,isTestPass:p}),!p&&e.sizes.length&&canvasTest(e)):p?e.onSuccess(i,o,h):(e.onError(i,o,h),e.sizes.length&&canvasTest(e)),p}r.d(t,{Z:()=>l});var n={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},i=["onError","onSuccess"],o={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},a={};function createSizesArray(e){var t=e.width===e.height,r=1===e.height,n=1===e.width,i=[];if(e.width&&e.height)for(var a=e.min||o.min,l=e.step||o.step,d=Math.max(e.width,e.height);d>=a;){var c=t||r?d:1,u=t||n?d:1;i.push([c,u]),d-=l}else e.sizes.forEach(function(e){var o=t||r?e:1,a=t||n?e:1;i.push([o,a])});return i}function handleMethod(e){var t=window&&"HTMLCanvasElement"in window,r=window&&"OffscreenCanvas"in window,n=Date.now(),o=e.onError,l=e.onSuccess,d=_objectWithoutProperties(e,i),c=null;if(!t)return!1;if(e.useWorker&&r){var u="\n            var canvasTest = ".concat(canvasTest.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([u],{type:"application/javascript"}),h=URL.createObjectURL(p);c=new Worker(h),URL.revokeObjectURL(h),c.onmessage=function(e){var t=e.data,r=t.width,i=t.height,o=t.benchmark;t.isTestPass?(a[n].onSuccess(r,i,o),delete a[n]):a[n].onError(r,i,o)}}return e.usePromise?new Promise(function(t,r){var i=_objectSpread2(_objectSpread2({},e),{},{onError:function(t,n,i){var a;if(0===e.sizes.length)a=!0;else{var l=_slicedToArray(e.sizes.slice(-1),1),d=_slicedToArray(l[0],2),c=d[0],u=d[1];a=t===c&&n===u}o(t,n,i),a&&r({width:t,height:n,benchmark:i})},onSuccess:function(e,r,n){l(e,r,n),t({width:e,height:r,benchmark:n})}});if(c){var u=i.onError,p=i.onSuccess;a[n]={onError:u,onSuccess:p},c.postMessage(d)}else canvasTest(i)}):c?void(a[n]={onError:o,onSuccess:l},c.postMessage(d)):canvasTest(e)}var l={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:e.max,height:e.max,min:e.min,step:e.step,sizes:_toConsumableArray(n.area)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},o),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:1,height:e.max,min:e.min,step:e.step,sizes:_toConsumableArray(n.height)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},o),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:e.max,height:1,min:e.min,step:e.step,sizes:_toConsumableArray(n.width)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},o),e),{},{sizes:t}))},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread2(_objectSpread2({},o),e);return t.sizes=_toConsumableArray(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),handleMethod(t)}}},1507:function(e){/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */e.exports=function(){"use strict";function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,l=[],d=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;d=!1}else for(;!(d=(n=o.call(r)).done)&&(l.push(n.value),l.length!==t);d=!0);}catch(e){c=!0,i=e}finally{try{if(!d&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return l}}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function canvasTest(e){var t,r,n=e.sizes.shift(),i=Math.max(Math.ceil(n[0]),1),o=Math.max(Math.ceil(n[1]),1),a=[i-1,o-1,1,1],l=Date.now(),d="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;d?(t=new OffscreenCanvas(1,1),r=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(r=document.createElement("canvas")).width=i,r.height=o);var c=t.getContext("2d"),u=r.getContext("2d");u&&(u.fillRect.apply(u,a),c.drawImage(r,i-1,o-1,1,1,0,0,1,1));var p=c&&0!==c.getImageData(0,0,1,1).data[3],h=Date.now()-l;return[t,r].forEach(function(e){e.height=0,e.width=0}),d?(postMessage({width:i,height:o,benchmark:h,isTestPass:p}),!p&&e.sizes.length&&canvasTest(e)):p?e.onSuccess(i,o,h):(e.onError(i,o,h),e.sizes.length&&canvasTest(e)),p}var e={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},t=["onError","onSuccess"],r={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},n={};function createSizesArray(e){var t=e.width===e.height,n=1===e.height,i=1===e.width,o=[];if(e.width&&e.height)for(var a=e.min||r.min,l=e.step||r.step,d=Math.max(e.width,e.height);d>=a;){var c=t||n?d:1,u=t||i?d:1;o.push([c,u]),d-=l}else e.sizes.forEach(function(e){var r=t||n?e:1,a=t||i?e:1;o.push([r,a])});return o}function handleMethod(e){var r=window&&"HTMLCanvasElement"in window,i=window&&"OffscreenCanvas"in window,o=Date.now(),a=e.onError,l=e.onSuccess,d=_objectWithoutProperties(e,t),c=null;if(!r)return!1;if(e.useWorker&&i){var u="\n            var canvasTest = ".concat(canvasTest.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([u],{type:"application/javascript"}),h=URL.createObjectURL(p);c=new Worker(h),URL.revokeObjectURL(h),c.onmessage=function(e){var t=e.data,r=t.width,i=t.height,a=t.benchmark;t.isTestPass?(n[o].onSuccess(r,i,a),delete n[o]):n[o].onError(r,i,a)}}return e.usePromise?new Promise(function(t,r){var i=_objectSpread2(_objectSpread2({},e),{},{onError:function(t,n,i){var o;if(0===e.sizes.length)o=!0;else{var l=_slicedToArray(e.sizes.slice(-1),1),d=_slicedToArray(l[0],2),c=d[0],u=d[1];o=t===c&&n===u}a(t,n,i),o&&r({width:t,height:n,benchmark:i})},onSuccess:function(e,r,n){l(e,r,n),t({width:e,height:r,benchmark:n})}});if(c){var u=i.onError,p=i.onSuccess;n[o]={onError:u,onSuccess:p},c.postMessage(d)}else canvasTest(i)}):c?void(n[o]={onError:a,onSuccess:l},c.postMessage(d)):canvasTest(e)}return{maxArea:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=createSizesArray({width:t.max,height:t.max,min:t.min,step:t.step,sizes:_toConsumableArray(e.area)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},r),t),{},{sizes:n}))},maxHeight:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=createSizesArray({width:1,height:t.max,min:t.min,step:t.step,sizes:_toConsumableArray(e.height)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},r),t),{},{sizes:n}))},maxWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=createSizesArray({width:t.max,height:1,min:t.min,step:t.step,sizes:_toConsumableArray(e.width)});return handleMethod(_objectSpread2(_objectSpread2(_objectSpread2({},r),t),{},{sizes:n}))},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread2(_objectSpread2({},r),e);return t.sizes=_toConsumableArray(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),handleMethod(t)}}}()},9367:(e,t)=>{var r;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function classNames(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var i=typeof r;if("string"===i||"number"===i)e.push(r);else if(Array.isArray(r)){if(r.length){var o=classNames.apply(null,r);o&&e.push(o)}}else if("object"===i){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){e.push(r.toString());continue}for(var a in r)n.call(r,a)&&r[a]&&e.push(a)}}}return e.join(" ")}e.exports?(classNames.default=classNames,e.exports=classNames):void 0!==(r=(function(){return classNames}).apply(t,[]))&&(e.exports=r)}()},882:e=>{e.exports.isNode="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)},8419:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function Events(){}function EE(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function addListener(e,t,n,i,o){if("function"!=typeof n)throw TypeError("The listener must be a function");var a=new EE(n,i||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(r=!1)),EventEmitter.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},EventEmitter.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=Array(o);i<o;i++)a[i]=n[i].fn;return a},EventEmitter.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},EventEmitter.prototype.emit=function(e,t,n,i,o,a){var l=r?r+e:e;if(!this._events[l])return!1;var d,c,u=this._events[l],p=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,o),!0;case 6:return u.fn.call(u.context,t,n,i,o,a),!0}for(c=1,d=Array(p-1);c<p;c++)d[c-1]=arguments[c];u.fn.apply(u.context,d)}else{var h,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),p){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,i);break;default:if(!d)for(h=1,d=Array(p-1);h<p;h++)d[h-1]=arguments[h];u[c].fn.apply(u[c].context,d)}}return!0},EventEmitter.prototype.on=function(e,t,r){return addListener(this,e,t,r,!1)},EventEmitter.prototype.once=function(e,t,r){return addListener(this,e,t,r,!0)},EventEmitter.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return clearEvent(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||clearEvent(this,o);else{for(var l=0,d=[],c=a.length;l<c;l++)(a[l].fn!==t||i&&!a[l].once||n&&a[l].context!==n)&&d.push(a[l]);d.length?this._events[o]=1===d.length?d[0]:d:clearEvent(this,o)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=r,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},7643:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setNonce=function(e){n=e},t.getNonce=function(){return n||r.nc}},1650:e=>{"use strict";/*! hotkeys-js v3.12.0 | MIT © 2023 kenny wong <wowohoo@qq.com> https://jaywcjlove.github.io/hotkeys-js */var t="undefined"!=typeof navigator&&0<navigator.userAgent.toLowerCase().indexOf("firefox");function addEvent(e,t,r,n){e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on".concat(t),function(){r(window.event)})}function getMods(e,t){for(var r=t.slice(0,t.length-1),n=0;n<r.length;n++)r[n]=e[r[n].toLowerCase()];return r}function getKeys(e){for(var t=(e=(e="string"!=typeof e?"":e).replace(/\s/g,"")).split(","),r=t.lastIndexOf("");0<=r;)t[r-1]+=",",t.splice(r,1),r=t.lastIndexOf("");return t}function compareArray(e,t){for(var r=e.length<t.length?t:e,n=e.length<t.length?e:t,i=!0,o=0;o<r.length;o++)~n.indexOf(r[o])||(i=!1);return i}for(var r={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":t?173:189,"=":t?61:187,";":t?59:186,"'":222,"[":219,"]":221,"\\":220},n={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},i={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},o={16:!1,18:!1,17:!1,91:!1},a={},l=1;l<20;l++)r["f".concat(l)]=111+l;var d=[],c=!1,u="all",p=[],code=function(e){return r[e.toLowerCase()]||n[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function setScope(e){u=e||"all"}function getScope(){return u||"all"}function deleteScope(e,t){var r,n,i;for(i in e=e||getScope(),a)if(Object.prototype.hasOwnProperty.call(a,i))for(r=a[i],n=0;n<r.length;)r[n].scope===e?r.splice(n,1):n++;getScope()===e&&setScope(t||"all")}function clearModifier(e){var t=e.keyCode||e.which||e.charCode,r=d.indexOf(t);if(r<0||d.splice(r,1),e.key&&"meta"==e.key.toLowerCase()&&d.splice(0,d.length),(t=93!==t&&224!==t?t:91)in o)for(var i in o[t]=!1,n)n[i]===t&&(hotkeys[i]=!1)}var eachUnbind=function(e){var t=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;getKeys(e.key).forEach(function(e){var i,e=e.split(o),l=e.length,d=e[l-1],d="*"===d?"*":code(d);a[d]&&(t=t||getScope(),i=1<l?getMods(n,e):[],a[d]=a[d].filter(function(e){return!((!r||e.method===r)&&e.scope===t&&compareArray(e.mods,i))}))})};function eventHandler(e,t,r,n){var i;if(t.element===n&&(t.scope===r||"all"===t.scope)){for(var a in i=0<t.mods.length,o)Object.prototype.hasOwnProperty.call(o,a)&&(!o[a]&&~t.mods.indexOf(+a)||o[a]&&!~t.mods.indexOf(+a))&&(i=!1);(0!==t.mods.length||o[16]||o[18]||o[17]||o[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(d),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble)&&(e.cancelBubble=!0))}}function dispatch(e,t){var r=a["*"],l=e.keyCode||e.which||e.charCode;if(hotkeys.filter.call(this,e)){if(~d.indexOf(l=93!==l&&224!==l?l:91)||229===l||d.push(l),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(t){var r=i[t];e[t]&&!~d.indexOf(r)?d.push(r):!e[t]&&~d.indexOf(r)?d.splice(d.indexOf(r),1):"metaKey"!==t||!e[t]||3!==d.length||e.ctrlKey||e.shiftKey||e.altKey||(d=d.slice(d.indexOf(r)))}),l in o){for(var c in o[l]=!0,n)n[c]===l&&(hotkeys[c]=!0);if(!r)return}for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(o[u]=e[i[u]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(~d.indexOf(17)||d.push(17),~d.indexOf(18)||d.push(18),o[17]=!0,o[18]=!0);var p=getScope();if(r)for(var h=0;h<r.length;h++)r[h].scope===p&&("keydown"===e.type&&r[h].keydown||"keyup"===e.type&&r[h].keyup)&&eventHandler(e,r[h],p,t);if(l in a){for(var f=0;f<a[l].length;f++)if(("keydown"===e.type&&a[l][f].keydown||"keyup"===e.type&&a[l][f].keyup)&&a[l][f].key){for(var g=a[l][f],m=g.key.split(g.splitKey),y=[],b=0;b<m.length;b++)y.push(code(m[b]));y.sort().join("")===d.sort().join("")&&eventHandler(e,g,p,t)}}}}function isElementBind(e){return!!~p.indexOf(e)}function hotkeys(e,t,r){d=[];var i=getKeys(e),o=[],l="all",u=document,h=0,f=!1,g=!0,m="+",y=!1;for(void 0===r&&"function"==typeof t&&(r=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(l=t.scope),t.element&&(u=t.element),t.keyup&&(f=t.keyup),void 0!==t.keydown&&(g=t.keydown),void 0!==t.capture&&(y=t.capture),"string"==typeof t.splitKey)&&(m=t.splitKey),"string"==typeof t&&(l=t);h<i.length;h++)o=[],1<(e=i[h].split(m)).length&&(o=getMods(n,e)),(e="*"===(e=e[e.length-1])?"*":code(e))in a||(a[e]=[]),a[e].push({keyup:f,keydown:g,scope:l,mods:o,shortcut:i[h],method:r,key:i[h],splitKey:m,element:u});void 0!==u&&!isElementBind(u)&&window&&(p.push(u),addEvent(u,"keydown",function(e){dispatch(e,u)},y),c||(c=!0,addEvent(window,"focus",function(){d=[]},y)),addEvent(u,"keyup",function(e){dispatch(e,u),clearModifier(e)},y))}var h,f,g={getPressedKeyString:function(){return d.map(function(e){return Object.keys(r).find(function(t){return r[t]===e})||Object.keys(n).find(function(t){return n[t]===e})||String.fromCharCode(e)})},setScope:setScope,getScope:getScope,deleteScope:deleteScope,getPressedKeyCodes:function(){return d.slice(0)},getAllKeyCodes:function(){var e=[];return Object.keys(a).forEach(function(t){a[t].forEach(function(t){var r=t.key;e.push({scope:t.scope,shortcut:t.shortcut,mods:t.mods,keys:r.split("+").map(function(e){return code(e)})})})}),e},isPressed:function(e){return"string"==typeof e&&(e=code(e)),!!~d.indexOf(e)},filter:function(e){var e=e.target||e.srcElement,t=e.tagName;return!e.isContentEditable&&("INPUT"!==t&&"TEXTAREA"!==t&&"SELECT"!==t||!!e.readOnly)},trigger:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(a).forEach(function(r){a[r].filter(function(r){return r.scope===t&&r.shortcut===e}).forEach(function(e){e&&e.method&&e.method()})})},unbind:function(e){if(void 0===e)Object.keys(a).forEach(function(e){return delete a[e]});else if(Array.isArray(e))e.forEach(function(e){e.key&&eachUnbind(e)});else if("object"==typeof e)e.key&&eachUnbind(e);else if("string"==typeof e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=r[0],o=r[1];"function"==typeof i&&(o=i,i=""),eachUnbind({key:e,scope:i,method:o,splitKey:"+"})}},keyMap:r,modifier:n,modifierMap:i};for(h in g)Object.prototype.hasOwnProperty.call(g,h)&&(hotkeys[h]=g[h]);"undefined"!=typeof window&&(f=window.hotkeys,hotkeys.noConflict=function(e){return e&&window.hotkeys===hotkeys&&(window.hotkeys=f),hotkeys},window.hotkeys=hotkeys),e.exports=hotkeys},9985:(e,t,r)=>{e.exports=r(1650)},510:(e,t,r)=>{e=r.nmd(e);var n="__lodash_hash_undefined__",i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",d="[object Error]",c="[object Function]",u="[object Map]",p="[object Number]",h="[object Object]",f="[object Promise]",g="[object RegExp]",m="[object Set]",y="[object String]",b="[object WeakMap]",v="[object ArrayBuffer]",S="[object DataView]",x=/^\[object .+?Constructor\]$/,w=/^(?:0|[1-9]\d*)$/,_={};_["[object Float32Array]"]=_["[object Float64Array]"]=_["[object Int8Array]"]=_["[object Int16Array]"]=_["[object Int32Array]"]=_["[object Uint8Array]"]=_["[object Uint8ClampedArray]"]=_["[object Uint16Array]"]=_["[object Uint32Array]"]=!0,_[i]=_[o]=_[v]=_[a]=_[S]=_[l]=_[d]=_[c]=_[u]=_[p]=_[h]=_[g]=_[m]=_[y]=_[b]=!1;var P="object"==typeof global&&global&&global.Object===Object&&global,E="object"==typeof self&&self&&self.Object===Object&&self,C=P||E||Function("return this")(),k=t&&!t.nodeType&&t,I=k&&e&&!e.nodeType&&e,T=I&&I.exports===k,A=T&&P.process,$=function(){try{return A&&A.binding&&A.binding("util")}catch(e){}}(),M=$&&$.isTypedArray;function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}function arrayPush(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function baseUnary(e){return function(t){return e(t)}}function cacheHas(e,t){return e.has(t)}function getValue(e,t){return null==e?void 0:e[t]}function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function overArg(e,t){return function(r){return e(t(r))}}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var D=Array.prototype,V=Function.prototype,R=Object.prototype,j=C["__core-js_shared__"],O=V.toString,L=R.hasOwnProperty,F=function(){var e=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),N=R.toString,z=RegExp("^"+O.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),B=T?C.Buffer:void 0,U=C.Symbol,H=C.Uint8Array,G=R.propertyIsEnumerable,W=D.splice,K=U?U.toStringTag:void 0,q=Object.getOwnPropertySymbols,Y=B?B.isBuffer:void 0,X=overArg(Object.keys,Object),Z=getNative(C,"DataView"),Q=getNative(C,"Map"),J=getNative(C,"Promise"),ee=getNative(C,"Set"),et=getNative(C,"WeakMap"),er=getNative(Object,"create"),en=toSource(Z),ei=toSource(Q),eo=toSource(J),ea=toSource(ee),es=toSource(et),el=U?U.prototype:void 0,ed=el?el.valueOf:void 0;function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function hashClear(){this.__data__=er?er(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function hashGet(e){var t=this.__data__;if(er){var r=t[e];return r===n?void 0:r}return L.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return er?void 0!==t[e]:L.call(t,e)}function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=er&&void 0===t?n:t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():W.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Q||ListCache),string:new Hash}}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function setCacheAdd(e){return this.__data__.set(e,n),this}function setCacheHas(e){return this.__data__.has(e)}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Q||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function arrayLikeKeys(e,t){var r=eh(e),n=!r&&ep(e),i=!r&&!n&&ef(e),o=!r&&!n&&!i&&eg(e),a=r||n||i||o,l=a?baseTimes(e.length,String):[],d=l.length;for(var c in e)(t||L.call(e,c))&&!(a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||isIndex(c,d)))&&l.push(c);return l}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return -1}function baseGetAllKeys(e,t,r){var n=t(e);return eh(e)?n:arrayPush(n,r(e))}function baseGetTag(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?getRawTag(e):objectToString(e)}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==i}function baseIsEqual(e,t,r,n,i){return e===t||(null!=e&&null!=t&&(isObjectLike(e)||isObjectLike(t))?baseIsEqualDeep(e,t,r,n,baseIsEqual,i):e!=e&&t!=t)}function baseIsEqualDeep(e,t,r,n,a,l){var d=eh(e),c=eh(t),u=d?o:eu(e),p=c?o:eu(t);u=u==i?h:u,p=p==i?h:p;var f=u==h,g=p==h,m=u==p;if(m&&ef(e)){if(!ef(t))return!1;d=!0,f=!1}if(m&&!f)return l||(l=new Stack),d||eg(e)?equalArrays(e,t,r,n,a,l):equalByTag(e,t,u,r,n,a,l);if(!(1&r)){var y=f&&L.call(e,"__wrapped__"),b=g&&L.call(t,"__wrapped__");if(y||b){var v=y?e.value():e,S=b?t.value():t;return l||(l=new Stack),a(v,S,r,n,l)}}return!!m&&(l||(l=new Stack),equalObjects(e,t,r,n,a,l))}function baseIsNative(e){return!(!isObject(e)||isMasked(e))&&(isFunction(e)?z:x).test(toSource(e))}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!_[baseGetTag(e)]}function baseKeys(e){if(!isPrototype(e))return X(e);var t=[];for(var r in Object(e))L.call(e,r)&&"constructor"!=r&&t.push(r);return t}function equalArrays(e,t,r,n,i,o){var a=1&r,l=e.length,d=t.length;if(l!=d&&!(a&&d>l))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,p=!0,h=2&r?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++u<l;){var f=e[u],g=t[u];if(n)var m=a?n(g,f,u,t,e,o):n(f,g,u,e,t,o);if(void 0!==m){if(m)continue;p=!1;break}if(h){if(!arraySome(t,function(e,t){if(!cacheHas(h,t)&&(f===e||i(f,e,r,n,o)))return h.push(t)})){p=!1;break}}else if(!(f===g||i(f,g,r,n,o))){p=!1;break}}return o.delete(e),o.delete(t),p}function equalByTag(e,t,r,n,i,o,c){switch(r){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case v:if(e.byteLength!=t.byteLength||!o(new H(e),new H(t)))break;return!0;case a:case l:case p:return eq(+e,+t);case d:return e.name==t.name&&e.message==t.message;case g:case y:return e==t+"";case u:var h=mapToArray;case m:var f=1&n;if(h||(h=setToArray),e.size!=t.size&&!f)break;var b=c.get(e);if(b)return b==t;n|=2,c.set(e,t);var x=equalArrays(h(e),h(t),n,i,o,c);return c.delete(e),x;case"[object Symbol]":if(ed)return ed.call(e)==ed.call(t)}return!1}function equalObjects(e,t,r,n,i,o){var a=1&r,l=baseGetAllKeys(e,keys,ec),d=l.length;if(d!=baseGetAllKeys(t,keys,ec).length&&!a)return!1;for(var c=d;c--;){var u=l[c];if(!(a?u in t:L.call(t,u)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var h=!0;o.set(e,t),o.set(t,e);for(var f=a;++c<d;){var g=e[u=l[c]],m=t[u];if(n)var y=a?n(m,g,u,t,e,o):n(g,m,u,e,t,o);if(!(void 0===y?g===m||i(g,m,r,n,o):y)){h=!1;break}f||(f="constructor"==u)}if(h&&!f){var b=e.constructor,v=t.constructor;b!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof v&&v instanceof v)&&(h=!1)}return o.delete(e),o.delete(t),h}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}function getRawTag(e){var t=L.call(e,K),r=e[K];try{e[K]=void 0;var n=!0}catch(e){}var i=N.call(e);return n&&(t?e[K]=r:delete e[K]),i}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var ec=q?function(e){return null==e?[]:arrayFilter(q(e=Object(e)),function(t){return G.call(e,t)})}:stubArray,eu=baseGetTag;function isIndex(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||w.test(e))&&e>-1&&e%1==0&&e<t}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function isMasked(e){return!!F&&F in e}function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||R)}function objectToString(e){return N.call(e)}function toSource(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eq(e,t){return e===t||e!=e&&t!=t}(Z&&eu(new Z(new ArrayBuffer(1)))!=S||Q&&eu(new Q)!=u||J&&eu(J.resolve())!=f||ee&&eu(new ee)!=m||et&&eu(new et)!=b)&&(eu=function(e){var t=baseGetTag(e),r=t==h?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case en:return S;case ei:return u;case eo:return f;case ea:return m;case es:return b}return t});var ep=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&L.call(e,"callee")&&!G.call(e,"callee")},eh=Array.isArray;function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var ef=Y||stubFalse;function isEqual(e,t){return baseIsEqual(e,t)}function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==c||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function isObjectLike(e){return null!=e&&"object"==typeof e}var eg=M?baseUnary(M):baseIsTypedArray;function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function stubArray(){return[]}function stubFalse(){return!1}e.exports=isEqual},1186:e=>{var t="Expected a function",r=0/0,n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt,d="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,u=d||c||Function("return this")(),p=Object.prototype.toString,h=Math.max,f=Math.min,now=function(){return u.Date.now()};function debounce(e,r,n){var i,o,a,l,d,c,u=0,p=!1,g=!1,m=!0;if("function"!=typeof e)throw TypeError(t);function invokeFunc(t){var r=i,n=o;return i=o=void 0,u=t,l=e.apply(n,r)}function leadingEdge(e){return u=e,d=setTimeout(timerExpired,r),p?invokeFunc(e):l}function remainingWait(e){var t=e-c,n=e-u,i=r-t;return g?f(i,a-n):i}function shouldInvoke(e){var t=e-c,n=e-u;return void 0===c||t>=r||t<0||g&&n>=a}function timerExpired(){var e=now();if(shouldInvoke(e))return trailingEdge(e);d=setTimeout(timerExpired,remainingWait(e))}function trailingEdge(e){return(d=void 0,m&&i)?invokeFunc(e):(i=o=void 0,l)}function cancel(){void 0!==d&&clearTimeout(d),u=0,i=c=o=d=void 0}function flush(){return void 0===d?l:trailingEdge(now())}function debounced(){var e=now(),t=shouldInvoke(e);if(i=arguments,o=this,c=e,t){if(void 0===d)return leadingEdge(c);if(g)return d=setTimeout(timerExpired,r),invokeFunc(c)}return void 0===d&&(d=setTimeout(timerExpired,r)),l}return r=toNumber(r)||0,isObject(n)&&(p=!!n.leading,a=(g="maxWait"in n)?h(toNumber(n.maxWait)||0,r):a,m="trailing"in n?!!n.trailing:m),debounced.cancel=cancel,debounced.flush=flush,debounced}function throttle(e,r,n){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(t);return isObject(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),debounce(e,r,{leading:i,maxWait:r,trailing:o})}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&"[object Symbol]"==p.call(e)}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return r;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var d=o.test(e);return d||a.test(e)?l(e.slice(2),d?2:8):i.test(e)?r:+e}e.exports=throttle},8338:e=>{var t="__lodash_hash_undefined__",r=/^\[object .+?Constructor\]$/,n="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();function arrayIncludes(e,t){return!!(e?e.length:0)&&baseIndexOf(e,t,0)>-1}function arrayIncludesWith(e,t,r){for(var n=-1,i=e?e.length:0;++n<i;)if(r(t,e[n]))return!0;return!1}function baseFindIndex(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return -1}function baseIndexOf(e,t,r){if(t!=t)return baseFindIndex(e,baseIsNaN,r);for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return -1}function baseIsNaN(e){return e!=e}function cacheHas(e,t){return e.has(t)}function getValue(e,t){return null==e?void 0:e[t]}function isHostObject(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var a=Array.prototype,l=Function.prototype,d=Object.prototype,c=o["__core-js_shared__"],u=function(){var e=/[^.]+$/.exec(c&&c.keys&&c.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),p=l.toString,h=d.hasOwnProperty,f=d.toString,g=RegExp("^"+p.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),m=a.splice,y=getNative(o,"Map"),b=getNative(o,"Set"),v=getNative(Object,"create");function Hash(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function hashClear(){this.__data__=v?v(null):{}}function hashDelete(e){return this.has(e)&&delete this.__data__[e]}function hashGet(e){var r=this.__data__;if(v){var n=r[e];return n===t?void 0:n}return h.call(r,e)?r[e]:void 0}function hashHas(e){var t=this.__data__;return v?void 0!==t[e]:h.call(t,e)}function hashSet(e,r){return this.__data__[e]=v&&void 0===r?t:r,this}function ListCache(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():m.call(t,r,1),!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}function MapCache(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(y||ListCache),string:new Hash}}function mapCacheDelete(e){return getMapData(this,e).delete(e)}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){return getMapData(this,e).set(e,t),this}function SetCache(e){var t=-1,r=e?e.length:0;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function setCacheAdd(e){return this.__data__.set(e,t),this}function setCacheHas(e){return this.__data__.has(e)}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return -1}function baseIsNative(e){return!(!isObject(e)||isMasked(e))&&(isFunction(e)||isHostObject(e)?g:r).test(toSource(e))}function baseUniq(e,t,r){var n=-1,i=arrayIncludes,o=e.length,a=!0,l=[],d=l;if(r)a=!1,i=arrayIncludesWith;else if(o>=200){var c=t?null:S(e);if(c)return setToArray(c);a=!1,i=cacheHas,d=new SetCache}else d=t?[]:l;e:for(;++n<o;){var u=e[n],p=t?t(u):u;if(u=r||0!==u?u:0,a&&p==p){for(var h=d.length;h--;)if(d[h]===p)continue e;t&&d.push(p),l.push(u)}else i(d,p,r)||(d!==l&&d.push(p),l.push(u))}return l}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var S=b&&1/setToArray(new b([,-0]))[1]==1/0?function(e){return new b(e)}:noop;function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function isMasked(e){return!!u&&u in e}function toSource(e){if(null!=e){try{return p.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function uniq(e){return e&&e.length?baseUniq(e):[]}function eq(e,t){return e===t||e!=e&&t!=t}function isFunction(e){var t=isObject(e)?f.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function noop(){}e.exports=uniq},776:(e,t,r)=>{var n,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function getBaseValue(e,t){if(!n[e]){n[e]={};for(var r=0;r<e.length;r++)n[e][e.charAt(r)]=r}return n[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var r=i._compress(e,6,function(e){return t.charAt(e)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(r){return getBaseValue(t,e.charAt(r))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),r=new Uint8Array(2*t.length),n=0,o=t.length;n<o;n++){var a=t.charCodeAt(n);r[2*n]=a>>>8,r[2*n+1]=a%256}return r},decompressFromUint8Array:function(t){if(null==t)return i.decompress(t);for(var r=Array(t.length/2),n=0,o=r.length;n<o;n++)r[n]=256*t[2*n]+t[2*n+1];var a=[];return r.forEach(function(t){a.push(e(t))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return r.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return getBaseValue(r,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,r){if(null==e)return"";var n,i,o,a={},l={},d="",c="",u="",p=2,h=3,f=2,g=[],m=0,y=0;for(o=0;o<e.length;o+=1)if(d=e.charAt(o),Object.prototype.hasOwnProperty.call(a,d)||(a[d]=h++,l[d]=!0),c=u+d,Object.prototype.hasOwnProperty.call(a,c))u=c;else{if(Object.prototype.hasOwnProperty.call(l,u)){if(256>u.charCodeAt(0)){for(n=0;n<f;n++)m<<=1,y==t-1?(y=0,g.push(r(m)),m=0):y++;for(n=0,i=u.charCodeAt(0);n<8;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1}else{for(n=0,i=1;n<f;n++)m=m<<1|i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i=0;for(n=0,i=u.charCodeAt(0);n<16;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1}0==--p&&(p=Math.pow(2,f),f++),delete l[u]}else for(n=0,i=a[u];n<f;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1;0==--p&&(p=Math.pow(2,f),f++),a[c]=h++,u=String(d)}if(""!==u){if(Object.prototype.hasOwnProperty.call(l,u)){if(256>u.charCodeAt(0)){for(n=0;n<f;n++)m<<=1,y==t-1?(y=0,g.push(r(m)),m=0):y++;for(n=0,i=u.charCodeAt(0);n<8;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1}else{for(n=0,i=1;n<f;n++)m=m<<1|i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i=0;for(n=0,i=u.charCodeAt(0);n<16;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1}0==--p&&(p=Math.pow(2,f),f++),delete l[u]}else for(n=0,i=a[u];n<f;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1;0==--p&&(p=Math.pow(2,f),f++)}for(n=0,i=2;n<f;n++)m=m<<1|1&i,y==t-1?(y=0,g.push(r(m)),m=0):y++,i>>=1;for(;;){if(m<<=1,y==t-1){g.push(r(m));break}y++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,r,n){var i,o,a,l,d,c,u,p=[],h=4,f=4,g=3,m="",y=[],b={val:n(0),position:r,index:1};for(i=0;i<3;i+=1)p[i]=i;for(a=0,d=4,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,d=256,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;u=e(a);break;case 1:for(a=0,d=65536,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;u=e(a);break;case 2:return""}for(p[3]=u,o=u,y.push(u);;){if(b.index>t)return"";for(a=0,d=Math.pow(2,g),c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;switch(u=a){case 0:for(a=0,d=256,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;p[f++]=e(a),u=f-1,h--;break;case 1:for(a=0,d=65536,c=1;c!=d;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=n(b.index++)),a|=(l>0?1:0)*c,c<<=1;p[f++]=e(a),u=f-1,h--;break;case 2:return y.join("")}if(0==h&&(h=Math.pow(2,g),g++),p[u])m=p[u];else{if(u!==f)return null;m=o+o.charAt(0)}y.push(m),p[f++]=o+m.charAt(0),h--,o=m,0==h&&(h=Math.pow(2,g),g++)}}};return i}();void 0!==(n=(function(){return i}).call(t,r,t,e))&&(e.exports=n)},3642:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return dynamic}});let n=r(85);r(9885);let i=n._(r(112));function convertModule(e){return{default:(null==e?void 0:e.default)||e}}function dynamic(e,t){let r=i.default,n={loading:e=>{let{error:t,isLoading:r,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e),Object.assign(n,t);let o=n.loader;return r({...n,loader:()=>null!=o?o().then(convertModule):Promise.resolve(convertModule(()=>null))})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6800:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NoSSR",{enumerable:!0,get:function(){return NoSSR}});let n=r(1118);function NoSSR(e){let{children:t}=e;return(0,n.throwWithNoSSR)(),t}},112:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let n=r(85),i=n._(r(9885)),o=r(6800);function Loadable(e){let t=Object.assign({loader:null,loading:null,ssr:!0},e);function LoadableComponent(e){let r=t.loading,n=i.default.createElement(r,{isLoading:!0,pastDelay:!0,error:null}),a=t.ssr?i.default.Fragment:o.NoSSR,l=t.lazy;return i.default.createElement(i.default.Suspense,{fallback:n},i.default.createElement(a,null,i.default.createElement(l,e)))}return t.lazy=i.default.lazy(t.loader),LoadableComponent.displayName="LoadableComponent",LoadableComponent}let a=Loadable},9001:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RSC:function(){return r},ACTION:function(){return n},NEXT_ROUTER_STATE_TREE:function(){return i},NEXT_ROUTER_PREFETCH:function(){return o},NEXT_URL:function(){return a},RSC_CONTENT_TYPE_HEADER:function(){return l},RSC_VARY_HEADER:function(){return d},FLIGHT_PARAMETERS:function(){return c},NEXT_RSC_UNION_QUERY:function(){return u}});let r="RSC",n="Next-Action",i="Next-Router-State-Tree",o="Next-Router-Prefetch",a="Next-Url",l="text/x-component",d=r+", "+i+", "+o+", "+a,c=[[r],[i],[o]],u="_rsc";("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8712:e=>{"use strict";(()=>{"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=__dirname+"/");var t={};(()=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=parse,t.serialize=serialize;var e=decodeURIComponent,r=encodeURIComponent,n=/; */,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function parse(t,r){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var i={},o=t.split(n),a=(r||{}).decode||e,l=0;l<o.length;l++){var d=o[l],c=d.indexOf("=");if(!(c<0)){var u=d.substr(0,c).trim(),p=d.substr(++c,d.length).trim();'"'==p[0]&&(p=p.slice(1,-1)),void 0==i[u]&&(i[u]=tryDecode(p,a))}}return i}function serialize(e,t,n){var o=n||{},a=o.encode||r;if("function"!=typeof a)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var l=a(t);if(l&&!i.test(l))throw TypeError("argument val is invalid");var d=e+"="+l;if(null!=o.maxAge){var c=o.maxAge-0;if(isNaN(c)||!isFinite(c))throw TypeError("option maxAge is invalid");d+="; Max-Age="+Math.floor(c)}if(o.domain){if(!i.test(o.domain))throw TypeError("option domain is invalid");d+="; Domain="+o.domain}if(o.path){if(!i.test(o.path))throw TypeError("option path is invalid");d+="; Path="+o.path}if(o.expires){if("function"!=typeof o.expires.toUTCString)throw TypeError("option expires is invalid");d+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(d+="; HttpOnly"),o.secure&&(d+="; Secure"),o.sameSite)switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:case"strict":d+="; SameSite=Strict";break;case"lax":d+="; SameSite=Lax";break;case"none":d+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return d}function tryDecode(e,t){try{return t(e)}catch(t){return e}}})(),e.exports=t})()},9481:(e,t)=>{"use strict";function lexer(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"===n||"+"===n||"?"===n){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if("\\"===n){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if("{"===n){t.push({type:"OPEN",index:r,value:e[r++]});continue}if("}"===n){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(":"===n){for(var i="",o=r+1;o<e.length;){var a=e.charCodeAt(o);if(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||95===a){i+=e[o++];continue}break}if(!i)throw TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:i}),r=o;continue}if("("===n){var l=1,d="",o=r+1;if("?"===e[o])throw TypeError('Pattern cannot start with "?" at '+o);for(;o<e.length;){if("\\"===e[o]){d+=e[o++]+e[o++];continue}if(")"===e[o]){if(0==--l){o++;break}}else if("("===e[o]&&(l++,"?"!==e[o+1]))throw TypeError("Capturing groups are not allowed at "+o);d+=e[o++]}if(l)throw TypeError("Unbalanced pattern at "+r);if(!d)throw TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:d}),r=o;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function parse(e,t){void 0===t&&(t={});for(var r=lexer(e),n=t.prefixes,i=void 0===n?"./":n,o="[^"+escapeString(t.delimiter||"/#?")+"]+?",a=[],l=0,d=0,c="",tryConsume=function(e){if(d<r.length&&r[d].type===e)return r[d++].value},mustConsume=function(e){var t=tryConsume(e);if(void 0!==t)return t;var n=r[d];throw TypeError("Unexpected "+n.type+" at "+n.index+", expected "+e)},consumeText=function(){for(var e,t="";e=tryConsume("CHAR")||tryConsume("ESCAPED_CHAR");)t+=e;return t};d<r.length;){var u=tryConsume("CHAR"),p=tryConsume("NAME"),h=tryConsume("PATTERN");if(p||h){var f=u||"";-1===i.indexOf(f)&&(c+=f,f=""),c&&(a.push(c),c=""),a.push({name:p||l++,prefix:f,suffix:"",pattern:h||o,modifier:tryConsume("MODIFIER")||""});continue}var g=u||tryConsume("ESCAPED_CHAR");if(g){c+=g;continue}if(c&&(a.push(c),c=""),tryConsume("OPEN")){var f=consumeText(),m=tryConsume("NAME")||"",y=tryConsume("PATTERN")||"",b=consumeText();mustConsume("CLOSE"),a.push({name:m||(y?l++:""),pattern:m&&!y?o:y,prefix:f,suffix:b,modifier:tryConsume("MODIFIER")||""});continue}mustConsume("END")}return a}function compile(e,t){return tokensToFunction(parse(e,t),t)}function tokensToFunction(e,t){void 0===t&&(t={});var r=flags(t),n=t.encode,i=void 0===n?function(e){return e}:n,o=t.validate,a=void 0===o||o,l=e.map(function(e){if("object"==typeof e)return RegExp("^(?:"+e.pattern+")$",r)});return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"==typeof o){r+=o;continue}var d=t?t[o.name]:void 0,c="?"===o.modifier||"*"===o.modifier,u="*"===o.modifier||"+"===o.modifier;if(Array.isArray(d)){if(!u)throw TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===d.length){if(c)continue;throw TypeError('Expected "'+o.name+'" to not be empty')}for(var p=0;p<d.length;p++){var h=i(d[p],o);if(a&&!l[n].test(h))throw TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+h+'"');r+=o.prefix+h+o.suffix}continue}if("string"==typeof d||"number"==typeof d){var h=i(String(d),o);if(a&&!l[n].test(h))throw TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+h+'"');r+=o.prefix+h+o.suffix;continue}if(!c){var f=u?"an array":"a string";throw TypeError('Expected "'+o.name+'" to be '+f)}}return r}}function match(e,t){var r=[];return regexpToFunction(pathToRegexp(e,r,t),r,t)}function regexpToFunction(e,t,r){void 0===r&&(r={});var n=r.decode,i=void 0===n?function(e){return e}:n;return function(r){var n=e.exec(r);if(!n)return!1;for(var o=n[0],a=n.index,l=Object.create(null),d=1;d<n.length;d++)!function(e){if(void 0!==n[e]){var r=t[e-1];"*"===r.modifier||"+"===r.modifier?l[r.name]=n[e].split(r.prefix+r.suffix).map(function(e){return i(e,r)}):l[r.name]=i(n[e],r)}}(d);return{path:o,index:a,params:l}}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function regexpToRegexp(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}function arrayToRegexp(e,t,r){return RegExp("(?:"+e.map(function(e){return pathToRegexp(e,t,r).source}).join("|")+")",flags(r))}function stringToRegexp(e,t,r){return tokensToRegexp(parse(e,r),t,r)}function tokensToRegexp(e,t,r){void 0===r&&(r={});for(var n=r.strict,i=void 0!==n&&n,o=r.start,a=r.end,l=r.encode,d=void 0===l?function(e){return e}:l,c="["+escapeString(r.endsWith||"")+"]|$",u="["+escapeString(r.delimiter||"/#?")+"]",p=void 0===o||o?"^":"",h=0;h<e.length;h++){var f=e[h];if("string"==typeof f)p+=escapeString(d(f));else{var g=escapeString(d(f.prefix)),m=escapeString(d(f.suffix));if(f.pattern){if(t&&t.push(f),g||m){if("+"===f.modifier||"*"===f.modifier){var y="*"===f.modifier?"?":"";p+="(?:"+g+"((?:"+f.pattern+")(?:"+m+g+"(?:"+f.pattern+"))*)"+m+")"+y}else p+="(?:"+g+"("+f.pattern+")"+m+")"+f.modifier}else p+="("+f.pattern+")"+f.modifier}else p+="(?:"+g+m+")"+f.modifier}}if(void 0===a||a)i||(p+=u+"?"),p+=r.endsWith?"(?="+c+")":"$";else{var b=e[e.length-1],v="string"==typeof b?u.indexOf(b[b.length-1])>-1:void 0===b;i||(p+="(?:"+u+"(?="+c+"))?"),v||(p+="(?="+u+"|"+c+")")}return new RegExp(p,flags(r))}function pathToRegexp(e,t,r){return e instanceof RegExp?regexpToRegexp(e,t):Array.isArray(e)?arrayToRegexp(e,t,r):stringToRegexp(e,t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=parse,t.compile=compile,t.tokensToFunction=tokensToFunction,t.match=match,t.regexpToFunction=regexpToFunction,t.tokensToRegexp=tokensToRegexp,t.pathToRegexp=pathToRegexp},9368:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{NEXT_QUERY_PARAM_PREFIX:function(){return r},PRERENDER_REVALIDATE_HEADER:function(){return n},PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER:function(){return i},NEXT_DID_POSTPONE_HEADER:function(){return o},NEXT_CACHE_TAGS_HEADER:function(){return a},NEXT_CACHE_SOFT_TAGS_HEADER:function(){return l},NEXT_CACHE_REVALIDATED_TAGS_HEADER:function(){return d},NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER:function(){return c},NEXT_CACHE_TAG_MAX_LENGTH:function(){return u},NEXT_CACHE_SOFT_TAG_MAX_LENGTH:function(){return p},NEXT_CACHE_IMPLICIT_TAG_ID:function(){return h},CACHE_ONE_YEAR:function(){return f},MIDDLEWARE_FILENAME:function(){return g},MIDDLEWARE_LOCATION_REGEXP:function(){return m},INSTRUMENTATION_HOOK_FILENAME:function(){return y},PAGES_DIR_ALIAS:function(){return b},DOT_NEXT_ALIAS:function(){return v},ROOT_DIR_ALIAS:function(){return S},APP_DIR_ALIAS:function(){return x},RSC_MOD_REF_PROXY_ALIAS:function(){return w},RSC_ACTION_VALIDATE_ALIAS:function(){return _},RSC_ACTION_PROXY_ALIAS:function(){return P},RSC_ACTION_ENCRYPTION_ALIAS:function(){return E},RSC_ACTION_CLIENT_WRAPPER_ALIAS:function(){return C},PUBLIC_DIR_MIDDLEWARE_CONFLICT:function(){return k},SSG_GET_INITIAL_PROPS_CONFLICT:function(){return I},SERVER_PROPS_GET_INIT_PROPS_CONFLICT:function(){return T},SERVER_PROPS_SSG_CONFLICT:function(){return A},STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR:function(){return $},SERVER_PROPS_EXPORT_ERROR:function(){return M},GSP_NO_RETURNED_VALUE:function(){return D},GSSP_NO_RETURNED_VALUE:function(){return V},UNSTABLE_REVALIDATE_RENAME_ERROR:function(){return R},GSSP_COMPONENT_MEMBER_ERROR:function(){return j},NON_STANDARD_NODE_ENV:function(){return O},SSG_FALLBACK_EXPORT_ERROR:function(){return L},ESLINT_DEFAULT_DIRS:function(){return F},ESLINT_PROMPT_VALUES:function(){return N},SERVER_RUNTIME:function(){return z},WEBPACK_LAYERS:function(){return U},WEBPACK_RESOURCE_QUERIES:function(){return H}});let r="nxtP",n="x-prerender-revalidate",i="x-prerender-revalidate-if-generated",o="x-nextjs-postponed",a="x-next-cache-tags",l="x-next-cache-soft-tags",d="x-next-revalidated-tags",c="x-next-revalidate-tag-token",u=256,p=1024,h="_N_T_",f=31536e3,g="middleware",m=`(?:src/)?${g}`,y="instrumentation",b="private-next-pages",v="private-dot-next",S="private-next-root-dir",x="private-next-app-dir",w="next/dist/build/webpack/loaders/next-flight-loader/module-proxy",_="private-next-rsc-action-validate",P="private-next-rsc-action-proxy",E="private-next-rsc-action-encryption",C="private-next-rsc-action-client-wrapper",k="You can not have a '_next' folder inside of your public folder. This conflicts with the internal '/_next' route. https://nextjs.org/docs/messages/public-next-folder-conflict",I="You can not use getInitialProps with getStaticProps. To use SSG, please remove your getInitialProps",T="You can not use getInitialProps with getServerSideProps. Please remove getInitialProps.",A="You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps",$="can not have getInitialProps/getServerSideProps, https://nextjs.org/docs/messages/404-get-initial-props",M="pages with `getServerSideProps` can not be exported. See more info here: https://nextjs.org/docs/messages/gssp-export",D="Your `getStaticProps` function did not return an object. Did you forget to add a `return`?",V="Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?",R="The `unstable_revalidate` property is available for general use.\nPlease use `revalidate` instead.",j="can not be attached to a page's component and must be exported from the page. See more info here: https://nextjs.org/docs/messages/gssp-component-member",O='You are using a non-standard "NODE_ENV" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env',L="Pages with `fallback` enabled in `getStaticPaths` can not be exported. See more info here: https://nextjs.org/docs/messages/ssg-fallback-true-export",F=["app","pages","components","lib","src"],N=[{title:"Strict",recommended:!0,config:{extends:"next/core-web-vitals"}},{title:"Base",config:{extends:"next"}},{title:"Cancel",config:null}],z={edge:"edge",experimentalEdge:"experimental-edge",nodejs:"nodejs"},B={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",api:"api",middleware:"middleware",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",appMetadataRoute:"app-metadata-route",appRouteHandler:"app-route-handler"},U={...B,GROUP:{server:[B.reactServerComponents,B.actionBrowser,B.appMetadataRoute,B.appRouteHandler],nonClientServerTarget:[B.middleware,B.api],app:[B.reactServerComponents,B.actionBrowser,B.appMetadataRoute,B.appRouteHandler,B.serverSideRendering,B.appPagesBrowser]}},H={edgeSSREntry:"__next_edge_ssr_entry__",metadata:"__next_metadata__",metadataRoute:"__next_metadata_route__",metadataImageMeta:"__next_metadata_image_meta__"}},8531:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{fillMetadataSegment:function(){return fillMetadataSegment},normalizeMetadataRoute:function(){return normalizeMetadataRoute}});let n=r(2038),i=_interop_require_default(r(5585)),o=r(1239),a=r(4018),l=r(8043),d=r(1478),c=r(7819);function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function getMetadataRouteSuffix(e){let t="";return(e.includes("(")&&e.includes(")")||e.includes("@"))&&(t=(0,l.djb2Hash)(e).toString(36).slice(0,6)),t}function fillMetadataSegment(e,t,r){let n=(0,d.normalizeAppPath)(e),l=(0,a.getNamedRouteRegex)(n,!1),u=(0,o.interpolateDynamicPath)(n,t,l),p=getMetadataRouteSuffix(e),h=p?`-${p}`:"",{name:f,ext:g}=i.default.parse(r);return(0,c.normalizePathSep)(i.default.join(u,`${f}${h}${g}`))}function normalizeMetadataRoute(e){if(!(0,n.isMetadataRoute)(e))return e;let t=e,r="";if("/robots"===e)t+=".txt";else if("/manifest"===e)t+=".webmanifest";else if(e.endsWith("/sitemap"))t+=".xml";else{let t=e.slice(0,-(i.default.basename(e).length+1));r=getMetadataRouteSuffix(t)}if(!t.endsWith("/route")){let{dir:o,name:a,ext:l}=i.default.parse(t),d=(0,n.isStaticMetadataRoute)(e);t=i.default.posix.join(o,`${a}${r?`-${r}`:""}${l}`,d?"":"[[...__metadata_id__]]","route")}return t}},2038:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{STATIC_METADATA_IMAGES:function(){return i},isMetadataRouteFile:function(){return isMetadataRouteFile},isStaticMetadataRouteFile:function(){return isStaticMetadataRouteFile},isStaticMetadataRoute:function(){return isStaticMetadataRoute},isMetadataRoute:function(){return isMetadataRoute}});let n=r(7819),i={icon:{filename:"icon",extensions:["ico","jpg","jpeg","png","svg"]},apple:{filename:"apple-icon",extensions:["jpg","jpeg","png"]},favicon:{filename:"favicon",extensions:["ico"]},openGraph:{filename:"opengraph-image",extensions:["jpg","jpeg","png","gif"]},twitter:{filename:"twitter-image",extensions:["jpg","jpeg","png","gif"]}},o=["js","jsx","ts","tsx"],getExtensionRegexString=e=>`(?:${e.join("|")})`;function isMetadataRouteFile(e,t,r){let o=[RegExp(`^[\\\\/]robots${r?`\\.${getExtensionRegexString(t.concat("txt"))}$`:""}`),RegExp(`^[\\\\/]manifest${r?`\\.${getExtensionRegexString(t.concat("webmanifest","json"))}$`:""}`),RegExp("^[\\\\/]favicon\\.ico$"),RegExp(`[\\\\/]sitemap${r?`\\.${getExtensionRegexString(t.concat("xml"))}$`:""}`),RegExp(`[\\\\/]${i.icon.filename}\\d?${r?`\\.${getExtensionRegexString(t.concat(i.icon.extensions))}$`:""}`),RegExp(`[\\\\/]${i.apple.filename}\\d?${r?`\\.${getExtensionRegexString(t.concat(i.apple.extensions))}$`:""}`),RegExp(`[\\\\/]${i.openGraph.filename}\\d?${r?`\\.${getExtensionRegexString(t.concat(i.openGraph.extensions))}$`:""}`),RegExp(`[\\\\/]${i.twitter.filename}\\d?${r?`\\.${getExtensionRegexString(t.concat(i.twitter.extensions))}$`:""}`)],a=(0,n.normalizePathSep)(e);return o.some(e=>e.test(a))}function isStaticMetadataRouteFile(e){return isMetadataRouteFile(e,[],!0)}function isStaticMetadataRoute(e){return"/robots"===e||"/manifest"===e||isStaticMetadataRouteFile(e)}function isMetadataRoute(e){let t=e.replace(/^\/?app\//,"").replace(/\/route$/,"");return"/"!==t[0]&&(t="/"+t),!t.endsWith("/page")&&isMetadataRouteFile(t,o,!1)}},4427:(e,t,r)=>{"use strict";function getCookieParser(e){return function(){let{cookie:t}=e;if(!t)return{};let{parse:n}=r(8712);return n(Array.isArray(t)?t.join("; "):t)}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getCookieParser",{enumerable:!0,get:function(){return getCookieParser}})},7302:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{INTERCEPTION_ROUTE_MARKERS:function(){return i},isInterceptionRouteAppPath:function(){return isInterceptionRouteAppPath},extractInterceptionRouteInformation:function(){return extractInterceptionRouteInformation}});let n=r(1478),i=["(..)(..)","(.)","(..)","(...)"];function isInterceptionRouteAppPath(e){return void 0!==e.split("/").find(e=>i.find(t=>e.startsWith(t)))}function extractInterceptionRouteInformation(e){let t,r,o;for(let n of e.split("/"))if(r=i.find(e=>n.startsWith(e))){[t,o]=e.split(r,2);break}if(!t||!r||!o)throw Error(`Invalid interception route: ${e}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`);switch(t=(0,n.normalizeAppPath)(t),r){case"(.)":o="/"===t?`/${o}`:t+"/"+o;break;case"(..)":if("/"===t)throw Error(`Invalid interception route: ${e}. Cannot use (..) marker at the root level, use (.) instead.`);o=t.split("/").slice(0,-1).concat(o).join("/");break;case"(...)":o="/"+o;break;case"(..)(..)":let a=t.split("/");if(a.length<=2)throw Error(`Invalid interception route: ${e}. Cannot use (..)(..) marker at the root level or one level up.`);o=a.slice(0,-2).concat(o).join("/");break;default:throw Error("Invariant: unexpected marker")}return{interceptingRoute:t,interceptedRoute:o}}},1239:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{normalizeVercelUrl:function(){return normalizeVercelUrl},interpolateDynamicPath:function(){return interpolateDynamicPath},getUtils:function(){return getUtils}});let n=r(7310),i=r(5259),o=r(9302),a=r(4018),l=r(4893),d=r(1731),c=r(4419),u=r(1478),p=r(9368);function normalizeVercelUrl(e,t,r,i,o){if(i&&t&&o){let t=(0,n.parse)(e.url,!0);for(let e of(delete t.search,Object.keys(t.query)))(e!==p.NEXT_QUERY_PARAM_PREFIX&&e.startsWith(p.NEXT_QUERY_PARAM_PREFIX)||(r||Object.keys(o.groups)).includes(e))&&delete t.query[e];e.url=(0,n.format)(t)}}function interpolateDynamicPath(e,t,r){if(!r)return e;for(let n of Object.keys(r.groups)){let{optional:i,repeat:o}=r.groups[n],a=`[${o?"...":""}${n}]`;i&&(a=`[${a}]`);let l=e.indexOf(a);if(l>-1){let r;let i=t[n];r=Array.isArray(i)?i.map(e=>e&&encodeURIComponent(e)).join("/"):i?encodeURIComponent(i):"",e=e.slice(0,l)+r+e.slice(l+a.length)}}return e}function getUtils({page:e,i18n:t,basePath:r,rewrites:n,pageIsDynamic:h,trailingSlash:f,caseSensitive:g}){let m,y,b;function getParamsFromRouteMatches(e,r,n){return(0,l.getRouteMatcher)(function(){let{groups:e,routeKeys:i}=m;return{re:{exec:o=>{let a=Object.fromEntries(new URLSearchParams(o)),l=t&&n&&a["1"]===n;for(let e of Object.keys(a)){let t=a[e];if(e!==p.NEXT_QUERY_PARAM_PREFIX&&e.startsWith(p.NEXT_QUERY_PARAM_PREFIX)){let r=e.substring(p.NEXT_QUERY_PARAM_PREFIX.length);a[r]=t,delete a[e]}}let d=Object.keys(i||{}),filterLocaleItem=e=>{if(t){let i=Array.isArray(e),o=i?e[0]:e;if("string"==typeof o&&t.locales.some(e=>e.toLowerCase()===o.toLowerCase()&&(n=e,r.locale=n,!0)))return i&&e.splice(0,1),!i||0===e.length}return!1};return d.every(e=>a[e])?d.reduce((t,r)=>{let n=null==i?void 0:i[r];return n&&!filterLocaleItem(a[r])&&(t[e[n].pos]=a[r]),t},{}):Object.keys(a).reduce((e,t)=>{if(!filterLocaleItem(a[t])){let r=t;return l&&(r=parseInt(t,10)-1+""),Object.assign(e,{[r]:a[t]})}return e},{})}},groups:e}}())(e.headers["x-now-route-matches"])}function normalizeDynamicRouteParams(e,t){let r=!0;return m?{params:e=Object.keys(m.groups).reduce((n,i)=>{let o=e[i];"string"==typeof o&&(o=(0,u.normalizeRscURL)(o)),Array.isArray(o)&&(o=o.map(e=>("string"==typeof e&&(e=(0,u.normalizeRscURL)(e)),e)));let a=b[i],l=m.groups[i].optional,d=Array.isArray(a)?a.some(e=>Array.isArray(o)?o.some(t=>t.includes(e)):null==o?void 0:o.includes(e)):null==o?void 0:o.includes(a);return(d||void 0===o&&!(l&&t))&&(r=!1),l&&(!o||Array.isArray(o)&&1===o.length&&("index"===o[0]||o[0]===`[[...${i}]]`))&&(o=void 0,delete e[i]),o&&"string"==typeof o&&m.groups[i].repeat&&(o=o.split("/")),o&&(n[i]=o),n},{}),hasValidParams:r}:{params:e,hasValidParams:!1}}return h&&(m=(0,a.getNamedRouteRegex)(e,!1),b=(y=(0,l.getRouteMatcher)(m))(e)),{handleRewrites:function(a,l){let u={},p=l.pathname,checkRewrite=n=>{let c=(0,o.getPathMatch)(n.source+(f?"(/)?":""),{removeUnnamedParams:!0,strict:!0,sensitive:!!g}),m=c(l.pathname);if((n.has||n.missing)&&m){let e=(0,d.matchHas)(a,l.query,n.has,n.missing);e?Object.assign(m,e):m=!1}if(m){let{parsedDestination:o,destQuery:a}=(0,d.prepareDestination)({appendParamsToQuery:!0,destination:n.destination,params:m,query:l.query});if(o.protocol)return!0;if(Object.assign(u,a,m),Object.assign(l.query,o.query),delete o.query,Object.assign(l,o),p=l.pathname,r&&(p=p.replace(RegExp(`^${r}`),"")||"/"),t){let e=(0,i.normalizeLocalePath)(p,t.locales);p=e.pathname,l.query.nextInternalLocale=e.detectedLocale||m.nextInternalLocale}if(p===e)return!0;if(h&&y){let e=y(p);if(e)return l.query={...l.query,...e},!0}}return!1};for(let e of n.beforeFiles||[])checkRewrite(e);if(p!==e){let t=!1;for(let e of n.afterFiles||[])if(t=checkRewrite(e))break;if(!t&&!(()=>{let t=(0,c.removeTrailingSlash)(p||"");return t===(0,c.removeTrailingSlash)(e)||(null==y?void 0:y(t))})()){for(let e of n.fallback||[])if(t=checkRewrite(e))break}}return u},defaultRouteRegex:m,dynamicRouteMatcher:y,defaultRouteMatches:b,getParamsFromRouteMatches,normalizeDynamicRouteParams,normalizeVercelUrl:(e,t,r)=>normalizeVercelUrl(e,t,r,h,m),interpolateDynamicPath:(e,t)=>interpolateDynamicPath(e,t,m)}}},9789:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"escapeStringRegexp",{enumerable:!0,get:function(){return escapeStringRegexp}});let r=/[|\\{}()[\]^$+*?.-]/,n=/[|\\{}()[\]^$+*?.-]/g;function escapeStringRegexp(e){return r.test(e)?e.replace(n,"\\$&"):e}},8043:(e,t)=>{"use strict";function djb2Hash(e){let t=5381;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);t=(t<<5)+t+n}return Math.abs(t)}function hexHash(e){return djb2Hash(e).toString(36).slice(0,5)}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{djb2Hash:function(){return djb2Hash},hexHash:function(){return hexHash}})},5259:(e,t)=>{"use strict";function normalizeLocalePath(e,t){let r;let n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return normalizeLocalePath}})},5585:(e,t,r)=>{"use strict";let n;n=r(1017),e.exports=n},9701:(e,t)=>{"use strict";function ensureLeadingSlash(e){return e.startsWith("/")?e:"/"+e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureLeadingSlash",{enumerable:!0,get:function(){return ensureLeadingSlash}})},7819:(e,t)=>{"use strict";function normalizePathSep(e){return e.replace(/\\/g,"/")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizePathSep",{enumerable:!0,get:function(){return normalizePathSep}})},1478:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{normalizeAppPath:function(){return normalizeAppPath},normalizeRscURL:function(){return normalizeRscURL},normalizePostponedURL:function(){return normalizePostponedURL}});let n=r(9701),i=r(2219);function normalizeAppPath(e){return(0,n.ensureLeadingSlash)(e.split("/").reduce((e,t,r,n)=>!t||(0,i.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:e+"/"+t,""))}function normalizeRscURL(e){return e.replace(/\.rsc($|\?)/,"$1")}function normalizePostponedURL(e){let t=new URL(e),{pathname:r}=t;return r&&r.startsWith("/_next/postponed")?(t.pathname=r.substring(16)||"/",t.toString()):e}},129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parseRelativeUrl",{enumerable:!0,get:function(){return parseRelativeUrl}}),r(351);let n=r(6024);function parseRelativeUrl(e,t){let r=new URL("http://n"),i=t?new URL(t,r):e.startsWith(".")?new URL("http://n"):r,{pathname:o,searchParams:a,search:l,hash:d,href:c,origin:u}=new URL(e,i);if(u!==r.origin)throw Error("invariant: invalid relative URL, router received "+e);return{pathname:o,query:(0,n.searchParamsToUrlQuery)(a),search:l,hash:d,href:c.slice(r.origin.length)}}},6940:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parseUrl",{enumerable:!0,get:function(){return parseUrl}});let n=r(6024),i=r(129);function parseUrl(e){if(e.startsWith("/"))return(0,i.parseRelativeUrl)(e);let t=new URL(e);return{hash:t.hash,hostname:t.hostname,href:t.href,pathname:t.pathname,port:t.port,protocol:t.protocol,query:(0,n.searchParamsToUrlQuery)(t.searchParams),search:t.search}}},9302:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getPathMatch",{enumerable:!0,get:function(){return getPathMatch}});let n=r(9481);function getPathMatch(e,t){let r=[],i=(0,n.pathToRegexp)(e,r,{delimiter:"/",sensitive:"boolean"==typeof(null==t?void 0:t.sensitive)&&t.sensitive,strict:null==t?void 0:t.strict}),o=(0,n.regexpToFunction)((null==t?void 0:t.regexModifier)?new RegExp(t.regexModifier(i.source),i.flags):i,r);return(e,n)=>{if("string"!=typeof e)return!1;let i=o(e);if(!i)return!1;if(null==t?void 0:t.removeUnnamedParams)for(let e of r)"number"==typeof e.name&&delete i.params[e.name];return{...n,...i.params}}}},1731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{matchHas:function(){return matchHas},compileNonPath:function(){return compileNonPath},prepareDestination:function(){return prepareDestination}});let n=r(9481),i=r(9789),o=r(6940),a=r(7302),l=r(9001),d=r(4427);function getSafeParamName(e){let t="";for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);(n>64&&n<91||n>96&&n<123)&&(t+=e[r])}return t}function escapeSegment(e,t){return e.replace(RegExp(":"+(0,i.escapeStringRegexp)(t),"g"),"__ESC_COLON_"+t)}function unescapeSegments(e){return e.replace(/__ESC_COLON_/gi,":")}function matchHas(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=[]);let i={},hasMatch=r=>{let n;let o=r.key;switch(r.type){case"header":o=o.toLowerCase(),n=e.headers[o];break;case"cookie":if("cookies"in e)n=e.cookies[r.key];else{let t=(0,d.getCookieParser)(e.headers)();n=t[r.key]}break;case"query":n=t[o];break;case"host":{let{host:t}=(null==e?void 0:e.headers)||{},r=null==t?void 0:t.split(":",1)[0].toLowerCase();n=r}}if(!r.value&&n)return i[getSafeParamName(o)]=n,!0;if(n){let e=RegExp("^"+r.value+"$"),t=Array.isArray(n)?n.slice(-1)[0].match(e):n.match(e);if(t)return Array.isArray(t)&&(t.groups?Object.keys(t.groups).forEach(e=>{i[e]=t.groups[e]}):"host"===r.type&&t[0]&&(i.host=t[0])),!0}return!1},o=r.every(e=>hasMatch(e))&&!n.some(e=>hasMatch(e));return!!o&&i}function compileNonPath(e,t){if(!e.includes(":"))return e;for(let r of Object.keys(t))e.includes(":"+r)&&(e=e.replace(RegExp(":"+r+"\\*","g"),":"+r+"--ESCAPED_PARAM_ASTERISKS").replace(RegExp(":"+r+"\\?","g"),":"+r+"--ESCAPED_PARAM_QUESTION").replace(RegExp(":"+r+"\\+","g"),":"+r+"--ESCAPED_PARAM_PLUS").replace(RegExp(":"+r+"(?!\\w)","g"),"--ESCAPED_PARAM_COLON"+r));return e=e.replace(/(:|\*|\?|\+|\(|\)|\{|\})/g,"\\$1").replace(/--ESCAPED_PARAM_PLUS/g,"+").replace(/--ESCAPED_PARAM_COLON/g,":").replace(/--ESCAPED_PARAM_QUESTION/g,"?").replace(/--ESCAPED_PARAM_ASTERISKS/g,"*"),(0,n.compile)("/"+e,{validate:!1})(t).slice(1)}function prepareDestination(e){let t;let r=Object.assign({},e.query);delete r.__nextLocale,delete r.__nextDefaultLocale,delete r.__nextDataReq,delete r.__nextInferredLocaleFromDefault,delete r[l.NEXT_RSC_UNION_QUERY];let i=e.destination;for(let t of Object.keys({...e.params,...r}))i=escapeSegment(i,t);let d=(0,o.parseUrl)(i),c=d.query,u=unescapeSegments(""+d.pathname+(d.hash||"")),p=unescapeSegments(d.hostname||""),h=[],f=[];(0,n.pathToRegexp)(u,h),(0,n.pathToRegexp)(p,f);let g=[];h.forEach(e=>g.push(e.name)),f.forEach(e=>g.push(e.name));let m=(0,n.compile)(u,{validate:!1}),y=(0,n.compile)(p,{validate:!1});for(let[t,r]of Object.entries(c))Array.isArray(r)?c[t]=r.map(t=>compileNonPath(unescapeSegments(t),e.params)):"string"==typeof r&&(c[t]=compileNonPath(unescapeSegments(r),e.params));let b=Object.keys(e.params).filter(e=>"nextInternalLocale"!==e);if(e.appendParamsToQuery&&!b.some(e=>g.includes(e)))for(let t of b)t in c||(c[t]=e.params[t]);if((0,a.isInterceptionRouteAppPath)(u))for(let t of u.split("/")){let r=a.INTERCEPTION_ROUTE_MARKERS.find(e=>t.startsWith(e));if(r){e.params["0"]=r;break}}try{t=m(e.params);let[r,n]=t.split("#",2);d.hostname=y(e.params),d.pathname=r,d.hash=(n?"#":"")+(n||""),delete d.search}catch(e){if(e.message.match(/Expected .*? to not repeat, but got an array/))throw Error("To use a multi-match in the destination you must add `*` at the end of the param name to signify it should repeat. https://nextjs.org/docs/messages/invalid-multi-match");throw e}return d.query={...r,...d.query},{newUrl:t,destQuery:c,parsedDestination:d}}},6024:(e,t)=>{"use strict";function searchParamsToUrlQuery(e){let t={};return e.forEach((e,r)=>{void 0===t[r]?t[r]=e:Array.isArray(t[r])?t[r].push(e):t[r]=[t[r],e]}),t}function stringifyUrlQueryParam(e){return"string"!=typeof e&&("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function urlQueryToSearchParams(e){let t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[r,n]=e;Array.isArray(n)?n.forEach(e=>t.append(r,stringifyUrlQueryParam(e))):t.set(r,stringifyUrlQueryParam(n))}),t}function assign(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.forEach(t=>{Array.from(t.keys()).forEach(t=>e.delete(t)),t.forEach((t,r)=>e.append(r,t))}),e}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{searchParamsToUrlQuery:function(){return searchParamsToUrlQuery},urlQueryToSearchParams:function(){return urlQueryToSearchParams},assign:function(){return assign}})},4419:(e,t)=>{"use strict";function removeTrailingSlash(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return removeTrailingSlash}})},4893:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getRouteMatcher",{enumerable:!0,get:function(){return getRouteMatcher}});let n=r(351);function getRouteMatcher(e){let{re:t,groups:r}=e;return e=>{let i=t.exec(e);if(!i)return!1;let decode=e=>{try{return decodeURIComponent(e)}catch(e){throw new n.DecodeError("failed to decode param")}},o={};return Object.keys(r).forEach(e=>{let t=r[e],n=i[t.pos];void 0!==n&&(o[e]=~n.indexOf("/")?n.split("/").map(e=>decode(e)):t.repeat?[decode(n)]:decode(n))}),o}}},4018:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{getRouteRegex:function(){return getRouteRegex},getNamedRouteRegex:function(){return getNamedRouteRegex},getNamedMiddlewareRegex:function(){return getNamedMiddlewareRegex}});let n=r(7302),i=r(9789),o=r(4419);function parseParameter(e){let t=e.startsWith("[")&&e.endsWith("]");t&&(e=e.slice(1,-1));let r=e.startsWith("...");return r&&(e=e.slice(3)),{key:e,repeat:r,optional:t}}function getParametrizedRoute(e){let t=(0,o.removeTrailingSlash)(e).slice(1).split("/"),r={},a=1;return{parameterizedRoute:t.map(e=>{let t=n.INTERCEPTION_ROUTE_MARKERS.find(t=>e.startsWith(t)),o=e.match(/\[((?:\[.*\])|.+)\]/);if(t&&o){let{key:e,optional:n,repeat:l}=parseParameter(o[1]);return r[e]={pos:a++,repeat:l,optional:n},"/"+(0,i.escapeStringRegexp)(t)+"([^/]+?)"}if(!o)return"/"+(0,i.escapeStringRegexp)(e);{let{key:e,repeat:t,optional:n}=parseParameter(o[1]);return r[e]={pos:a++,repeat:t,optional:n},t?n?"(?:/(.+?))?":"/(.+?)":"/([^/]+?)"}}).join(""),groups:r}}function getRouteRegex(e){let{parameterizedRoute:t,groups:r}=getParametrizedRoute(e);return{re:RegExp("^"+t+"(?:/)?$"),groups:r}}function buildGetSafeRouteKey(){let e=0;return()=>{let t="",r=++e;for(;r>0;)t+=String.fromCharCode(97+(r-1)%26),r=Math.floor((r-1)/26);return t}}function getSafeKeyFromSegment(e){let{getSafeRouteKey:t,segment:r,routeKeys:n,keyPrefix:i}=e,{key:o,optional:a,repeat:l}=parseParameter(r),d=o.replace(/\W/g,"");i&&(d=""+i+d);let c=!1;return(0===d.length||d.length>30)&&(c=!0),isNaN(parseInt(d.slice(0,1)))||(c=!0),c&&(d=t()),i?n[d]=""+i+o:n[d]=""+o,l?a?"(?:/(?<"+d+">.+?))?":"/(?<"+d+">.+?)":"/(?<"+d+">[^/]+?)"}function getNamedParametrizedRoute(e,t){let r=(0,o.removeTrailingSlash)(e).slice(1).split("/"),a=buildGetSafeRouteKey(),l={};return{namedParameterizedRoute:r.map(e=>{let r=n.INTERCEPTION_ROUTE_MARKERS.some(t=>e.startsWith(t)),o=e.match(/\[((?:\[.*\])|.+)\]/);return r&&o?getSafeKeyFromSegment({getSafeRouteKey:a,segment:o[1],routeKeys:l,keyPrefix:t?"nxtI":void 0}):o?getSafeKeyFromSegment({getSafeRouteKey:a,segment:o[1],routeKeys:l,keyPrefix:t?"nxtP":void 0}):"/"+(0,i.escapeStringRegexp)(e)}).join(""),routeKeys:l}}function getNamedRouteRegex(e,t){let r=getNamedParametrizedRoute(e,t);return{...getRouteRegex(e),namedRegex:"^"+r.namedParameterizedRoute+"(?:/)?$",routeKeys:r.routeKeys}}function getNamedMiddlewareRegex(e,t){let{parameterizedRoute:r}=getParametrizedRoute(e),{catchAll:n=!0}=t;if("/"===r)return{namedRegex:"^/"+(n?".*":"")+"$"};let{namedParameterizedRoute:i}=getNamedParametrizedRoute(e,!1);return{namedRegex:"^"+i+(n?"(?:(/.*)?)":"")+"$"}}},2219:(e,t)=>{"use strict";function isGroupSegment(e){return"("===e[0]&&e.endsWith(")")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isGroupSegment",{enumerable:!0,get:function(){return isGroupSegment}})},351:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{WEB_VITALS:function(){return r},execOnce:function(){return execOnce},isAbsoluteUrl:function(){return isAbsoluteUrl},getLocationOrigin:function(){return getLocationOrigin},getURL:function(){return getURL},getDisplayName:function(){return getDisplayName},isResSent:function(){return isResSent},normalizeRepeatedSlashes:function(){return normalizeRepeatedSlashes},loadGetInitialProps:function(){return loadGetInitialProps},SP:function(){return i},ST:function(){return o},DecodeError:function(){return DecodeError},NormalizeError:function(){return NormalizeError},PageNotFoundError:function(){return PageNotFoundError},MissingStaticPage:function(){return MissingStaticPage},MiddlewareNotFoundError:function(){return MiddlewareNotFoundError},stringifyError:function(){return stringifyError}});let r=["CLS","FCP","FID","INP","LCP","TTFB"];function execOnce(e){let t,r=!1;return function(){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];return r||(r=!0,t=e(...i)),t}}let n=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,isAbsoluteUrl=e=>n.test(e);function getLocationOrigin(){let{protocol:e,hostname:t,port:r}=window.location;return e+"//"+t+(r?":"+r:"")}function getURL(){let{href:e}=window.location,t=getLocationOrigin();return e.substring(t.length)}function getDisplayName(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function isResSent(e){return e.finished||e.headersSent}function normalizeRepeatedSlashes(e){let t=e.split("?"),r=t[0];return r.replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?"?"+t.slice(1).join("?"):"")}async function loadGetInitialProps(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await loadGetInitialProps(t.Component,t.ctx)}:{};let n=await e.getInitialProps(t);if(r&&isResSent(r))return n;if(!n){let t='"'+getDisplayName(e)+'.getInitialProps()" should resolve to an object. But found "'+n+'" instead.';throw Error(t)}return n}let i="undefined"!=typeof performance,o=i&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);let DecodeError=class DecodeError extends Error{};let NormalizeError=class NormalizeError extends Error{};let PageNotFoundError=class PageNotFoundError extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message="Cannot find module for page: "+e}};let MissingStaticPage=class MissingStaticPage extends Error{constructor(e,t){super(),this.message="Failed to load static file for page: "+e+" "+t}};let MiddlewareNotFoundError=class MiddlewareNotFoundError extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}};function stringifyError(e){return JSON.stringify({message:e.message,stack:e.stack})}},8582:()=>{},4105:()=>{},784:(e,t,r)=>{"use strict";e.exports=r(316).vendored["react-ssr"].ReactJsxRuntime},5497:()=>{!function(e){var t=/\/(?![/*])|\/\/.*[\r\n]|\/\*[^*]*(?:\*(?!\/)[^*]*)*\*\//.source,r=/@(?!")|"(?:[^\r\n\\"]|\\.)*"|@"(?:[^\\"]|""|\\[\s\S])*"(?!")/.source+"|"+/'(?:(?:[^\r\n'\\]|\\.|\\[Uux][\da-fA-F]{1,8})'|(?=[^\\](?!')))/.source;function nested(e,n){for(var i=0;i<n;i++)e=e.replace(/<self>/g,function(){return"(?:"+e+")"});return e.replace(/<self>/g,"[^\\s\\S]").replace(/<str>/g,"(?:"+r+")").replace(/<comment>/g,"(?:"+t+")")}var n=nested(/\((?:[^()'"@/]|<str>|<comment>|<self>)*\)/.source,2),i=nested(/\[(?:[^\[\]'"@/]|<str>|<comment>|<self>)*\]/.source,1),o=nested(/\{(?:[^{}'"@/]|<str>|<comment>|<self>)*\}/.source,2),a=nested(/<(?:[^<>'"@/]|<comment>|<self>)*>/.source,1),l=/@/.source+/(?:await\b\s*)?/.source+"(?:"+/(?!await\b)\w+\b/.source+"|"+n+")(?:"+/[?!]?\.\w+\b/.source+"|(?:"+a+")?"+n+"|"+i+")*"+/(?![?!\.(\[]|<(?!\/))/.source,d=/@(?![\w()])/.source+"|"+l,c="(?:"+/"[^"@]*"|'[^'@]*'|[^\s'"@>=]+(?=[\s>])/.source+"|[\"'][^\"'@]*(?:(?:"+d+")[^\"'@]*)+[\"'])",u=/(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*<tagAttrValue>|(?=[\s/>])))+)?/.source.replace(/<tagAttrValue>/,c),p=/(?!\d)[^\s>\/=$<%]+/.source+u+/\s*\/?>/.source,h=/\B@?/.source+"(?:"+/<([a-zA-Z][\w:]*)/.source+u+/\s*>/.source+"(?:"+(/[^<]/.source+"|"+/<\/?(?!\1\b)/.source)+p+"|"+nested(/<\1/.source+u+/\s*>/.source+"(?:"+(/[^<]/.source+"|")+/<\/?(?!\1\b)/.source+p+"|<self>)*"+/<\/\1\s*>/.source,2)+")*"+/<\/\1\s*>/.source+"|"+/</.source+p+")";e.languages.cshtml=e.languages.extend("markup",{});var f={pattern:/\S[\s\S]*/,alias:"language-csharp",inside:e.languages.insertBefore("csharp","string",{html:{pattern:RegExp(h),greedy:!0,inside:e.languages.cshtml}},{csharp:e.languages.extend("csharp",{})})},g={pattern:RegExp(/(^|[^@])/.source+l),lookbehind:!0,greedy:!0,alias:"variable",inside:{keyword:/^@/,csharp:f}};e.languages.cshtml.tag.pattern=RegExp(/<\/?/.source+p),e.languages.cshtml.tag.inside["attr-value"].pattern=RegExp(/=\s*/.source+c),e.languages.insertBefore("inside","punctuation",{value:g},e.languages.cshtml.tag.inside["attr-value"]),e.languages.insertBefore("cshtml","prolog",{"razor-comment":{pattern:/@\*[\s\S]*?\*@/,greedy:!0,alias:"comment"},block:{pattern:RegExp(/(^|[^@])@/.source+"(?:"+[o,/(?:code|functions)\s*/.source+o,/(?:for|foreach|lock|switch|using|while)\s*/.source+n+/\s*/.source+o,/do\s*/.source+o+/\s*while\s*/.source+n+/(?:\s*;)?/.source,/try\s*/.source+o+/\s*catch\s*/.source+n+/\s*/.source+o+/\s*finally\s*/.source+o,/if\s*/.source+n+/\s*/.source+o+"(?:"+/\s*else/.source+"(?:"+/\s+if\s*/.source+n+")?"+/\s*/.source+o+")*",/helper\s+\w+\s*/.source+n+/\s*/.source+o].join("|")+")"),lookbehind:!0,greedy:!0,inside:{keyword:/^@\w*/,csharp:f}},directive:{pattern:/^([ \t]*)@(?:addTagHelper|attribute|implements|inherits|inject|layout|model|namespace|page|preservewhitespace|removeTagHelper|section|tagHelperPrefix|using)(?=\s).*/m,lookbehind:!0,greedy:!0,inside:{keyword:/^@\w+/,csharp:f}},value:g,"delegate-operator":{pattern:/(^|[^@])@(?=<)/,lookbehind:!0,alias:"operator"}}),e.languages.razor=e.languages.cshtml}(Prism)},8713:e=>{/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var t=function(e){var t=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,r=0,n={},i={manual:e.Prism&&e.Prism.manual,disableWorkerMessageHandler:e.Prism&&e.Prism.disableWorkerMessageHandler,util:{encode:function encode(e){return e instanceof Token?new Token(e.type,encode(e.content),e.alias):Array.isArray(e)?e.map(encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++r}),e.__id},clone:function deepClone(e,t){var r,n;switch(t=t||{},i.util.type(e)){case"Object":if(t[n=i.util.objId(e)])return t[n];for(var o in r={},t[n]=r,e)e.hasOwnProperty(o)&&(r[o]=deepClone(e[o],t));return r;case"Array":if(t[n=i.util.objId(e)])return t[n];return r=[],t[n]=r,e.forEach(function(e,n){r[n]=deepClone(e,t)}),r;default:return e}},getLanguage:function(e){for(;e;){var r=t.exec(e.className);if(r)return r[1].toLowerCase();e=e.parentElement}return"none"},setLanguage:function(e,r){e.className=e.className.replace(RegExp(t,"gi"),""),e.classList.add("language-"+r)},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw Error()}catch(n){var e=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(n.stack)||[])[1];if(e){var t=document.getElementsByTagName("script");for(var r in t)if(t[r].src==e)return t[r]}return null}},isActive:function(e,t,r){for(var n="no-"+t;e;){var i=e.classList;if(i.contains(t))return!0;if(i.contains(n))return!1;e=e.parentElement}return!!r}},languages:{plain:n,plaintext:n,text:n,txt:n,extend:function(e,t){var r=i.util.clone(i.languages[e]);for(var n in t)r[n]=t[n];return r},insertBefore:function(e,t,r,n){var o=(n=n||i.languages)[e],a={};for(var l in o)if(o.hasOwnProperty(l)){if(l==t)for(var d in r)r.hasOwnProperty(d)&&(a[d]=r[d]);r.hasOwnProperty(l)||(a[l]=o[l])}var c=n[e];return n[e]=a,i.languages.DFS(i.languages,function(t,r){r===c&&t!=e&&(this[t]=a)}),a},DFS:function DFS(e,t,r,n){n=n||{};var o=i.util.objId;for(var a in e)if(e.hasOwnProperty(a)){t.call(e,a,e[a],r||a);var l=e[a],d=i.util.type(l);"Object"!==d||n[o(l)]?"Array"!==d||n[o(l)]||(n[o(l)]=!0,DFS(l,t,a,n)):(n[o(l)]=!0,DFS(l,t,null,n))}}},plugins:{},highlightAll:function(e,t){i.highlightAllUnder(document,e,t)},highlightAllUnder:function(e,t,r){var n={callback:r,container:e,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};i.hooks.run("before-highlightall",n),n.elements=Array.prototype.slice.apply(n.container.querySelectorAll(n.selector)),i.hooks.run("before-all-elements-highlight",n);for(var o,a=0;o=n.elements[a++];)i.highlightElement(o,!0===t,n.callback)},highlightElement:function(t,r,n){var o=i.util.getLanguage(t),a=i.languages[o];i.util.setLanguage(t,o);var l=t.parentElement;l&&"pre"===l.nodeName.toLowerCase()&&i.util.setLanguage(l,o);var d=t.textContent,c={element:t,language:o,grammar:a,code:d};function insertHighlightedCode(e){c.highlightedCode=e,i.hooks.run("before-insert",c),c.element.innerHTML=c.highlightedCode,i.hooks.run("after-highlight",c),i.hooks.run("complete",c),n&&n.call(c.element)}if(i.hooks.run("before-sanity-check",c),(l=c.element.parentElement)&&"pre"===l.nodeName.toLowerCase()&&!l.hasAttribute("tabindex")&&l.setAttribute("tabindex","0"),!c.code){i.hooks.run("complete",c),n&&n.call(c.element);return}if(i.hooks.run("before-highlight",c),!c.grammar){insertHighlightedCode(i.util.encode(c.code));return}if(r&&e.Worker){var u=new Worker(i.filename);u.onmessage=function(e){insertHighlightedCode(e.data)},u.postMessage(JSON.stringify({language:c.language,code:c.code,immediateClose:!0}))}else insertHighlightedCode(i.highlight(c.code,c.grammar,c.language))},highlight:function(e,t,r){var n={code:e,grammar:t,language:r};if(i.hooks.run("before-tokenize",n),!n.grammar)throw Error('The language "'+n.language+'" has no grammar.');return n.tokens=i.tokenize(n.code,n.grammar),i.hooks.run("after-tokenize",n),Token.stringify(i.util.encode(n.tokens),n.language)},tokenize:function(e,t){var r=t.rest;if(r){for(var n in r)t[n]=r[n];delete t.rest}var i=new LinkedList;return addAfter(i,i.head,e),matchGrammar(e,i,t,i.head,0),toArray(i)},hooks:{all:{},add:function(e,t){var r=i.hooks.all;r[e]=r[e]||[],r[e].push(t)},run:function(e,t){var r=i.hooks.all[e];if(r&&r.length)for(var n,o=0;n=r[o++];)n(t)}},Token:Token};function Token(e,t,r,n){this.type=e,this.content=t,this.alias=r,this.length=0|(n||"").length}function matchPattern(e,t,r,n){e.lastIndex=t;var i=e.exec(r);if(i&&n&&i[1]){var o=i[1].length;i.index+=o,i[0]=i[0].slice(o)}return i}function matchGrammar(e,t,r,n,o,a){for(var l in r)if(r.hasOwnProperty(l)&&r[l]){var d=r[l];d=Array.isArray(d)?d:[d];for(var c=0;c<d.length;++c){if(a&&a.cause==l+","+c)return;var u=d[c],p=u.inside,h=!!u.lookbehind,f=!!u.greedy,g=u.alias;if(f&&!u.pattern.global){var m=u.pattern.toString().match(/[imsuy]*$/)[0];u.pattern=RegExp(u.pattern.source,m+"g")}for(var y=u.pattern||u,b=n.next,v=o;b!==t.tail&&(!a||!(v>=a.reach));v+=b.value.length,b=b.next){var S,x=b.value;if(t.length>e.length)return;if(!(x instanceof Token)){var w=1;if(f){if(!(S=matchPattern(y,v,e,h))||S.index>=e.length)break;var _=S.index,P=S.index+S[0].length,E=v;for(E+=b.value.length;_>=E;)E+=(b=b.next).value.length;if(E-=b.value.length,v=E,b.value instanceof Token)continue;for(var C=b;C!==t.tail&&(E<P||"string"==typeof C.value);C=C.next)w++,E+=C.value.length;w--,x=e.slice(v,E),S.index-=v}else if(!(S=matchPattern(y,0,x,h)))continue;var _=S.index,k=S[0],I=x.slice(0,_),T=x.slice(_+k.length),A=v+x.length;a&&A>a.reach&&(a.reach=A);var $=b.prev;if(I&&($=addAfter(t,$,I),v+=I.length),removeRange(t,$,w),b=addAfter(t,$,new Token(l,p?i.tokenize(k,p):k,g,k)),T&&addAfter(t,b,T),w>1){var M={cause:l+","+c,reach:A};matchGrammar(e,t,r,b.prev,v,M),a&&M.reach>a.reach&&(a.reach=M.reach)}}}}}}function LinkedList(){var e={value:null,prev:null,next:null},t={value:null,prev:e,next:null};e.next=t,this.head=e,this.tail=t,this.length=0}function addAfter(e,t,r){var n=t.next,i={value:r,prev:t,next:n};return t.next=i,n.prev=i,e.length++,i}function removeRange(e,t,r){for(var n=t.next,i=0;i<r&&n!==e.tail;i++)n=n.next;t.next=n,n.prev=t,e.length-=i}function toArray(e){for(var t=[],r=e.head.next;r!==e.tail;)t.push(r.value),r=r.next;return t}if(e.Prism=i,Token.stringify=function stringify(e,t){if("string"==typeof e)return e;if(Array.isArray(e)){var r="";return e.forEach(function(e){r+=stringify(e,t)}),r}var n={type:e.type,content:stringify(e.content,t),tag:"span",classes:["token",e.type],attributes:{},language:t},o=e.alias;o&&(Array.isArray(o)?Array.prototype.push.apply(n.classes,o):n.classes.push(o)),i.hooks.run("wrap",n);var a="";for(var l in n.attributes)a+=" "+l+'="'+(n.attributes[l]||"").replace(/"/g,"&quot;")+'"';return"<"+n.tag+' class="'+n.classes.join(" ")+'"'+a+">"+n.content+"</"+n.tag+">"},!e.document)return e.addEventListener&&(i.disableWorkerMessageHandler||e.addEventListener("message",function(t){var r=JSON.parse(t.data),n=r.language,o=r.code,a=r.immediateClose;e.postMessage(i.highlight(o,i.languages[n],n)),a&&e.close()},!1)),i;var o=i.util.currentScript();function highlightAutomaticallyCallback(){i.manual||i.highlightAll()}if(o&&(i.filename=o.src,o.hasAttribute("data-manual")&&(i.manual=!0)),!i.manual){var a=document.readyState;"loading"===a||"interactive"===a&&o&&o.defer?document.addEventListener("DOMContentLoaded",highlightAutomaticallyCallback):window.requestAnimationFrame?window.requestAnimationFrame(highlightAutomaticallyCallback):window.setTimeout(highlightAutomaticallyCallback,16)}return i}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{});e.exports&&(e.exports=t),"undefined"!=typeof global&&(global.Prism=t),t.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},t.languages.markup.tag.inside["attr-value"].inside.entity=t.languages.markup.entity,t.languages.markup.doctype.inside["internal-subset"].inside=t.languages.markup,t.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),Object.defineProperty(t.languages.markup.tag,"addInlined",{value:function(e,r){var n={};n["language-"+r]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:t.languages[r]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};i["language-"+r]={pattern:/[\s\S]+/,inside:t.languages[r]};var o={};o[e]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return e}),"i"),lookbehind:!0,greedy:!0,inside:i},t.languages.insertBefore("markup","cdata",o)}}),Object.defineProperty(t.languages.markup.tag,"addAttribute",{value:function(e,r){t.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[r,"language-"+r],inside:t.languages[r]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),t.languages.html=t.languages.markup,t.languages.mathml=t.languages.markup,t.languages.svg=t.languages.markup,t.languages.xml=t.languages.extend("markup",{}),t.languages.ssml=t.languages.xml,t.languages.atom=t.languages.xml,t.languages.rss=t.languages.xml,function(e){var t=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;e.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+t.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+t.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+t.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+t.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:t,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},e.languages.css.atrule.inside.rest=e.languages.css;var r=e.languages.markup;r&&(r.tag.addInlined("style","css"),r.tag.addAttribute("style","css"))}(t),t.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},t.languages.javascript=t.languages.extend("clike",{"class-name":[t.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|")+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),t.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,t.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:t.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:t.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:t.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:t.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:t.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),t.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:t.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),t.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),t.languages.markup&&(t.languages.markup.tag.addInlined("script","javascript"),t.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),t.languages.js=t.languages.javascript,function(){if(void 0!==t&&"undefined"!=typeof document){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var e={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},r="data-src-status",n="loading",i="loaded",o="pre[data-src]:not(["+r+'="'+i+'"]):not(['+r+'="'+n+'"])';t.hooks.add("before-highlightall",function(e){e.selector+=", "+o}),t.hooks.add("before-sanity-check",function(a){var l=a.element;if(l.matches(o)){a.code="",l.setAttribute(r,n);var d=l.appendChild(document.createElement("CODE"));d.textContent="Loading…";var c=l.getAttribute("data-src"),u=a.language;if("none"===u){var p=(/\.(\w+)$/.exec(c)||[,"none"])[1];u=e[p]||p}t.util.setLanguage(d,u),t.util.setLanguage(l,u);var h=t.plugins.autoloader;h&&h.loadLanguages(u),loadFile(c,function(e){l.setAttribute(r,i);var n=parseRange(l.getAttribute("data-range"));if(n){var o=e.split(/\r\n?|\n/g),a=n[0],c=null==n[1]?o.length:n[1];a<0&&(a+=o.length),a=Math.max(0,Math.min(a-1,o.length)),c<0&&(c+=o.length),c=Math.max(0,Math.min(c,o.length)),e=o.slice(a,c).join("\n"),l.hasAttribute("data-start")||l.setAttribute("data-start",String(a+1))}d.textContent=e,t.highlightElement(d)},function(e){l.setAttribute(r,"failed"),d.textContent=e})}}),t.plugins.fileHighlight={highlight:function(e){for(var r,n=(e||document).querySelectorAll(o),i=0;r=n[i++];)t.highlightElement(r)}};var a=!1;t.fileHighlight=function(){a||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),a=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}}function loadFile(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4==n.readyState&&(n.status<400&&n.responseText?t(n.responseText):n.status>=400?r("✖ Error "+n.status+" while fetching file: "+n.statusText):r("✖ Error: File does not exist or is empty"))},n.send(null)}function parseRange(e){var t=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(e||"");if(t){var r=Number(t[1]),n=t[2],i=t[3];return n?i?[r,Number(i)]:[r,void 0]:[r,r]}}}()},4626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveScrollBar=void 0;var n=r(2838).__importStar(r(9885)),i=r(7034),o=r(9461),a=r(2989),l=(0,i.styleSingleton)(),getStyles=function(e,t,r,n){var i=e.left,a=e.top,l=e.right,d=e.gap;return void 0===r&&(r="margin"),"\n  .".concat(o.noScrollbarsClassName," {\n   overflow: hidden ").concat(n,";\n   padding-right: ").concat(d,"px ").concat(n,";\n  }\n  body {\n    overflow: hidden ").concat(n,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(n,";"),"margin"===r&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(a,"px;\n    padding-right: ").concat(l,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(d,"px ").concat(n,";\n    "),"padding"===r&&"padding-right: ".concat(d,"px ").concat(n,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(o.zeroRightClassName," {\n    right: ").concat(d,"px ").concat(n,";\n  }\n  \n  .").concat(o.fullWidthClassName," {\n    margin-right: ").concat(d,"px ").concat(n,";\n  }\n  \n  .").concat(o.zeroRightClassName," .").concat(o.zeroRightClassName," {\n    right: 0 ").concat(n,";\n  }\n  \n  .").concat(o.fullWidthClassName," .").concat(o.fullWidthClassName," {\n    margin-right: 0 ").concat(n,";\n  }\n  \n  body {\n    ").concat(o.removedBarSizeVariable,": ").concat(d,"px;\n  }\n")};t.RemoveScrollBar=function(e){var t=e.noRelative,r=e.noImportant,i=e.gapMode,o=void 0===i?"margin":i,d=n.useMemo(function(){return(0,a.getGapWidth)(o)},[o]);return n.createElement(l,{styles:getStyles(d,!t,o,r?"":"!important")})}},9461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removedBarSizeVariable=t.noScrollbarsClassName=t.fullWidthClassName=t.zeroRightClassName=void 0,t.zeroRightClassName="right-scroll-bar-position",t.fullWidthClassName="width-before-scroll-bar",t.noScrollbarsClassName="with-scroll-bars-hidden",t.removedBarSizeVariable="--removed-body-scroll-bar-size"},2786:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGapWidth=t.removedBarSizeVariable=t.noScrollbarsClassName=t.fullWidthClassName=t.zeroRightClassName=t.RemoveScrollBar=void 0;var n=r(4626);Object.defineProperty(t,"RemoveScrollBar",{enumerable:!0,get:function(){return n.RemoveScrollBar}});var i=r(9461);Object.defineProperty(t,"zeroRightClassName",{enumerable:!0,get:function(){return i.zeroRightClassName}}),Object.defineProperty(t,"fullWidthClassName",{enumerable:!0,get:function(){return i.fullWidthClassName}}),Object.defineProperty(t,"noScrollbarsClassName",{enumerable:!0,get:function(){return i.noScrollbarsClassName}}),Object.defineProperty(t,"removedBarSizeVariable",{enumerable:!0,get:function(){return i.removedBarSizeVariable}});var o=r(2989);Object.defineProperty(t,"getGapWidth",{enumerable:!0,get:function(){return o.getGapWidth}})},2989:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGapWidth=t.zeroGap=void 0,t.zeroGap={left:0,top:0,right:0,gap:0};var parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],n=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[parse(r),parse(n),parse(i)]};t.getGapWidth=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return t.zeroGap;var r=getOffset(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:r[0],top:r[1],right:r[2],gap:Math.max(0,i-n+r[2]-r[0])}}},840:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2838),i=n.__importStar(r(9885)),o=r(3254),a=n.__importDefault(r(902)),l=i.forwardRef(function(e,t){return i.createElement(o.RemoveScroll,n.__assign({},e,{ref:t,sideCar:a.default}))});l.classNames=o.RemoveScroll.classNames,t.default=l},5320:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveScrollSideCar=t.getDeltaXY=t.getTouchXY=void 0;var n=r(2838),i=n.__importStar(r(9885)),o=r(2786),a=r(7034),l=r(3731),d=r(7557);t.getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},t.getDeltaXY=function(e){return[e.deltaX,e.deltaY]};var extractRef=function(e){return e&&"current"in e?e.current:e},c=0,u=[];function RemoveScrollSideCar(e){var r=i.useRef([]),p=i.useRef([0,0]),h=i.useRef(),f=i.useState(c++)[0],g=i.useState(function(){return(0,a.styleSingleton)()})[0],m=i.useRef(e);i.useEffect(function(){m.current=e},[e]),i.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(f));var t=n.__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(f))}),function(){document.body.classList.remove("block-interactivity-".concat(f)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(f))})}}},[e.inert,e.lockRef.current,e.shards]);var y=i.useCallback(function(e,r){if("touches"in e&&2===e.touches.length)return!m.current.allowPinchZoom;var n,i=(0,t.getTouchXY)(e),o=p.current,a="deltaX"in e?e.deltaX:o[0]-i[0],l="deltaY"in e?e.deltaY:o[1]-i[1],c=e.target,u=Math.abs(a)>Math.abs(l)?"h":"v";if("touches"in e&&"h"===u&&"range"===c.type)return!1;var f=(0,d.locationCouldBeScrolled)(u,c);if(!f)return!0;if(f?n=u:(n="v"===u?"h":"v",f=(0,d.locationCouldBeScrolled)(u,c)),!f)return!1;if(!h.current&&"changedTouches"in e&&(a||l)&&(h.current=n),!n)return!0;var g=h.current||n;return(0,d.handleScroll)(g,r,e,"h"===g?a:l,!0)},[]),b=i.useCallback(function(e){if(u.length&&u[u.length-1]===g){var n="deltaY"in e?(0,t.getDeltaXY)(e):(0,t.getTouchXY)(e),i=r.current.filter(function(t){var r;return t.name===e.type&&t.target===e.target&&(r=t.delta)[0]===n[0]&&r[1]===n[1]})[0];if(i&&i.should){e.cancelable&&e.preventDefault();return}if(!i){var o=(m.current.shards||[]).map(extractRef).filter(Boolean).filter(function(t){return t.contains(e.target)});(o.length>0?y(e,o[0]):!m.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),v=i.useCallback(function(e,t,n,i){var o={name:e,delta:t,target:n,should:i};r.current.push(o),setTimeout(function(){r.current=r.current.filter(function(e){return e!==o})},1)},[]),S=i.useCallback(function(e){p.current=(0,t.getTouchXY)(e),h.current=void 0},[]),x=i.useCallback(function(r){v(r.type,(0,t.getDeltaXY)(r),r.target,y(r,e.lockRef.current))},[]),w=i.useCallback(function(r){v(r.type,(0,t.getTouchXY)(r),r.target,y(r,e.lockRef.current))},[]);i.useEffect(function(){return u.push(g),e.setCallbacks({onScrollCapture:x,onWheelCapture:x,onTouchMoveCapture:w}),document.addEventListener("wheel",b,l.nonPassive),document.addEventListener("touchmove",b,l.nonPassive),document.addEventListener("touchstart",S,l.nonPassive),function(){u=u.filter(function(e){return e!==g}),document.removeEventListener("wheel",b,l.nonPassive),document.removeEventListener("touchmove",b,l.nonPassive),document.removeEventListener("touchstart",S,l.nonPassive)}},[]);var _=e.removeScrollBar,P=e.inert;return i.createElement(i.Fragment,null,P?i.createElement(g,{styles:"\n  .block-interactivity-".concat(f," {pointer-events: none;}\n  .allow-interactivity-").concat(f," {pointer-events: all;}\n")}):null,_?i.createElement(o.RemoveScrollBar,{gapMode:"margin"}):null)}t.RemoveScrollSideCar=RemoveScrollSideCar},3254:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveScroll=void 0;var n=r(2838),i=n.__importStar(r(9885)),o=r(9461),a=r(3609),l=r(5210),nothing=function(){},d=i.forwardRef(function(e,t){var r=i.useRef(null),o=i.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),d=o[0],c=o[1],u=e.forwardProps,p=e.children,h=e.className,f=e.removeScrollBar,g=e.enabled,m=e.shards,y=e.sideCar,b=e.noIsolation,v=e.inert,S=e.allowPinchZoom,x=e.as,w=void 0===x?"div":x,_=n.__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),P=(0,a.useMergeRefs)([r,t]),E=n.__assign(n.__assign({},_),d);return i.createElement(i.Fragment,null,g&&i.createElement(y,{sideCar:l.effectCar,removeScrollBar:f,shards:m,noIsolation:b,inert:v,setCallbacks:c,allowPinchZoom:!!S,lockRef:r}),u?i.cloneElement(i.Children.only(p),n.__assign(n.__assign({},E),{ref:P})):i.createElement(w,n.__assign({},E,{className:h,ref:P}),p))});t.RemoveScroll=d,d.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},d.classNames={fullWidth:o.fullWidthClassName,zeroRight:o.zeroRightClassName}},3731:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nonPassive=void 0;var r=!1;if("undefined"!=typeof window)try{var n=Object.defineProperty({},"passive",{get:function(){return r=!0,!0}});window.addEventListener("test",n,n),window.removeEventListener("test",n,n)}catch(e){r=!1}t.nonPassive=!!r&&{passive:!1}},7557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleScroll=t.locationCouldBeScrolled=void 0;var elementCanBeScrolled=function(e,t){var r=window.getComputedStyle(e);return"hidden"!==r[t]&&!(r.overflowY===r.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===r[t])};t.locationCouldBeScrolled=function(e,t){var r=t;do{if("undefined"!=typeof ShadowRoot&&r instanceof ShadowRoot&&(r=r.host),elementCouldBeScrolled(e,r)){var n=getScrollVariables(e,r);if(n[1]>n[2])return!0}r=r.parentNode}while(r&&r!==document.body);return!1};var elementCouldBeScrolled=function(e,t){return"v"===e?elementCanBeScrolled(t,"overflowY"):elementCanBeScrolled(t,"overflowX")},getScrollVariables=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]};t.handleScroll=function(e,t,r,n,i){var o,a=(o=window.getComputedStyle(t).direction,"h"===e&&"rtl"===o?-1:1),l=a*n,d=r.target,c=t.contains(d),u=!1,p=l>0,h=0,f=0;do{var g=getScrollVariables(e,d),m=g[0],y=g[1]-g[2]-a*m;(m||y)&&elementCouldBeScrolled(e,d)&&(h+=y,f+=m),d=d.parentNode}while(!c&&d!==document.body||c&&(t.contains(d)||t===d));return p&&(i&&0===h||!i&&l>h)?u=!0:!p&&(i&&0===f||!i&&-l>f)&&(u=!0),u}},2864:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveScroll=void 0;var n=r(2838).__importDefault(r(840));t.RemoveScroll=n.default},5210:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.effectCar=void 0;var n=r(8221);t.effectCar=(0,n.createSidecarMedium)()},902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8221),i=r(5320),o=r(5210);t.default=(0,n.exportSidecar)(o.effectCar,i.RemoveScrollSideCar)},200:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSingleton=void 0;var n=r(9812);t.styleSingleton=function(){var e=(0,n.styleHookSingleton)();return function(t){return e(t.styles,t.dynamic),null}}},9812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleHookSingleton=void 0;var n=r(2838).__importStar(r(9885)),i=r(1995);t.styleHookSingleton=function(){var e=(0,i.stylesheetSingleton)();return function(t,r){n.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}}},7034:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleHookSingleton=t.stylesheetSingleton=t.styleSingleton=void 0;var n=r(200);Object.defineProperty(t,"styleSingleton",{enumerable:!0,get:function(){return n.styleSingleton}});var i=r(1995);Object.defineProperty(t,"stylesheetSingleton",{enumerable:!0,get:function(){return i.stylesheetSingleton}});var o=r(9812);Object.defineProperty(t,"styleHookSingleton",{enumerable:!0,get:function(){return o.styleHookSingleton}})},1995:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stylesheetSingleton=void 0;var n=r(7643);function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=(0,n.getNonce)();return t&&e.setAttribute("nonce",t),e}function injectStyles(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function insertStyleTag(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}t.stylesheetSingleton=function(){var e=0,t=null;return{add:function(r){0==e&&(t=makeStyleTag())&&(injectStyles(t,r),insertStyleTag(t)),e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}}},1859:(e,t)=>{"use strict";function assignRef(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}Object.defineProperty(t,"__esModule",{value:!0}),t.assignRef=void 0,t.assignRef=assignRef},319:(e,t)=>{"use strict";function createCallbackRef(e){var t=null;return{get current(){return t},set current(value){var r=t;r!==value&&(t=value,e(value,r))}}}Object.defineProperty(t,"__esModule",{value:!0}),t.createCallbackRef=void 0,t.createCallbackRef=createCallbackRef},3609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useRefToCallback=t.refToCallback=t.transformRef=t.useTransformRef=t.useMergeRefs=t.mergeRefs=t.createCallbackRef=t.useCallbackRef=t.assignRef=void 0;var n=r(1859);Object.defineProperty(t,"assignRef",{enumerable:!0,get:function(){return n.assignRef}});var i=r(9308);Object.defineProperty(t,"useCallbackRef",{enumerable:!0,get:function(){return i.useCallbackRef}});var o=r(319);Object.defineProperty(t,"createCallbackRef",{enumerable:!0,get:function(){return o.createCallbackRef}});var a=r(6256);Object.defineProperty(t,"mergeRefs",{enumerable:!0,get:function(){return a.mergeRefs}});var l=r(233);Object.defineProperty(t,"useMergeRefs",{enumerable:!0,get:function(){return l.useMergeRefs}});var d=r(8750);Object.defineProperty(t,"useTransformRef",{enumerable:!0,get:function(){return d.useTransformRef}});var c=r(1461);Object.defineProperty(t,"transformRef",{enumerable:!0,get:function(){return c.transformRef}});var u=r(5601);Object.defineProperty(t,"refToCallback",{enumerable:!0,get:function(){return u.refToCallback}}),Object.defineProperty(t,"useRefToCallback",{enumerable:!0,get:function(){return u.useRefToCallback}})},6256:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeRefs=void 0;var n=r(1859),i=r(319);function mergeRefs(e){return(0,i.createCallbackRef)(function(t){return e.forEach(function(e){return(0,n.assignRef)(e,t)})})}t.mergeRefs=mergeRefs},5601:(e,t)=>{"use strict";function refToCallback(e){return function(t){"function"==typeof e?e(t):e&&(e.current=t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.useRefToCallback=t.refToCallback=void 0,t.refToCallback=refToCallback;var nullCallback=function(){return null},r=new WeakMap,weakMemoize=function(e){var t=e||nullCallback,n=r.get(t);if(n)return n;var i=refToCallback(t);return r.set(t,i),i};function useRefToCallback(e){return weakMemoize(e)}t.useRefToCallback=useRefToCallback},1461:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformRef=void 0;var n=r(1859),i=r(319);function transformRef(e,t){return(0,i.createCallbackRef)(function(r){return(0,n.assignRef)(e,t(r))})}t.transformRef=transformRef},233:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useMergeRefs=void 0;var n=r(1859),i=r(9308);function useMergeRefs(e,t){return(0,i.useCallbackRef)(t||null,function(t){return e.forEach(function(e){return(0,n.assignRef)(e,t)})})}t.useMergeRefs=useMergeRefs},9308:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useCallbackRef=void 0;var n=r(9885);function useCallbackRef(e,t){var r=(0,n.useState)(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(value){var n=r.value;n!==value&&(r.value=value,r.callback(value,n))}}}})[0];return r.callback=t,r.facade}t.useCallbackRef=useCallbackRef},8750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useTransformRef=void 0;var n=r(1859),i=r(9308);function useTransformRef(e,t){return(0,i.useCallbackRef)(null,function(r){return(0,n.assignRef)(e,t(r))})}t.useTransformRef=useTransformRef},3164:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setConfig=t.config=void 0,t.config={onError:function(e){return console.error(e)}},t.setConfig=function(e){Object.assign(t.config,e)}},4614:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0;var n=r(882);t.env={isNode:n.isNode,forceCache:!1}},1183:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportSidecar=void 0;var n=r(2838),i=n.__importStar(r(9885)),SideCar=function(e){var t=e.sideCar,r=n.__rest(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var o=t.read();if(!o)throw Error("Sidecar medium not found");return i.createElement(o,n.__assign({},r))};function exportSidecar(e,t){return e.useMedium(t),SideCar}SideCar.isSideCarExport=!0,t.exportSidecar=exportSidecar},3711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sidecar=void 0;var n=r(2838),i=n.__importStar(r(9885)),o=r(3421);function sidecar(e,t){var ErrorCase=function(){return t};return function(r){var a=(0,o.useSidecar)(e,r.sideCar),l=a[0];return a[1]&&t?ErrorCase:l?i.createElement(l,n.__assign({},r)):null}}t.sidecar=sidecar},3421:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useSidecar=void 0;var n=r(9885),i=r(4614),o=new WeakMap,a={};function useSidecar(e,t){var r=t&&t.options||a;return i.env.isNode&&!r.ssr?[null,null]:useRealSidecar(e,t)}function useRealSidecar(e,t){var r=t&&t.options||a,l=i.env.forceCache||i.env.isNode&&!!r.ssr||!r.async,d=(0,n.useState)(l?function(){return o.get(e)}:void 0),c=d[0],u=d[1],p=(0,n.useState)(null),h=p[0],f=p[1];return(0,n.useEffect)(function(){c||e().then(function(r){var n,i=t?t.read():r.default||r;if(!i)throw console.error("Sidecar error: with importer",e),t?(console.error("Sidecar error: with medium",t),n=Error("Sidecar medium was not found")):n=Error("Sidecar was not found in exports"),f(function(){return n}),n;o.set(e,i),u(function(){return i})},function(e){return f(function(){return e})})},[]),[c,h]}t.useSidecar=useSidecar},8221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportSidecar=t.renderCar=t.createSidecarMedium=t.createMedium=t.setConfig=t.useSidecar=t.sidecar=void 0;var n=r(3711);Object.defineProperty(t,"sidecar",{enumerable:!0,get:function(){return n.sidecar}});var i=r(3421);Object.defineProperty(t,"useSidecar",{enumerable:!0,get:function(){return i.useSidecar}});var o=r(3164);Object.defineProperty(t,"setConfig",{enumerable:!0,get:function(){return o.setConfig}});var a=r(8626);Object.defineProperty(t,"createMedium",{enumerable:!0,get:function(){return a.createMedium}}),Object.defineProperty(t,"createSidecarMedium",{enumerable:!0,get:function(){return a.createSidecarMedium}});var l=r(5919);Object.defineProperty(t,"renderCar",{enumerable:!0,get:function(){return l.renderCar}});var d=r(1183);Object.defineProperty(t,"exportSidecar",{enumerable:!0,get:function(){return d.exportSidecar}})},8626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSidecarMedium=t.createMedium=void 0;var n=r(2838);function ItoI(e){return e}function innerCreateMedium(e,t){void 0===t&&(t=ItoI);var r=[],n=!1;return{read:function(){if(n)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(e){var i=t(e,n);return r.push(i),function(){r=r.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(n=!0;r.length;){var t=r;r=[],t.forEach(e)}r={push:function(t){return e(t)},filter:function(){return r}}},assignMedium:function(e){n=!0;var t=[];if(r.length){var i=r;r=[],i.forEach(e),t=r}var executeQueue=function(){var r=t;t=[],r.forEach(e)},cycle=function(){return Promise.resolve().then(executeQueue)};cycle(),r={push:function(e){t.push(e),cycle()},filter:function(e){return t=t.filter(e),r}}}}}function createMedium(e,t){return void 0===t&&(t=ItoI),innerCreateMedium(e,t)}function createSidecarMedium(e){void 0===e&&(e={});var t=innerCreateMedium(null);return t.options=n.__assign({async:!0,ssr:!1},e),t}t.createMedium=createMedium,t.createSidecarMedium=createSidecarMedium},5919:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderCar=void 0;var n=r(2838),i=n.__importStar(r(9885)),o=r(9885);function renderCar(e,t){function State(t){var r=t.stateRef,a=t.props,l=(0,o.useCallback)(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,o.useLayoutEffect)(function(){r.current(e)}),null},[]);return i.createElement(e,n.__assign({},a,{children:l}))}var r=i.memo(function(e){var t=e.stateRef,r=e.defaultState,n=e.children,i=(0,o.useState)(r.current),a=i[0],l=i[1];return(0,o.useEffect)(function(){t.current=l},[]),n.apply(void 0,a)},function(){return!0});return function(e){var n=i.useRef(t(e)),o=i.useRef(function(e){return n.current=e});return i.createElement(i.Fragment,null,i.createElement(State,{stateRef:o,props:e}),i.createElement(r,{stateRef:o,defaultState:n,children:e.children}))}}t.renderCar=renderCar},3259:e=>{function _extends(){return e.exports=_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,_extends.apply(this,arguments)}e.exports=_extends,e.exports.__esModule=!0,e.exports.default=e.exports},2821:(e,t,r)=>{"use strict";r(6730);var n=r(7698);e.exports=n("Array","at")},8831:(e,t,r)=>{"use strict";r(7743),r(9902);var n=r(7698);e.exports=n("Array","flatMap")},6338:(e,t,r)=>{"use strict";r(9725),r(9717);var n=r(7698);e.exports=n("Array","flat")},5137:(e,t,r)=>{"use strict";r(1898);var n=r(7698);e.exports=n("String","at")},5720:(e,t,r)=>{"use strict";r(9506),r(2084),r(5499);var n=r(7698);e.exports=n("String","replaceAll")},1909:(e,t,r)=>{"use strict";var n=r(950),i=r(2581),o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not a function")}},4834:(e,t,r)=>{"use strict";var n=r(6161),i=r(2143),o=r(1600).f,a=n("unscopables"),l=Array.prototype;void 0===l[a]&&o(l,a,{configurable:!0,value:i(null)}),e.exports=function(e){l[a][e]=!0}},4690:(e,t,r)=>{"use strict";var n=r(3798).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},767:(e,t,r)=>{"use strict";var n=r(1702),i=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not an object")}},6998:(e,t,r)=>{"use strict";var n=r(7794),i=r(3027),o=r(1856),createMethod=function(e){return function(t,r,a){var l,d=n(t),c=o(d),u=i(a,c);if(e&&r!=r){for(;c>u;)if((l=d[u++])!=l)return!0}else for(;c>u;u++)if((e||u in d)&&d[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},5927:(e,t,r)=>{"use strict";var n=r(1178),i=r(6),o=r(1702),a=r(6161)("species"),l=Array;e.exports=function(e){var t;return n(e)&&(i(t=e.constructor)&&(t===l||n(t.prototype))?t=void 0:o(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?l:t}},7240:(e,t,r)=>{"use strict";var n=r(5927);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},2820:(e,t,r)=>{"use strict";var n=r(8640),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},3755:(e,t,r)=>{"use strict";var n=r(8784),i=r(950),o=r(2820),a=r(6161)("toStringTag"),l=Object,d="Arguments"===o(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}};e.exports=n?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=l(e),a))?r:d?o(t):"Object"===(n=o(t))&&i(t.callee)?"Arguments":n}},3666:(e,t,r)=>{"use strict";var n=r(4250),i=r(1987),o=r(8029),a=r(1600);e.exports=function(e,t,r){for(var l=i(t),d=a.f,c=o.f,u=0;u<l.length;u++){var p=l[u];n(e,p)||r&&n(r,p)||d(e,p,c(t,p))}}},6135:(e,t,r)=>{"use strict";var n=r(2884),i=r(1600),o=r(8348);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},8348:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2822:(e,t,r)=>{"use strict";var n=r(950),i=r(1600),o=r(9040),a=r(379);e.exports=function(e,t,r,l){l||(l={});var d=l.enumerable,c=void 0!==l.name?l.name:t;if(n(r)&&o(r,c,l),l.global)d?e[t]=r:a(t,r);else{try{l.unsafe?e[t]&&(d=!0):delete e[t]}catch(e){}d?e[t]=r:i.f(e,t,{value:r,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return e}},379:(e,t,r)=>{"use strict";var n=r(7330),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},2884:(e,t,r)=>{"use strict";var n=r(9722);e.exports=!n(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},6982:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports={all:t,IS_HTMLDDA:void 0===t&&void 0!==t}},9140:(e,t,r)=>{"use strict";var n=r(7330),i=r(1702),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},5085:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},1029:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},3499:(e,t,r)=>{"use strict";var n,i,o=r(7330),a=r(1029),l=o.process,d=o.Deno,c=l&&l.versions||d&&d.version,u=c&&c.v8;u&&(i=(n=u.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},7698:(e,t,r)=>{"use strict";var n=r(7330),i=r(8640);e.exports=function(e,t){return i(n[e].prototype[t])}},2010:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},5187:(e,t,r)=>{"use strict";var n=r(7330),i=r(8029).f,o=r(6135),a=r(2822),l=r(379),d=r(3666),c=r(9986);e.exports=function(e,t){var r,u,p,h,f,g=e.target,m=e.global,y=e.stat;if(r=m?n:y?n[g]||l(g,{}):(n[g]||{}).prototype)for(u in t){if(h=t[u],p=e.dontCallGetSet?(f=i(r,u))&&f.value:r[u],!c(m?u:g+(y?".":"#")+u,e.forced)&&void 0!==p){if(typeof h==typeof p)continue;d(h,p)}(e.sham||p&&p.sham)&&o(h,"sham",!0),a(r,u,h,e)}}},9722:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},491:(e,t,r)=>{"use strict";r(9506);var n=r(2835),i=r(2822),o=r(5611),a=r(9722),l=r(6161),d=r(6135),c=l("species"),u=RegExp.prototype;e.exports=function(e,t,r,p){var h=l(e),f=!a(function(){var t={};return t[h]=function(){return 7},7!==""[e](t)}),g=f&&!a(function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[c]=function(){return r},r.flags="",r[h]=/./[h]),r.exec=function(){return t=!0,null},r[h](""),!t});if(!f||!g||r){var m=n(/./[h]),y=t(h,""[e],function(e,t,r,i,a){var l=n(e),d=t.exec;return d===o||d===u.exec?f&&!a?{done:!0,value:m(t,r,i)}:{done:!0,value:l(r,t,i)}:{done:!1}});i(String.prototype,e,y[0]),i(u,h,y[1])}p&&d(u[h],"sham",!0)}},7199:(e,t,r)=>{"use strict";var n=r(1178),i=r(1856),o=r(5085),a=r(7632),flattenIntoArray=function(e,t,r,l,d,c,u,p){for(var h,f,g=d,m=0,y=!!u&&a(u,p);m<l;)m in r&&(h=y?y(r[m],m,t):r[m],c>0&&n(h)?(f=i(h),g=flattenIntoArray(e,t,h,f,g,c-1)-1):(o(g+1),e[g]=h),g++),m++;return g};e.exports=flattenIntoArray},329:(e,t,r)=>{"use strict";var n=r(2969),i=Function.prototype,o=i.apply,a=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?a.bind(o):function(){return a.apply(o,arguments)})},7632:(e,t,r)=>{"use strict";var n=r(2835),i=r(1909),o=r(2969),a=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},2969:(e,t,r)=>{"use strict";var n=r(9722);e.exports=!n(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},9067:(e,t,r)=>{"use strict";var n=r(2969),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},9715:(e,t,r)=>{"use strict";var n=r(2884),i=r(4250),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,l=i(o,"name"),d=l&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:l,PROPER:l&&"something"===(function(){}).name,CONFIGURABLE:d}},2835:(e,t,r)=>{"use strict";var n=r(2820),i=r(8640);e.exports=function(e){if("Function"===n(e))return i(e)}},8640:(e,t,r)=>{"use strict";var n=r(2969),i=Function.prototype,o=i.call,a=n&&i.bind.bind(o,o);e.exports=n?a:function(e){return function(){return o.apply(e,arguments)}}},3210:(e,t,r)=>{"use strict";var n=r(7330),i=r(950);e.exports=function(e,t){var r;return arguments.length<2?i(r=n[e])?r:void 0:n[e]&&n[e][t]}},1721:(e,t,r)=>{"use strict";var n=r(1909),i=r(7297);e.exports=function(e,t){var r=e[t];return i(r)?void 0:n(r)}},5482:(e,t,r)=>{"use strict";var n=r(8640),i=r(242),o=Math.floor,a=n("".charAt),l=n("".replace),d=n("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,p,h){var f=r+e.length,g=n.length,m=u;return void 0!==p&&(p=i(p),m=c),l(h,m,function(i,l){var c;switch(a(l,0)){case"$":return"$";case"&":return e;case"`":return d(t,0,r);case"'":return d(t,f);case"<":c=p[d(l,1,-1)];break;default:var u=+l;if(0===u)return i;if(u>g){var h=o(u/10);if(0===h)return i;if(h<=g)return void 0===n[h-1]?a(l,1):n[h-1]+a(l,1);return i}c=n[u-1]}return void 0===c?"":c})}},7330:function(e){"use strict";var check=function(e){return e&&e.Math===Math&&e};e.exports=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof global&&global)||function(){return this}()||this||Function("return this")()},4250:(e,t,r)=>{"use strict";var n=r(8640),i=r(242),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},8254:e=>{"use strict";e.exports={}},6118:(e,t,r)=>{"use strict";var n=r(3210);e.exports=n("document","documentElement")},4036:(e,t,r)=>{"use strict";var n=r(2884),i=r(9722),o=r(9140);e.exports=!n&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},3955:(e,t,r)=>{"use strict";var n=r(8640),i=r(9722),o=r(2820),a=Object,l=n("".split);e.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?l(e,""):a(e)}:a},1586:(e,t,r)=>{"use strict";var n=r(8640),i=r(950),o=r(5103),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},7957:(e,t,r)=>{"use strict";var n,i,o,a=r(7060),l=r(7330),d=r(1702),c=r(6135),u=r(4250),p=r(5103),h=r(3198),f=r(8254),g="Object already initialized",m=l.TypeError,y=l.WeakMap;if(a||p.state){var b=p.state||(p.state=new y);b.get=b.get,b.has=b.has,b.set=b.set,n=function(e,t){if(b.has(e))throw new m(g);return t.facade=e,b.set(e,t),t},i=function(e){return b.get(e)||{}},o=function(e){return b.has(e)}}else{var v=h("state");f[v]=!0,n=function(e,t){if(u(e,v))throw new m(g);return t.facade=e,c(e,v,t),t},i=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!d(t)||(r=i(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return r}}}},1178:(e,t,r)=>{"use strict";var n=r(2820);e.exports=Array.isArray||function(e){return"Array"===n(e)}},950:(e,t,r)=>{"use strict";var n=r(6982),i=n.all;e.exports=n.IS_HTMLDDA?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},6:(e,t,r)=>{"use strict";var n=r(8640),i=r(9722),o=r(950),a=r(3755),l=r(3210),d=r(1586),noop=function(){},c=[],u=l("Reflect","construct"),p=/^\s*(?:class|function)\b/,h=n(p.exec),f=!p.test(noop),isConstructorModern=function(e){if(!o(e))return!1;try{return u(noop,c,e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!h(p,d(e))}catch(e){return!0}};isConstructorLegacy.sham=!0,e.exports=!u||i(function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern(function(){e=!0})||e})?isConstructorLegacy:isConstructorModern},9986:(e,t,r)=>{"use strict";var n=r(9722),i=r(950),o=/#|\.prototype\./,isForced=function(e,t){var r=l[a(e)];return r===c||r!==d&&(i(t)?n(t):!!t)},a=isForced.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=isForced.data={},d=isForced.NATIVE="N",c=isForced.POLYFILL="P";e.exports=isForced},7297:e=>{"use strict";e.exports=function(e){return null==e}},1702:(e,t,r)=>{"use strict";var n=r(950),i=r(6982),o=i.all;e.exports=i.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:n(e)||e===o}:function(e){return"object"==typeof e?null!==e:n(e)}},9980:e=>{"use strict";e.exports=!1},8924:(e,t,r)=>{"use strict";var n=r(1702),i=r(2820),o=r(6161)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},5414:(e,t,r)=>{"use strict";var n=r(3210),i=r(950),o=r(7324),a=r(4872),l=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return i(t)&&o(t.prototype,l(e))}},1856:(e,t,r)=>{"use strict";var n=r(2138);e.exports=function(e){return n(e.length)}},9040:(e,t,r)=>{"use strict";var n=r(8640),i=r(9722),o=r(950),a=r(4250),l=r(2884),d=r(9715).CONFIGURABLE,c=r(1586),u=r(7957),p=u.enforce,h=u.get,f=String,g=Object.defineProperty,m=n("".slice),y=n("".replace),b=n([].join),v=l&&!i(function(){return 8!==g(function(){},"length",{value:8}).length}),S=String(String).split("String"),x=e.exports=function(e,t,r){"Symbol("===m(f(t),0,7)&&(t="["+y(f(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!a(e,"name")||d&&e.name!==t)&&(l?g(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&a(r,"arity")&&e.length!==r.arity&&g(e,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?l&&g(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=p(e);return a(n,"source")||(n.source=b(S,"string"==typeof t?t:"")),e};Function.prototype.toString=x(function(){return o(this)&&h(this).source||c(this)},"toString")},4786:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},2143:(e,t,r)=>{"use strict";var n,i=r(767),o=r(3922),a=r(2010),l=r(8254),d=r(6118),c=r(9140),u=r(3198),p="prototype",h="script",f=u("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return"<"+h+">"+e+"</"+h+">"},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=c("iframe");return t.style.display="none",d.appendChild(t),t.src=String("java"+h+":"),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},NullProtoObject=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&n?NullProtoObjectViaActiveX(n):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(n);for(var e=a.length;e--;)delete NullProtoObject[p][a[e]];return NullProtoObject()};l[f]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor[p]=i(e),r=new EmptyConstructor,EmptyConstructor[p]=null,r[f]=e):r=NullProtoObject(),void 0===t?r:o.f(r,t)}},3922:(e,t,r)=>{"use strict";var n=r(2884),i=r(7162),o=r(1600),a=r(767),l=r(7794),d=r(8535);t.f=n&&!i?Object.defineProperties:function(e,t){a(e);for(var r,n=l(t),i=d(t),c=i.length,u=0;c>u;)o.f(e,r=i[u++],n[r]);return e}},1600:(e,t,r)=>{"use strict";var n=r(2884),i=r(4036),o=r(7162),a=r(767),l=r(7495),d=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,p="enumerable",h="configurable",f="writable";t.f=n?o?function(e,t,r){if(a(e),t=l(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&f in r&&!r[f]){var n=u(e,t);n&&n[f]&&(e[t]=r.value,r={configurable:h in r?r[h]:n[h],enumerable:p in r?r[p]:n[p],writable:!1})}return c(e,t,r)}:c:function(e,t,r){if(a(e),t=l(t),a(r),i)try{return c(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new d("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},8029:(e,t,r)=>{"use strict";var n=r(2884),i=r(9067),o=r(2061),a=r(8348),l=r(7794),d=r(7495),c=r(4250),u=r(4036),p=Object.getOwnPropertyDescriptor;t.f=n?p:function(e,t){if(e=l(e),t=d(t),u)try{return p(e,t)}catch(e){}if(c(e,t))return a(!i(o.f,e,t),e[t])}},9890:(e,t,r)=>{"use strict";var n=r(3821),i=r(2010).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},498:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},7324:(e,t,r)=>{"use strict";var n=r(8640);e.exports=n({}.isPrototypeOf)},3821:(e,t,r)=>{"use strict";var n=r(8640),i=r(4250),o=r(7794),a=r(6998).indexOf,l=r(8254),d=n([].push);e.exports=function(e,t){var r,n=o(e),c=0,u=[];for(r in n)!i(l,r)&&i(n,r)&&d(u,r);for(;t.length>c;)i(n,r=t[c++])&&(~a(u,r)||d(u,r));return u}},8535:(e,t,r)=>{"use strict";var n=r(3821),i=r(2010);e.exports=Object.keys||function(e){return n(e,i)}},2061:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},1642:(e,t,r)=>{"use strict";var n=r(9067),i=r(950),o=r(1702),a=TypeError;e.exports=function(e,t){var r,l;if("string"===t&&i(r=e.toString)&&!o(l=n(r,e))||i(r=e.valueOf)&&!o(l=n(r,e))||"string"!==t&&i(r=e.toString)&&!o(l=n(r,e)))return l;throw new a("Can't convert object to primitive value")}},1987:(e,t,r)=>{"use strict";var n=r(3210),i=r(8640),o=r(9890),a=r(498),l=r(767),d=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(l(e)),r=a.f;return r?d(t,r(e)):t}},5212:(e,t,r)=>{"use strict";var n=r(9067),i=r(767),o=r(950),a=r(2820),l=r(5611),d=TypeError;e.exports=function(e,t){var r=e.exec;if(o(r)){var c=n(r,e,t);return null!==c&&i(c),c}if("RegExp"===a(e))return n(l,e,t);throw new d("RegExp#exec called on incompatible receiver")}},5611:(e,t,r)=>{"use strict";var n=r(9067),i=r(8640),o=r(2557),a=r(4549),l=r(9032),d=r(4334),c=r(2143),u=r(7957).get,p=r(6158),h=r(1839),f=d("native-string-replace",String.prototype.replace),g=RegExp.prototype.exec,m=g,y=i("".charAt),b=i("".indexOf),v=i("".replace),S=i("".slice),x=function(){var e=/a/,t=/b*/g;return n(g,e,"a"),n(g,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),w=l.BROKEN_CARET,_=void 0!==/()??/.exec("")[1];(x||_||w||p||h)&&(m=function(e){var t,r,i,l,d,p,h,P=u(this),E=o(e),C=P.raw;if(C)return C.lastIndex=this.lastIndex,t=n(m,C,E),this.lastIndex=C.lastIndex,t;var k=P.groups,I=w&&this.sticky,T=n(a,this),A=this.source,$=0,M=E;if(I&&(-1===b(T=v(T,"y",""),"g")&&(T+="g"),M=S(E,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==y(E,this.lastIndex-1))&&(A="(?: "+A+")",M=" "+M,$++),r=RegExp("^(?:"+A+")",T)),_&&(r=RegExp("^"+A+"$(?!\\s)",T)),x&&(i=this.lastIndex),l=n(g,I?r:this,M),I?l?(l.input=S(l.input,$),l[0]=S(l[0],$),l.index=this.lastIndex,this.lastIndex+=l[0].length):this.lastIndex=0:x&&l&&(this.lastIndex=this.global?l.index+l[0].length:i),_&&l&&l.length>1&&n(f,l[0],r,function(){for(d=1;d<arguments.length-2;d++)void 0===arguments[d]&&(l[d]=void 0)}),l&&k)for(d=0,l.groups=p=c(null);d<k.length;d++)p[(h=k[d])[0]]=l[h[1]];return l}),e.exports=m},4549:(e,t,r)=>{"use strict";var n=r(767);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},2131:(e,t,r)=>{"use strict";var n=r(9067),i=r(4250),o=r(7324),a=r(4549),l=RegExp.prototype;e.exports=function(e){var t=e.flags;return!(void 0===t&&!("flags"in l)&&!i(e,"flags")&&o(l,e))?t:n(a,e)}},9032:(e,t,r)=>{"use strict";var n=r(9722),i=r(7330).RegExp,o=n(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),a=o||n(function(){return!i("a","y").sticky}),l=o||n(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:l,MISSED_STICKY:a,UNSUPPORTED_Y:o}},6158:(e,t,r)=>{"use strict";var n=r(9722),i=r(7330).RegExp;e.exports=n(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},1839:(e,t,r)=>{"use strict";var n=r(9722),i=r(7330).RegExp;e.exports=n(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},3895:(e,t,r)=>{"use strict";var n=r(7297),i=TypeError;e.exports=function(e){if(n(e))throw new i("Can't call method on "+e);return e}},3198:(e,t,r)=>{"use strict";var n=r(4334),i=r(8141),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5103:(e,t,r)=>{"use strict";var n=r(7330),i=r(379),o="__core-js_shared__",a=n[o]||i(o,{});e.exports=a},4334:(e,t,r)=>{"use strict";var n=r(9980),i=r(5103);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.33.2",mode:n?"pure":"global",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.33.2/LICENSE",source:"https://github.com/zloirock/core-js"})},3798:(e,t,r)=>{"use strict";var n=r(8640),i=r(7485),o=r(2557),a=r(3895),l=n("".charAt),d=n("".charCodeAt),c=n("".slice),createMethod=function(e){return function(t,r){var n,u,p=o(a(t)),h=i(r),f=p.length;return h<0||h>=f?e?"":void 0:(n=d(p,h))<55296||n>56319||h+1===f||(u=d(p,h+1))<56320||u>57343?e?l(p,h):n:e?c(p,h,h+2):(n-55296<<10)+(u-56320)+65536}};e.exports={codeAt:createMethod(!1),charAt:createMethod(!0)}},1705:(e,t,r)=>{"use strict";var n=r(3499),i=r(9722),o=r(7330).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&n&&n<41})},3027:(e,t,r)=>{"use strict";var n=r(7485),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},7794:(e,t,r)=>{"use strict";var n=r(3955),i=r(3895);e.exports=function(e){return n(i(e))}},7485:(e,t,r)=>{"use strict";var n=r(4786);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},2138:(e,t,r)=>{"use strict";var n=r(7485),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},242:(e,t,r)=>{"use strict";var n=r(3895),i=Object;e.exports=function(e){return i(n(e))}},607:(e,t,r)=>{"use strict";var n=r(9067),i=r(1702),o=r(5414),a=r(1721),l=r(1642),d=r(6161),c=TypeError,u=d("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var r,d=a(e,u);if(d){if(void 0===t&&(t="default"),!i(r=n(d,e,t))||o(r))return r;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),l(e,t)}},7495:(e,t,r)=>{"use strict";var n=r(607),i=r(5414);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},8784:(e,t,r)=>{"use strict";var n=r(6161)("toStringTag"),i={};i[n]="z",e.exports="[object z]"===String(i)},2557:(e,t,r)=>{"use strict";var n=r(3755),i=String;e.exports=function(e){if("Symbol"===n(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},2581:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},8141:(e,t,r)=>{"use strict";var n=r(8640),i=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},4872:(e,t,r)=>{"use strict";var n=r(1705);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7162:(e,t,r)=>{"use strict";var n=r(2884),i=r(9722);e.exports=n&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},7060:(e,t,r)=>{"use strict";var n=r(7330),i=r(950),o=n.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},6161:(e,t,r)=>{"use strict";var n=r(7330),i=r(4334),o=r(4250),a=r(8141),l=r(1705),d=r(4872),c=n.Symbol,u=i("wks"),p=d?c.for||c:c&&c.withoutSetter||a;e.exports=function(e){return o(u,e)||(u[e]=l&&o(c,e)?c[e]:p("Symbol."+e)),u[e]}},6730:(e,t,r)=>{"use strict";var n=r(5187),i=r(242),o=r(1856),a=r(7485),l=r(4834);n({target:"Array",proto:!0},{at:function(e){var t=i(this),r=o(t),n=a(e),l=n>=0?n:r+n;return l<0||l>=r?void 0:t[l]}}),l("at")},7743:(e,t,r)=>{"use strict";var n=r(5187),i=r(7199),o=r(1909),a=r(242),l=r(1856),d=r(7240);n({target:"Array",proto:!0},{flatMap:function(e){var t,r=a(this),n=l(r);return o(e),(t=d(r,0)).length=i(t,r,r,n,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},9725:(e,t,r)=>{"use strict";var n=r(5187),i=r(7199),o=r(242),a=r(1856),l=r(7485),d=r(7240);n({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),r=a(t),n=d(t,0);return n.length=i(n,t,t,r,0,void 0===e?1:l(e)),n}})},9902:(e,t,r)=>{"use strict";r(4834)("flatMap")},9717:(e,t,r)=>{"use strict";r(4834)("flat")},9506:(e,t,r)=>{"use strict";var n=r(5187),i=r(5611);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},1898:(e,t,r)=>{"use strict";var n=r(5187),i=r(8640),o=r(3895),a=r(7485),l=r(2557),d=r(9722),c=i("".charAt);n({target:"String",proto:!0,forced:d(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=l(o(this)),r=t.length,n=a(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:c(t,i)}})},5499:(e,t,r)=>{"use strict";var n=r(5187),i=r(9067),o=r(8640),a=r(3895),l=r(950),d=r(7297),c=r(8924),u=r(2557),p=r(1721),h=r(2131),f=r(5482),g=r(6161),m=r(9980),y=g("replace"),b=TypeError,v=o("".indexOf),S=o("".replace),x=o("".slice),w=Math.max,stringIndexOf=function(e,t,r){return r>e.length?-1:""===t?r:v(e,t,r)};n({target:"String",proto:!0},{replaceAll:function(e,t){var r,n,o,g,_,P,E,C,k=a(this),I=0,T=0,A="";if(!d(e)){if((r=c(e))&&!~v(u(a(h(e))),"g"))throw new b("`.replaceAll` does not allow non-global regexes");if(n=p(e,y))return i(n,e,k,t);if(m&&r)return S(u(k),e,t)}for(o=u(k),g=u(e),(_=l(t))||(t=u(t)),E=w(1,P=g.length),I=stringIndexOf(o,g,0);-1!==I;)C=_?u(t(g,I,o)):f(g,o,I,[],void 0,t),A+=x(o,T,I)+C,T=I+P,I=stringIndexOf(o,g,I+E);return T<o.length&&(A+=x(o,T)),A}})},2084:(e,t,r)=>{"use strict";var n=r(329),i=r(9067),o=r(8640),a=r(491),l=r(9722),d=r(767),c=r(950),u=r(7297),p=r(7485),h=r(2138),f=r(2557),g=r(3895),m=r(4690),y=r(1721),b=r(5482),v=r(5212),S=r(6161)("replace"),x=Math.max,w=Math.min,_=o([].concat),P=o([].push),E=o("".indexOf),C=o("".slice),k="$0"==="a".replace(/./,"$0"),I=!!/./[S]&&""===/./[S]("a","$0");a("replace",function(e,t,r){var o=I?"$":"$0";return[function(e,r){var n=g(this),o=u(e)?void 0:y(e,S);return o?i(o,e,n,r):i(t,f(n),e,r)},function(e,i){var a=d(this),l=f(e);if("string"==typeof i&&-1===E(i,o)&&-1===E(i,"$<")){var u=r(t,a,l,i);if(u.done)return u.value}var g=c(i);g||(i=f(i));var y=a.global;y&&($=a.unicode,a.lastIndex=0);for(var S=[];null!==(M=v(a,l))&&(P(S,M),y);)""===f(M[0])&&(a.lastIndex=m(l,h(a.lastIndex),$));for(var k="",I=0,T=0;T<S.length;T++){for(var A,$,M,D,V=f((M=S[T])[0]),R=x(w(p(M.index),l.length),0),j=[],O=1;O<M.length;O++)P(j,void 0===(A=M[O])?A:String(A));var L=M.groups;if(g){var F=_([V],j,R,l);void 0!==L&&P(F,L),D=f(n(i,void 0,F))}else D=b(V,l,R,j,L,i);R>=I&&(k+=C(l,I,R)+D,I=R+V.length)}return k+C(l,I)}]},!!l(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!k||I)},3318:(e,t,r)=>{"use strict";var n=r(2821);e.exports=n},443:(e,t,r)=>{"use strict";var n=r(8831);e.exports=n},205:(e,t,r)=>{"use strict";var n=r(6338);e.exports=n},1680:(e,t,r)=>{"use strict";var n=r(5137);e.exports=n},8714:(e,t,r)=>{"use strict";var n=r(5720);e.exports=n},610:(e,t,r)=>{"use strict";let n,i,o,a,l,d,c,u,p,h,f;r.r(t),r.d(t,{ANIMATION_MEDIUM_MS:()=>na,ANIMATION_SHORT_MS:()=>no,Arc2d:()=>Arc2d,ArrayOfValidator:()=>ArrayOfValidator,ArrowShapeArrowheadEndStyle:()=>t7,ArrowShapeArrowheadStartStyle:()=>t9,ArrowShapeTool:()=>ArrowShapeTool,ArrowShapeUtil:()=>ArrowShapeUtil,AssetRecordType:()=>tK,AssetUrlsProvider:()=>AssetUrlsProvider,BaseBoxShapeTool:()=>BaseBoxShapeTool,BaseBoxShapeUtil:()=>BaseBoxShapeUtil,BookmarkShapeUtil:()=>BookmarkShapeUtil,Box2d:()=>Box2d_Box2d,BreakPointProvider:()=>BreakPointProvider,Button:()=>iH,CAMERA_SLIDE_FRICTION:()=>nm,CameraRecordType:()=>e6,Canvas:()=>Canvas,Circle2d:()=>Circle2d,ContextMenu:()=>ContextMenu,CubicBezier2d:()=>CubicBezier2d,CubicSpline2d:()=>CubicSpline2d,DEFAULT_ACCEPTED_IMG_TYPE:()=>aA,DEFAULT_ACCEPTED_VID_TYPE:()=>a$,DEFAULT_ANIMATION_OPTIONS:()=>ng,DOUBLE_CLICK_DURATION:()=>nc,DRAG_DISTANCE:()=>np,DefaultBackground:()=>DefaultBackground,DefaultBrush:()=>DefaultBrush,DefaultCollaboratorHint:()=>DefaultCollaboratorHint,DefaultColorStyle:()=>t0,DefaultColorThemePalette:()=>tJ,DefaultCursor:()=>nt,DefaultDashStyle:()=>t2,DefaultErrorFallback:()=>DefaultErrorFallback,DefaultFillStyle:()=>t3,DefaultFontFamilies:()=>t4,DefaultFontStyle:()=>t5,DefaultGrid:()=>DefaultGrid,DefaultHandle:()=>DefaultHandle,DefaultHandles:()=>DefaultHandles,DefaultHorizontalAlignStyle:()=>rv,DefaultHoveredShapeIndicator:()=>DefaultHoveredShapeIndicator,DefaultScribble:()=>DefaultScribble,DefaultSelectionBackground:()=>DefaultSelectionBackground,DefaultSelectionForeground:()=>DefaultSelectionForeground,DefaultSizeStyle:()=>t8,DefaultSnapLine:()=>DefaultSnapLine,DefaultSpinner:()=>DefaultSpinner,DefaultSvgDefs:()=>DefaultSvgDefs,DefaultVerticalAlignStyle:()=>rS,Dialog:()=>C,DictValidator:()=>DictValidator,DocumentRecordType:()=>tV,DrawShapeTool:()=>DrawShapeTool,DrawShapeUtil:()=>DrawShapeUtil,DropdownMenu:()=>k,EASINGS:()=>r3,EMBED_DEFINITIONS:()=>rp,EMPTY_ARRAY:()=>ev,EPSILON:()=>r7,EVENT_NAME_MAP:()=>n9,Edge2d:()=>Edge2d,Editor:()=>Editor,Ellipse2d:()=>Ellipse2d,EmbedShapeUtil:()=>EmbedShapeUtil,EnumStyleProp:()=>EnumStyleProp,EraserTool:()=>EraserTool,ErrorBoundary:()=>ErrorBoundary,ErrorScreen:()=>ErrorScreen,FileHelpers:()=>FileHelpers,FrameShapeTool:()=>FrameShapeTool,FrameShapeUtil:()=>FrameShapeUtil,GRID_STEPS:()=>ny,GeoShapeGeoStyle:()=>rx,GeoShapeTool:()=>GeoShapeTool,GeoShapeUtil:()=>GeoShapeUtil,Geometry2d:()=>Geometry2d,Group2d:()=>Group2d,GroupShapeUtil:()=>GroupShapeUtil,HASH_PATTERN_ZOOM_NAMES:()=>nf,HIT_TEST_MARGIN:()=>nv,HTMLContainer:()=>HTMLContainer,HandTool:()=>HandTool,HighlightShapeTool:()=>HighlightShapeTool,HighlightShapeUtil:()=>HighlightShapeUtil,Icon:()=>iN,ImageShapeUtil:()=>ImageShapeUtil,IncrementalSetConstructor:()=>IncrementalSetConstructor,Input:()=>sE,InstancePageStateRecordType:()=>tx,InstancePresenceRecordType:()=>tA,LANGUAGES:()=>rq,LaserTool:()=>LaserTool,LineShapeSplineStyle:()=>rR,LineShapeTool:()=>LineShapeTool,LineShapeUtil:()=>LineShapeUtil,LoadingScreen:()=>LoadingScreen,MAX_PAGES:()=>ni,MAX_SHAPES_PER_PAGE:()=>nn,MAX_ZOOM:()=>nd,MIN_ZOOM:()=>nl,MULTI_CLICK_DURATION:()=>nu,Matrix2d:()=>Matrix2d,MediaHelpers:()=>MediaHelpers,MigrationFailureReason:()=>ez,NoteShapeTool:()=>NoteShapeTool,NoteShapeUtil:()=>NoteShapeUtil,ObjectValidator:()=>ObjectValidator,OfflineIndicator:()=>OfflineIndicator,OptionalErrorBoundary:()=>OptionalErrorBoundary,PI:()=>r8,PI2:()=>r9,PageRecordType:()=>tp,PngHelpers:()=>PngHelpers,PointerRecordType:()=>tE,Polygon2d:()=>Polygon2d,Polyline2d:()=>Polyline2d,PositionedOnCanvas:()=>iV,ROTATE_CORNER_TO_SELECTION_CORNER:()=>r4,ReadonlySharedStyleMap:()=>ReadonlySharedStyleMap,RecordType:()=>RecordType,Rectangle2d:()=>Rectangle2d,Result:()=>e$,SIN:()=>ne,SVGContainer:()=>SVGContainer,SVG_PADDING:()=>nh,SelectTool:()=>SelectTool,ShapeIndicator:()=>r2,ShapeUtil:()=>ShapeUtil,SharedStyleMap:()=>SharedStyleMap,SnapManager:()=>SnapManager,Spinner:()=>Spinner,Stadium2d:()=>Stadium2d,StateNode:()=>StateNode,Store:()=>Store,StoreSchema:()=>StoreSchema,StyleProp:()=>StyleProp,T:()=>E,TAB_ID:()=>iu,TAU:()=>r6,TLDOCUMENT_ID:()=>tR,TLDRAW_FILE_EXTENSION:()=>dy,TLINSTANCE_ID:()=>tg,TLPOINTER_ID:()=>tC,TL_CANVAS_UI_COLOR_TYPES:()=>ti,TextShapeTool:()=>TextShapeTool,TextShapeUtil:()=>TextShapeUtil,Tldraw:()=>Tldraw,TldrawEditor:()=>iM,TldrawUi:()=>lq,TldrawUiContextProvider:()=>TldrawUiContextProvider,USER_COLORS:()=>nz,UiEventsProvider:()=>UiEventsProvider,UnionValidator:()=>UnionValidator,Validator:()=>Validator,Vec2d:()=>Vec2d_Vec2d,VideoShapeUtil:()=>VideoShapeUtil,WeakMapCache:()=>WeakMapCache,ZOOMS:()=>ns,ZoomTool:()=>ZoomTool,angleDelta:()=>angleDelta,annotateError:()=>annotateError,applyRotationToSnapshotShapes:()=>applyRotationToSnapshotShapes,approximately:()=>approximately,areAnglesCompatible:()=>areAnglesCompatible,arrowShapeMigrations:()=>rn,arrowShapeProps:()=>rt,assert:()=>eM,assertExists:()=>eD,assertIdType:()=>assertIdType,assetIdValidator:()=>e3,assetMigrations:()=>tW,assetValidator:()=>tH,atom:()=>Atom_atom,average:()=>average,bookmarkShapeMigrations:()=>ra,bookmarkShapeProps:()=>ri,box2dModelValidator:()=>e7,buildFromV1Document:()=>buildFromV1Document,canonicalizeRotation:()=>canonicalizeRotation,canvasUiColorTypeValidator:()=>to,clamp:()=>clamp,clampRadians:()=>clampRadians,clockwiseAngleDist:()=>clockwiseAngleDist,compact:()=>compact,compactMenuItems:()=>compactMenuItems,compareRecordVersions:()=>compareRecordVersions,compareSchemas:()=>compareSchemas,computed:()=>computed,containBoxSize:()=>containBoxSize,coreShapes:()=>nY,createAssetValidator:()=>createAssetValidator,createPresenceStateDerivation:()=>createPresenceStateDerivation,createRecordType:()=>createRecordType,createSessionStateSnapshotSignal:()=>createSessionStateSnapshotSignal,createShapeId:()=>createShapeId,createShapeValidator:()=>createShapeValidator,createTLSchema:()=>createTLSchema,createTLStore:()=>createTLStore,createTLUser:()=>createTLUser,dataUrlToFile:()=>dataUrlToFile,debounce:()=>debounce,debugFlags:()=>rZ,dedupe:()=>dedupe,deepCopy:()=>deepCopy,defaultShapeTools:()=>aD,defaultShapeUtils:()=>a1,defaultTools:()=>a6,defaultUserPreferences:()=>nB,defineMigrations:()=>defineMigrations,degreesToRadians:()=>degreesToRadians,devFreeze:()=>devFreeze,drawShapeMigrations:()=>rc,drawShapeProps:()=>rl,embedShapeMigrations:()=>rm,embedShapePermissionDefaults:()=>rh,embedShapeProps:()=>rf,exhaustiveSwitchError:()=>exhaustiveSwitchError,extractSessionStateFromLegacySnapshot:()=>extractSessionStateFromLegacySnapshot,featureFlags:()=>rX,filterEntries:()=>filterEntries,findMenuItem:()=>findMenuItem,frameShapeMigrations:()=>rb,frameShapeProps:()=>ry,geoShapeMigrations:()=>rP,geoShapeProps:()=>rw,getArcLength:()=>getArcLength,getArrowTerminalsInArrowSpace:()=>getArrowTerminalsInArrowSpace,getArrowheadPathForType:()=>getArrowheadPathForType,getCursor:()=>getCursor,getCurvedArrowHandlePath:()=>getCurvedArrowHandlePath,getDefaultColorTheme:()=>getDefaultColorTheme,getDefaultTranslationLocale:()=>getDefaultTranslationLocale,getEmbedInfo:()=>getEmbedInfo,getErrorAnnotations:()=>getErrorAnnotations,getFirstFromIterable:()=>getFirstFromIterable,getFreshUserPreferences:()=>getFreshUserPreferences,getHashForObject:()=>getHashForObject,getHashForString:()=>getHashForString,getIncrementedName:()=>getIncrementedName,getIndexAbove:()=>getIndexAbove,getIndexBelow:()=>getIndexBelow,getIndexBetween:()=>getIndexBetween,getIndices:()=>getIndices,getIndicesAbove:()=>getIndicesAbove,getIndicesBelow:()=>getIndicesBelow,getIndicesBetween:()=>getIndicesBetween,getOwnProperty:()=>getOwnProperty,getPointOnCircle:()=>getPointOnCircle,getPointerInfo:()=>getPointerInfo,getPolygonVertices:()=>getPolygonVertices,getRecordVersion:()=>getRecordVersion,getResizedImageDataUrl:()=>getResizedImageDataUrl,getRotationSnapshot:()=>getRotationSnapshot,getShapePropKeysByStyle:()=>getShapePropKeysByStyle,getSolidCurvedArrowPath:()=>getSolidCurvedArrowPath,getSolidStraightArrowPath:()=>getSolidStraightArrowPath,getStarBounds:()=>getStarBounds,getStraightArrowHandlePath:()=>getStraightArrowHandlePath,getSvgPathFromPoints:()=>getSvgPathFromPoints_getSvgPathFromPoints,getSweep:()=>getSweep,getUserPreferences:()=>getUserPreferences,groupShapeMigrations:()=>rC,groupShapeProps:()=>rE,hardReset:()=>hardReset,hardResetEditor:()=>hardResetEditor,hasOwnProperty:()=>object_hasOwnProperty,highlightShapeMigrations:()=>rI,highlightShapeProps:()=>rk,idValidator:()=>idValidator,imageShapeMigrations:()=>rM,imageShapeProps:()=>rA,intersectLineSegmentPolygon:()=>intersectLineSegmentPolygon,intersectLineSegmentPolyline:()=>intersectLineSegmentPolyline,intersectPolygonPolygon:()=>intersectPolygonPolygon,isAngleBetween:()=>isAngleBetween,isDefined:()=>isDefined,isGifAnimated:()=>isGifAnimated,isNonNull:()=>isNonNull,isNonNullish:()=>isNonNullish,isPageId:()=>isPageId,isSafeFloat:()=>isSafeFloat,isShape:()=>isShape,isShapeId:()=>isShapeId,isValidUrl:()=>isValidUrl,last:()=>last,lerp:()=>lerp,lerpAngles:()=>lerpAngles,lineShapeMigrations:()=>rL,lineShapeProps:()=>rj,linesIntersect:()=>linesIntersect,lns:()=>lns,loadSessionStateSnapshotIntoStore:()=>loadSessionStateSnapshotIntoStore,longAngleDist:()=>longAngleDist,loopToHtmlElement:()=>loopToHtmlElement,mapObjectMapValues:()=>mapObjectMapValues,menuCustom:()=>menuCustom,menuGroup:()=>menuGroup,menuItem:()=>menuItem,menuSubmenu:()=>menuSubmenu,migrate:()=>migrate,migrateRecord:()=>migrateRecord,minBy:()=>minBy,modulate:()=>modulate,noop:()=>noop,normalizeWheel:()=>normalizeWheel,noteShapeMigrations:()=>rz,noteShapeProps:()=>rF,objectMapEntries:()=>objectMapEntries,objectMapFromEntries:()=>objectMapFromEntries,objectMapKeys:()=>objectMapKeys,objectMapValues:()=>objectMapValues,omitFromStackTrace:()=>omitFromStackTrace,opacityValidator:()=>tn,openWindow:()=>openWindow,pageIdValidator:()=>tl,parentIdValidator:()=>tm,parseAndLoadDocument:()=>parseAndLoadDocument,parseTldrawJsonFile:()=>parseTldrawJsonFile,partition:()=>partition,perimeterOfEllipse:()=>perimeterOfEllipse,pointInBounds:()=>pointInBounds,pointInCircle:()=>pointInCircle,pointInEllipse:()=>pointInEllipse,pointInPolygon:()=>pointInPolygon,pointInPolyline:()=>pointInPolyline,pointInRect:()=>pointInRect,pointNearToLineSegment:()=>pointNearToLineSegment,pointNearToPolyline:()=>pointNearToPolyline,polygonsIntersect:()=>polygonsIntersect,precise:()=>precise,preventDefault:()=>preventDefault,promiseWithResolve:()=>promiseWithResolve,radiansToDegrees:()=>radiansToDegrees,rafThrottle:()=>rafThrottle,rangeIntersection:()=>rangeIntersection,react:()=>EffectScheduler_react,refreshPage:()=>refreshPage,releasePointerCapture:()=>releasePointerCapture,resizeBox:()=>resizeBox,reverseRecordsDiff:()=>reverseRecordsDiff,rng:()=>rng,rootShapeMigrations:()=>tY,rotateArray:()=>rotateArray,rotateSelectionHandle:()=>rotateSelectionHandle,runtime:()=>nr,scribbleValidator:()=>ts,serializeTldrawJson:()=>serializeTldrawJson,serializeTldrawJsonBlob:()=>serializeTldrawJsonBlob,setDefaultEditorAssetUrls:()=>setDefaultEditorAssetUrls,setDefaultUiAssetUrls:()=>setDefaultUiAssetUrls,setPointerCapture:()=>setPointerCapture,setRuntimeOverrides:()=>setRuntimeOverrides,setUserPreferences:()=>setUserPreferences,shapeIdValidator:()=>ty,shortAngleDist:()=>shortAngleDist,snapAngle:()=>snapAngle,sortById:()=>sortById,sortByIndex:()=>reordering_sortByIndex,squashRecordDiffs:()=>squashRecordDiffs,stopEventPropagation:()=>stopEventPropagation,structuredClone:()=>eL,textShapeMigrations:()=>rH,textShapeProps:()=>rB,throttle:()=>throttle,throttledRaf:()=>throttledRaf,toDomPrecision:()=>toDomPrecision,toFixed:()=>toFixed,toPrecision:()=>toPrecision,toolbarItem:()=>toolbarItem,track:()=>track,transact:()=>transact,transaction:()=>transaction,truncateStringWithEllipsis:()=>truncateStringWithEllipsis,uniq:()=>uniq,uniqueId:()=>uniqueId,useActions:()=>useActions,useActionsMenuSchema:()=>useActionsMenuSchema,useAssetUrls:()=>useAssetUrls,useBreakpoint:()=>useBreakpoint,useCanRedo:()=>useCanRedo,useCanUndo:()=>useCanUndo,useComputed:()=>useComputed,useContainer:()=>useContainer,useContextMenuSchema:()=>useContextMenuSchema,useCopyAs:()=>useCopyAs,useDefaultHelpers:()=>useDefaultHelpers,useDialogs:()=>useDialogs,useEditor:()=>useEditor,useExportAs:()=>useExportAs,useHelpMenuSchema:()=>useHelpMenuSchema,useIsCropping:()=>useIsCropping,useIsDarkMode:()=>useIsDarkMode,useIsEditing:()=>useIsEditing,useKeyboardShortcuts:()=>useKeyboardShortcuts,useKeyboardShortcutsSchema:()=>useKeyboardShortcutsSchema,useLocalStorageState:()=>useLocalStorageState,useLocalStore:()=>useLocalStore,useMenuClipboardEvents:()=>useMenuClipboardEvents,useMenuIsOpen:()=>useMenuIsOpen,useMenuSchema:()=>useMenuSchema,useNativeClipboardEvents:()=>useNativeClipboardEvents,usePeerIds:()=>usePeerIds,usePresence:()=>usePresence,useQuickReactor:()=>useQuickReactor,useReactor:()=>useReactor,useReadonly:()=>useReadonly,useSelectionEvents:()=>useSelectionEvents,useTLStore:()=>useTLStore,useToasts:()=>useToasts,useToolbarSchema:()=>useToolbarSchema,useTools:()=>useTools,useTransform:()=>useTransform,useTranslation:()=>useTranslation,useUiEvents:()=>useUiEvents,useValue:()=>useValue,vec2dModelValidator:()=>e9,videoShapeMigrations:()=>rK,videoShapeProps:()=>rG,whyAmIRunning:()=>whyAmIRunning});var g,m,y,b,v,S,x,w,_,P,E={};r.r(E),r.d(E,{ArrayOfValidator:()=>ArrayOfValidator,DictValidator:()=>DictValidator,ObjectValidator:()=>ObjectValidator,UnionValidator:()=>UnionValidator,ValidationError:()=>ValidationError,Validator:()=>Validator,any:()=>eU,array:()=>e0,arrayOf:()=>arrayOf,bigint:()=>eJ,boolean:()=>eQ,dict:()=>dict,integer:()=>eY,jsonDict:()=>jsonDict,jsonValue:()=>e2,literal:()=>literal,literalEnum:()=>literalEnum,model:()=>model,nonZeroInteger:()=>eZ,nonZeroNumber:()=>eK,nullable:()=>nullable,number:()=>eG,object:()=>object,optional:()=>optional,positiveInteger:()=>eX,positiveNumber:()=>eW,setEnum:()=>setEnum,string:()=>eH,union:()=>union,unknown:()=>eB,unknownObject:()=>e1});var C={};r.r(C),r.d(C,{Body:()=>Body,CloseButton:()=>CloseButton,Footer:()=>Footer,Header:()=>Header,Title:()=>Title});var k={};r.r(k),r.d(k,{CheckboxItem:()=>CheckboxItem,Content:()=>Content,Group:()=>Group,Indicator:()=>Indicator,Item:()=>Item,RadioItem:()=>RadioItem,Root:()=>Root,Sub:()=>Sub,SubContent:()=>SubContent,SubTrigger:()=>SubTrigger,Trigger:()=>Trigger});var I=r(784);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var T=r(9885),A=r.t(T,2);function $e42e1063c40fb3ef$export$b9ecd428b558ff10(e,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(null==e||e(n),!1===r||!n.defaultPrevented)return null==t?void 0:t(n)}}function $6ed0406888f73fc4$var$setRef(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...e){return t=>e.forEach(e=>$6ed0406888f73fc4$var$setRef(e,t))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...e){return(0,T.useCallback)($6ed0406888f73fc4$export$43e446d32b3d21af(...e),e)}function $c512c27ab02ef895$export$fd42f52fd3ae1109(e,t){let r=(0,T.createContext)(t);function Provider(e){let{children:t,...n}=e,i=(0,T.useMemo)(()=>n,Object.values(n));return(0,T.createElement)(r.Provider,{value:i},t)}function useContext(n){let i=(0,T.useContext)(r);if(i)return i;if(void 0!==t)return t;throw Error(`\`${n}\` must be used within \`${e}\``)}return Provider.displayName=e+"Provider",[Provider,useContext]}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(e,t=[]){let r=[];function $c512c27ab02ef895$export$fd42f52fd3ae1109(t,n){let i=(0,T.createContext)(n),o=r.length;function Provider(t){let{scope:r,children:n,...a}=t,l=(null==r?void 0:r[e][o])||i,d=(0,T.useMemo)(()=>a,Object.values(a));return(0,T.createElement)(l.Provider,{value:d},n)}function useContext(r,a){let l=(null==a?void 0:a[e][o])||i,d=(0,T.useContext)(l);if(d)return d;if(void 0!==n)return n;throw Error(`\`${r}\` must be used within \`${t}\``)}return r=[...r,n],Provider.displayName=t+"Provider",[Provider,useContext]}let createScope=()=>{let t=r.map(e=>(0,T.createContext)(e));return function(r){let n=(null==r?void 0:r[e])||t;return(0,T.useMemo)(()=>({[`__scope${e}`]:{...r,[e]:n}}),[r,n])}};return createScope.scopeName=e,[$c512c27ab02ef895$export$fd42f52fd3ae1109,$c512c27ab02ef895$var$composeContextScopes(createScope,...t)]}function $c512c27ab02ef895$var$composeContextScopes(...e){let t=e[0];if(1===e.length)return t;let createScope1=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let n=r.reduce((t,{useScope:r,scopeName:n})=>{let i=r(e),o=i[`__scope${n}`];return{...t,...o}},{});return(0,T.useMemo)(()=>({[`__scope${t.scopeName}`]:n}),[n])}};return createScope1.scopeName=t.scopeName,createScope1}let $=(null==globalThis?void 0:globalThis.document)?T.useLayoutEffect:()=>{},M=A["useId".toString()]||(()=>void 0),D=0;function $1746a345f3d73bb7$export$f680877a34711e37(e){let[t,r]=T.useState(M());return $(()=>{e||r(e=>null!=e?e:String(D++))},[e]),e||(t?`radix-${t}`:"")}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e){let t=(0,T.useRef)(e);return(0,T.useEffect)(()=>{t.current=e}),(0,T.useMemo)(()=>(...e)=>{var r;return null===(r=t.current)||void 0===r?void 0:r.call(t,...e)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:e,defaultProp:t,onChange:r=()=>{}}){let[n,i]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:t,onChange:r}),o=void 0!==e,a=o?e:n,l=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(r),d=(0,T.useCallback)(t=>{if(o){let r="function"==typeof t?t(e):t;r!==e&&l(r)}else i(t)},[o,e,i,l]);return[a,d]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:e,onChange:t}){let r=(0,T.useState)(e),[n]=r,i=(0,T.useRef)(n),o=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(t);return(0,T.useEffect)(()=>{i.current!==n&&(o(n),i.current=n)},[n,i,o]),r}var V=r(8908);let R=(0,T.forwardRef)((e,t)=>{let{children:r,...n}=e,i=T.Children.toArray(r),o=i.find($5e63c961fc1ce211$var$isSlottable);if(o){let e=o.props.children,r=i.map(t=>t!==o?t:T.Children.count(e)>1?T.Children.only(null):(0,T.isValidElement)(e)?e.props.children:null);return(0,T.createElement)(j,_extends({},n,{ref:t}),(0,T.isValidElement)(e)?(0,T.cloneElement)(e,void 0,r):null)}return(0,T.createElement)(j,_extends({},n,{ref:t}),r)});R.displayName="Slot";let j=(0,T.forwardRef)((e,t)=>{let{children:r,...n}=e;return(0,T.isValidElement)(r)?(0,T.cloneElement)(r,{...$5e63c961fc1ce211$var$mergeProps(n,r.props),ref:t?$6ed0406888f73fc4$export$43e446d32b3d21af(t,r.ref):r.ref}):T.Children.count(r)>1?T.Children.only(null):null});j.displayName="SlotClone";let $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:e})=>(0,T.createElement)(T.Fragment,null,e);function $5e63c961fc1ce211$var$isSlottable(e){return(0,T.isValidElement)(e)&&e.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(e,t){let r={...t};for(let n in t){let i=e[n],o=t[n],a=/^on[A-Z]/.test(n);a?i&&o?r[n]=(...e)=>{o(...e),i(...e)}:i&&(r[n]=i):"style"===n?r[n]={...i,...o}:"className"===n&&(r[n]=[i,o].filter(Boolean).join(" "))}return{...e,...r}}let O=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=(0,T.forwardRef)((e,r)=>{let{asChild:n,...i}=e,o=n?R:t;return(0,T.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,T.createElement)(o,_extends({},i,{ref:r}))});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(e,t){e&&(0,V.flushSync)(()=>e.dispatchEvent(t))}function $addc16e1bbe58fd0$export$3a72a57244d6e765(e,t=null==globalThis?void 0:globalThis.document){let r=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e);(0,T.useEffect)(()=>{let handleKeyDown=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",handleKeyDown),()=>t.removeEventListener("keydown",handleKeyDown)},[r,t])}let L="dismissableLayer.update",F=(0,T.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),N=(0,T.forwardRef)((e,t)=>{var r;let{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:o,onPointerDownOutside:a,onFocusOutside:l,onInteractOutside:d,onDismiss:c,...u}=e,p=(0,T.useContext)(F),[h,f]=(0,T.useState)(null),g=null!==(r=null==h?void 0:h.ownerDocument)&&void 0!==r?r:null==globalThis?void 0:globalThis.document,[,m]=(0,T.useState)({}),y=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>f(e)),b=Array.from(p.layers),[v]=[...p.layersWithOutsidePointerEventsDisabled].slice(-1),S=b.indexOf(v),x=h?b.indexOf(h):-1,w=p.layersWithOutsidePointerEventsDisabled.size>0,_=x>=S,P=$5cb92bef7577960e$var$usePointerDownOutside(e=>{let t=e.target,r=[...p.branches].some(e=>e.contains(t));!_||r||(null==a||a(e),null==d||d(e),e.defaultPrevented||null==c||c())},g),E=$5cb92bef7577960e$var$useFocusOutside(e=>{let t=e.target,r=[...p.branches].some(e=>e.contains(t));r||(null==l||l(e),null==d||d(e),e.defaultPrevented||null==c||c())},g);return $addc16e1bbe58fd0$export$3a72a57244d6e765(e=>{let t=x===p.layers.size-1;t&&(null==o||o(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))},g),(0,T.useEffect)(()=>{if(h)return i&&(0===p.layersWithOutsidePointerEventsDisabled.size&&(n=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),p.layersWithOutsidePointerEventsDisabled.add(h)),p.layers.add(h),$5cb92bef7577960e$var$dispatchUpdate(),()=>{i&&1===p.layersWithOutsidePointerEventsDisabled.size&&(g.body.style.pointerEvents=n)}},[h,g,i,p]),(0,T.useEffect)(()=>()=>{h&&(p.layers.delete(h),p.layersWithOutsidePointerEventsDisabled.delete(h),$5cb92bef7577960e$var$dispatchUpdate())},[h,p]),(0,T.useEffect)(()=>{let handleUpdate=()=>m({});return document.addEventListener(L,handleUpdate),()=>document.removeEventListener(L,handleUpdate)},[]),(0,T.createElement)(O.div,_extends({},u,{ref:y,style:{pointerEvents:w?_?"auto":"none":void 0,...e.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocusCapture,E.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onBlurCapture,E.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDownCapture,P.onPointerDownCapture)}))}),z=(0,T.forwardRef)((e,t)=>{let r=(0,T.useContext)(F),n=(0,T.useRef)(null),i=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,n);return(0,T.useEffect)(()=>{let e=n.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,T.createElement)(O.div,_extends({},e,{ref:i}))});function $5cb92bef7577960e$var$usePointerDownOutside(e,t=null==globalThis?void 0:globalThis.document){let r=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e),n=(0,T.useRef)(!1),i=(0,T.useRef)(()=>{});return(0,T.useEffect)(()=>{let handlePointerDown=e=>{if(e.target&&!n.current){let n={originalEvent:e};function handleAndDispatchPointerDownOutsideEvent(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent("dismissableLayer.pointerDownOutside",r,n,{discrete:!0})}"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=handleAndDispatchPointerDownOutsideEvent,t.addEventListener("click",i.current,{once:!0})):handleAndDispatchPointerDownOutsideEvent()}else t.removeEventListener("click",i.current);n.current=!1},e=window.setTimeout(()=>{t.addEventListener("pointerdown",handlePointerDown)},0);return()=>{window.clearTimeout(e),t.removeEventListener("pointerdown",handlePointerDown),t.removeEventListener("click",i.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(e,t=null==globalThis?void 0:globalThis.document){let r=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e),n=(0,T.useRef)(!1);return(0,T.useEffect)(()=>{let handleFocus=e=>{e.target&&!n.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",handleFocus),()=>t.removeEventListener("focusin",handleFocus)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){let e=new CustomEvent(L);document.dispatchEvent(e)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(e,t,r,{discrete:n}){let i=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),n?$8927f6f2acc4f386$export$6d1a0317bde7de7f(i,o):i.dispatchEvent(o)}let B="focusScope.autoFocusOnMount",U="focusScope.autoFocusOnUnmount",H={bubbles:!1,cancelable:!0},G=(0,T.forwardRef)((e,t)=>{let{loop:r=!1,trapped:n=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...a}=e,[l,d]=(0,T.useState)(null),c=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(i),u=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(o),p=(0,T.useRef)(null),h=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>d(e)),f=(0,T.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,T.useEffect)(()=>{if(n){function handleFocusIn(e){if(f.paused||!l)return;let t=e.target;l.contains(t)?p.current=t:$d3863c46a17e8a28$var$focus(p.current,{select:!0})}function handleFocusOut(e){if(f.paused||!l)return;let t=e.relatedTarget;null===t||l.contains(t)||$d3863c46a17e8a28$var$focus(p.current,{select:!0})}function handleMutations(e){let t=document.activeElement;if(t===document.body)for(let t of e)t.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(l)}document.addEventListener("focusin",handleFocusIn),document.addEventListener("focusout",handleFocusOut);let e=new MutationObserver(handleMutations);return l&&e.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",handleFocusIn),document.removeEventListener("focusout",handleFocusOut),e.disconnect()}}},[n,l,f.paused]),(0,T.useEffect)(()=>{if(l){W.add(f);let e=document.activeElement,t=l.contains(e);if(!t){let t=new CustomEvent(B,H);l.addEventListener(B,c),l.dispatchEvent(t),t.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(l)),{select:!0}),document.activeElement===e&&$d3863c46a17e8a28$var$focus(l))}return()=>{l.removeEventListener(B,c),setTimeout(()=>{let t=new CustomEvent(U,H);l.addEventListener(U,u),l.dispatchEvent(t),t.defaultPrevented||$d3863c46a17e8a28$var$focus(null!=e?e:document.body,{select:!0}),l.removeEventListener(U,u),W.remove(f)},0)}}},[l,c,u,f]);let g=(0,T.useCallback)(e=>{if(!r&&!n||f.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[n,o]=$d3863c46a17e8a28$var$getTabbableEdges(t),a=n&&o;a?e.shiftKey||i!==o?e.shiftKey&&i===n&&(e.preventDefault(),r&&$d3863c46a17e8a28$var$focus(o,{select:!0})):(e.preventDefault(),r&&$d3863c46a17e8a28$var$focus(n,{select:!0})):i===t&&e.preventDefault()}},[r,n,f.paused]);return(0,T.createElement)(O.div,_extends({tabIndex:-1},a,{ref:h,onKeyDown:g}))});function $d3863c46a17e8a28$var$focusFirst(e,{select:t=!1}={}){let r=document.activeElement;for(let n of e)if($d3863c46a17e8a28$var$focus(n,{select:t}),document.activeElement!==r)return}function $d3863c46a17e8a28$var$getTabbableEdges(e){let t=$d3863c46a17e8a28$var$getTabbableCandidates(e),r=$d3863c46a17e8a28$var$findVisible(t,e),n=$d3863c46a17e8a28$var$findVisible(t.reverse(),e);return[r,n]}function $d3863c46a17e8a28$var$getTabbableCandidates(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function $d3863c46a17e8a28$var$findVisible(e,t){for(let r of e)if(!$d3863c46a17e8a28$var$isHidden(r,{upTo:t}))return r}function $d3863c46a17e8a28$var$isHidden(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function $d3863c46a17e8a28$var$focus(e,{select:t=!1}={}){if(e&&e.focus){let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&$d3863c46a17e8a28$var$isSelectableInput(e)&&t&&e.select()}}let W=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let e=[];return{add(t){let r=e[0];t!==r&&(null==r||r.pause()),(e=$d3863c46a17e8a28$var$arrayRemove(e,t)).unshift(t)},remove(t){var r;null===(r=(e=$d3863c46a17e8a28$var$arrayRemove(e,t))[0])||void 0===r||r.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(e,t){let r=[...e],n=r.indexOf(t);return -1!==n&&r.splice(n,1),r}function $d3863c46a17e8a28$var$removeLinks(e){return e.filter(e=>"A"!==e.tagName)}let K=(0,T.forwardRef)((e,t)=>{var r;let{container:n=null==globalThis?void 0:null===(r=globalThis.document)||void 0===r?void 0:r.body,...i}=e;return n?V.createPortal((0,T.createElement)(O.div,_extends({},i,{ref:t})),n):null});function $fe963b355347cc68$export$3e6543de14f8614f(e,t){return(0,T.useReducer)((e,r)=>{let n=t[e][r];return null!=n?n:e},e)}let $921a889cee6df7e8$export$99c2b779aa4e8b8b=e=>{let{present:t,children:r}=e,n=$921a889cee6df7e8$var$usePresence(t),i="function"==typeof r?r({present:n.isPresent}):T.Children.only(r),o=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(n.ref,i.ref),a="function"==typeof r;return a||n.isPresent?(0,T.cloneElement)(i,{ref:o}):null};function $921a889cee6df7e8$var$usePresence(e){let[t,r]=(0,T.useState)(),n=(0,T.useRef)({}),i=(0,T.useRef)(e),o=(0,T.useRef)("none"),a=e?"mounted":"unmounted",[l,d]=$fe963b355347cc68$export$3e6543de14f8614f(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,T.useEffect)(()=>{let e=$921a889cee6df7e8$var$getAnimationName(n.current);o.current="mounted"===l?e:"none"},[l]),$(()=>{let t=n.current,r=i.current,a=r!==e;if(a){let n=o.current,a=$921a889cee6df7e8$var$getAnimationName(t);e?d("MOUNT"):"none"===a||(null==t?void 0:t.display)==="none"?d("UNMOUNT"):r&&n!==a?d("ANIMATION_OUT"):d("UNMOUNT"),i.current=e}},[e,d]),$(()=>{if(t){let handleAnimationEnd=e=>{let r=$921a889cee6df7e8$var$getAnimationName(n.current),i=r.includes(e.animationName);e.target===t&&i&&(0,V.flushSync)(()=>d("ANIMATION_END"))},handleAnimationStart=e=>{e.target===t&&(o.current=$921a889cee6df7e8$var$getAnimationName(n.current))};return t.addEventListener("animationstart",handleAnimationStart),t.addEventListener("animationcancel",handleAnimationEnd),t.addEventListener("animationend",handleAnimationEnd),()=>{t.removeEventListener("animationstart",handleAnimationStart),t.removeEventListener("animationcancel",handleAnimationEnd),t.removeEventListener("animationend",handleAnimationEnd)}}d("ANIMATION_END")},[t,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:(0,T.useCallback)(e=>{e&&(n.current=getComputedStyle(e)),r(e)},[])}}function $921a889cee6df7e8$var$getAnimationName(e){return(null==e?void 0:e.animationName)||"none"}$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";let q=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){(0,T.useEffect)(()=>{var e,t;let r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=r[0])&&void 0!==e?e:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",null!==(t=r[1])&&void 0!==t?t:$3db38b7d1fb3fe6a$var$createFocusGuard()),q++,()=>{1===q&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),q--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var Y=r(2864),X=r(4348);let Z="Dialog",[Q,J]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(Z),[ee,et]=Q(Z),er="DialogPortal",[en,ei]=Q(er,{forceMount:void 0}),eo="DialogOverlay",ea=(0,T.forwardRef)((e,t)=>{let r=ei(eo,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,o=et(eo,e.__scopeDialog);return o.modal?(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:n||o.open},(0,T.createElement)(es,_extends({},i,{ref:t}))):null}),es=(0,T.forwardRef)((e,t)=>{let{__scopeDialog:r,...n}=e,i=et(eo,r);return(0,T.createElement)(Y.RemoveScroll,{as:R,allowPinchZoom:!0,shards:[i.contentRef]},(0,T.createElement)(O.div,_extends({"data-state":$5d3850c4d0b4e6c7$var$getState(i.open)},n,{ref:t,style:{pointerEvents:"auto",...n.style}})))}),el="DialogContent",ed=(0,T.forwardRef)((e,t)=>{let r=ei(el,e.__scopeDialog),{forceMount:n=r.forceMount,...i}=e,o=et(el,e.__scopeDialog);return(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:n||o.open},o.modal?(0,T.createElement)(ec,_extends({},i,{ref:t})):(0,T.createElement)(eu,_extends({},i,{ref:t})))}),ec=(0,T.forwardRef)((e,t)=>{let r=et(el,e.__scopeDialog),n=(0,T.useRef)(null),i=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,r.contentRef,n);return(0,T.useEffect)(()=>{let e=n.current;if(e)return(0,X.hideOthers)(e)},[]),(0,T.createElement)(ep,_extends({},e,{ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null===(t=r.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;n&&e.preventDefault()}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocusOutside,e=>e.preventDefault())}))}),eu=(0,T.forwardRef)((e,t)=>{let r=et(el,e.__scopeDialog),n=(0,T.useRef)(!1),i=(0,T.useRef)(!1);return(0,T.createElement)(ep,_extends({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,a;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(n.current||null===(a=r.triggerRef.current)||void 0===a||a.focus(),t.preventDefault()),n.current=!1,i.current=!1},onInteractOutside:t=>{var o,a;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(n.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let l=t.target,d=null===(a=r.triggerRef.current)||void 0===a?void 0:a.contains(l);d&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),ep=(0,T.forwardRef)((e,t)=>{let{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:i,onCloseAutoFocus:o,...a}=e,l=et(el,r),d=(0,T.useRef)(null),c=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,d);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),(0,T.createElement)(T.Fragment,null,(0,T.createElement)(G,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,T.createElement)(N,_extends({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":$5d3850c4d0b4e6c7$var$getState(l.open)},a,{ref:c,onDismiss:()=>l.onOpenChange(!1)}))),!1)}),eh="DialogTitle",ef=(0,T.forwardRef)((e,t)=>{let{__scopeDialog:r,...n}=e,i=et(eh,r);return(0,T.createElement)(O.h2,_extends({id:i.titleId},n,{ref:t}))}),eg=(0,T.forwardRef)((e,t)=>{let{__scopeDialog:r,...n}=e,i=et("DialogClose",r);return(0,T.createElement)(O.button,_extends({type:"button"},n,{ref:t,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onClick,()=>i.onOpenChange(!1))}))});function $5d3850c4d0b4e6c7$var$getState(e){return e?"open":"closed"}let[em,ey]=$c512c27ab02ef895$export$fd42f52fd3ae1109("DialogTitleWarning",{contentName:el,titleName:eh,docsSlug:"dialog"}),$5d3850c4d0b4e6c7$export$be92b6f5f03c0fe9=e=>{let{__scopeDialog:t,children:r,open:n,defaultOpen:i,onOpenChange:o,modal:a=!0}=e,l=(0,T.useRef)(null),d=(0,T.useRef)(null),[c=!1,u]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:n,defaultProp:i,onChange:o});return(0,T.createElement)(ee,{scope:t,triggerRef:l,contentRef:d,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),titleId:$1746a345f3d73bb7$export$f680877a34711e37(),descriptionId:$1746a345f3d73bb7$export$f680877a34711e37(),open:c,onOpenChange:u,onOpenToggle:(0,T.useCallback)(()=>u(e=>!e),[u]),modal:a},r)},$5d3850c4d0b4e6c7$export$602eac185826482c=e=>{let{__scopeDialog:t,forceMount:r,children:n,container:i}=e,o=et(er,t);return(0,T.createElement)(en,{scope:t,forceMount:r},T.Children.map(n,e=>(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:r||o.open},(0,T.createElement)(K,{asChild:!0,container:i},e))))};var eb=r(9367);let ArraySet=class ArraySet{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array){let t=this.array.indexOf(e);return -1===t&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0)}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let r=this.array[t];void 0!==r&&e(r)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}};function isChild(e){return e&&"object"==typeof e&&"parents"in e}function haveParentsChanged(e){for(let t=0,r=e.parents.length;t<r;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}let detach=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&isChild(e))for(let t=0,r=e.parents.length;t<r;t++)detach(e.parents[t],e)},attach=(e,t)=>{if(e.children.add(t)&&isChild(e))for(let t=0,r=e.parents.length;t<r;t++)attach(e.parents[t],e)};function equals(e,t){let r=e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t));return r}let ev=Object.freeze([]),eS=Symbol.for("__@tldraw/state__"),ex=globalThis;ex[eS]?console.error('Multiple versions of @tldraw/state detected. This will cause unexpected behavior. Please add "resolutions" (yarn/pnpm) or "overrides" (npm) in your package.json to ensure only one version of @tldraw/state is loaded.'):ex[eS]=!0;let CaptureStackFrame=class CaptureStackFrame{constructor(e,t){this.below=e,this.child=t}offset=0;numNewParents=0;maybeRemoved};let ew=null;function startCapturingParents(e){ew=new CaptureStackFrame(ew,e)}function stopCapturingParents(){let e=ew;ew=e.below;let t=e.numNewParents>0||e.offset!==e.child.parents.length;if(t){for(let t=e.offset;t<e.child.parents.length;t++){let r=e.child.parents[t],n=e.child.parents.indexOf(r)>=e.offset;n&&detach(r,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,ew?.maybeRemoved)for(let t=0;t<ew.maybeRemoved.length;t++){let r=ew.maybeRemoved[t];-1===e.child.parents.indexOf(r)&&detach(r,e.child)}}}function maybeCaptureParent(e){if(ew){let t=ew.child.parents.indexOf(e);if(t<0&&(ew.numNewParents++,ew.child.isActivelyListening&&attach(e,ew.child)),t<0||t>=ew.offset){if(t!==ew.offset&&t>0){let e=ew.child.parents[ew.offset];ew.maybeRemoved?-1===ew.maybeRemoved.indexOf(e)&&ew.maybeRemoved.push(e):ew.maybeRemoved=[e]}ew.child.parents[ew.offset]=e,ew.child.parentEpochs[ew.offset]=e.lastChangedEpoch,ew.offset++}}}function whyAmIRunning(){let e=ew?.child;if(!e)throw Error("whyAmIRunning() called outside of a reactive context");let t=[];for(let r=0;r<e.parents.length;r++){let n=e.parents[r];n.lastChangedEpoch>e.parentEpochs[r]&&t.push(n)}if(0===t.length)console.log(e.name,"is running but none of the parents changed");else for(let r of(console.log(e.name,"is running because:"),t))console.log("	",r.name,"changed =>",r.__unsafe__getWithoutCapture())}let e_=Symbol("RESET_VALUE");let HistoryBuffer=class HistoryBuffer{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,r){if(void 0!==r){if(r===e_){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:r,buffer:n}=this;for(let i=0;i<r;i++){let o=(t-1+r-i)%r,a=n[o];if(!a)break;let[l,d]=a;if(0===i&&e>=d)return[];if(l<=e&&e<d){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=n[(o+i)%r][2];return t}}return e_}};let eP=0,eE=!1;function advanceGlobalEpoch(){eP++}let Transaction=class Transaction{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(this.isRoot){let e=this.initialAtomValues;this.initialAtomValues=new Map,flushChanges(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){eP++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}};function flushChanges(e){if(eE)throw Error("cannot change atoms during reaction cycle");try{eE=!0;let t=new Set,traverse=e=>{e.lastTraversedEpoch!==eP&&(e.lastTraversedEpoch=eP,"maybeScheduleEffect"in e?t.add(e):e.children.visit(traverse))};for(let t of e)t.children.visit(traverse);for(let e of t)e.maybeScheduleEffect()}finally{eE=!1}}function atomDidChange(e,t){eC?eC.initialAtomValues.has(e)||eC.initialAtomValues.set(e,t):flushChanges([e])}let eC=null;function transaction(e){let t=new Transaction(eC);eC=t;try{let r=!1,n=e(()=>r=!0);return r?t.abort():t.commit(),n}catch(e){throw t.abort(),e}finally{eC=eC.parent}}function transact(e){return eC?e():transaction(e)}let Atom_Atom=class Atom_Atom{constructor(e,t,r){if(this.name=e,this.current=t,this.isEqual=r?.isEqual??null,!r)return;r.historyLength&&(this.historyBuffer=new HistoryBuffer(r.historyLength)),this.computeDiff=r.computeDiff}isEqual;computeDiff;lastChangedEpoch=eP;children=new ArraySet;historyBuffer;__unsafe__getWithoutCapture(){return this.current}get value(){return maybeCaptureParent(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??equals(this.current,e))return this.current;advanceGlobalEpoch(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,eP,t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,eP)??e_),this.lastChangedEpoch=eP;let r=this.current;return this.current=e,atomDidChange(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(maybeCaptureParent(this),e>=this.lastChangedEpoch)?ev:this.historyBuffer?.getChangesSince(e)??e_}};function Atom_atom(e,t,r){return new Atom_Atom(e,t,r)}let ek=Symbol("UNINITIALIZED"),isUninitialized=e=>e===ek;let WithDiff=class WithDiff{constructor(e,t){this.value=e,this.diff=t}};function withDiff(e,t){return new WithDiff(e,t)}let Computed_Computed=class Computed_Computed{constructor(e,t,r){this.name=e,this.derive=t,r?.historyLength&&(this.historyBuffer=new HistoryBuffer(r.historyLength)),this.computeDiff=r?.computeDiff,this.isEqual=r?.isEqual??equals}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parents=[];parentEpochs=[];children=new ArraySet;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=ek;computeDiff;isEqual;__unsafe__getWithoutCapture(){let e=-1===this.lastChangedEpoch;if(!e&&(this.lastCheckedEpoch===eP||!haveParentsChanged(this)))return this.lastCheckedEpoch=eP,this.state;try{startCapturingParents(this);let t=this.derive(this.state,this.lastCheckedEpoch),r=t instanceof WithDiff?t.value:t;if(this.state===ek||!this.isEqual(r,this.state)){if(this.historyBuffer&&!e){let e=t instanceof WithDiff?t.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,eP,e??this.computeDiff?.(this.state,r,this.lastCheckedEpoch,eP)??e_)}this.lastChangedEpoch=eP,this.state=r}return this.lastCheckedEpoch=eP,this.state}finally{stopCapturingParents()}}get value(){let e=this.__unsafe__getWithoutCapture();return maybeCaptureParent(this),e}getDiffSince(e){return(this.value,e>=this.lastChangedEpoch)?ev:this.historyBuffer?.getChangesSince(e)??e_}};function computedAnnotation(e={},t,r,n){let i=n.get,o=Symbol.for("__@tldraw/state__computed__"+r);return n.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new Computed_Computed(r,i.bind(this),e)}),t.value},n}function computed(){if(1==arguments.length){let e=arguments[0];return(t,r,n)=>computedAnnotation(e,t,r,n)}return"string"==typeof arguments[0]?new Computed_Computed(arguments[0],arguments[1],arguments[2]):computedAnnotation(void 0,arguments[0],arguments[1],arguments[2])}let EffectScheduler=class EffectScheduler{constructor(e,t,r){this.name=e,this.runEffect=t,this._scheduleEffect=r?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==eP){if(this.parents.length&&!haveParentsChanged(this)){this.lastReactedEpoch=eP;return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)attach(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)detach(this.parents[e],this)}execute(){try{startCapturingParents(this);let e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=eP,e}finally{stopCapturingParents()}}};function EffectScheduler_react(e,t,r){let n=new EffectScheduler(e,t,r);return n.attach(),n.scheduleEffect(),()=>{n.detach()}}function reactor(e,t,r){let n=new EffectScheduler(e,t,r);return{scheduler:n,start:e=>{let t=e?.force??!1;n.attach(),t?n.scheduleEffect():n.maybeScheduleEffect()},stop:()=>{n.detach()}}}function useStateTracking(e,t){let r=T.useRef(t);r.current=t;let[n,i,o]=T.useMemo(()=>{let t=null,n=new EffectScheduler(`useStateTracking(${e})`,()=>r.current?.(),{scheduleEffect(){t?.()}});return[n,e=>(t=e,()=>{t=null}),()=>n.scheduleCount]},[e]);return T.useSyncExternalStore(i,o,o),T.useEffect(()=>(n.attach(),n.maybeScheduleEffect(),()=>{n.detach()}),[n]),n.execute()}let eI={apply:(e,t,r)=>useStateTracking(e.displayName??e.name??"tracked(???)",()=>e.apply(t,r))},eT=Symbol.for("react.memo"),eA=Symbol.for("react.forward_ref");function track(e){let t=null,r=e.$$typeof;return(r===eT&&(t=(e=e.type).compare),r===eA)?(0,T.memo)((0,T.forwardRef)(new Proxy(e.render,eI))):(0,T.memo)(new Proxy(e,eI),t)}function useComputed(){let e=arguments[0],t=arguments[1],r=3==arguments.length?void 0:arguments[2],n=3==arguments.length?arguments[2]:arguments[3];return(0,T.useMemo)(()=>computed(`useComputed(${e})`,t,r),n)}function useQuickReactor(e,t,r=ev){(0,T.useEffect)(()=>{let r=new EffectScheduler(e,t);return r.attach(),r.execute(),()=>{r.detach()}},r)}function useReactor(e,t,r=[]){let n=(0,T.useMemo)(()=>new EffectScheduler(e,t,{scheduleEffect:e=>requestAnimationFrame(e)}),r);(0,T.useEffect)(()=>(n.attach(),n.execute(),()=>{n.detach()}),[n])}function useValue(){let e=arguments,t=3===e.length?e[2]:[e[0]],r=3===e.length?e[0]:`useValue(${e[0].name})`,n=(0,T.useRef)(!0);n.current=!0;let i=(0,T.useMemo)(()=>1===e.length?e[0]:computed(r,()=>{if(n.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{let{subscribe:e,getSnapshot:t}=(0,T.useMemo)(()=>({subscribe:e=>EffectScheduler_react(`useValue(${r})`,()=>{i.value,e()}),getSnapshot:()=>i.value}),[i]);return(0,T.useSyncExternalStore)(e,t,t)}finally{n.current=!1}}let IncrementalSetConstructor=class IncrementalSetConstructor{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){let r=this.diff?.removed?.has(e);if(!r)return;return this._add(e,t)}let r=this.nextValue?.has(e);r||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){let r=this.diff?.added?.has(e);if(!r)return;return this._remove(e,t)}let r=this.diff?.removed?.has(e);r||this._remove(e,t)}};function rotateArray(e,t){return e.map((r,n)=>e[(n+t)%e.length])}function dedupe(e,t){let r=[];t:for(let n of e){for(let e of r)if(t?t(n,e):n===e)continue t;r.push(n)}return r}function compact(e){return e.filter(e=>null!=e)}function last(e){return e[e.length-1]}function minBy(e,t){let r;let n=1/0;for(let i of e){let e=t(i);e<n&&(r=i,n=e)}return r}function partition(e,t){let r=[],n=[];for(let i of e)t(i)?r.push(i):n.push(i);return[r,n]}function throttle(e,t){let r,n;return function(...i){return r||(r=!0,setTimeout(()=>r=!1,t),n=e(...i)),n}}function omitFromStackTrace(e){let wrappedFn=(...t)=>{try{return e(...t)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,wrappedFn),e}};return wrappedFn}function noop(){}let e$={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function exhaustiveSwitchError(e,t){let r=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${r}`)}let eM=omitFromStackTrace((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),eD=omitFromStackTrace((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function promiseWithResolve(){let e,t;let r=new Promise((r,n)=>{e=r,t=n});return Object.assign(r,{resolve:e,reject:t})}function debounce(e,t){let r;let fn=(...n)=>(r||((r={}).promise=new Promise((e,t)=>{r.resolve=e,r.reject=t})),clearTimeout(r.timeout),r.latestArgs=n,r.timeout=setTimeout(()=>{let t=r;r=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),r.promise);return fn.cancel=()=>{r&&clearTimeout(r.timeout)},fn}let eV=new WeakMap;function annotateError(e,t){if("object"!=typeof e||null===e)return;let r=eV.get(e);r||(r={tags:{},extras:{}},eV.set(e,r)),t.tags&&(r.tags={...r.tags,...t.tags}),t.extras&&(r.extras={...r.extras,...t.extras})}function getErrorAnnotations(e){return eV.get(e)??{tags:{},extras:{}}}let FileHelpers=class FileHelpers{static async base64ToFile(e){return fetch(e).then(function(e){return e.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,r)=>{if(e){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>r(e),n.onabort=e=>r(e)}})}};function getHashForString(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t+""}function getHashForObject(e){return getHashForString(JSON.stringify(e))}function lns(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(e=>+e?5>+e?5+ +e:+e>5?+e-5:e:e).join("")}function getFirstFromIterable(e){return e.values().next().value}let eR=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(eR=new Int32Array(eR));let crc=(e,t)=>{let r=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)r=eR[(r^e[t])&255]^r>>>8;return -1^r};let PngHelpers=class PngHelpers{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let r={};if(!PngHelpers.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let n=t,i=e.getInt32(t);t+=4;let o=PngHelpers.getChunkType(e,t);if("IDAT"===o&&r[o]){t+=i+4+4;continue}if("IEND"===o)break;r[o]={start:n,dataOffset:t+4,size:i},t+=i+4+4}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){let r=PngHelpers.readChunks(e);return r[t]}static setPhysChunk(e,t=1,r){let n=46,i=0,o=PngHelpers.findChunk(e,"pHYs");o&&(n=o.start,i=o.size);let a=PngHelpers.findChunk(e,"IDAT");a&&(n=a.start,i=0);let l=new ArrayBuffer(21),d=new DataView(l);d.setUint32(0,9),d.setUint8(4,112),d.setUint8(5,72),d.setUint8(6,89),d.setUint8(7,115),d.setInt32(8,2835.5*t),d.setInt32(12,2835.5*t),d.setInt8(16,1);let c=new Uint8Array(l.slice(4,17));d.setInt32(17,crc(c));let u=e.buffer.slice(0,n),p=e.buffer.slice(n+i);return new Blob([u,l,p],r)}};let MediaHelpers=class MediaHelpers{static async getVideoSizeFromSrc(e){return await new Promise((t,r)=>{let n=document.createElement("video");n.onloadeddata=()=>t({w:n.videoWidth,h:n.videoHeight}),n.onerror=e=>{console.error(e),r(Error("Could not get video size"))},n.crossOrigin="anonymous",n.src=e})}static async getImageSizeFromSrc(e){return await new Promise((t,r)=>{let n=new Image;n.onload=async()=>{try{let r=await FileHelpers.base64ToFile(e),i=new DataView(r);if(PngHelpers.isPng(i,0)){let e=PngHelpers.findChunk(i,"pHYs");if(e){let r=PngHelpers.parsePhys(i,e.dataOffset);if(0===r.unit&&r.ppux===r.ppuy){let e=Math.round(r.ppux/2834.5);t({w:n.width/e,h:n.height/e});return}}}t({w:n.width,h:n.height})}catch(e){console.error(e),t({w:n.width,h:n.height})}},n.onerror=e=>{console.error(e),r(Error("Could not get image size"))},n.crossOrigin="anonymous",n.src=e})}};function lerp(e,t,r){return e+(t-e)*r}function rng(e=""){let t=0,r=0,n=0,i=0;function next(){let e=t^t<<11;return t=r,r=n,n=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let r=0;r<e.length+64;r++)t^=0|e.charCodeAt(r),next();return next}function modulate(e,t,r,n=!1){let[i,o]=t,[a,l]=r,d=a+(e-i)/(o-i)*(l-a);return n?a<l?Math.max(Math.min(d,l),a):Math.max(Math.min(d,a),l):d}function object_hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function getOwnProperty(e,t){if(object_hasOwnProperty(e,t))return e[t]}function deepCopy(e){if(!e)return e;if(Array.isArray(e)){let t=[],r=e.length;for(let n=0;n<r;n++)t.push(deepCopy(e[n]));return t}if("object"==typeof e){let t=Object.keys(e),r=t.length,n={};for(let i=0;i<r;i++){let r=t[i];n[r]=deepCopy(e[r])}return n}return e}function objectMapKeys(e){return Object.keys(e)}function objectMapValues(e){return Object.values(e)}function objectMapEntries(e){return Object.entries(e)}function objectMapFromEntries(e){return Object.fromEntries(e)}function filterEntries(e,t){let r={},n=!1;for(let[i,o]of objectMapEntries(e))t(i,o)?r[i]=o:n=!0;return n?r:e}function mapObjectMapValues(e,t){let r={};for(let[n,i]of objectMapEntries(e)){let e=t(n,i);r[n]=e}return r}let isTest=()=>"undefined"!=typeof process&&!1,ej=[],tick=()=>{let e=ej.splice(0,ej.length);for(let t of e)t()};function raf(){i||(i=requestAnimationFrame(()=>{i=void 0,tick()}))}function rafThrottle(e){return isTest()?e:()=>{ej.includes(e)||(ej.push(e),raf())}}function throttledRaf(e){if(isTest())return e();ej.includes(e)||(ej.push(e),raf())}function sortById(e,t){return e.id>t.id?1:-1}let eO=new RegExp(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i);function isValidUrl(e){return eO.test(e)}function isDefined(e){return void 0!==e}function isNonNull(e){return null!==e}function isNonNullish(e){return null!=e}let eL="undefined"!=typeof window&&window.structuredClone?window.structuredClone:e=>e?JSON.parse(JSON.stringify(e)):e;var eF=r(6113);let fillPool=e=>{!o||o.length<e?(o=Buffer.allocUnsafe(128*e),(0,eF.randomFillSync)(o),a=0):a+e>o.length&&((0,eF.randomFillSync)(o),a=0),a+=e},nanoid=(e=21)=>{fillPool(e-=0);let t="";for(let r=a-e;r<a;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&o[r]];return t};let RecordType=class RecordType{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document"}createDefaultProperties;migrations;validator;scope;create(e){let t={...this.createDefaultProperties(),id:this.createId()};for(let[r,n]of Object.entries(e))void 0!==n&&(t[r]=n);return t.typeName=this.typeName,t}clone(e){return{...eL(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??nanoid())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new RecordType(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}};function createRecordType(e,t){return new RecordType(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}function assertIdType(e,t){if(!e||!t.isId(e))throw Error(`string ${JSON.stringify(e)} is not a valid ${t.typeName} id`)}let Cache=class Cache{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}};var eN=r(510);function intersectSets(e){if(0===e.length)return new Set;let t=e[0],r=e.slice(1),n=new Set;for(let e of t)r.every(t=>t.has(e))&&n.add(e);return n}function diffSets(e,t){let r={};for(let n of t)e.has(n)||(r.added??=new Set,r.added.add(n));for(let n of e)t.has(n)||(r.removed??=new Set,r.removed.add(n));return r.added||r.removed?r:void 0}function objectMatchesQuery(e,t){for(let[r,n]of Object.entries(e)){let e=t[r];if("eq"in n&&e!==n.eq||"neq"in n&&e===n.neq||"gt"in n&&("number"!=typeof e||e<=n.gt))return!1}return!0}function executeQuery(e,t,r){let n=Object.fromEntries(Object.keys(r).map(e=>[e,new Set]));for(let[i,o]of Object.entries(r))if("eq"in o){let r=e.index(t,i),a=r.value.get(o.eq);if(a)for(let e of a)n[i].add(e)}else if("neq"in o){let r=e.index(t,i);for(let[e,t]of r.value)if(e!==o.neq)for(let e of t)n[i].add(e)}else if("gt"in o){let r=e.index(t,i);for(let[e,t]of r.value)if(e>o.gt)for(let e of t)n[i].add(e)}return intersectSets(Object.values(n))}let StoreQueries=class StoreQueries{constructor(e,t){this.atoms=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=computed("filterHistory:"+e,(t,r)=>{if(isUninitialized(t))return this.history.value;let n=this.history.getDiffSince(r);if(n===e_)return this.history.value;let i={added:{},removed:{},updated:{}},o=0,a=0,l=0;for(let t of n){for(let r of objectMapValues(t.added))if(r.typeName===e){if(i.removed[r.id]){let e=i.removed[r.id];delete i.removed[r.id],a--,e!==r&&(i.updated[r.id]=[e,r],l++)}else i.added[r.id]=r,o++}for(let[r,n]of objectMapValues(t.updated))n.typeName===e&&(i.added[n.id]?i.added[n.id]=n:i.updated[n.id]?i.updated[n.id]=[i.updated[n.id][0],n]:(i.updated[n.id]=[r,n],l++));for(let r of objectMapValues(t.removed))r.typeName===e&&(i.added[r.id]?(delete i.added[r.id],o--):(i.updated[r.id]?(i.removed[r.id]=i.updated[r.id][0],delete i.updated[r.id],l--):i.removed[r.id]=r,a++))}return o||a||l?withDiff(this.history.value,i):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);let n=this.__uncached_createIndex(e,t);return this.indexCache.set(r,n),n}__uncached_createIndex(e,t){let r=this.filterHistory(e),fromScratch=()=>{r.value;let n=new Map;for(let r of objectMapValues(this.atoms.value)){let i=r.value;if(i.typeName===e){let e=i[t];n.has(e)||n.set(e,new Set),n.get(e).add(i.id)}}return n};return computed("index:"+e+":"+t,(n,i)=>{let o,a;if(isUninitialized(n))return fromScratch();let l=r.getDiffSince(i);if(l===e_)return fromScratch();let d=new Map,add=(e,t)=>{let r=d.get(e);r||(r=new IncrementalSetConstructor(n.get(e)??new Set)),r.add(t),d.set(e,r)},remove=(e,t)=>{let r=d.get(e);r||(r=new IncrementalSetConstructor(n.get(e)??new Set)),r.remove(t),d.set(e,r)};for(let r of l){for(let n of objectMapValues(r.added))if(n.typeName===e){let e=n[t];add(e,n.id)}for(let[n,i]of objectMapValues(r.updated))if(i.typeName===e){let e=n[t],r=i[t];e!==r&&(remove(e,i.id),add(r,i.id))}for(let n of objectMapValues(r.removed))if(n.typeName===e){let e=n[t];remove(e,n.id)}}for(let[e,t]of d){let r=t.get();r&&(o||(o=new Map(n)),a||(a=new Map),0===r.value.size?o.delete(e):o.set(e,r.value),a.set(e,r.diff))}return o&&a?withDiff(o,a):n},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){let n=this.ids(e,t,r);return computed(r,()=>{for(let e of n.value)return this.atoms.value[e]?.value})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){let n=this.ids(e,t,"ids:"+r);return computed(r,()=>[...n.value].map(e=>{let t=this.atoms.value[e];if(!t)throw Error("no atom found for record id: "+e);return t.value}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){let n=this.filterHistory(e),fromScratch=()=>{n.value;let r=t();return 0===Object.keys(r).length?new Set(objectMapValues(this.atoms.value).flatMap(t=>{let r=t.value;return r.typeName===e?r.id:[]})):executeQuery(this,e,r)},fromScratchWithDiff=e=>{let t=fromScratch(),r=diffSets(e,t);return r?withDiff(t,r):e},i=computed("ids_query:"+r,t,{isEqual:eN});return computed("query:"+r,(t,r)=>{let o=i.value;if(isUninitialized(t))return fromScratch();if(r<i.lastChangedEpoch)return fromScratchWithDiff(t);let a=n.getDiffSince(r);if(a===e_)return fromScratchWithDiff(t);let l=new IncrementalSetConstructor(t);for(let t of a){for(let r of objectMapValues(t.added))r.typeName===e&&objectMatchesQuery(o,r)&&l.add(r.id);for(let[r,n]of objectMapValues(t.updated))n.typeName===e&&(objectMatchesQuery(o,n)?l.add(n.id):l.remove(n.id));for(let r of objectMapValues(t.removed))r.typeName===e&&l.remove(r.id)}let d=l.get();return d?withDiff(d.value,d.diff):t},{historyLength:50})}exec(e,t){let r=executeQuery(this,e,t);if(0===r.size)return ev;let n=this.atoms.value;return[...r].map(e=>n[e].value)}};function devFreeze(e){return e}let Store=class Store{id=nanoid();atoms=Atom_atom("store_atoms",{});history=Atom_atom("history",0,{historyLength:1e3});query=new StoreQueries(this.atoms,this.history);listeners=new Set;historyAccumulator=new HistoryAccumulator;historyReactor;schema;props;scopedTypes;constructor(e){let{initialData:t,schema:r}=e;this.schema=r,this.props=e.props,t&&this.atoms.set(objectMapFromEntries(objectMapEntries(t).map(([e,t])=>[e,Atom_atom("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))]))),this.historyReactor=reactor("Store.historyReactor",()=>{this.history.value,this._flushHistory()},{scheduleEffect:e=>throttledRaf(e)}),this.scopedTypes={document:new Set(objectMapValues(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set(objectMapValues(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set(objectMapValues(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){let e=this.historyAccumulator.flush();for(let{changes:t,source:r}of e){let e=null,n=null,i=null;for(let{onHistory:o,filters:a}of this.listeners)if("all"===a.source||a.source===r){if("all"!==a.scope){if("document"===a.scope){if(!(n??=this.filterChangesByScope(t,"document")))continue;o({changes:n,source:r})}else if("session"===a.scope){if(!(e??=this.filterChangesByScope(t,"session")))continue;o({changes:e,source:r})}else{if(!(i??=this.filterChangesByScope(t,"presence")))continue;o({changes:i,source:r})}}else o({changes:t,source:r})}}}}filterChangesByScope(e,t){let r={added:filterEntries(e.added,(e,r)=>this.scopedTypes[t].has(r.typeName)),updated:filterEntries(e.updated,(e,r)=>this.scopedTypes[t].has(r[1].typeName)),removed:filterEntries(e.removed,(e,r)=>this.scopedTypes[t].has(r.typeName))};return 0===Object.keys(r.added).length&&0===Object.keys(r.updated).length&&0===Object.keys(r.removed).length?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.value+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}onBeforeCreate;onAfterCreate;onBeforeChange;onAfterChange;onBeforeDelete;onAfterDelete;_runCallbacks=!0;put=(e,t)=>{transact(()=>{let r;let n={},i={},o=this.atoms.__unsafe__getWithoutCapture(),a=null,l=!1,d=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,c=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,u=this.isMergingRemoteChanges?"remote":"user";for(let p=0,h=e.length;p<h;p++){r=e[p];let h=(a??o)[r.id];if(h){c&&(r=c(h.value,r,u));let e=h.__unsafe__getWithoutCapture();r=this.schema.validateRecord(this,r,t??"updateRecord",e),h.set(r);let i=h.__unsafe__getWithoutCapture();e!==i&&(l=!0,n[r.id]=[e,i])}else d&&(r=d(r,u)),l=!0,i[(r=this.schema.validateRecord(this,r,t??"createRecord",null)).id]=r,a||(a={...o}),a[r.id]=Atom_atom("atom:"+r.id,r)}if(a&&this.atoms.set(a),l&&(this.updateHistory({added:i,updated:n,removed:{}}),this._runCallbacks)){let{onAfterCreate:e,onAfterChange:t}=this;e&&Object.values(i).forEach(t=>{e(t,u)}),t&&Object.values(n).forEach(([e,r])=>{t(e,r,u)})}})};remove=e=>{transact(()=>{let t;let r=[],n=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(let t of e){let e=this.atoms.__unsafe__getWithoutCapture()[t];e&&!1===this.onBeforeDelete(e.value,n)&&r.push(t)}if(this.atoms.update(n=>{let i;for(let o of e)!r.includes(o)&&o in n&&(i||(i={...n}),t||(t={}),delete i[o],t[o]=n[o].value);return i??n}),t&&(this.updateHistory({added:{},updated:{},removed:t}),this.onAfterDelete&&this._runCallbacks)){let r;for(let i=0,o=e.length;i<o;i++)(r=t[e[i]])&&this.onAfterDelete(r,n)}})};get=e=>this.atoms.value[e]?.value;unsafeGetWithoutCapture=e=>this.atoms.value[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{let t={};for(let[r,n]of objectMapEntries(this.atoms.value)){let i=n.value;("all"===e||this.scopedTypes[e].has(i.typeName))&&(t[r]=i)}return t};getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);transact(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}allRecords=()=>objectMapValues(this.atoms.value).map(e=>e.value);clear=()=>{this.remove(objectMapKeys(this.atoms.value))};update=(e,t)=>{let r=this.atoms.value[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.value[e];listen=(e,t)=>{this._flushHistory();let r={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),0===this.listeners.size&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,transact(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){let t=[],r=this.historyAccumulator.intercepting(e=>t.push(e.changes));try{return transact(e),squashRecordDiffs(t)}finally{r()}}applyDiff(e,t=!0){let r=this._runCallbacks;try{this._runCallbacks=t,transact(()=>{let t=objectMapValues(e.added).concat(objectMapValues(e.updated).map(([e,t])=>t)),r=objectMapKeys(e.removed);t.length&&this.put(t),r.length&&this.remove(r)})}finally{this._runCallbacks=r}}createComputedCache=(e,t,r)=>{let n=new Cache;return{get:i=>{let o=this.atoms.value[i];if(o)return n.get(o,()=>{let n=r?computed(o.name+":equals",()=>o.value,{isEqual:r}):o;return computed(e+":"+i,()=>t(n.value))}).value}}};createSelectedComputedCache=(e,t,r)=>{let n=new Cache;return{get:i=>{let o=this.atoms.value[i];if(!o)return;let a=computed(e+":"+i+":selector",()=>t(o.value));return n.get(o,()=>computed(e+":"+i,()=>r(a.value))).value}}};getRecordType=e=>{let t=this.schema.types[e.typeName];if(!t)throw Error(`Record type ${e.typeName} not found`);return t};_integrityChecker;ensureStoreIsUsable(){this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}};function squashRecordDiffs(e){let t={added:{},removed:{},updated:{}};for(let r of e){for(let[e,n]of objectMapEntries(r.added))if(t.removed[e]){let r=t.removed[e];delete t.removed[e],r!==n&&(t.updated[e]=[r,n])}else t.added[e]=n;for(let[e,[n,i]]of objectMapEntries(r.updated)){if(t.added[e]){t.added[e]=i,delete t.updated[e],delete t.removed[e];continue}if(t.updated[e]){t.updated[e][1]=i,delete t.removed[e];continue}t.updated[e]=r.updated[e],delete t.removed[e]}for(let[e,n]of objectMapEntries(r.removed))t.added[e]?delete t.added[e]:t.updated[e]?(t.removed[e]=t.updated[e][0],delete t.updated[e]):t.removed[e]=n}return t}function squashHistoryEntries(e){let t;let r=[],n=e[0];for(let i=1,o=e.length;i<o;i++)t=e[i],n.source!==t.source?(r.push(n),n=t):n={source:n.source,changes:squashRecordDiffs([n.changes,t.changes])};return r.push(n),r}function reverseRecordsDiff(e){let t={added:e.removed,removed:e.added,updated:{}};for(let[r,n]of Object.values(e.updated))t.updated[r.id]=[n,r];return t}let HistoryAccumulator=class HistoryAccumulator{_history=[];_interceptors=new Set;intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=squashHistoryEntries(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}};function isRecord(e){return"object"==typeof e&&null!==e&&"id"in e&&"typeName"in e}function defineMigrations(e){let{currentVersion:t,firstVersion:r,migrators:n={},subTypeKey:i,subTypeMigrations:o}=e;if("number"==typeof t&&"number"==typeof r){if(t===r)throw Error("Current version is equal to initial version.");if(t<r)throw Error("Current version is lower than initial version.")}return{firstVersion:r??0,currentVersion:t??0,migrators:n,subTypeKey:i,subTypeMigrations:o}}var ez=((g=ez||{}).IncompatibleSubtype="incompatible-subtype",g.UnknownType="unknown-type",g.TargetVersionTooNew="target-version-too-new",g.TargetVersionTooOld="target-version-too-old",g.MigrationError="migration-error",g.UnrecognizedSubtype="unrecognized-subtype",g);function getRecordVersion(e,t){let r=t.recordVersions[e.typeName];if(!r)return{rootVersion:0};if("subTypeKey"in r){let t=e[r.subTypeKey],n=r.subTypeVersions[t];return{rootVersion:r.version,subTypeVersion:n}}return{rootVersion:r.version}}function compareRecordVersions(e,t){if(e.rootVersion>t.rootVersion)return 1;if(e.rootVersion<t.rootVersion)return -1;if(null!=e.subTypeVersion&&null!=t.subTypeVersion){if(e.subTypeVersion>t.subTypeVersion)return 1;if(e.subTypeVersion<t.subTypeVersion)return -1}return 0}function migrateRecord({record:e,migrations:t,fromVersion:r,toVersion:n}){let i=r;if(!isRecord(e))throw Error("[migrateRecord] object is not a record");let{typeName:o,id:a,...l}=e,d=l;for(;i<n;){let e=i+1,r=t.migrators[e];if(!r)return{type:"error",reason:"target-version-too-new"};d=r.up(d),i=e}for(;i>n;){let e=i-1,r=t.migrators[i];if(!r)return{type:"error",reason:"target-version-too-old"};d=r.down(d),i=e}return{type:"success",value:{...d,id:a,typeName:o}}}function migrate({value:e,migrations:t,fromVersion:r,toVersion:n}){let i=r;for(;i<n;){let r=i+1,n=t.migrators[r];if(!n)return{type:"error",reason:"target-version-too-new"};e=n.up(e),i=r}for(;i>n;){let r=i-1,n=t.migrators[i];if(!n)return{type:"error",reason:"target-version-too-old"};e=n.down(e),i=r}return{type:"success",value:e}}let StoreSchema=class StoreSchema{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new StoreSchema(e,t??{})}get currentStoreVersion(){return this.options.snapshotMigrations?.currentVersion??0}validateRecord(e,t,r,n){try{let e=getOwnProperty(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:n,error:i});throw i}}migratePersistedRecord(e,t,r="up"){let n=getOwnProperty(this.types,e.typeName),i=t.recordVersions[e.typeName];if(!i||!n)return{type:"error",reason:ez.UnknownType};let o=n.migrations.currentVersion,a=i.version;if(o!==a){let t="up"===r?migrateRecord({record:e,migrations:n.migrations,fromVersion:a,toVersion:o}):migrateRecord({record:e,migrations:n.migrations,fromVersion:o,toVersion:a});if("error"===t.type)return t;e=t.value}if(!n.migrations.subTypeKey)return{type:"success",value:e};let l=n.migrations.subTypeMigrations?.[e[n.migrations.subTypeKey]],d="subTypeVersions"in i?i.subTypeVersions[e[n.migrations.subTypeKey]]:void 0;if(void 0===l)return{type:"error",reason:ez.UnrecognizedSubtype};if(void 0===d)return{type:"error",reason:ez.IncompatibleSubtype};let c="up"===r?migrateRecord({record:e,migrations:l,fromVersion:d,toVersion:l.currentVersion}):migrateRecord({record:e,migrations:l,fromVersion:l.currentVersion,toVersion:d});return"error"===c.type?c:{type:"success",value:c.value}}migrateStoreSnapshot(e){let{store:t}=e,r=this.options.snapshotMigrations;if(!r)return{type:"success",value:t};let n=r.currentVersion,i=e.schema.storeVersion??0;if(n<i)return{type:"error",reason:ez.TargetVersionTooOld};if(n>i){let e=migrate({value:t,migrations:r,fromVersion:i,toVersion:n});if("error"===e.type)return e;t=e.value}let o=[];for(let r of objectMapValues(t)){let t=this.migratePersistedRecord(r,e.schema);if("error"===t.type)return t;t.value&&t.value!==r&&o.push(t.value)}if(o.length)for(let e of(t={...t},o))t[e.id]=e;return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.currentVersion??0,recordVersions:Object.fromEntries(objectMapValues(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.currentVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.currentVersion])):void 0}:{version:e.migrations.currentVersion}]))}}serializeEarliestVersion(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.firstVersion??0,recordVersions:Object.fromEntries(objectMapValues(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.firstVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.firstVersion])):void 0}:{version:e.migrations.firstVersion}]))}}};let compareSchemas=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return -1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return -1;for(let r of Object.keys(e.recordVersions)){let n=e.recordVersions[r],i=t.recordVersions[r];if(n.version>i.version)return 1;if(n.version<i.version)return -1;if("subTypeVersions"in n&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in n)&&"subTypeVersions"in i)return -1;if("subTypeVersions"in n&&"subTypeVersions"in i)for(let e of Object.keys(n.subTypeVersions)){let t=n.subTypeVersions[e],r=i.subTypeVersions[e];if(t>r)return 1;if(t<r)return -1}}return 0};function formatPath(e){if(!e.length)return null;let t="";for(let r of e)"number"==typeof r?t+=`.${r}`:r.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${r.slice(1)}`:t+=r:t+=`.${r}`;return t.startsWith(".")?t.slice(1):t}let ValidationError=class ValidationError extends Error{constructor(e,t=[]){let r=formatPath(t),n=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${r}: ${n}`:n),this.rawMessage=e,this.path=t}name="ValidationError"};function prefixError(e,t){try{return t()}catch(t){if(t instanceof ValidationError)throw new ValidationError(t.rawMessage,[e,...t.path]);throw new ValidationError(t.toString(),[e])}}function typeToString(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:exhaustiveSwitchError(t)}}let Validator=class Validator{constructor(e){this.validationFn=e}validate(e){let t=this.validationFn(e);return t}nullable(){return nullable(this)}optional(){return optional(this)}refine(e){return new Validator(t=>e(this.validate(t)))}check(e,t){return"string"==typeof e?this.refine(r=>(prefixError(`(check ${e})`,()=>t(r)),r)):this.refine(t=>(e(t),t))}};let ArrayOfValidator=class ArrayOfValidator extends Validator{constructor(e){super(t=>{let r=e0.validate(t);for(let t=0;t<r.length;t++)prefixError(t,()=>e.validate(r[t]));return r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new ValidationError("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ValidationError("Expected an array with length greater than 1")})}};let ObjectValidator=class ObjectValidator extends Validator{constructor(e,t=!1){super(r=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);for(let[t,n]of Object.entries(e))prefixError(t,()=>{n.validate(getOwnProperty(r,t))});if(!t){for(let t of Object.keys(r))if(!object_hasOwnProperty(e,t))throw new ValidationError("Unexpected property",[t])}return r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new ObjectValidator(this.config,!0)}extend(e){return new ObjectValidator({...this.config,...e})}};let UnionValidator=class UnionValidator extends Validator{constructor(e,t,r){super(r=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected an object, got ${typeToString(r)}`,[]);let n=getOwnProperty(r,e);if("string"!=typeof n)throw new ValidationError(`Expected a string for key "${e}", got ${typeToString(n)}`);let i=object_hasOwnProperty(t,n)?t[n]:void 0;return void 0===i?this.unknownValueValidation(r,n):prefixError(`(${e} = ${n})`,()=>i.validate(r))}),this.key=e,this.config=t,this.unknownValueValidation=r}validateUnknownVariants(e){return new UnionValidator(this.key,this.config,e)}};let DictValidator=class DictValidator extends Validator{constructor(e,t){super(r=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);for(let[n,i]of Object.entries(r))prefixError(n,()=>{e.validate(n),t.validate(i)});return r}),this.keyValidator=e,this.valueValidator=t}};function typeofValidator(e){return new Validator(t=>{if(typeof t!==e)throw new ValidationError(`Expected ${e}, got ${typeToString(t)}`);return t})}let eB=new Validator(e=>e),eU=new Validator(e=>e),eH=typeofValidator("string"),eG=typeofValidator("number").check(e=>{if(Number.isNaN(e))throw new ValidationError("Expected a number, got NaN");if(!Number.isFinite(e))throw new ValidationError(`Expected a finite number, got ${e}`)}),eW=eG.check(e=>{if(e<0)throw new ValidationError(`Expected a positive number, got ${e}`)}),eK=eG.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive number, got ${e}`)}),eY=eG.check(e=>{if(!Number.isInteger(e))throw new ValidationError(`Expected an integer, got ${e}`)}),eX=eY.check(e=>{if(e<0)throw new ValidationError(`Expected a positive integer, got ${e}`)}),eZ=eY.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive integer, got ${e}`)}),eQ=typeofValidator("boolean"),eJ=typeofValidator("bigint");function literal(e){return new Validator(t=>{if(t!==e)throw new ValidationError(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}let e0=new Validator(e=>{if(!Array.isArray(e))throw new ValidationError(`Expected an array, got ${typeToString(e)}`);return e});function arrayOf(e){return new ArrayOfValidator(e)}let e1=new Validator(e=>{if("object"!=typeof e||null===e)throw new ValidationError(`Expected object, got ${typeToString(e)}`);return e});function object(e){return new ObjectValidator(e)}function isValidJson(e){return null===e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(isValidJson):"object"==typeof e&&Object.values(e).every(isValidJson))}let e2=new Validator(e=>{if(isValidJson(e))return e;throw new ValidationError(`Expected json serializable value, got ${typeof e}`)});function jsonDict(){return dict(eH,e2)}function dict(e,t){return new DictValidator(e,t)}function union(e,t){return new UnionValidator(e,t,(r,n)=>{throw new ValidationError(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(n)}`,[e])})}function model(e,t){return new Validator(r=>{let n=r&&"object"==typeof r&&"id"in r&&"string"==typeof r.id?`${e}(id = ${r.id})`:e;return prefixError(n,()=>t.validate(r))})}function setEnum(e){return new Validator(t=>{if(!e.has(t)){let r=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new ValidationError(`Expected ${r}, got ${t}`)}return t})}function optional(e){return new Validator(t=>{if(void 0!==t)return e.validate(t)})}function nullable(e){return new Validator(t=>null===t?null:e.validate(t))}function literalEnum(...e){return setEnum(new Set(e))}function idValidator(e){return eH.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let e3=idValidator("asset");function createAssetValidator(e,t){return object({id:e3,typeName:literal("asset"),type:literal(e),props:t,meta:e2})}let e5=model("camera",object({typeName:literal("camera"),id:idValidator("camera"),x:eG,y:eG,z:eG,meta:e2})),e4={AddMeta:1},e8=defineMigrations({currentVersion:e4.AddMeta,migrators:{[e4.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),e6=createRecordType("camera",{validator:e5,migrations:e8,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),e9=object({x:eG,y:eG,z:eG.optional()}),e7=object({x:eG,y:eG,w:eG,h:eG}),te=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),tt=setEnum(te),tr=object({type:tt,rotation:eG}),tn=eG.check(e=>{if(e<0||e>1)throw new ValidationError("Opacity must be between 0 and 1")}),ti=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),to=setEnum(ti),ta=new Set(["starting","paused","active","stopping"]),ts=object({points:arrayOf(e9),size:eW,color:to,opacity:eG,state:setEnum(ta),delay:eG}),tl=idValidator("page"),td=model("page",object({typeName:literal("page"),id:tl,name:eH,index:eH,meta:e2})),tc={AddMeta:1},tu=defineMigrations({currentVersion:tc.AddMeta,migrators:{[tc.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),tp=createRecordType("page",{validator:td,migrations:tu,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function isPageId(e){return tp.isId(e)}function createInstanceRecordType(e){let t={};for(let[r,n]of e)t[r]=optional(n);let r=model("instance",object({typeName:literal("instance"),id:idValidator("instance"),currentPageId:tl,followingUserId:eH.nullable(),brush:e7.nullable(),opacityForNextShape:tn,stylesForNextShape:object(t),cursor:tr,scribble:ts.nullable(),isFocusMode:eQ,isDebugMode:eQ,isToolLocked:eQ,exportBackground:eQ,screenBounds:e7,zoomBrush:e7.nullable(),isPenMode:eQ,isGridMode:eQ,chatMessage:eH,isChatting:eQ,highlightedUserIds:arrayOf(eH),canMoveCamera:eQ,isFocused:eQ,devicePixelRatio:eG,isCoarsePointer:eQ,isHoveringCanvas:eQ.nullable(),openMenus:arrayOf(eH),isChangingStyle:eQ,isReadonly:eQ,meta:e2}));return createRecordType("instance",{migrations:tf,validator:r,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribble:null,cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}idValidator("instance");let th={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21},tf=defineMigrations({currentVersion:th.AddHoveringCanvas,migrators:{[th.AddTransparentExportBgs]:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},[th.RemoveDialog]:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},[th.AddToolLockMode]:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},[th.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))}),down:e=>e},[th.AddLabelColor]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{let{labelColor:t,...r}=e.propsForNextShape;return{...e,propsForNextShape:{...r}}}},[th.AddFollowingUserId]:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},[th.RemoveAlignJustify]:{up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[th.AddZoom]:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},[th.AddVerticalAlign]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...r}=e.propsForNextShape;return{...e,propsForNextShape:r}}},[th.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...r}=e.scribble;return{...e,scribble:r}}return{...e}}},[th.RemoveUserId]:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},[th.AddIsPenModeAndIsGridMode]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...r})=>r},[th.HoistOpacity]:{up:({propsForNextShape:{opacity:e,...t},...r})=>({...r,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[th.AddChat]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...r})=>r},[th.AddHighlightedUserIds]:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},[th.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[th.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[th.RemoveCursorColor]:{up:e=>{let{color:t,...r}=e.cursor;return{...e,cursor:r}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[th.AddLonelyProperties]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:r,isCoarsePointer:n,openMenus:i,isChangingStyle:o,isReadOnly:a,...l})=>({...l})},[th.ReadOnlyReadonly]:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},[th.AddHoveringCanvas]:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})}}}),tg="instance:instance",tm=eH.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),ty=idValidator("shape");function createShapeValidator(e,t,r){return object({id:ty,typeName:literal("shape"),x:eG,y:eG,rotation:eG,index:eH,parentId:tm,type:literal(e),isLocked:eQ,opacity:tn,props:t?object(t):e2,meta:r?object(r):e2})}let tb=model("instance_page_state",object({typeName:literal("instance_page_state"),id:idValidator("instance_page_state"),pageId:tl,selectedShapeIds:arrayOf(ty),hintingShapeIds:arrayOf(ty),erasingShapeIds:arrayOf(ty),hoveredShapeId:ty.nullable(),editingShapeId:ty.nullable(),croppingShapeId:ty.nullable(),focusedGroupId:ty.nullable(),meta:e2})),tv={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},tS=defineMigrations({currentVersion:tv.RenamePropertiesAgain,migrators:{[tv.AddCroppingId]:{up:e=>({...e,croppingShapeId:null}),down:({croppingShapeId:e,...t})=>t},[tv.RemoveInstanceIdAndCameraId]:{up:({instanceId:e,cameraId:t,...r})=>r,down:e=>({...e,instanceId:tg,cameraId:e6.createId("void")})},[tv.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[tv.RenameProperties]:{up:e=>{let{selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...d}=e;return{selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...d}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...d}=e;return{selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...d}}},[tv.RenamePropertiesAgain]:{up:e=>{let{selectedIds:t,hintingIds:r,erasingIds:n,hoveredId:i,editingId:o,croppingId:a,focusLayerId:l,...d}=e;return{...d,selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:r,erasingShapeIds:n,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...d}=e;return{...d,selectedIds:t,hintingIds:r,erasingIds:n,hoveredId:i,editingId:o,croppingId:a,focusLayerId:l}}}}}),tx=createRecordType("instance_page_state",{migrations:tS,validator:tb,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),tw=model("pointer",object({typeName:literal("pointer"),id:idValidator("pointer"),x:eG,y:eG,lastActivityTimestamp:eG,meta:e2})),t_={AddMeta:1},tP=defineMigrations({currentVersion:t_.AddMeta,migrators:{[t_.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),tE=createRecordType("pointer",{validator:tw,migrations:tP,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),tC=tE.createId("pointer"),tk=model("instance_presence",object({typeName:literal("instance_presence"),id:idValidator("instance_presence"),userId:eH,userName:eH,lastActivityTimestamp:eG,followingUserId:eH.nullable(),cursor:object({x:eG,y:eG,type:tt,rotation:eG}),color:eH,camera:object({x:eG,y:eG,z:eG}),screenBounds:e7,selectedShapeIds:arrayOf(idValidator("shape")),currentPageId:idValidator("page"),brush:e7.nullable(),scribble:ts.nullable(),chatMessage:eH,meta:e2})),tI={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},tT=defineMigrations({currentVersion:tI.RenameSelectedShapeIds,migrators:{[tI.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...r}=e.scribble;return{...e,scribble:r}}return{...e}}},[tI.RemoveInstanceId]:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:tg})},[tI.AddChatMessage]:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},[tI.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[tI.RenameSelectedShapeIds]:{up:e=>{let{selectedShapeIds:t,...r}=e;return{selectedShapeIds:t,...r}},down:e=>{let{selectedShapeIds:t,...r}=e;return{selectedShapeIds:t,...r}}}}}),tA=createRecordType("instance_presence",{migrations:tT,validator:tk,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribble:null,chatMessage:"",meta:{}})),createPresenceStateDerivation=(e,t)=>r=>computed("instancePresence",()=>{let n=r.get(tg),i=r.get(tx.createId(n?.currentPageId)),o=r.get(e6.createId(n?.currentPageId)),a=r.get(tC),l=e.value;return i&&n&&o&&a&&l?tA.create({id:t??tA.createId(r.id),selectedShapeIds:i.selectedShapeIds,brush:n.brush,scribble:n.scribble,userId:l.id,userName:l.name,followingUserId:n.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:l.color,currentPageId:n.currentPageId,cursor:{x:a.x,y:a.y,rotation:n.cursor.rotation,type:n.cursor.type},lastActivityTimestamp:a.lastActivityTimestamp,screenBounds:n.screenBounds,chatMessage:n.chatMessage,meta:{}}):null}),t$=model("document",object({typeName:literal("document"),id:literal("document:document"),gridSize:eG,name:eH,meta:e2})),tM={AddName:1,AddMeta:2},tD=defineMigrations({currentVersion:tM.AddMeta,migrators:{[tM.AddName]:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},[tM.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),tV=createRecordType("document",{migrations:tD,validator:t$,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),tR=tV.createId("document");function sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function redactRecordForErrorReporting(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}let onValidationFailure=({error:e,phase:t,record:r,recordBefore:n})=>{throw annotateError(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:n?redactRecordForErrorReporting(eL(n)):void 0,recordAfter:redactRecordForErrorReporting(eL(r))}}),e};function getDefaultPages(){return[tp.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function createIntegrityChecker(e){let t=e.query.ids("page"),ensureStoreIsUsable=()=>{if(!e.has(tR))return e.put([tV.create({id:tR,name:e.props.defaultName})]),ensureStoreIsUsable();if(!e.has(tC))return e.put([tE.create({id:tC})]),ensureStoreIsUsable();let r=t.value;if(0===r.size)return e.put(getDefaultPages()),ensureStoreIsUsable();let n=e.get(tg);if(!n)return e.put([e.schema.types.instance.create({id:tg,currentPageId:[...r].map(t=>e.get(t)).sort(sortByIndex)[0].id,exportBackground:!0})]),ensureStoreIsUsable();if(!r.has(n.currentPageId))return e.put([{...n,currentPageId:[...r].map(t=>e.get(t)).sort(sortByIndex)[0].id}]),ensureStoreIsUsable();let i=new Set,o=new Set;for(let t of r){let r=tx.createId(t);e.has(r)||i.add(r);let n=e6.createId(t);e.has(n)||o.add(n)}i.size>0&&e.put([...i].map(e=>tx.create({id:e,pageId:tx.parseId(e)}))),o.size>0&&e.put([...o].map(e=>e6.create({id:e})))};return ensureStoreIsUsable}let tj=createAssetValidator("bookmark",object({title:eH,description:eH,image:eH,src:eH.nullable()})),tO=defineMigrations({}),tL=createAssetValidator("image",object({w:eG,h:eG,name:eH,isAnimated:eQ,mimeType:eH.nullable(),src:eH.nullable()})),tF={AddIsAnimated:1,RenameWidthHeight:2},tN=defineMigrations({currentVersion:tF.RenameWidthHeight,migrators:{[tF.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...r}=e.props;return{...e,props:r}}},[tF.RenameWidthHeight]:{up:e=>{let{width:t,height:r,...n}=e.props;return{...e,props:{w:t,h:r,...n}}},down:e=>{let{w:t,h:r,...n}=e.props;return{...e,props:{width:t,height:r,...n}}}}}}),tz=createAssetValidator("video",object({w:eG,h:eG,name:eH,isAnimated:eQ,mimeType:eH.nullable(),src:eH.nullable()})),tB={AddIsAnimated:1,RenameWidthHeight:2},tU=defineMigrations({currentVersion:tB.RenameWidthHeight,migrators:{[tB.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...r}=e.props;return{...e,props:r}}},[tB.RenameWidthHeight]:{up:e=>{let{width:t,height:r,...n}=e.props;return{...e,props:{w:t,h:r,...n}}},down:e=>{let{w:t,h:r,...n}=e.props;return{...e,props:{width:t,height:r,...n}}}}}}),tH=model("asset",union("type",{image:tL,video:tz,bookmark:tj})),tG={AddMeta:1},tW=defineMigrations({subTypeKey:"type",subTypeMigrations:{image:tN,video:tU,bookmark:tO},currentVersion:tG.AddMeta,migrators:{[tG.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),tK=createRecordType("asset",{migrations:tW,validator:tH,scope:"document"}).withDefaultProperties(()=>({meta:{}})),nanoid_fillPool=e=>{!l||l.length<e?(l=Buffer.allocUnsafe(128*e),(0,eF.randomFillSync)(l),d=0):d+e>l.length&&((0,eF.randomFillSync)(l),d=0),d+=e},nanoid_nanoid=(e=21)=>{nanoid_fillPool(e-=0);let t="";for(let r=d-e;r<d;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&l[r]];return t};let StyleProp=class StyleProp{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){let{defaultValue:r,type:n=eU}=t;return new StyleProp(e,r,n)}static defineEnum(e,t){let{defaultValue:r,values:n}=t;return new EnumStyleProp(e,r,n)}validate(e){return this.type.validate(e)}};let EnumStyleProp=class EnumStyleProp extends StyleProp{constructor(e,t,r){super(e,t,literalEnum(...r)),this.values=r}};let tq={AddIsLocked:1,HoistOpacity:2,AddMeta:3},tY=defineMigrations({currentVersion:tq.AddMeta,migrators:{[tq.AddIsLocked]:{up:e=>({...e,isLocked:!1}),down:e=>{let{isLocked:t,...r}=e;return{...r}}},[tq.HoistOpacity]:{up:({props:{opacity:e,...t},...r})=>({...r,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[tq.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function isShape(e){return!!e&&"shape"===e.typeName}function isShapeId(e){return!!e&&e.startsWith("shape:")}function createShapeId(e){return`shape:${e??nanoid_nanoid()}`}function getShapePropKeysByStyle(e){let t=new Map;for(let[r,n]of Object.entries(e))if(n instanceof StyleProp){if(t.has(n))throw Error(`Duplicate style prop ${n.id}. Each style prop can only be used once within a shape.`);t.set(n,r)}return t}function createShapeRecordType(e){return createRecordType("shape",{migrations:defineMigrations({currentVersion:tY.currentVersion,firstVersion:tY.firstVersion,migrators:tY.migrators,subTypeKey:"type",subTypeMigrations:mapObjectMapValues(e,(e,t)=>t.migrations??defineMigrations({}))}),scope:"document",validator:model("shape",union("type",mapObjectMapValues(e,(e,{props:t,meta:r})=>createShapeValidator(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}let tX={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},tZ=defineMigrations({currentVersion:tX.RemoveUserDocument,migrators:{[tX.RemoveCodeAndIconShapeTypes]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"shape"!==t.typeName||"icon"!==t.type&&"code"!==t.type)),down:e=>e},[tX.AddInstancePresenceType]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"instance_presence"!==t.typeName))},[tX.RemoveTLUserAndPresenceAndAddPointer]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"pointer"!==t.typeName))},[tX.RemoveUserDocument]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match("user_document"))),down:e=>e}}});function createTLSchema({shapes:e}){let t=new Map;for(let r of objectMapValues(e))for(let e of getShapePropKeysByStyle(r.props??{}).keys()){if(t.has(e.id)&&t.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);t.set(e.id,e)}let r=createShapeRecordType(e),n=createInstanceRecordType(t);return StoreSchema.create({asset:tK,camera:e6,document:tV,instance:n,instance_page_state:tx,page:tp,shape:r,instance_presence:tA,pointer:tE},{snapshotMigrations:tZ,onValidationFailure:onValidationFailure,createIntegrityChecker:createIntegrityChecker})}let tQ=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],tJ={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function getDefaultColorTheme(e){return e.isDarkMode?tJ.darkMode:tJ.lightMode}let t0=StyleProp.defineEnum("tldraw:color",{defaultValue:"black",values:tQ}),t1=StyleProp.defineEnum("tldraw:labelColor",{defaultValue:"black",values:tQ}),t2=StyleProp.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),t3=StyleProp.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),t5=StyleProp.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),t4={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},t8=StyleProp.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),t6=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],t9=StyleProp.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:t6}),t7=StyleProp.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:t6}),re=union("type",{binding:object({type:literal("binding"),boundShapeId:ty,normalizedAnchor:e9,isExact:eQ}),point:object({type:literal("point"),x:eG,y:eG})}),rt={labelColor:t1,color:t0,fill:t3,dash:t2,size:t8,arrowheadStart:t9,arrowheadEnd:t7,font:t5,start:re,end:re,bend:eG,text:eH},rr={AddLabelColor:1},rn=defineMigrations({currentVersion:rr.AddLabelColor,migrators:{[rr.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...r}=e.props;return{...e,props:r}}}}}),ri={w:eK,h:eK,assetId:e3.nullable(),url:eH},ro={NullAssetId:1},ra=defineMigrations({currentVersion:ro.NullAssetId,migrators:{[ro.NullAssetId]:{up:e=>void 0===e.props.assetId?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(null===e.props.assetId){let{assetId:t,...r}=e.props;return{...e,props:r}}return e}}}}),rs=object({type:literalEnum("free","straight"),points:arrayOf(e9)}),rl={color:t0,fill:t3,dash:t2,size:t8,segments:arrayOf(rs),isComplete:eQ,isClosed:eQ,isPen:eQ},rd={AddInPen:1},rc=defineMigrations({currentVersion:rd.AddInPen,migrators:{[rd.AddInPen]:{up:e=>{let{points:t}=e.props.segments[0];if(0===t.length)return{...e,props:{...e.props,isPen:!1}};let r=!(0===t[0].z||.5===t[0].z);return t[1]&&(r=r&&!(0===t[1].z||.5===t[1].z)),{...e,props:{...e.props,isPen:r}}},down:e=>{let{isPen:t,...r}=e.props;return{...e,props:{...r}}}}}}),ru=/(^\/r\/[^/]+\/?$)/,safeParseUrl=e=>{try{return new URL(e)}catch(e){return}},rp=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(ru))return e},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(ru))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){let t;let r=e.match(/@(.*),(.*),(.*)z/);if(r){let[,n,i,o]=r,a=new URL(e).host.replace("www.","");t=`https://${a}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${n},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let r=t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/);if(r&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[r,n]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${n},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e),r=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(r)return`https://www.val.town/embed/${r[1]}`},fromEmbedUrl:e=>{let t=safeParseUrl(e),r=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(r)return`https://www.val.town/v/${r[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e),r=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(r)return`https://codesandbox.io/embed/${r[1]}`},fromEmbedUrl:e=>{let t=safeParseUrl(e),r=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(r)return`https://codesandbox.io/s/${r[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,r,n]=t;return`https://codepen.io/${r}/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,r,n]=t;return`https://codepen.io/${r}/pen/${n}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,r]=t;return`https://scratch.mit.edu/projects/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,r]=t;return`https://scratch.mit.edu/projects/${r}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let r=t.hostname.replace(/^www./,"");if("youtu.be"===r){let e=t.pathname.split("/").filter(Boolean)[0];return`https://www.youtube.com/embed/${e}`}if(("youtube.com"===r||"m.youtube.com"===r)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v");return`https://www.youtube.com/embed/${e}`}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let r=t.hostname.replace(/^www./,"");if("youtube.com"===r){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{let t=safeParseUrl(e),r=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&r){t.pathname="/calendar/embed";let e=Array.from(t.searchParams.keys());for(let r of e)t.searchParams.delete(r);return t.searchParams.set("src",r),t.href}},fromEmbedUrl:e=>{let t=safeParseUrl(e),r=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&r){t.pathname="/calendar/u/0";let e=Array.from(t.searchParams.keys());for(let r of e)t.searchParams.delete(r);return t.searchParams.set("cid",r),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){t.pathname=t.pathname.replace(/\/pub$/,"/embed");let e=Array.from(t.searchParams.keys());for(let r of e)t.searchParams.delete(r);return t.href}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");let e=Array.from(t.searchParams.keys());for(let r of e)t.searchParams.delete(r);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=safeParseUrl(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}}],rh={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},rf={w:eK,h:eK,url:eH},rg={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},rm=defineMigrations({currentVersion:rg.RemovePermissionOverrides,migrators:{[rg.GenOriginalUrlInEmbed]:{up:e=>{let t;let r=e.props.url,n=new URL(r).host.replace("www.","");for(let e of rp)if(e.hostnames.includes(n))try{t=e.fromEmbedUrl(r)}catch(e){console.warn(e)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:t??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||""===t){let r=e.props.url,n=new URL(r).host.replace("www.","");for(let e of rp)if(e.hostnames.includes(n))try{t=e.toEmbedUrl(r)}catch(e){console.warn(e)}}let{tmpOldUrl:r,...n}=e.props;return{...e,props:{...n,url:t??""}}}},[rg.RemoveDoesResize]:{up:e=>{let{doesResize:t,...r}=e.props;return{...e,props:{...r}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[rg.RemoveTmpOldUrl]:{up:e=>{let{tmpOldUrl:t,...r}=e.props;return{...e,props:{...r}}},down:e=>({...e,props:{...e.props}})},[rg.RemovePermissionOverrides]:{up:e=>{let{overridePermissions:t,...r}=e.props;return{...e,props:{...r}}},down:e=>({...e,props:{...e.props}})}}}),ry={w:eK,h:eK,name:eH},rb=defineMigrations({}),rv=StyleProp.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),rS=StyleProp.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),rx=StyleProp.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),rw={geo:rx,labelColor:t1,color:t0,fill:t3,dash:t2,size:t8,font:t5,align:rv,verticalAlign:rS,url:eH,w:eK,h:eK,growY:eW,text:eH},r_={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7},rP=defineMigrations({currentVersion:r_.AddCloud,migrators:{[r_.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...r}=e.props;return{...e,props:r}}},[r_.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...r}=e.props;return{...e,props:r}}},[r_.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[r_.AddCheckBox]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:"check-box"===e.props.geo?"rectangle":e.props.geo}})},[r_.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...r}=e.props;return{...e,props:r}}},[r_.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[r_.AddCloud]:{up:e=>e,down:e=>{if("cloud"===e.props.geo)return{...e,props:{...e.props,geo:"rectangle"}}}}}}),rE={},rC=defineMigrations({}),rk={color:t0,size:t8,segments:arrayOf(rs),isComplete:eQ,isPen:eQ},rI=defineMigrations({}),rT=object({topLeft:e9,bottomRight:e9}),rA={w:eK,h:eK,playing:eQ,url:eH,assetId:e3.nullable(),crop:rT.nullable()},r$={AddUrlProp:1,AddCropProp:2},rM=defineMigrations({currentVersion:r$.AddCropProp,migrators:{[r$.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...r}=e.props;return{...e,props:r}}},[r$.AddCropProp]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{let{crop:t,...r}=e.props;return{...e,props:r}}}}}),rD=new Set(["vertex","virtual","create"]),rV=object({id:eH,type:setEnum(rD),canBind:eQ.optional(),canSnap:eQ.optional(),index:eH,x:eG,y:eG}),rR=StyleProp.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),rj={color:t0,dash:t2,size:t8,spline:rR,handles:dict(eH,rV)},rO={AddSnapHandles:1},rL=defineMigrations({currentVersion:rO.AddSnapHandles,migrators:{[rO.AddSnapHandles]:{up:e=>{let t=deepCopy(e.props.handles);for(let e in t)t[e].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{let t=deepCopy(e.props.handles);for(let e in t)delete t[e].canSnap;return{...e,props:{...e.props,handles:t}}}}}}),rF={color:t0,size:t8,font:t5,align:rv,verticalAlign:rS,growY:eW,url:eH,text:eH},rN={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4},rz=defineMigrations({currentVersion:rN.AddVerticalAlign,migrators:{[rN.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...r}=e.props;return{...e,props:r}}},[rN.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[rN.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[rN.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...r}=e.props;return{...e,props:r}}}}}),rB={color:t0,size:t8,font:t5,align:rv,w:eK,text:eH,scale:eK,autoSize:eQ},rU={RemoveJustify:1},rH=defineMigrations({currentVersion:rU.RemoveJustify,migrators:{[rU.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),rG={w:eK,h:eK,time:eG,playing:eQ,url:eH,assetId:e3.nullable()},rW={AddUrlProp:1},rK=defineMigrations({currentVersion:rW.AddUrlProp,migrators:{[rW.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...r}=e.props;return{...e,props:r}}}}}),rq=[{locale:"ar",label:"عربي"},{locale:"ca",label:"Catal\xe0"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fa",label:"فارسی"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"עברית"},{locale:"it",label:"Italiano"},{locale:"ja",label:"日本語"},{locale:"ko-kr",label:"한국어"},{locale:"ku",label:"کوردی"},{locale:"hi-in",label:"हिन्दी"},{locale:"hu",label:"Magyar"},{locale:"my",label:"မြန်မာစာ"},{locale:"ne",label:"नेपाली"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2nă"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Tiếng Việt"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function getDefaultTranslationLocale(){let e="undefined"!=typeof window?window.navigator.languages??["en"]:["en"];return _getDefaultTranslationLocale(e)}function _getDefaultTranslationLocale(e){for(let t of e){let e=getSupportedLocale(t);if(e)return e}return"en"}let rY={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function getSupportedLocale(e){let t=rq.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[r,n]=e.split(/[-_]/).map(e=>e.toLowerCase());if(n){let e=rq.find(e=>e.locale===r);if(e)return e.locale}return r in rY?rY[r]:null}let rX={},rZ={preventDefaultLogging:createDebugValue("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:createDebugValue("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:createDebugValue("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:createDebugValue("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:createDebugValue("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:createDebugValue("debugSvg",{defaults:{all:!1}}),throwToBlob:createDebugValue("throwToBlob",{defaults:{all:!1}}),logMessages:createDebugValue("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:createDebugValue("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:createDebugValue("debugCursors",{defaults:{all:!1}}),forceSrgb:createDebugValue("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:createDebugValue("debugGeometry",{defaults:{all:!1}}),hideShapes:createDebugValue("hideShapes",{defaults:{all:!1}})};if("undefined"!=typeof window&&(window.tldrawLog=e=>{rZ.logMessages.set(rZ.logMessages.value.concat(e))}),"undefined"!=typeof Element){let e=Element.prototype.removeChild;EffectScheduler_react("element removal logging",()=>{rZ.elementRemovalLogging.value?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function createDebugValue(e,{defaults:t,shouldStoreForSession:r=!0}){return createDebugValueBase({name:e,defaults:t,shouldStoreForSession:r})}function createDebugValueBase(e){let t=getDefaultValue(e),r=e.shouldStoreForSession?getStoredInitialValue(e.name):null,n=Atom_atom(`debug:${e.name}`,r??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&EffectScheduler_react(`debug:${e.name}`,()=>{let r=n.value;try{r===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(r))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>n.value,set(e){n.set(e)},configurable:!0})),Object.assign(n,e)}function getStoredInitialValue(e){try{return JSON.parse(window?.sessionStorage.getItem(`tldraw_debug:${e}`)??"null")}catch(e){return null}}function readEnv(e){try{return e()}catch{return null}}function getDefaultValue(e){let t=readEnv(()=>process.env.TLDRAW_ENV)??readEnv(()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV)??readEnv(()=>process.env.NEXT_PUBLIC_TLDRAW_ENV)??"production";switch(t){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}function loopToHtmlElement(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return loopToHtmlElement(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function preventDefault(e){e.preventDefault(),rZ.preventDefaultLogging.value&&console.warn("preventDefault called on event:",e)}function setPointerCapture(e,t){if(e.setPointerCapture(t.pointerId),rZ.pointerCaptureTracking.value){let t=rZ.pointerCaptureTrackingObject.value;t.set(e,(t.get(e)??0)+1)}rZ.pointerCaptureLogging.value&&console.warn("setPointerCapture called on element:",e,t)}function releasePointerCapture(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),rZ.pointerCaptureTracking.value){let t=rZ.pointerCaptureTrackingObject.value;1===t.get(e)?t.delete(e):t.has(e)?t.set(e,t.get(e)-1):console.warn("Release without capture")}rZ.pointerCaptureLogging.value&&console.warn("releasePointerCapture called on element:",e,t)}}let stopEventPropagation=e=>e.stopPropagation();function getPointerInfo(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}let rQ=T.createContext({}),useEditor=()=>T.useContext(rQ);function useCanvasEvents(){let e=useEditor(),t=(0,T.useMemo)(function(){let t,r;return{onPointerDown:function(t){if(!t.isKilled){if(2===t.button){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...getPointerInfo(t)});return}(0===t.button||1===t.button||5===t.button)&&(setPointerCapture(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...getPointerInfo(t)}),e.openMenus.length>0&&(document.body.click(),e.getContainer().focus()))}},onPointerMove:function(n){n.isKilled||n.clientX===t&&n.clientY===r||(t=n.clientX,r=n.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...getPointerInfo(n)}))},onPointerUp:function(n){n.isKilled||0!==n.button&&1!==n.button&&2!==n.button&&5!==n.button||(t=n.clientX,r=n.clientY,releasePointerCapture(n.currentTarget,n),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...getPointerInfo(n)}))},onPointerEnter:function(t){if(t.isKilled||e.instanceState.isPenMode&&"pen"!==t.pointerType)return;let r="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!r||null})},onPointerLeave:function(t){if(t.isKilled||e.instanceState.isPenMode&&"pen"!==t.pointerType)return;let r="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!r&&null})},onDragOver:function(e){preventDefault(e)},onDrop:async function(t){if(preventDefault(t),!t.dataTransfer?.files?.length)return;let r=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:r,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,document.body.click(),preventDefault(e)},onTouchEnd:function(e){e.isKilled=!0,"A"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&preventDefault(e)},onClick:function(e){stopEventPropagation(e)}}},[e]);return t}function useCoarsePointer(){let e=useEditor();(0,T.useEffect)(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){let t=window.matchMedia("(pointer: coarse)"),handler=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(handler(),t)return t.addEventListener("change",handler),()=>t.removeEventListener("change",handler)}},[e])}let rJ=(0,T.createContext)(null);function ContainerProvider({container:e,children:t}){return(0,I.jsx)(rJ.Provider,{value:e,children:t})}function useContainer(){return eD((0,T.useContext)(rJ),"useContainer used outside of <Tldraw />")}function useDocumentEvents(){let e=useEditor(),t=useContainer(),r=useValue("isFocused",()=>e.instanceState.isFocused,[e]);(0,T.useEffect)(()=>{let t=null,updatePixelRatio=()=>{null!=t&&t();let r=`(resolution: ${window.devicePixelRatio}dppx)`,n=matchMedia(r);n.addEventListener("change",updatePixelRatio),t=()=>{n.removeEventListener("change",updatePixelRatio)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return updatePixelRatio(),()=>{t?.()}},[e]),(0,T.useEffect)(()=>{if(!r)return;let handleKeyDown=r=>{if(r.altKey&&(e.isIn("zoom")||!e.root.path.value.endsWith(".idle"))&&!isFocusingInput()&&preventDefault(r),r.isKilled)return;switch(r.isKilled=!0,r.key){case"=":case"-":case"0":if(r.metaKey||r.ctrlKey){preventDefault(r);return}break;case"Tab":default:if(isFocusingInput()||e.isMenuOpen)return;break;case",":if(!isFocusingInput()&&(preventDefault(r),!e.inputs.keys.has("Comma"))){let{x:t,y:n,z:i}=e.inputs.currentScreenPoint;e.inputs.keys.add("Comma");let o={type:"pointer",name:"pointer_down",point:{x:t,y:n,z:i},shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey,pointerId:0,button:0,isPen:e.instanceState.isPenMode,target:"canvas"};e.dispatch(o);return}break;case"Escape":if((e.editingShape||e.selectedShapeIds.length>0)&&r.preventDefault(),e.openMenus.length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}let n={type:"keyboard",name:r.repeat?"key_repeat":"key_down",key:r.key,code:r.code,shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey};e.dispatch(n)},handleKeyUp=t=>{if(t.isKilled||(t.isKilled=!0,isFocusingInput()||e.isMenuOpen))return;if(","===t.key&&(document.activeElement?.ELEMENT_NODE&&preventDefault(t),e.inputs.keys.has(t.code))){let{x:r,y:n,z:i}=e.inputs.currentScreenPoint;e.inputs.keys.delete(t.code);let o={type:"pointer",name:"pointer_up",point:{x:r,y:n,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.instanceState.isPenMode,target:"canvas"};e.dispatch(o);return}let r={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(r)};function handleTouchStart(r){if(t.contains(r.target)){let t=r.touches[0].pageX,n=r.touches[0].radiusX||0;(t-n<10||t+n>e.viewportScreenBounds.width-10)&&(r.target?.tagName==="BUTTON"&&r.target?.click(),preventDefault(r))}}let handleWheel=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&preventDefault(e)};return t.addEventListener("touchstart",handleTouchStart,{passive:!1}),t.addEventListener("wheel",handleWheel,{passive:!1}),document.addEventListener("gesturestart",preventDefault),document.addEventListener("gesturechange",preventDefault),document.addEventListener("gestureend",preventDefault),t.addEventListener("keydown",handleKeyDown),t.addEventListener("keyup",handleKeyUp),()=>{t.removeEventListener("touchstart",handleTouchStart),t.removeEventListener("wheel",handleWheel),document.removeEventListener("gesturestart",preventDefault),document.removeEventListener("gesturechange",preventDefault),document.removeEventListener("gestureend",preventDefault),t.removeEventListener("keydown",handleKeyDown),t.removeEventListener("keyup",handleKeyUp)}},[e,t,r])}let r0=["input","select","button","textarea"];function isFocusingInput(){let{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||r0.indexOf(e.tagName.toLowerCase())>-1))}let r1={error:null};let ErrorBoundary=class ErrorBoundary extends T.Component{static getDerivedStateFromError(e){return{error:e}}state=r1;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,I.jsx)(t,{error:e})}return this.props.children}};function OptionalErrorBoundary({children:e,fallback:t,...r}){return null===t?(0,I.jsx)(I.Fragment,{children:e}):(0,I.jsx)(ErrorBoundary,{fallback:t,...r,children:e})}let ShapeWithPropsEquality=class ShapeWithPropsEquality{constructor(e){this.shape=e}equals(e){return this.shape?.isLocked===e?.shape?.isLocked&&this.shape?.props===e?.shape?.props&&this.shape?.meta===e?.shape?.meta}};let EvenInnererIndicator=({shape:e,util:t})=>useStateTracking("Indicator:"+e.type,()=>t.indicator(e)),InnerIndicator=({editor:e,id:t})=>{let r=useValue("shape",()=>new ShapeWithPropsEquality(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:n}=useEditorComponents();return!r.shape||r.shape.isLocked?null:(0,I.jsx)(OptionalErrorBoundary,{fallback:n,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,I.jsx)(EvenInnererIndicator,{shape:r.shape,util:e.getShapeUtil(r.shape)},r.shape.id)})},r2=T.memo(({id:e,className:t,color:r,opacity:n})=>{let i=useEditor(),o=useValue("transform",()=>{let t=i.getShapePageTransform(e);return t?t.toCssString():""},[i,e]);return(0,I.jsx)("svg",{className:eb("tl-overlays__item",t),children:(0,I.jsx)("g",{className:"tl-shape-indicator",transform:o,stroke:r??"var(--color-selected)",opacity:n,children:(0,I.jsx)(InnerIndicator,{editor:i,id:e})})})});function DefaultBackground(){return(0,I.jsx)("div",{className:"tl-background"})}function useTransform(e,t,r,n,i,o){(0,T.useLayoutEffect)(()=>{let a=e.current;if(!a||void 0===t)return;let l=`translate(${t}px, ${r}px)`;void 0!==n&&(l+=` scale(${n})`),void 0!==i&&(l+=` rotate(${i}rad)`),o&&(l+=` translate(${o.x}px, ${o.y}px)`),a.style.transform=l})}let r3={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};let Vec2d_Vec2d=class Vec2d_Vec2d{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(0===e)return this;let{x:t,y:r}=this,n=Math.sin(e),i=Math.cos(e);return this.x=t*i-r*n,this.y=t*n+r*i,this}rotWith(e,t){if(0===t)return this;let r=this.x-e.x,n=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(r*o-n*i),this.y=e.y+(r*i+n*o),this}clone(){let{x:e,y:t,z:r}=this;return new Vec2d_Vec2d(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let r=Vec2d_Vec2d.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Vec2d_Vec2d.Dpr(this,e)}cpr(e){return Vec2d_Vec2d.Cpr(this,e)}len2(){return Vec2d_Vec2d.Len2(this)}len(){return Vec2d_Vec2d.Len(this)}pry(e){return Vec2d_Vec2d.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return Vec2d_Vec2d.Uni(this)}tan(e){return Vec2d_Vec2d.Tan(this,e)}dist(e){return Vec2d_Vec2d.Dist(this,e)}distanceToLineSegment(e,t){return Vec2d_Vec2d.DistanceToLineSegment(e,t,this)}slope(e){return Vec2d_Vec2d.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Vec2d_Vec2d.Angle(this,e)}toAngle(){return Vec2d_Vec2d.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Vec2d_Vec2d.Equals(this,e)}equalsXY(e,t){return Vec2d_Vec2d.EqualsXY(this,e,t)}norm(){let e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return Vec2d_Vec2d.ToFixed(this)}toString(){return Vec2d_Vec2d.ToString(Vec2d_Vec2d.ToFixed(this))}toJson(){return Vec2d_Vec2d.ToJson(this)}toArray(){return Vec2d_Vec2d.ToArray(this)}static Add(e,t){return new Vec2d_Vec2d(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new Vec2d_Vec2d(e.x+t,e.y+r)}static Sub(e,t){return new Vec2d_Vec2d(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new Vec2d_Vec2d(e.x-t,e.y-r)}static AddScalar(e,t){return new Vec2d_Vec2d(e.x+t,e.y+t)}static SubScalar(e,t){return new Vec2d_Vec2d(e.x-t,e.y-t)}static Div(e,t){return new Vec2d_Vec2d(e.x/t,e.y/t)}static Mul(e,t){return new Vec2d_Vec2d(e.x*t,e.y*t)}static DivV(e,t){return new Vec2d_Vec2d(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Vec2d_Vec2d(e.x*t.x,e.y*t.y)}static Neg(e){return new Vec2d_Vec2d(-e.x,-e.y)}static Per(e){return new Vec2d_Vec2d(e.y,-e.x)}static Dist2(e,t){return Vec2d_Vec2d.Sub(e,t).len2()}static Abs(e){return new Vec2d_Vec2d(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Vec2d_Vec2d(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return Vec2d_Vec2d.Dpr(e,t)/Vec2d_Vec2d.Len(t)}static Uni(e){return Vec2d_Vec2d.Div(e,Vec2d_Vec2d.Len(e))}static Tan(e,t){return Vec2d_Vec2d.Uni(Vec2d_Vec2d.Sub(e,t))}static Min(e,t){return new Vec2d_Vec2d(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Vec2d_Vec2d(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new Vec2d_Vec2d(e,t,r)}static FromArray(e){return new Vec2d_Vec2d(e[0],e[1])}static Rot(e,t=0){let r=Math.sin(t),n=Math.cos(t);return new Vec2d_Vec2d(e.x*n-e.y*r,e.x*r+e.y*n)}static RotWith(e,t,r){let n=e.x-t.x,i=e.y-t.y,o=Math.sin(r),a=Math.cos(r);return new Vec2d_Vec2d(t.x+(n*a-i*o),t.y+(n*o+i*a))}static NearestPointOnLineThroughPoint(e,t,r){return Vec2d_Vec2d.Mul(t,Vec2d_Vec2d.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,n=!0){let i=Vec2d_Vec2d.Tan(t,e),o=Vec2d_Vec2d.Add(e,Vec2d_Vec2d.Mul(i,Vec2d_Vec2d.Sub(r,e).pry(i)));if(n){if(o.x<Math.min(e.x,t.x))return Vec2d_Vec2d.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return Vec2d_Vec2d.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return Vec2d_Vec2d.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return Vec2d_Vec2d.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,r){return Vec2d_Vec2d.Dist(r,Vec2d_Vec2d.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,n=!0){return Vec2d_Vec2d.Dist(r,Vec2d_Vec2d.NearestPointOnLineSegment(e,t,r,n))}static Snap(e,t=1){return new Vec2d_Vec2d(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Vec2d_Vec2d?e:Vec2d_Vec2d.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return Vec2d_Vec2d.Sub(t,e).mul(r).add(e)}static Med(e,t){return new Vec2d_Vec2d((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){let r=Vec2d_Vec2d.Len(e);return new Vec2d_Vec2d(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return Vec2d_Vec2d.Sub(e,r).mul(t).add(r)}static ToFixed(e,t=2){return new Vec2d_Vec2d(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,r){return Vec2d_Vec2d.Add(e,Vec2d_Vec2d.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new Vec2d_Vec2d(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:r,z:n}=e;return{x:t,y:r,z:n}}static Average(e){let t=e.length,r=new Vec2d_Vec2d(0,0);for(let n=0;n<t;n++)r.add(e[n]);return r.div(t)}static Clamp(e,t,r){return void 0===r?new Vec2d_Vec2d(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Vec2d_Vec2d(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){let n=[];for(let i=0;i<r;i++){let o=r3.easeInQuad(i/(r-1)),a=Vec2d_Vec2d.Lrp(e,t,o);a.z=Math.min(1,.5+.65*Math.abs(.5-ease(o))),n.push(a)}return n}static SnapToGrid(e,t=8){return new Vec2d_Vec2d(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}};let ease=e=>e<.5?2*e*e:-1+(4-2*e)*e;let Box2d_Box2d=class Box2d_Box2d{constructor(e=0,t=0,r=0,n=0){this.x=e,this.y=t,this.w=r,this.h=n}x=0;y=0;w=0;h=0;get point(){return new Vec2d_Vec2d(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new Vec2d_Vec2d(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new Vec2d_Vec2d(this.minX,this.minY),new Vec2d_Vec2d(this.maxX,this.minY),new Vec2d_Vec2d(this.maxX,this.maxY),new Vec2d_Vec2d(this.minX,this.maxY)]}get snapPoints(){return[new Vec2d_Vec2d(this.minX,this.minY),new Vec2d_Vec2d(this.maxX,this.minY),new Vec2d_Vec2d(this.maxX,this.maxY),new Vec2d_Vec2d(this.minX,this.maxY),this.center]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new Vec2d_Vec2d(this.w,this.h)}toFixed(){return this.x=toPrecision(this.x),this.y=toPrecision(this.y),this.w=toPrecision(this.w),this.h=toPrecision(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,n=0){return this.x=e,this.y=t,this.w=r,this.h=n,this}expand(e){let t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),n=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=n-t,this.h=i-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:r,h:n}=this;return new Box2d_Box2d(e,t,r,n)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,n=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,n-t),this.height=Math.max(1,i-r)}collides(e){return Box2d_Box2d.Collides(this,e)}contains(e){return Box2d_Box2d.Contains(this,e)}includes(e){return Box2d_Box2d.Includes(this,e)}containsPoint(e,t=0){return Box2d_Box2d.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new Vec2d_Vec2d(this.minX,this.minY);case"top_right":return new Vec2d_Vec2d(this.maxX,this.minY);case"bottom_left":return new Vec2d_Vec2d(this.minX,this.maxY);case"bottom_right":return new Vec2d_Vec2d(this.maxX,this.maxY);case"top":return new Vec2d_Vec2d(this.midX,this.minY);case"right":return new Vec2d_Vec2d(this.maxX,this.midY);case"bottom":return new Vec2d_Vec2d(this.midX,this.maxY);case"left":return new Vec2d_Vec2d(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){let{minX:n,minY:i,maxX:o,maxY:a}=this,{minX:l,minY:d,maxX:c,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":l+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":d+=r;break;case"bottom":case"bottom_left":case"bottom_right":u+=r}let p=(c-l)/(o-n),h=(u-d)/(a-i);if(p<0){let e=c;c=l,l=e}if(h<0){let e=u;u=d,d=e}this.minX=l,this.minY=d,this.width=Math.abs(c-l),this.height=Math.abs(u-d)}union(e){let t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),n=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=n-t,this.height=i-r,this}static From(e){return new Box2d_Box2d(e.x,e.y,e.w,e.h)}static FromPoints(e){let t;if(0===e.length)return new Box2d_Box2d;let r=1/0,n=1/0,i=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a++)r=Math.min((t=e[a]).x,r),n=Math.min(t.y,n),i=Math.max(t.x,i),o=Math.max(t.y,o);return new Box2d_Box2d(r,n,i-r,o-n)}static Expand(e,t){let r=Math.min(t.minX,e.minX),n=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new Box2d_Box2d(r,n,i-r,o-n)}static ExpandBy(e,t){return new Box2d_Box2d(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides=(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY);static Contains=(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX;static Includes=(e,t)=>Box2d_Box2d.Collides(e,t)||Box2d_Box2d.Contains(e,t);static ContainsPoint=(e,t,r=0)=>!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r);static Common=e=>{let t=1/0,r=1/0,n=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let a=e[o];t=Math.min(t,a.minX),r=Math.min(r,a.minY),n=Math.max(n,a.maxX),i=Math.max(i,a.maxY)}return new Box2d_Box2d(t,r,n-t,i-r)};static Sides=(e,t=0)=>{let{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]};static Resize(e,t,r,n,i=!1){let{minX:o,minY:a,maxX:l,maxY:d}=e,{minX:c,minY:u,maxX:p,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":c+=r;break;case"right":case"top_right":case"bottom_right":p+=r}switch(t){case"top":case"top_left":case"top_right":u+=n;break;case"bottom":case"bottom_left":case"bottom_right":h+=n}let f=(p-c)/(l-o),g=(h-u)/(d-a);if(i){let e=(l-o)/(d-a),r=Math.abs(p-c),n=Math.abs(h-u),i=r*(g<0?1:-1)*(1/e),m=n*(f<0?1:-1)*e,y=e<r/n;switch(t){case"top_left":y?u=h+i:c=p+m;break;case"top_right":y?u=h+i:p=c-m;break;case"bottom_right":y?h=u-i:p=c-m;break;case"bottom_left":y?h=u-i:c=p+m;break;case"bottom":case"top":{let t=(c+p)/2,r=n*e;c=t-r/2,p=t+r/2;break}case"left":case"right":{let t=(u+h)/2,n=r/e;u=t-n/2,h=t+n/2}}}if(f<0){let e=p;p=c,c=e}if(g<0){let e=h;h=u,u=e}let m=new Box2d_Box2d(c,u,Math.abs(p-c),Math.abs(h-u));return{box:m,scaleX:+(m.width/e.width*(f>0?1:-1)).toFixed(5),scaleY:+(m.height/e.height*(g>0?1:-1)).toFixed(5)}}equals(e){return Box2d_Box2d.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Box2d_Box2d(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};function flipSelectionHandleY(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function flipSelectionHandleX(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}let r5=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(e,t){t%=r9;let r=Math.round(t/(r8/4)),n=r5.indexOf(e);return r5[(n+r)%r5.length]}function isSelectionCorner(e){return"top_left"===e||"top_right"===e||"bottom_right"===e||"bottom_left"===e}let r4={top_left_rotate:"top_left",top_right_rotate:"top_right",bottom_right_rotate:"bottom_right",bottom_left_rotate:"bottom_left",mobile_rotate:"top_left"};function precise(e){return`${toDomPrecision(e.x)},${toDomPrecision(e.y)} `}function average(e,t){return`${toDomPrecision((e.x+t.x)/2)},${toDomPrecision((e.y+t.y)/2)} `}let r8=Math.PI,r6=r8/2,r9=2*r8,r7=Math.PI/180,ne=Math.sin;function clamp(e,t,r){return Math.max(t,void 0!==r?Math.min(e,r):e)}function toPrecision(e,t=1e10){return e?Math.round(e*t)/t:0}function approximately(e,t,r=1e-6){return Math.abs(e-t)<=r}function perimeterOfEllipse(e,t){let r=Math.pow(e-t,2)/Math.pow(e+t,2),n=r8*(e+t)*(1+3*r/(10+Math.sqrt(4-3*r)));return n}function canonicalizeRotation(e){return(e%=r9)<0?e+=r9:0===e&&(e=0),e}function clockwiseAngleDist(e,t){return(e=canonicalizeRotation(e))>(t=canonicalizeRotation(t))&&(t+=r9),t-e}function counterClockwiseAngleDist(e,t){return r9-clockwiseAngleDist(e,t)}function shortAngleDist(e,t){let r=(t-e)%r9;return 2*r%r9-r}function longAngleDist(e,t){return r9-shortAngleDist(e,t)}function lerpAngles(e,t,r){return e+shortAngleDist(e,t)*r}function angleDelta(e,t){return shortAngleDist(e,t)}function getSweep(e,t,r){return shortAngleDist(Vec2d_Vec2d.Angle(e,t),Vec2d_Vec2d.Angle(e,r))}function clampRadians(e){return(r9+e)%r9}function snapAngle(e,t){let r=r9/t,n=Math.floor((clampRadians(e)+r/2)/r)*r%r9;return n<r8&&(n+=r9),n>r8&&(n-=r9),n}function areAnglesCompatible(e,t){return e===t||approximately(e%(Math.PI/2)-t%(Math.PI/2),0)}function isAngleBetween(e,t,r){e=canonicalizeRotation(e),t=canonicalizeRotation(t),r=canonicalizeRotation(r);let n=Math.cos(e),i=Math.sin(e),o=Math.cos(t),a=Math.sin(t),l=Math.cos(r),d=Math.sin(r);return n*l+i*d>=0&&o*l+a*d>=0}function degreesToRadians(e){return e*r8/180}function radiansToDegrees(e){return 180*e/r8}function getArcLength(e,t,r,n){let i=getSweep(e,r,n);return t*r9*(i/r9)}function getPointOnCircle(e,t,r,n){return new Vec2d_Vec2d(e+r*Math.cos(n),t+r*Math.sin(n))}function getPolygonVertices(e,t,r){let n=e/2,i=t/2,o=[],a=1/0,l=1/0;for(let e=0;e<r;e++){let t=r9/r,d=-r6+e*t,c=n+n*Math.cos(d),u=i+i*Math.sin(d);c<a&&(a=c),u<l&&(l=u),o.push(new Vec2d_Vec2d(c,u))}if(0!==a||0!==l)for(let e=0;e<o.length;e++){let t=o[e];t.x-=a,t.y-=l}return o}function rangeIntersection(e,t,r,n){let i=Math.max(e,r),o=Math.min(t,n);return i<=o?[i,o]:null}let getStarBounds=(e,t,r)=>{let n=r9/e/2,i=2*Math.floor(e/4),o=Math.cos(-r6+i*n)*t/2,a=Math.cos(-r6+(2*e-i)*n)*t/2,l=Math.sin(-r6+0*n)*r/2,d=Math.sin(-r6+2*Math.floor(e/2)*n)*r/2;return new Box2d_Box2d(0,0,o-a,d-l)};function cross(e,t,r){return(t.x-e.x)*(r.y-e.y)-(r.x-e.x)*(t.y-e.y)}function pointInCircle(e,t,r){return Vec2d_Vec2d.Dist(e,t)<=r}function pointInEllipse(e,t,r,n,i=0){i=i||0;let o=Math.cos(i),a=Math.sin(i),l=Vec2d_Vec2d.Sub(e,t),d=o*l.x+a*l.y,c=a*l.x-o*l.y;return d*d/(r*r)+c*c/(n*n)<=1}function pointInRect(e,t,r){return!(e.x<t.x||e.x>t.x+r.x||e.y<t.y||e.y>t.y+r.y)}function pointInPolygon(e,t){let r,n,i=0;for(let o=0;o<t.length;o++)r=t[o],n=t[(o+1)%t.length],r.y<=e.y?n.y>e.y&&cross(r,n,e)>0&&(i+=1):n.y<=e.y&&0>cross(r,n,e)&&(i-=1);return 0!==i}function pointInBounds(e,t){return!(e.x<t.minX||e.x>t.maxX||e.y<t.minY||e.y>t.maxY)}function pointInPolyline(e,t,r=3){for(let n=1;n<t.length;n++)if(Vec2d_Vec2d.DistanceToLineSegment(t[n-1],t[n],e)<r)return!0;return!1}function pointNearToPolyline(e,t,r=8){let n=t.length;for(let i=1;i<n;i++){let n=t[i-1],o=t[i],a=Vec2d_Vec2d.DistanceToLineSegment(n,o,e);if(a<r)return!0}return!1}function pointNearToLineSegment(e,t,r,n=8){let i=Vec2d_Vec2d.DistanceToLineSegment(t,r,e);return i<n}function toDomPrecision(e){return+e.toFixed(4)}function toFixed(e){return+e.toFixed(2)}let isSafeFloat=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER,DefaultBrush=({brush:e,color:t,opacity:r})=>{let n=(0,T.useRef)(null);useTransform(n,e.x,e.y);let i=toDomPrecision(Math.max(1,e.w)),o=toDomPrecision(Math.max(1,e.h));return(0,I.jsx)("svg",{className:"tl-overlays__item",ref:n,children:t?(0,I.jsxs)("g",{className:"tl-brush",opacity:r,children:[(0,I.jsx)("rect",{width:i,height:o,fill:t,opacity:.75}),(0,I.jsx)("rect",{width:i,height:o,fill:"none",stroke:t,opacity:.1})]}):(0,I.jsx)("rect",{className:"tl-brush tl-brush__default",width:i,height:o})})},DefaultCollaboratorHint=({className:e,zoom:t,point:r,color:n,viewport:i,opacity:o=1})=>{let a=(0,T.useRef)(null);return useTransform(a,clamp(r.x,i.minX+5/t,i.maxX-5/t),clamp(r.y,i.minY+5/t,i.maxY-5/t),1/t,Vec2d_Vec2d.Angle(i.center,r)),(0,I.jsxs)("svg",{ref:a,className:eb("tl-overlays__item",e),children:[(0,I.jsx)("use",{href:"#cursor_hint",color:n,strokeWidth:3,stroke:"var(--color-background)"}),(0,I.jsx)("use",{href:"#cursor_hint",color:n,opacity:o})]})},nt=(0,T.memo)(({className:e,zoom:t,point:r,color:n,name:i,chatMessage:o})=>{let a=(0,T.useRef)(null);return(useTransform(a,r?.x,r?.y,1/t),r)?(0,I.jsxs)("div",{ref:a,className:eb("tl-overlays__item",e),children:[(0,I.jsx)("svg",{className:"tl-cursor",children:(0,I.jsx)("use",{href:"#cursor",color:n})}),o?(0,I.jsxs)(I.Fragment,{children:[i&&(0,I.jsx)("div",{className:"tl-nametag-title",style:{color:n},children:i}),(0,I.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:n},children:o})]}):i&&(0,I.jsx)("div",{className:"tl-nametag",style:{backgroundColor:n},children:i})]}):null}),nr={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function setRuntimeOverrides(e){Object.assign(nr,e)}function hardResetEditor(){nr.hardReset()}function refreshPage(){nr.refreshPage()}function DefaultErrorFallback_noop(){}let DefaultErrorFallback=({error:e,editor:t})=>{let r=(0,T.useRef)(null),[n,i]=(0,T.useState)(!1),[o,a]=(0,T.useState)(!1),[l,d]=(0,T.useState)(!1),c=e instanceof Error?e.message:String(e),u=e instanceof Error?e.stack:null,p=useValue("isDarkMode",()=>{try{if(t)return t.user.isDarkMode}catch{}return null},[t]),[h,f]=(0,T.useState)(null);(0,T.useLayoutEffect)(()=>{null!==p&&f(p);let e=r.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){f(null);return}f(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),(0,T.useEffect)(()=>{if(o){let e=setTimeout(()=>{a(!1)},2e3);return()=>clearTimeout(e)}},[o]);let resetLocalState=async()=>{hardResetEditor()},g=new URL("https://github.com/tldraw/tldraw/issues/new");return g.searchParams.set("title",c),g.searchParams.set("labels","bug"),g.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??c}
\`\`\`

My browser: ${navigator.userAgent}`),(0,I.jsxs)("div",{ref:r,className:eb("tl-container tl-error-boundary",null===h?"":h?"tl-theme__dark":"tl-theme__light"),children:[(0,I.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,I.jsx)(ErrorBoundary,{onError:DefaultErrorFallback_noop,fallback:()=>null,children:(0,I.jsx)(rQ.Provider,{value:t,children:(0,I.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:(0,I.jsx)(Canvas,{})})})}),(0,I.jsx)("div",{className:eb("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":n&&!l}),children:l?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("h2",{children:"Are you sure?"}),(0,I.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,I.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,I.jsx)("button",{onClick:()=>d(!1),children:"Cancel"}),(0,I.jsx)("button",{className:"tl-error-boundary__reset",onClick:resetLocalState,children:"Reset data"})]})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("h2",{children:"Something's gone wrong."}),(0,I.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,I.jsx)("a",{href:g.toString(),children:"create a GitHub issue"})," or"," ",(0,I.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),n&&(0,I.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,I.jsx)("pre",{children:(0,I.jsx)("code",{children:u??c})}),(0,I.jsx)("button",{onClick:()=>{let e=document.createElement("textarea");e.value=u??c,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),a(!0)},children:o?"Copied!":"Copy"})]}),(0,I.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,I.jsx)("button",{onClick:()=>i(!n),children:n?"Hide details":"Show details"}),(0,I.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,I.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>d(!0),children:"Reset data"}),(0,I.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{refreshPage()},children:"Refresh Page"})]})]})]})})]})},nn=2e3,ni=40,no=80,na=320,ns=[.1,.25,.5,1,2,4,8],nl=.1,nd=8,nc=450,nu=200,np=4,nh=32,nf={};for(let e=1;e<=Math.ceil(nd);e++)nf[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,nf[e+"_light"]=`hash_pattern_zoom_${e}_light`;let ng={duration:0,easing:r3.easeInOutCubic},nm=.09,ny=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],nb={CAMERA_MOVE:-10},nv=8,DefaultGrid=({x:e,y:t,z:r,size:n})=>(0,I.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,I.jsx)("defs",{children:ny.map(({min:i,mid:o,step:a},l)=>{let d=a*n*r,c=.5+e*r,u=.5+t*r,p=r<o?modulate(r,[i,o],[0,1]):1;return(0,I.jsx)("pattern",{id:`grid-${a}`,width:d,height:d,patternUnits:"userSpaceOnUse",children:(0,I.jsx)("circle",{className:"tl-grid-dot",cx:c>0?c%d:d+c%d,cy:u>0?u%d:d+u%d,r:1,opacity:p})},`grid-pattern-${l}`)})}),ny.map(({step:e},t)=>(0,I.jsx)("rect",{width:"100%",height:"100%",fill:`url(#grid-${e})`},`grid-rect-${t}`))]}),DefaultHandle=({handle:e,isCoarse:t,className:r,zoom:n})=>{let i=("create"===e.type&&t?3:4)/n;return(0,I.jsxs)("g",{className:eb("tl-handle",{"tl-handle__virtual":"virtual"===e.type,"tl-handle__create":"create"===e.type},r),children:[(0,I.jsx)("circle",{className:"tl-handle__bg",r:(t?20:12)/n}),(0,I.jsx)("circle",{className:"tl-handle__fg",r:i})]})},DefaultHandles=({children:e})=>(0,I.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}),DefaultHoveredShapeIndicator=({shapeId:e})=>(0,I.jsx)(r2,{className:"tl-user-indicator__hovered",id:e});function getSvgPathFromPoints_getSvgPathFromPoints(e,t=!0){let r=e.length;if(r<2)return"";let n=e[0],i=e[1];if(2===r)return`M${precise(n)}L${precise(i)}`;let o="";for(let t=2,a=r-1;t<a;t++)o+=average(n=e[t],i=e[t+1]);return t?`M${average(e[0],e[1])}Q${precise(e[1])}${average(e[1],e[2])}T${o}${average(e[r-1],e[0])}${average(e[0],e[1])}Z`:`M${precise(e[0])}Q${precise(e[1])}${average(e[1],e[2])}${e.length>3?"T":""}${o}L${precise(e[r-1])}`}let DefaultScribble=({scribble:e,zoom:t,color:r,opacity:n,className:i})=>e.points.length?(0,I.jsx)("svg",{className:i?eb("tl-overlays__item",i):i,children:(0,I.jsx)("path",{className:"tl-scribble",d:getSvgPathFromPoints_getSvgPathFromPoints(e.points,!1),stroke:r??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:n??e.opacity})}):null,DefaultSelectionBackground=({bounds:e,rotation:t})=>{let r=T.useRef(null);return useTransform(r,e.x,e.y,1,t),T.useLayoutEffect(()=>{let t=r.current;t&&(t.style.width=toDomPrecision(Math.max(1,e.width))+"px",t.style.height=toDomPrecision(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,I.jsx)("div",{ref:r,className:"tl-selection__bg",draggable:!1})},DefaultSelectionForeground=({bounds:e,rotation:t})=>{let r=useEditor(),n=(0,T.useRef)(null),i=useValue("only selected shape",()=>r.onlySelectedShape,[r]),o=i?r.getShapeUtil(i).expandSelectionOutlinePx(i):0;return useTransform(n,e?.x,e?.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),(0,I.jsx)("svg",{ref:n,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,I.jsx)("rect",{className:eb("tl-selection__fg__outline"),width:toDomPrecision(e.width),height:toDomPrecision(e.height)})})},DefaultShapeErrorFallback=()=>(0,I.jsx)("div",{className:"tl-shape-error-boundary"}),DefaultShapeIndicatorErrorFallback=()=>(0,I.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function PointsSnapLine({points:e,zoom:t}){let r,n,i,o;let a=2.5/t,l=e.reduce((e,t)=>Math.min(e,t.x),1/0),d=e.reduce((e,t)=>Math.max(e,t.x),-1/0),c=e.reduce((e,t)=>Math.min(e,t.y),1/0),u=e.reduce((e,t)=>Math.max(e,t.y),-1/0),p=e.some(e=>e.x===l&&e.y===c);return p?(r=l,n=c,i=d,o=u):(r=l,n=u,i=d,o=c),(0,I.jsxs)("g",{className:"tl-snap-line",children:[(0,I.jsx)("line",{x1:r,y1:n,x2:i,y2:o}),e.map((e,t)=>(0,I.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,I.jsx)("path",{className:"tl-snap-point",d:`M ${-a},${-a} L ${a},${a} M ${-a},${a} L ${a},${-a}`})},t))]})}function GapsSnapLine({gaps:e,direction:t,zoom:r}){let n=3.5/r,i=[-1/0,1/0],o=null,a="horizontal"===t;for(let t of e)(o=rangeIntersection(i[0],i[1],a?t.startEdge[0].y:t.startEdge[0].x,a?t.startEdge[1].y:t.startEdge[1].x))&&(o=rangeIntersection((i=o)[0],i[1],a?t.endEdge[0].y:t.endEdge[0].x,a?t.endEdge[1].y:t.endEdge[1].x))&&(i=o);if(null===i)return null;let l=(i[0]+i[1])/2;return(0,I.jsx)("g",{className:"tl-snap-line",children:e.map(({startEdge:e,endEdge:t},r)=>(0,I.jsx)(T.Fragment,{children:a?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("line",{x1:e[0].x,y1:l-2*n,x2:e[1].x,y2:l+2*n}),(0,I.jsx)("line",{x1:t[0].x,y1:l-2*n,x2:t[1].x,y2:l+2*n}),(0,I.jsx)("line",{x1:e[0].x,y1:l,x2:t[0].x,y2:l}),(0,I.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:l-n,x2:(e[0].x+t[0].x)/2,y2:l+n})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("line",{x1:l-2*n,y1:e[0].y,x2:l+2*n,y2:e[1].y}),(0,I.jsx)("line",{x1:l-2*n,y1:t[0].y,x2:l+2*n,y2:t[1].y}),(0,I.jsx)("line",{x1:l,y1:e[0].y,x2:l,y2:t[0].y}),(0,I.jsx)("line",{x1:l-n,y1:(e[0].y+t[0].y)/2,x2:l+n,y2:(e[0].y+t[0].y)/2})]})},r))})}let DefaultSnapLine=({className:e,line:t,zoom:r})=>(0,I.jsx)("svg",{className:eb("tl-overlays__item",e),children:"points"===t.type?(0,I.jsx)(PointsSnapLine,{...t,zoom:r}):"gaps"===t.type?(0,I.jsx)(GapsSnapLine,{...t,zoom:r}):null}),DefaultSpinner=()=>(0,I.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,I.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,I.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),(0,I.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:(0,I.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),DefaultSvgDefs=()=>null,nS=(0,T.createContext)({});function EditorComponentsProvider({overrides:e,children:t}){return(0,I.jsx)(nS.Provider,{value:(0,T.useMemo)(()=>({Background:DefaultBackground,SvgDefs:DefaultSvgDefs,Brush:DefaultBrush,ZoomBrush:DefaultBrush,CollaboratorBrush:DefaultBrush,Cursor:nt,CollaboratorCursor:nt,CollaboratorHint:DefaultCollaboratorHint,CollaboratorShapeIndicator:r2,Grid:DefaultGrid,Scribble:DefaultScribble,SnapLine:DefaultSnapLine,Handles:DefaultHandles,Handle:DefaultHandle,CollaboratorScribble:DefaultScribble,ErrorFallback:DefaultErrorFallback,ShapeErrorFallback:DefaultShapeErrorFallback,ShapeIndicatorErrorFallback:DefaultShapeIndicatorErrorFallback,Spinner:DefaultSpinner,SelectionBackground:DefaultSelectionBackground,SelectionForeground:DefaultSelectionForeground,HoveredShapeIndicator:DefaultHoveredShapeIndicator,...e}),[e]),children:t})}function useEditorComponents(){return(0,T.useContext)(nS)}let nx=["textarea","input"];function useFixSafariDoubleTapZoomPencilEvents(e){let t=useEditor();(0,T.useEffect)(()=>{let r=e.current;if(!r)return;let handleEvent=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:r}=e;nx.includes(r.tagName?.toLocaleLowerCase())||t.isIn("select.editing_shape")||preventDefault(e)}};return r.addEventListener("touchstart",handleEvent),r.addEventListener("touchend",handleEvent),()=>{r.removeEventListener("touchstart",handleEvent),r.addEventListener("touchend",handleEvent)}},[t,e])}var nw=r(51);let n_=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function normalizeWheel(e){let{deltaY:t,deltaX:r}=e,n=0;if(e.ctrlKey||e.altKey||e.metaKey){let r=Math.sign(e.deltaY),i=Math.abs(e.deltaY),o=t;i>10&&(o=10*r),n=o/100}else e.shiftKey&&!n_&&(r=t,t=0);return{x:-r,y:-t,z:-n}}let nP=(0,nw.createUseGesture)([nw.wheelAction,nw.pinchAction]),isWheelEndEvent=e=>void 0===f?(f=e,!1):e-f>120&&e-f<160?(f=e,!0):(f=e,!1);function useGestureEvents(e){let t=useEditor(),r=T.useMemo(()=>{let r="not sure",n=1,i=1,o=1,a=0,l=new Vec2d_Vec2d,d=new Vec2d_Vec2d,updatePinchState=e=>{if(e&&(r="zooming"),"zooming"===r)return;let t=Math.abs(a-n),i=Vec2d_Vec2d.Dist(l,d);switch(r){case"not sure":t>24?r="zooming":i>16&&(r="panning");break;case"panning":t>64&&(r="zooming")}};return{onWheel:({event:e})=>{if(!t.instanceState.isFocused||(r="not sure",isWheelEndEvent(Date.now())))return;if(t.editingShapeId){let e=t.getShape(t.editingShapeId);if(e){let r=t.getShapeUtil(e);if(r.canScroll(e)){let e=t.getShapePageBounds(t.editingShapeId);if(e?.containsPoint(t.inputs.currentPagePoint))return}}}preventDefault(e);let n=normalizeWheel(e);if(0===n.x&&0===n.y)return;let i={type:"wheel",name:"wheel",delta:n,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(i)},onPinchStart:o=>{let a=e.current;r="not sure";let{event:c,origin:u,da:p}=o;!(c instanceof WheelEvent)&&(c.target===a||a?.contains(c.target))&&(d.x=u[0],d.y=u[1],l.x=u[0],l.y=u[1],n=p[0],i=t.zoomLevel,t.dispatch({type:"pinch",name:"pinch_start",point:{x:u[0],y:u[1],z:t.zoomLevel},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey}))},onPinchEnd:n=>{let i=e.current,{event:o,origin:a,offset:l}=n;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let d=l[0];r="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:a[0],y:a[1],z:d},delta:{x:a[0],y:a[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})})},onPinch:n=>{let l=e.current,{event:c,origin:u,offset:p,da:h}=n;if(c instanceof WheelEvent||!(c.target===l||l?.contains(c.target)))return;let f="gesturechange"===n.type||"gestureend"===n.type;a=h[0];let g=u[0]-d.x,m=u[1]-d.y;switch(d.x=u[0],d.y=u[1],updatePinchState(f),r){case"zooming":o=p[0],t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:o},delta:{x:g,y:m},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:i},delta:{x:g,y:m},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey})}}}},[t,e]);nP(r,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.zoomLevel,0],scaleBounds:()=>({from:t.zoomLevel,max:8,min:.05})}})}function getHandle(e,t,r){let n=e.getShape(t),i=e.getShapeHandles(n);return{shape:n,handle:i.find(e=>e.id===r)}}function useHandleEvents(e,t){let r=useEditor();return T.useMemo(()=>{let n,i;return{onPointerDown:n=>{if(n.isKilled)return;let i=loopToHtmlElement(n.currentTarget);setPointerCapture(i,n);let{shape:o,handle:a}=getHandle(r,e,t);a&&r.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_down",...getPointerInfo(n)})},onPointerMove:o=>{if(o.isKilled||o.clientX===n&&o.clientY===i)return;n=o.clientX,i=o.clientY;let{shape:a,handle:l}=getHandle(r,e,t);l&&r.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...getPointerInfo(o)})},onPointerUp:n=>{if(n.isKilled)return;let i=loopToHtmlElement(n.currentTarget);releasePointerCapture(i,n);let{shape:o,handle:a}=getHandle(r,e,t);a&&r.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_up",...getPointerInfo(n)})}}},[r,e,t])}var nE=r(1186);function useScreenBounds(){let e=useEditor();(0,T.useLayoutEffect)(()=>{let t=nE(()=>{e.updateViewportScreenBounds()},200,{trailing:!0});e.updateViewportScreenBounds();let r=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(r),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}},[e])}let Matrix2d=class Matrix2d{constructor(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.d=n,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:r,c:n,d:i,e:o,f:a}=this;return this.a=t*e.a+n*e.b,this.c=t*e.c+n*e.d,this.e=t*e.e+n*e.f+o,this.b=r*e.a+i*e.b,this.d=r*e.c+i*e.d,this.f=r*e.e+i*e.f+a,this}rotate(e,t,r){return 0===e?this:void 0===t?this.multiply(Matrix2d.Rotate(e)):this.translate(t,r).multiply(Matrix2d.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(Matrix2d.Translate(e,t))}scale(e,t){return this.multiply(Matrix2d.Scale(e,t))}invert(){let{a:e,b:t,c:r,d:n,e:i,f:o}=this,a=e*n-t*r;return this.a=n/a,this.b=-(t/a),this.c=-(r/a),this.d=e/a,this.e=-((n*i-r*o)/a),this.f=(t*i-e*o)/a,this}applyToPoint(e){return Matrix2d.applyToPoint(this,e)}applyToPoints(e){return Matrix2d.applyToPoints(this,e)}rotation(){return Matrix2d.Rotation(this)}point(){return Matrix2d.Point(this)}decomposed(){return Matrix2d.Decompose(this)}toCssString(){return Matrix2d.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Matrix2d.Decompose(this)}clone(){return new Matrix2d(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Matrix2d(1,0,0,1,0,0)}static Translate(e,t){return new Matrix2d(1,0,0,1,e,t)}static Rotate(e,t,r){if(0===e)return Matrix2d.Identity();let n=Math.cos(e),i=Math.sin(e),o=new Matrix2d(n,i,-i,n,0,0);return void 0===t?o:Matrix2d.Compose(Matrix2d.Translate(t,r),o,Matrix2d.Translate(-t,-r))}static Scale=(e,t,r,n)=>{let i=new Matrix2d(e,0,0,0,t,0);return void 0===r?i:Matrix2d.Compose(Matrix2d.Translate(r,n),i,Matrix2d.Translate(-r,-n))};static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=Matrix2d.Identity();for(let r=0,n=e.length;r<n;r++)t.multiply(e[r]);return t}static Point(e){return new Vec2d_Vec2d(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let r=Math.hypot(e.a,e.c);t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let r=Math.hypot(e.b,e.d);t=r6+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return clampRadians(t)}static Decompose(e){let t,r,n;if(0!==e.a||0!==e.c){let i=Math.hypot(e.a,e.c);t=i,r=(e.a*e.d-e.b*e.c)/i,n=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let i=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/i,r=i,n=r6+Math.acos(e.b/i)*(e.d>0?-1:1)}else t=0,r=0,n=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:clampRadians(n)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${toDomPrecision(e.a)}, ${toDomPrecision(e.b)}, ${toDomPrecision(e.c)}, ${toDomPrecision(e.d)}, ${toDomPrecision(e.e)}, ${toDomPrecision(e.f)})`}static applyToPoint(e,t){return new Vec2d_Vec2d(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(t=>new Vec2d_Vec2d(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new Box2d_Box2d(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Matrix2d(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Matrix2d?e:Matrix2d.From(e)}};function useTick(e=!0){let[t,r]=(0,T.useState)(0),n=useEditor();(0,T.useEffect)(()=>{if(!e)return;let update=()=>r(e=>e+1);return n.on("tick",update),()=>{n.off("tick",update)}},[n,e])}let nC=track(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){let n=useEditor();useTick(r);let{zoomLevel:i,renderingShapes:o,inputs:{currentPagePoint:a}}=n;return(0,I.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(o=>{let l=n.getShape(o.id);if("group"===l.type)return null;let d=n.getShapeGeometry(l),c=n.getShapePageTransform(l),u=n.getPointInShapeSpace(l,a),p=d.nearestPoint(u),h=d.distanceToPoint(u,!0),f=Math.abs(h)*i,{vertices:g}=d;return(0,I.jsxs)("g",{transform:c.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,I.jsx)("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:d.toSimpleSvgPath()}),t&&g.map((e,t)=>(0,I.jsx)("circle",{cx:e.x,cy:e.y,r:"2",fill:`hsl(${modulate(t,[0,g.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${t}`)),r&&f<150&&(0,I.jsx)("line",{x1:p.x,y1:p.y,x2:u.x,y2:u.y,opacity:1-f/150,stroke:h<0?"goldenrod":"dodgerblue",strokeWidth:"2"})]},o.id+"_outline")})})});var nk=r(8338);function uniq(e){return nk(e)}function usePeerIds(){let e=useEditor(),t=(0,T.useMemo)(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.id}})),[e]),r=useComputed("userIds",()=>nk(t.value.map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[t]);return useValue(r)}function usePresence(e){let t=useEditor(),r=(0,T.useMemo)(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]),n=useValue(`latestPresence:${e}`,()=>r.value.slice().sort((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp)[0],[]);return n??null}let nI=track(function(){let e=usePeerIds();return(0,I.jsx)(I.Fragment,{children:e.map(e=>(0,I.jsx)(nT,{collaboratorId:e},e))})}),nT=track(function({collaboratorId:e}){let t=useEditor(),r=usePresence(e),n=useCollaboratorState(r);if(!(r&&r.currentPageId===t.currentPageId))return null;switch(n){case"inactive":{let{followingUserId:e,highlightedUserIds:n}=t.instanceState;if(!(e===r.userId||n.includes(r.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.instanceState;if(r.followingUserId===t.user.id&&!(r.chatMessage||e.includes(r.userId)))return null}}return(0,I.jsx)(nA,{latestPresence:r})}),nA=track(function({latestPresence:e}){let t=useEditor(),{CollaboratorBrush:r,CollaboratorScribble:n,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:a}=useEditorComponents(),{viewportPageBounds:l,zoomLevel:d}=t,{userId:c,chatMessage:u,brush:p,scribble:h,selectedShapeIds:f,userName:g,cursor:m,color:y}=e,b=!(m.x<l.minX-12/d||m.y<l.minY-16/d||m.x>l.maxX-12/d||m.y>l.maxY-16/d);return(0,I.jsxs)(I.Fragment,{children:[p&&r?(0,I.jsx)(r,{className:"tl-collaborator__brush",brush:p,color:y,opacity:.1},c+"_brush"):null,b&&i?(0,I.jsx)(i,{className:"tl-collaborator__cursor",point:m,color:y,zoom:d,name:"New User"!==g?g:null,chatMessage:u},c+"_cursor"):o?(0,I.jsx)(o,{className:"tl-collaborator__cursor-hint",point:m,color:y,zoom:d,viewport:l},c+"_cursor_hint"):null,h&&n?(0,I.jsx)(n,{className:"tl-collaborator__scribble",scribble:h,color:y,zoom:d,opacity:"laser"===h.color?.5:.1},c+"_scribble"):null,a&&f.map(e=>(0,I.jsx)(a,{className:"tl-collaborator__shape-indicator",id:e,color:y,opacity:.5},c+"_"+e))]})});function getStateFromElapsedTime(e){return e>6e4?"inactive":e>3e3?"idle":"active"}function useCollaboratorState(e){let t=(0,T.useRef)(e?.lastActivityTimestamp??-1),[r,n]=(0,T.useState)(()=>getStateFromElapsedTime(Date.now()-t.current));return(0,T.useEffect)(()=>{let e=setInterval(()=>{n(getStateFromElapsedTime(Date.now()-t.current))},1200);return()=>clearInterval(e)},[]),e&&(t.current=e.lastActivityTimestamp),r}function gcd(e,t){return 0===t?e:gcd(t,e%t)}function nearestMultiple(e){let t=e.toString().split(".")[1];if(!t)return 1;let r=Math.pow(10,t.length),n=parseInt(t,10);return r/gcd(n,r)}function useDPRMultiple(){let e=useEditor(),t=useContainer();T.useEffect(()=>EffectScheduler_react("useDPRMultiple",()=>{let r=e.instanceState.devicePixelRatio;t.style.setProperty("--tl-dpr-multiple",nearestMultiple(r).toString())}),[e,t])}let n$=track(function({id:e,shape:t,util:r,index:n,backgroundIndex:i,opacity:o,isCulled:a}){let l=useEditor(),{ShapeErrorFallback:d}=useEditorComponents(),c=T.useRef(null),u=T.useRef(null),p=T.useCallback((e,t)=>{c.current?.style.setProperty(e,t),u.current?.style.setProperty(e,t)},[]);useQuickReactor("set shape container transform position",()=>{let t=l.getShape(e);if(!t)return;let r=l.getShapePageTransform(e),n=Matrix2d.toCssString(r);p("transform",n)},[l,p]),useQuickReactor("set shape container clip path",()=>{let t=l.getShape(e);if(!t)return null;let r=l.getShapeClipPath(e);p("clip-path",r??"none")},[l,p]),useQuickReactor("set shape height and width",()=>{let t=l.getShape(e);if(!t)return null;let r=l.getShapeGeometry(t).bounds,n=Math.floor(100*l.instanceState.devicePixelRatio)/100,i=nearestMultiple(n),o=r.w%i,a=0===o?r.w:r.w+(i-o),d=r.h%i,c=0===d?r.h:r.h+(i-d);p("width",Math.max(a,i)+"px"),p("height",Math.max(c,i)+"px")},[l]),T.useLayoutEffect(()=>{p("opacity",o+""),c.current?.style.setProperty("z-index",n+""),u.current?.style.setProperty("z-index",i+"")},[o,n,i,p]);let h=T.useCallback(e=>{l.annotateError(e,{origin:"react.shape",willCrashApp:!1})},[l]);return t?(0,I.jsxs)(I.Fragment,{children:[r.backgroundComponent&&(0,I.jsx)("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:!a&&(0,I.jsx)(OptionalErrorBoundary,{fallback:d,onError:h,children:(0,I.jsx)(nD,{shape:t,util:r})})}),(0,I.jsx)("div",{ref:c,className:"tl-shape","data-shape-type":t.type,draggable:!1,children:a?(0,I.jsx)(nV,{shape:t}):(0,I.jsx)(OptionalErrorBoundary,{fallback:d,onError:h,children:(0,I.jsx)(nM,{shape:t,util:r})})})]}):null}),nM=T.memo(function({shape:e,util:t}){return useStateTracking("InnerShape:"+e.type,()=>t.component(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),nD=T.memo(function({shape:e,util:t}){return useStateTracking("InnerShape:"+e.type,()=>t.backgroundComponent?.(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),nV=T.memo(function({shape:e}){let t=useEditor(),r=t.getShapeGeometry(e).bounds;return(0,I.jsx)("div",{className:"tl-shape__culled",style:{transform:`translate(${toDomPrecision(r.minX)}px, ${toDomPrecision(r.minY)}px)`,width:Math.max(1,toDomPrecision(r.width)),height:Math.max(1,toDomPrecision(r.height))}})},()=>!0);function Canvas({className:e}){let t=useEditor(),{Background:r,SvgDefs:n}=useEditorComponents(),i=T.useRef(null),o=T.useRef(null),a=T.useRef(null);useScreenBounds(),useDocumentEvents(),useCoarsePointer(),useGestureEvents(i),useFixSafariDoubleTapZoomPencilEvents(i),useQuickReactor("position layers",()=>{let e=o.current;if(!e)return;let r=a.current;if(!r)return;let{x:n,y:i,z:l}=t.camera,d=l>=1?modulate(l,[1,8],[.125,.5],!0):modulate(l,[.1,1],[-2,.125],!0),c=`scale(${toDomPrecision(l)}) translate(${toDomPrecision(n+d)}px,${toDomPrecision(i+d)}px)`;e.style.setProperty("transform",c),r.style.setProperty("transform",c)},[t]);let l=useCanvasEvents(),d=useValue("shapeSvgDefs",()=>{let e=new Map;for(let r of objectMapValues(t.shapeUtils)){if(!r)return;let t=r.getCanvasSvgDefs();for(let{key:r,component:n}of t)e.has(r)||e.set(r,(0,I.jsx)(n,{},r))}return[...e.values()]},[t]),c=useValue("debug_shapes",()=>rZ.hideShapes.value,[rZ]),u=useValue("debug_svg",()=>rZ.debugSvg.value,[rZ]),p=useValue("debug_geometry",()=>rZ.debugGeometry.value,[rZ]);return(0,I.jsxs)("div",{ref:i,draggable:!1,className:eb("tl-canvas",e),"data-testid":"canvas",...l,children:[r&&(0,I.jsx)(r,{}),(0,I.jsx)(GridWrapper,{}),(0,I.jsx)(UiLogger,{}),(0,I.jsx)("svg",{className:"tl-svg-context",children:(0,I.jsxs)("defs",{children:[d,Cursor&&(0,I.jsx)(Cursor,{}),(0,I.jsx)(CollaboratorHint,{}),(0,I.jsx)(ArrowheadDot,{}),(0,I.jsx)(ArrowheadCross,{}),n&&(0,I.jsx)(n,{})]})}),(0,I.jsxs)("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,I.jsx)(SelectionBackgroundWrapper,{}),c?null:u?(0,I.jsx)(ShapesWithSVGs,{}):(0,I.jsx)(ShapesToDisplay,{})]}),(0,I.jsx)("div",{className:"tl-fixed-layer tl-overlays",children:(0,I.jsxs)("div",{ref:a,className:"tl-html-layer",children:[p?(0,I.jsx)(nC,{}):null,(0,I.jsx)(HandlesWrapper,{}),(0,I.jsx)(BrushWrapper,{}),(0,I.jsx)(ScribbleWrapper,{}),(0,I.jsx)(ZoomBrushWrapper,{}),(0,I.jsx)(SelectedIdIndicators,{}),(0,I.jsx)(HoveredShapeIndicator,{}),(0,I.jsx)(nR,{}),(0,I.jsx)(SnapLinesWrapper,{}),(0,I.jsx)(SelectionForegroundWrapper,{}),(0,I.jsx)(nI,{})]})})]})}function GridWrapper(){let e=useEditor(),t=useValue("gridSize",()=>e.documentSettings.gridSize,[e]),{x:r,y:n,z:i}=useValue("camera",()=>e.camera,[e]),o=useValue("isGridMode",()=>e.instanceState.isGridMode,[e]),{Grid:a}=useEditorComponents();return a&&o?(0,I.jsx)(a,{x:r,y:n,z:i,size:t}):null}function ScribbleWrapper(){let e=useEditor(),t=useValue("scribble",()=>e.instanceState.scribble,[e]),r=useValue("zoomLevel",()=>e.zoomLevel,[e]),{Scribble:n}=useEditorComponents();return n&&t?(0,I.jsx)(n,{className:"tl-user-scribble",scribble:t,zoom:r}):null}function BrushWrapper(){let e=useEditor(),t=useValue("brush",()=>e.instanceState.brush,[e]),{Brush:r}=useEditorComponents();return r&&t?(0,I.jsx)(r,{className:"tl-user-brush",brush:t}):null}function ZoomBrushWrapper(){let e=useEditor(),t=useValue("zoomBrush",()=>e.instanceState.zoomBrush,[e]),{ZoomBrush:r}=useEditorComponents();return r&&t?(0,I.jsx)(r,{className:"tl-user-brush",brush:t}):null}function SnapLinesWrapper(){let e=useEditor(),t=useValue("snapLines",()=>e.snaps.lines,[e]),r=useValue("zoomLevel",()=>e.zoomLevel,[e]),{SnapLine:n}=useEditorComponents();return n&&t.length>0?(0,I.jsx)(I.Fragment,{children:t.map(e=>(0,I.jsx)(n,{className:"tl-user-snapline",line:e,zoom:r},e.id))}):null}function HandlesWrapper(){let e=useEditor(),{Handles:t}=useEditorComponents(),r=useValue("zoomLevel",()=>e.zoomLevel,[e]),n=useValue("coarse pointer",()=>e.instanceState.isCoarsePointer,[e]),i=useValue("onlySelectedShape",()=>e.onlySelectedShape,[e]),o=useValue("isChangingStyle",()=>e.instanceState.isChangingStyle,[e]),a=useValue("isChangingStyle",()=>e.instanceState.isReadonly,[e]),l=useValue("handles",()=>e.onlySelectedShape?e.getShapeHandles(e.onlySelectedShape):void 0,[e]),d=useValue("transform",()=>e.onlySelectedShape?e.getShapePageTransform(e.onlySelectedShape):void 0,[e]);if(!t||!i||o||a||!l||!d)return null;let c=[];for(let e=0,t=l[e];e<l.length;t=l[++e]){if("vertex"!==t.type){let t=l[e-1],n=l[e+1];if(t&&n&&Math.hypot(t.y-n.y,t.x-n.x)<48/r)continue}c.push(t)}return c.sort(e=>"vertex"===e.type?1:-1),(0,I.jsx)(t,{children:(0,I.jsx)("g",{transform:Matrix2d.toCssString(d),children:c.map(e=>(0,I.jsx)(HandleWrapper,{shapeId:i.id,handle:e,zoom:r,isCoarse:n},e.id))})})}function HandleWrapper({shapeId:e,handle:t,zoom:r,isCoarse:n}){let i=useHandleEvents(e,t.id),{Handle:o}=useEditorComponents();return o?(0,I.jsx)("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:(0,I.jsx)(o,{shapeId:e,handle:t,zoom:r,isCoarse:n})}):null}function ShapesWithSVGs(){let e=useEditor(),t=useValue("rendering shapes",()=>e.renderingShapes,[e]);return(0,I.jsx)(I.Fragment,{children:t.map(e=>(0,I.jsxs)(T.Fragment,{children:[(0,I.jsx)(n$,{...e}),(0,I.jsx)(nj,{id:e.id})]},e.id+"_fragment"))})}function ShapesToDisplay(){let e=useEditor(),t=useValue("rendering shapes",()=>e.renderingShapes,[e]);return(0,I.jsx)(I.Fragment,{children:t.map(e=>(0,I.jsx)(n$,{...e},e.id+"_shape"))})}function SelectedIdIndicators(){let e=useEditor(),t=useValue("selectedShapeIds",()=>e.currentPageState.selectedShapeIds,[e]),r=useValue("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.instanceState.isChangingStyle,[e]);return r?(0,I.jsx)(I.Fragment,{children:t.map(e=>(0,I.jsx)(r2,{className:"tl-user-indicator__selected",id:e},e+"_indicator"))}):null}let HoveredShapeIndicator=function(){let e=useEditor(),{HoveredShapeIndicator:t}=useEditorComponents(),r=useValue("coarse pointer",()=>e.instanceState.isCoarsePointer,[e]),n=useValue("hovering canvas",()=>e.instanceState.isHoveringCanvas,[e]),i=useValue("hovered id",()=>e.currentPageState.hoveredShapeId,[e]);return!r&&n&&i&&t?(0,I.jsx)(t,{shapeId:i}):null},nR=track(function(){let e=useEditor(),t=dedupe(e.hintingShapeIds);return t.length?(0,I.jsx)(I.Fragment,{children:t.map(e=>(0,I.jsx)(r2,{className:"tl-user-indicator__hint",id:e},e+"_hinting"))}):null});function Cursor(){return(0,I.jsxs)("g",{id:"cursor",children:[(0,I.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,I.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,I.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,I.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,I.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,I.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,I.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,I.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,I.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function CollaboratorHint(){return(0,I.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function ArrowheadDot(){return(0,I.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,I.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function ArrowheadCross(){return(0,I.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,I.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,I.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let nj=track(function({id:e}){let t=useEditor(),r=t.getShape(e),[n,i]=T.useState(""),o=r?.parentId===t.currentPageId;return(T.useEffect(()=>{if(!o)return;let r=null,n=EffectScheduler_react("shape to svg",async()=>{let n=Math.random();r=n;let o=t.getShapePageBounds(e),a=await t.getSvg([e],{padding:0});a&&o&&r===n&&(a.style.setProperty("overflow","visible"),a.setAttribute("preserveAspectRatio","xMidYMin slice"),a.style.setProperty("transform",`translate(${o.x}px, ${o.y+o.h+12}px)`),a.style.setProperty("border","1px solid black"),i(a?.outerHTML))});return()=>{r=null,n()}},[t,e,o]),o)?(0,I.jsx)("div",{style:{paddingTop:12,position:"absolute"},children:(0,I.jsx)("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:n}})}):null});function UiLogger(){let e=useValue("debugging ui log",()=>rZ.logMessages.value,[rZ]);return e.length?(0,I.jsx)("div",{className:"debug__ui-logger",children:e.map((e,t)=>{let r="string"==typeof e?e:JSON.stringify(e);return(0,I.jsx)("div",{className:"debug__ui-logger__line",children:r},t)})}):null}function SelectionForegroundWrapper(){let e=useEditor(),t=useValue("selection rotation",()=>e.selectionRotation,[e]),r=useValue("selection bounds",()=>e.selectionRotatedPageBounds,[e]),{SelectionForeground:n}=useEditorComponents();return r&&n?(0,I.jsx)(n,{bounds:r,rotation:t}):null}function SelectionBackgroundWrapper(){let e=useEditor(),t=useValue("selection rotation",()=>e.selectionRotation,[e]),r=useValue("selection bounds",()=>e.selectionRotatedPageBounds,[e]),{SelectionBackground:n}=useEditorComponents();return r&&n?(0,I.jsx)(n,{bounds:r,rotation:t}):null}let node_modules_nanoid_fillPool=e=>{!c||c.length<e?(c=Buffer.allocUnsafe(128*e),(0,eF.randomFillSync)(c),u=0):u+e>c.length&&((0,eF.randomFillSync)(c),u=0),u+=e},node_modules_nanoid_nanoid=(e=21)=>{node_modules_nanoid_fillPool(e-=0);let t="";for(let r=u-e;r<u;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&c[r]];return t};function uniqueId(){return node_modules_nanoid_nanoid()}let nO="TLDRAW_USER_DATA_v3",nL=object({id:eH,name:eH.nullable().optional(),locale:eH.nullable().optional(),color:eH.nullable().optional(),isDarkMode:eQ.nullable().optional(),animationSpeed:eG.nullable().optional(),isSnapMode:eQ.nullable().optional()}),nF={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3},nN=defineMigrations({currentVersion:nF.MakeFieldsNullable,migrators:{[nF.AddAnimationSpeed]:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},[nF.AddIsSnapMode]:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},[nF.MakeFieldsNullable]:{up:e=>e,down:e=>({id:e.id,name:e.name??nB.name,locale:e.locale??nB.locale,color:e.color??nB.color,isDarkMode:e.isDarkMode??nB.isDarkMode,animationSpeed:e.animationSpeed??nB.animationSpeed,isSnapMode:e.isSnapMode??nB.isSnapMode})}}}),nz=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function getRandomColor(){return nz[Math.floor(Math.random()*nz.length)]}function userPrefersDarkUI(){return"undefined"!=typeof window&&(window.matchMedia?.("(prefers-color-scheme: dark)")?.matches??!1)}function userPrefersReducedMotion(){return"undefined"!=typeof window&&(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1)}let nB=Object.freeze({name:"New User",locale:getDefaultTranslationLocale(),color:getRandomColor(),isDarkMode:!1,animationSpeed:userPrefersReducedMotion()?0:1,isSnapMode:!1});function getFreshUserPreferences(){return{id:uniqueId()}}function migrateUserPreferences(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return getFreshUserPreferences();let t=migrate({value:e.user,fromVersion:e.version,toVersion:nN.currentVersion??0,migrations:nN});if("error"===t.type)return getFreshUserPreferences();try{nL.validate(t.value)}catch(e){return getFreshUserPreferences()}return t.value}function loadUserPreferences(){let e="undefined"==typeof window?null:JSON.parse(window?.localStorage?.getItem(nO)||"null")??null;return migrateUserPreferences(e)}let nU=Atom_atom("globalUserData",loadUserPreferences());function storeUserPreferences(){"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(nO,JSON.stringify({version:nN.currentVersion,user:nU.value}))}function setUserPreferences(e){nL.validate(e),nU.set(e),storeUserPreferences(),broadcastUserPreferencesChange()}let nH="undefined"!=typeof process&&!1,nG="undefined"==typeof BroadcastChannel||nH?null:new BroadcastChannel("tldraw-user-sync");nG?.addEventListener("message",e=>{let t=e.data;t?.type===nK&&t?.origin!==nW&&nU.set(migrateUserPreferences(t.data))});let nW=uniqueId(),nK="tldraw-user-preferences-change";function broadcastUserPreferencesChange(){nG?.postMessage({type:nK,origin:nW,data:{user:nU.value,version:nN.currentVersion}})}function getUserPreferences(){return nU.value}function createTLUser(e={}){return{derivePresenceState:e.derivePresenceState??(()=>computed("presence",()=>null)),userPreferences:e.userPreferences??computed("userPreferences",()=>getUserPreferences()),setUserPreferences:e.setUserPreferences??setUserPreferences}}var nq=r(8419);function SVGContainer({children:e,className:t="",...r}){return(0,I.jsx)("svg",{...r,className:`tl-svg-container ${t}`,children:e})}let Geometry2d=class Geometry2d{isFilled=!1;isClosed=!0;isLabel=!1;isSnappable=!0;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1}hitTestPoint(e,t=0,r=!1){return this.distanceToPoint(e,r)<=t}distanceToPoint(e,t=!1){let r=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&pointInPolygon(e,this.vertices)?-r:r}distanceToLineSegment(e,t){let r=this.nearestPointOnLineSegment(e,t),n=Vec2d_Vec2d.DistanceToLineSegment(e,t,r);return this.isClosed&&this.isFilled&&pointInPolygon(r,this.vertices)?-n:n}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){let r,n=1/0;for(let i=0;i<this.vertices.length;i++){let o=this.vertices[i],a=Vec2d_Vec2d.DistanceToLineSegment(e,t,o);a<n&&(n=a,r=o)}if(!r)throw Error("nearest point not found");return r}isPointInBounds(e,t=0){let{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return Box2d_Box2d.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}_snapPoints;get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let r=0,n=e.length;r<n;r++){let i=e[r],o=e[(r+1)%n];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,r=t.length;if(0===r)return e;e+=`M${t[0].x},${t[0].y}`;for(let n=1;n<r;n++)e+=`L${t[n].x},${t[n].y}`;return this.isClosed&&(e+="Z"),e}};let Group2d=class Group2d extends Geometry2d{children;constructor(e){super({...e,isClosed:!0,isFilled:!1});let{children:t}=e;if(0===t.length)throw Error("Group2d must have at least one child");this.children=t}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let t,r=1/0,{children:n}=this;if(0===n.length)throw Error("no children");for(let i of n){let n=i.nearestPoint(e),o=n.dist(e);o<r&&(r=o,t=n)}if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map((r,n)=>r.distanceToPoint(e,t||n>0)))}hitTestPoint(e,t,r){return!!this.children.filter(e=>!e.isLabel).find(n=>n.hitTestPoint(e,t,r))}hitTestLineSegment(e,t,r){return!!this.children.filter(e=>!e.isLabel).find(n=>n.hitTestLineSegment(e,t,r))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=Box2d_Box2d.FromPoints(this.vertices).corners;for(let r=0,n=t.length;r<n;r++){let i=t[r],o=t[(r-1+n)%n],a=i.dist(o),l=t[(r+1)%n],d=i.dist(l),c=i.clone().lrp(o,4/a),u=i.clone().lrp(l,4/d);e+=`M${c.x},${c.y} L${i.x},${i.y} L${u.x},${u.y} `}return e}};function intersectLineSegmentLineSegment(e,t,r,n){let i=e.x-r.x,o=e.y-r.y,a=n.x-r.x,l=n.y-r.y,d=t.x-e.x,c=t.y-e.y,u=a*o-l*i,p=d*o-c*i,h=l*d-a*c;if(0===u||0===p||0===h)return null;if(0!==h){let t=u/h,r=p/h;if(0<=t&&t<=1&&0<=r&&r<=1)return Vec2d_Vec2d.AddXY(e,t*d,t*c)}return null}function intersectLineSegmentCircle(e,t,r,n){let i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=2*((t.x-e.x)*(e.x-r.x)+(t.y-e.y)*(e.y-r.y)),a=r.x*r.x+r.y*r.y+e.x*e.x+e.y*e.y-2*(r.x*e.x+r.y*e.y)-n*n,l=o*o-4*i*a;if(l<0||0===l)return null;let d=Math.sqrt(l),c=(-o+d)/(2*i),u=(-o-d)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;let p=[];return(0<=c&&c<=1&&p.push(Vec2d_Vec2d.Lrp(e,t,c)),0<=u&&u<=1&&p.push(Vec2d_Vec2d.Lrp(e,t,u)),0===p.length)?null:p}function intersectLineSegmentPolyline(e,t,r){let n;let i=[];for(let o=0,a=r.length-1;o<a;o++)(n=intersectLineSegmentLineSegment(e,t,r[o],r[o+1]))&&i.push(n);return 0===i.length?null:i}function intersectLineSegmentPolygon(e,t,r){let n;let i=[];for(let o=1,a=r.length;o<a+1;o++)(n=intersectLineSegmentLineSegment(e,t,r[o-1],r[o%r.length]))&&i.push(n);return 0===i.length?null:i}function intersectCircleCircle(e,t,r,n){let i=r.x-e.x,o=r.y-e.y,a=Math.sqrt(i*i+o*o),l=(a*a-n*n+t*t)/(2*a),d=Math.sqrt(t*t-l*l);return i/=a,o/=a,[new Vec2d_Vec2d(e.x+i*l-o*d,e.y+o*l+i*d),new Vec2d_Vec2d(e.x+i*l+o*d,e.y+o*l-i*d)]}function intersectCirclePolygon(e,t,r){let n;let i=[];for(let o=0,a=r.length;o<a;o++)(n=intersectLineSegmentCircle(r[o],r[(o+1)%r.length],e,t))&&i.push(...n);return 0===i.length?null:i}function intersectCirclePolyline(e,t,r){let n;let i=[];for(let o=1,a=r.length;o<a;o++)(n=intersectLineSegmentCircle(r[o-1],r[o],e,t))&&i.push(...n);return 0===i.length?null:i}function ccw(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function linesIntersect(e,t,r,n){return ccw(e,r,n)!==ccw(t,r,n)&&ccw(e,t,r)!==ccw(e,t,n)}function intersectPolygonPolygon(e,t){let r,n,i,o;let a=[];for(let n=0,i=e.length;n<i;n++)pointInPolygon(r=e[n],t)&&a.push(r);for(let n=0,i=t.length;n<i;n++)pointInPolygon(r=t[n],e)&&a.push(r);for(let l=0,d=e.length;l<d;l++){r=e[l],n=e[(l+1)%e.length];for(let e=0,l=t.length;e<l;e++){i=t[e],o=t[(e+1)%t.length];let l=intersectLineSegmentLineSegment(r,n,i,o);null!==l&&a.push(l)}}return 0===a.length?null:orderClockwise(a)}function orderClockwise(e){let t=Vec2d_Vec2d.Average(e);return e.sort((e,r)=>Vec2d_Vec2d.Angle(t,e)-Vec2d_Vec2d.Angle(t,r))}function polygonsIntersect(e,t){let r,n;for(let i=0,o=e.length;i<o;i++){r=e[i],n=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(linesIntersect(r,n,t[e],t[(e+1)%i]))return!0}return!1}let Edge2d=class Edge2d extends Geometry2d{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:r}=e;this.start=t,this.end=r,this.d=t.clone().sub(r),this.u=this.d.clone().uni(),this.ul=this.u.len()}_length;get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){let{start:t,end:r,u:n,ul:i}=this;if(0===i)return t;let o=Vec2d_Vec2d.Sub(e,t).dpr(n)/i,a=t.x+n.x*o;if(a<Math.min(t.x,r.x))return t.x<r.x?t:r;if(a>Math.max(t.x,r.x))return t.x>r.x?t:r;let l=t.y+n.y*o;return l<Math.min(t.y,r.y)?t.y<r.y?t:r:l>Math.max(t.y,r.y)?t.y>r.y?t:r:new Vec2d_Vec2d(a,l)}hitTestLineSegment(e,t,r){return linesIntersect(e,t,this.start,this.end)}};let Polyline2d=class Polyline2d extends Geometry2d{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,r=e.length-1;t<r;t++){let r=e[t],n=e[t+1];this._segments.push(new Edge2d({start:r,end:n}))}this.isClosed&&this._segments.push(new Edge2d({start:e[e.length-1],end:e[0]}))}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){return this.points}nearestPoint(e){let t,r;let{segments:n}=this,i=this.points[0],o=1/0;for(let a=0;a<n.length;a++)(r=(t=n[a].nearestPoint(e)).dist(e))<o&&(i=t,o=r);return i}hitTestLineSegment(e,t,r){return this.segments.some(n=>n.hitTestLineSegment(e,t,r))}};let Polygon2d=class Polygon2d extends Polyline2d{constructor(e){super({...e}),this.isClosed=!0}};let Rectangle2d=class Rectangle2d extends Polygon2d{x;y;w;h;constructor(e){let{x:t=0,y:r=0,width:n,height:i}=e;super({...e,points:[new Vec2d_Vec2d(t,r),new Vec2d_Vec2d(t+n,r),new Vec2d_Vec2d(t+n,r+i),new Vec2d_Vec2d(t,r+i)]}),this.x=t,this.y=r,this.w=n,this.h=i}getBounds(){return new Box2d_Box2d(this.x,this.y,this.w,this.h)}};let ShapeUtil=class ShapeUtil{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canUnmount=()=>!0;canBind=(e,t)=>!0;canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onRotateStart;onRotate;onRotateEnd;onHandleChange;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd};function getPerfectDashProps(e,t,r={}){let{closed:n=!1,snap:i=1,start:o="outset",end:a="outset",lengthRatio:l=2,style:d="dashed"}=r,c=0,u=0,p=1,h=0,f=0;switch(d){case"dashed":p=1,c=Math.min(t*l,e/4);break;case"dotted":c=t/(p=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return n||("outset"===o?(e+=c/2,f+=c/2):"skip"===o&&(e-=c,f-=c),"outset"===a?e+=c/2:"skip"!==a||(e-=c)),u=Math.floor(e/c/(2*p)),(u-=u%i)<3&&"dashed"===d?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(c=e/(u=Math.max(u,3))/(2*p),n?(f=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:f.toString()}}function DashedOutlineBox({bounds:e,className:t}){let r=useEditor(),n=useValue("zoom level",()=>r.zoomLevel,[r]);return(0,I.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:r,strokeDashoffset:i}=getPerfectDashProps(e[0].dist(e[1]),1/n,{style:"dashed",lengthRatio:4});return(0,I.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:r,strokeDashoffset:i},t)})})}let GroupShapeUtil=class GroupShapeUtil extends ShapeUtil{static type="group";static props=rE;static migrations=rC;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new Rectangle2d({width:1,height:1,isFilled:!1}):new Group2d({children:t.map(e=>{let t=this.editor.getShape(e),r=this.editor.getShapeGeometry(e),n=this.editor.getShapeLocalTransform(t).applyToPoints(r.vertices);return r.isClosed?new Polygon2d({points:n,isFilled:!0}):new Polyline2d({points:n})})})}component(e){let t=this.editor.erasingShapeIds.includes(e.id),{hintingShapeIds:r}=this.editor.currentPageState,n=r.length>0&&r.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),i=this.editor.currentPageState.focusedGroupId!==e.id;if(!t&&(i||n))return null;let o=this.editor.getShapeGeometry(e).bounds;return(0,I.jsx)(SVGContainer,{id:e.id,children:(0,I.jsx)(DashedOutlineBox,{className:"tl-group",bounds:o})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,I.jsx)(DashedOutlineBox,{className:"",bounds:t})}onChildrenChange=e=>{let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.currentPageState.focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.currentPageState.focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}};let nY=[GroupShapeUtil],nX=new Set(nY.map(e=>e.type));function checkShapesAndAddCore(e){let t=[...nY],r=new Set;for(let n of e){if(nX.has(n.type))throw Error(`Shape type "${n.type}" is a core shapes type and cannot be overridden`);if(r.has(n.type))throw Error(`Shape type "${n.type}" is defined more than once`);t.push(n),r.add(n.type)}return t}function sharedStyleEquals(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw exhaustiveSwitchError(e)}}let ReadonlySharedStyleMap=class ReadonlySharedStyleMap{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[r,n]of this){if(!sharedStyleEquals(n,e.get(r)))return!1;t.add(r)}for(let[r,n]of e)if(!t.has(r)&&!sharedStyleEquals(n,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}};let SharedStyleMap=class SharedStyleMap extends ReadonlySharedStyleMap{set(e,t){this.map.set(e,t)}applyValue(e,t){let r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:exhaustiveSwitchError(r,"type")}}};let WeakMapCache=class WeakMapCache{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}};function dataUrlToFile(e,t,r){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:r})})}function getIncrementedName(e,t){let r=e,n=new Set(t);for(;n.has(r);)r=/^.*(\d+)$/.exec(r)?.[1]?r.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${r} 1`;return r}let nZ="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",nQ="A00000000000000000000000000";function getIntegerLength(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw Error("Invalid index key head: "+e)}function validateInteger(e){if(e.length!==getIntegerLength(e.charAt(0)))throw Error("invalid integer part of index key: "+e)}function isNotUndefined(e){if(void 0===e)throw Error("n is undefined")}function incrementInteger(e){validateInteger(e);let[t,...r]=e.split(""),n=!0;for(let e=r.length-1;n&&e>=0;e--){let t=nZ.indexOf(r[e])+1;t===nZ.length?r[e]="0":(r[e]=nZ.charAt(t),n=!1)}if(!n)return t+r.join("");{if("Z"===t)return"a0";if("z"===t)return;let e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?r.push("0"):r.pop(),e+r.join("")}}function decrementInteger(e){validateInteger(e);let[t,...r]=e.split(""),n=!0;for(let e=r.length-1;n&&e>=0;e--){let t=nZ.indexOf(r[e])-1;-1===t?r[e]=nZ.slice(-1):(r[e]=nZ.charAt(t),n=!1)}if(!n)return t+r.join("");{if("a"===t)return"Z"+nZ.slice(-1);if("A"===t)return;let e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?r.push(nZ.slice(-1)):r.pop(),e+r.join("")}}function midpoint(e,t){if(void 0!==t&&e>=t)throw Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw Error("trailing zero");if(t){let r=0;for(;(e.charAt(r)||"0")===t.charAt(r);)r++;if(r>0)return t.slice(0,r)+midpoint(e.slice(r),t.slice(r))}let r=e?nZ.indexOf(e.charAt(0)):0,n=void 0!==t?nZ.indexOf(t.charAt(0)):nZ.length;if(n-r>1){let e=Math.round(.5*(r+n));return nZ.charAt(e)}return t&&t.length>1?t.slice(0,1):nZ.charAt(r)+midpoint(e.slice(1),void 0)}function getIntegerPart(e){let t=getIntegerLength(e.charAt(0));if(t>e.length)throw Error("invalid index: "+e);return e.slice(0,t)}function validateOrder(e){if(e===nQ)throw Error("invalid index: "+e);let t=getIntegerPart(e),r=e.slice(t.length);if("0"===r.slice(-1))throw Error("invalid index: "+e)}function generateKeyBetween(e,t){if(void 0!==e&&validateOrder(e),void 0!==t&&validateOrder(t),void 0!==e&&void 0!==t&&e>=t)throw Error(e+" >= "+t);if(void 0===e&&void 0===t)return"a0";if(void 0===e){if(void 0===t)throw Error("b is undefined");let e=getIntegerPart(t),r=t.slice(e.length);if(e===nQ)return e+midpoint("",r);if(e<t)return e;let n=decrementInteger(e);return isNotUndefined(n),n}if(void 0===t){let t=getIntegerPart(e),r=e.slice(t.length),n=incrementInteger(t);return void 0===n?t+midpoint(r,void 0):n}let r=getIntegerPart(e),n=e.slice(r.length),i=getIntegerPart(t),o=t.slice(i.length);if(r===i)return r+midpoint(n,o);let a=incrementInteger(r);return isNotUndefined(a),a<t?a:r+midpoint(n,void 0)}function generateNKeysBetween(e,t,r){if(0===r)return[];if(1===r)return[generateKeyBetween(e,t)];if(void 0===t){let n=generateKeyBetween(e,t),i=[n];for(let e=0;e<r-1;e++)i.push(n=generateKeyBetween(n,t));return i}if(void 0===e){let n=generateKeyBetween(e,t),i=[n];for(let t=0;t<r-1;t++)i.push(n=generateKeyBetween(e,n));return i.reverse(),i}let n=Math.floor(r/2),i=generateKeyBetween(e,t);return[...generateNKeysBetween(e,i,n),i,...generateNKeysBetween(i,t,r-n-1)]}function getIndicesBetween(e,t,r){return generateNKeysBetween(e,t,r)}function getIndicesAbove(e,t){return generateNKeysBetween(e,void 0,t)}function getIndicesBelow(e,t){return generateNKeysBetween(void 0,e,t)}function getIndexBetween(e,t){return generateNKeysBetween(e,t,1)[0]}function getIndexAbove(e){return generateNKeysBetween(e,void 0,1)[0]}function getIndexBelow(e){return generateNKeysBetween(void 0,e,1)[0]}function getIndices(e,t="a1"){return[t,...generateNKeysBetween(t,void 0,e)]}function reordering_sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function getReorderingShapesChanges(e,t,r){if(0===r.length)return[];let n=new Map;for(let t of compact(r.map(t=>e.getShape(t)))){let{parentId:r}=t;n.has(r)||n.set(r,{children:compact(e.getSortedChildIdsForParent(r).map(t=>e.getShape(t))),moving:new Set}),n.get(r).moving.add(t)}let i=[];switch(t){case"toBack":n.forEach(({moving:e,children:t})=>reorderToBack(e,t,i));break;case"toFront":n.forEach(({moving:e,children:t})=>reorderToFront(e,t,i));break;case"forward":n.forEach(({moving:e,children:t})=>reorderForward(e,t,i));break;case"backward":n.forEach(({moving:e,children:t})=>reorderBackward(e,t,i))}return i}function reorderToBack(e,t,r){let n,i;let o=t.length;if(e.size!==o){for(let r=0;r<o;r++){let o=t[r];if(e.has(o))n=o.index,e.delete(o);else{i=o.index;break}}if(0===e.size)return;{let t=generateNKeysBetween(n,i,e.size);r.push(...Array.from(e.values()).sort(reordering_sortByIndex).map((e,r)=>({...e,index:t[r]})))}}}function reorderToFront(e,t,r){let n,i;let o=t.length;if(e.size!==o){for(let r=o-1;r>-1;r--){let o=t[r];if(e.has(o))i=o.index,e.delete(o);else{n=o.index;break}}if(0===e.size)return;{let t=generateNKeysBetween(n,i,e.size);r.push(...Array.from(e.values()).sort(reordering_sortByIndex).map((e,r)=>({...e,index:t[r]})))}}}function reorderForward(e,t,r){let n=t.length;if(e.size===n)return;let i={name:"skipping"};for(let o=0;o<n;o++){let n=e.has(t[o]);switch(i.name){case"skipping":if(!n)continue;i={name:"selecting",selectIndex:o};break;case"selecting":{if(n)continue;let{selectIndex:e}=i;generateNKeysBetween(t[o].index,t[o+1]?.index,o-e).forEach((n,i)=>r.push({...t[e+i],index:n})),i={name:"skipping"}}}}}function reorderBackward(e,t,r){let n=t.length;if(e.size===n)return;let i={name:"skipping"};for(let o=n-1;o>-1;o--){let n=e.has(t[o]);switch(i.name){case"skipping":if(!n)continue;i={name:"selecting",selectIndex:o};break;case"selecting":if(n)continue;generateNKeysBetween(t[o-1]?.index,t[o].index,i.selectIndex-o).forEach((e,n)=>{r.push({...t[o+n+1],index:e})}),i={name:"skipping"}}}}function getRotationSnapshot({editor:e}){let{selectionRotation:t,selectionRotatedPageBounds:r,inputs:{originPagePoint:n},selectedShapes:i}=e;if(!r)return null;let o=r.center.clone().rotWith(r.point,t);return{selectionPageCenter:o,initialCursorAngle:o.angle(n),initialSelectionRotation:t,shapeSnapshots:i.map(t=>({shape:eL(t),initialPagePoint:e.getShapePageTransform(t.id).point()}))}}function applyRotationToSnapshotShapes({delta:e,editor:t,snapshot:r,stage:n}){let{selectionPageCenter:i,shapeSnapshots:o}=r;t.updateShapes(o.map(({shape:r,initialPagePoint:n})=>{let o=isShapeId(r.parentId)?t.getShapePageTransform(r.parentId):Matrix2d.Identity(),a=Vec2d_Vec2d.RotWith(n,i,e),l=Matrix2d.applyToPoint(Matrix2d.Inverse(o),a),d=canonicalizeRotation(r.rotation+e);return{id:r.id,type:r.type,x:l.x,y:l.y,rotation:d}}));let a=[];o.forEach(({shape:e})=>{let r=t.getShape(e.id);if(!r)return;let i=t.getShapeUtil(e);if("start"===n||"one-off"===n){let t=i.onRotateStart?.(e);t&&a.push(t)}let o=i.onRotate?.(e,r);if(o&&a.push(o),"end"===n||"one-off"===n){let t=i.onRotateEnd?.(e,r);t&&a.push(t)}}),a.length>0&&t.updateShapes(a)}let arrowBindingsIndex=e=>{let{store:t}=e,r=t.query.filterHistory("shape"),n=t.query.records("shape",()=>({type:{eq:"arrow"}}));function fromScratch(){let e=n.value,t={};for(let r of e){let{start:e,end:n}=r.props;if("binding"===e.type){let n=t[e.boundShapeId];n?n.push({arrowId:r.id,handleId:"start"}):t[e.boundShapeId]=[{arrowId:r.id,handleId:"start"}]}if("binding"===n.type){let e=t[n.boundShapeId];e?e.push({arrowId:r.id,handleId:"end"}):t[n.boundShapeId]=[{arrowId:r.id,handleId:"end"}]}}return t}return computed("arrowBindingsIndex",(t,n)=>{let i;if(isUninitialized(t))return fromScratch();let o=r.getDiffSince(n);if(o===e_)return fromScratch();function ensureNewArray(e){i||(i={...t}),i[e]?i[e]===t[e]&&(i[e]=[...i[e]]):i[e]=[]}function removingBinding(e,t,r){ensureNewArray(e),i[e]=i[e].filter(e=>e.arrowId!==t||e.handleId!==r),0===i[e].length&&delete i[e]}function addBinding(e,t,r){ensureNewArray(e),i[e].push({arrowId:t,handleId:r})}for(let t of o){for(let r of Object.values(t.added))if(e.isShapeOfType(r,"arrow")){let{start:e,end:t}=r.props;"binding"===e.type&&addBinding(e.boundShapeId,r.id,"start"),"binding"===t.type&&addBinding(t.boundShapeId,r.id,"end")}for(let[r,n]of Object.values(t.updated))if(e.isShapeOfType(r,"arrow")&&e.isShapeOfType(n,"arrow"))for(let e of["start","end"]){let t=r.props[e],i=n.props[e];"binding"===t.type&&"point"===i.type?removingBinding(t.boundShapeId,r.id,e):"point"===t.type&&"binding"===i.type?addBinding(i.boundShapeId,n.id,e):"binding"===t.type&&"binding"===i.type&&t.boundShapeId!==i.boundShapeId&&(removingBinding(t.boundShapeId,r.id,e),addBinding(i.boundShapeId,n.id,e))}for(let r of Object.values(t.removed))if(e.isShapeOfType(r,"arrow")){let{start:e,end:t}=r.props;"binding"===e.type&&removingBinding(e.boundShapeId,r.id,"start"),"binding"===t.type&&removingBinding(t.boundShapeId,r.id,"end")}}return i??t})},parentsToChildren=e=>{let t=e.query.ids("shape");function fromScratch(){let r={},n=t.value,i=Array(n.size);return n.forEach(t=>i.push(e.get(t))),i.sort(reordering_sortByIndex),i.forEach(e=>{r[e.parentId]||(r[e.parentId]=[]),r[e.parentId].push(e.id)}),r}return computed("parentsToChildrenWithIndexes",(t,r)=>{let n;if(isUninitialized(t))return fromScratch();let i=e.history.getDiffSince(r);if(i===e_)return fromScratch();if(0===i.length)return t;let o=null,ensureNewArray=e=>{o||(o={...t}),o[e]?o[e]===t[e]&&(o[e]=[...o[e]]):o[e]=[]},a=new Set;for(let e=0,t=i.length;e<t;e++){for(let t of Object.values((n=i[e]).added))isShape(t)&&(ensureNewArray(t.parentId),o[t.parentId].push(t.id),a.add(o[t.parentId]));for(let[e,t]of Object.values(n.updated))if(isShape(t)&&isShape(e)){if(e.parentId!==t.parentId)ensureNewArray(e.parentId),ensureNewArray(t.parentId),o[e.parentId].splice(o[e.parentId].indexOf(t.id),1),o[t.parentId].push(t.id),a.add(o[t.parentId]);else if(e.index!==t.index){ensureNewArray(t.parentId);let e=o[t.parentId].indexOf(t.id);o[t.parentId][e]=t.id,a.add(o[t.parentId])}}for(let e of Object.values(n.removed))isShape(e)&&(ensureNewArray(e.parentId),o[e.parentId].splice(o[e.parentId].indexOf(e.id),1))}for(let t of a){let r=compact(t.map(t=>e.get(t)));r.sort(reordering_sortByIndex),t.splice(0,t.length,...r.map(e=>e.id))}return o??t})},isShapeInPage=(e,t,r)=>{for(;!isPageId(r.parentId);){let t=e.get(r.parentId);if(!t)return!1;r=t}return r.parentId===t},deriveShapeIdsInCurrentPage=(e,t)=>{let r=e.query.ids("shape"),n=null;function fromScratch(){let i=t();return n=i,new Set([...r.value].filter(t=>isShapeInPage(e,i,e.get(t))))}return computed("_shapeIdsInCurrentPage",(r,i)=>{if(isUninitialized(r))return fromScratch();let o=t();if(o!==n)return fromScratch();let a=e.history.getDiffSince(i);if(a===e_)return fromScratch();let l=new IncrementalSetConstructor(r);for(let t of a){for(let r of Object.values(t.added))isShape(r)&&isShapeInPage(e,o,r)&&l.add(r.id);for(let[r,n]of Object.values(t.updated))isShape(n)&&(isShapeInPage(e,o,n)?l.add(n.id):l.remove(n.id));for(let e of Object.keys(t.removed))isShapeId(e)&&l.remove(e)}let d=l.get();return d?withDiff(d.value,d.diff):r})};let ClickManager=class ClickManager{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,t=uniqueId())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?nc:nu)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};transformPointerDownEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=Vec2d_Vec2d.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>40&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}};transformPointerUpEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=Vec2d_Vec2d.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"};handleMove=()=>{"idle"!==this._clickState&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.instanceState.isCoarsePointer?6:np)&&this.cancelDoubleClickTimeout()}};let EnvironmentManager=class EnvironmentManager{constructor(e){this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid};function Stack_stack(e){if(e){let t=nJ;for(;e.length;)t=t.push(e.pop());return t}return nJ}let EmptyStackItem=class EmptyStackItem{length=0;head=null;tail=this;push(e){return new StackItem(e,this)}toArray(){return ev}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}};let nJ=new EmptyStackItem;let StackItem=class StackItem{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new StackItem(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}};let HistoryManager=class HistoryManager{constructor(e,t){this.ctx=e,this.annotateError=t}_undos=Atom_atom("HistoryManager.undos",Stack_stack());_redos=Atom_atom("HistoryManager.redos",Stack_stack());_batchDepth=0;onBatchComplete=()=>void 0;_commands={};get numUndos(){return this._undos.value.length}get numRedos(){return this._redos.value.length}createCommand=(e,t,r)=>{if(this._commands[e])throw Error(`Duplicate command: ${e}`);this._commands[e]=r;let exec=(...n)=>{if(!this._batchDepth)return this.batch(()=>exec(...n)),this.ctx;let i=t(...n);if(!i)return this.ctx;let{data:o,ephemeral:a,squashing:l,preservesRedoStack:d}=i;if(this.ignoringUpdates((e,t)=>(r.do(o),{undos:e,redos:t})),!a){let t=this._undos.value.head;l&&t&&"command"===t.type&&t.name===e&&t.preservesRedoStack===d?this._undos.update(e=>e.tail.push({...t,id:uniqueId(),data:r.squash(t.data,o)})):this._undos.update(t=>t.push({type:"command",name:e,data:o,id:uniqueId(),preservesRedoStack:d})),i.preservesRedoStack||this._redos.set(Stack_stack()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return exec};batch=e=>{try{this._batchDepth++,1===this._batchDepth?transact(()=>{let t=this._undos.value.head?.id;e(),t!==this._undos.value.head?.id&&this.onBatchComplete()}):e()}catch(e){throw this.annotateError(e),e}finally{this._batchDepth--}return this};ignoringUpdates=e=>{let t=this._undos.value,r=this._redos.value;this._undos.set(Stack_stack()),this._redos.set(Stack_stack());try{({undos:t,redos:r}=transact(()=>e(t,r)))}finally{this._undos.set(t),this._redos.set(r)}};_undo=({pushToRedoStack:e,toMark:t})=>(this.ignoringUpdates((r,n)=>{if(0===r.length)return{undos:r,redos:n};for(;r.head?.type==="STOP";){let i=r.head;if(r=r.tail,e&&(n=n.push(i)),i.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:n}}if(0===r.length)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:n};for(;r.head;){let i=r.head;if(r=r.tail,e&&(n=n.push(i)),"STOP"===i.type){if(i.onUndo&&(!t||i.id===t))break}else{let e=this._commands[i.name];e.undo(i.data)}}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:n}}),this);undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>(this.ignoringUpdates((e,t)=>{if(0===t.length)return{undos:e,redos:t};for(;t.head?.type==="STOP";)e=e.push(t.head),t=t.tail;if(0===t.length)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){let r=t.head;if(e=e.push(t.head),t=t.tail,"STOP"===r.type){if(r.onRedo)break}else{let e=this._commands[r.name];e.redo?e.redo(r.data):e.do(r.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this);bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);mark=(e=uniqueId(),t=!0,r=!0)=>{let n=this._undos.value.head;return n&&"STOP"===n.type&&n.id===e&&n.onUndo===t&&n.onRedo===r?n.id:(this._undos.update(n=>n.push({type:"STOP",id:e,onUndo:t,onRedo:r})),this.ctx.emit("mark-history",{id:e}),e)};clear(){this._undos.set(Stack_stack()),this._redos.set(Stack_stack())}};let SideEffectManager=class SideEffectManager{constructor(e){this.editor=e,e.store.onBeforeCreate=(e,t)=>{let r=this._beforeCreateHandlers[e.typeName];if(r){let n=e;for(let e of r)n=e(n,t);return n}return e},e.store.onAfterCreate=(e,t)=>{let r=this._afterCreateHandlers[e.typeName];if(r)for(let n of r)n(e,t)},e.store.onBeforeChange=(e,t,r)=>{let n=this._beforeChangeHandlers[t.typeName];if(n){let i=t;for(let t of n)i=t(e,i,r);return i}return t};let t=0;e.store.onAfterChange=(e,r,n)=>{if(++t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{let t=this._afterChangeHandlers[r.typeName];if(t)for(let i of t)i(e,r,n)}t--},e.store.onBeforeDelete=(e,t)=>{let r=this._beforeDeleteHandlers[e.typeName];if(r){for(let n of r)if(!1===n(e,t))return!1}},e.store.onAfterDelete=(e,t)=>{let r=this._afterDeleteHandlers[e.typeName];if(r)for(let n of r)n(e,t)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(e=>e())}}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_batchCompleteHandlers=[];registerBeforeCreateHandler(e,t){let r=this._beforeCreateHandlers[e];return r||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>remove(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){let r=this._afterCreateHandlers[e];return r||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>remove(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){let r=this._beforeChangeHandlers[e];return r||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>remove(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){let r=this._afterChangeHandlers[e];return r||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>remove(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){let r=this._beforeDeleteHandlers[e];return r||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>remove(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){let r=this._afterDeleteHandlers[e];return r||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>remove(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>remove(this._batchCompleteHandlers,e)}};function remove(e,t){let r=e.indexOf(t);r>=0&&e.splice(r,1)}var n0=Object.defineProperty,n1=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,r,n)=>{for(var i,o=n>1?void 0:n?n1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&n0(t,r,o),o};let round=e=>Math.round(1e8*e)/1e8;function findAdjacentGaps(e,t,r,n,i){let o=e.filter(e=>("forward"===n?e.startNode.id===t:e.endNode.id===t)&&round(e.length)===round(r)&&rangeIntersection(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let a=new Set;return o.forEach(t=>{let l="forward"===n?t.endNode.id:t.startNode.id;if(!a.has(l)){a.add(l);let d=findAdjacentGaps(e,l,r,n,rangeIntersection(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...d)}}),o}function dedupeGapSnaps(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let r=e[t];for(let n=t-1;n>=0;n--){let i=e[n];if(i.direction===r.direction&&r.gaps.every(e=>i.gaps.some(t=>round(e.startEdge[0].x)===round(t.startEdge[0].x)&&round(e.startEdge[0].y)===round(t.startEdge[0].y)&&round(e.startEdge[1].x)===round(t.startEdge[1].x)&&round(e.startEdge[1].y)===round(t.startEdge[1].y))&&i.gaps.some(t=>round(e.endEdge[0].x)===round(t.endEdge[0].x)&&round(e.endEdge[0].y)===round(t.endEdge[0].y)&&round(e.endEdge[1].x)===round(t.endEdge[1].x)&&round(e.endEdge[1].y)===round(t.endEdge[1].y)))){e.splice(t,1);break}}}}let SnapManager=class SnapManager{constructor(e){this.editor=e}_snapLines=Atom_atom("snapLines",void 0);get lines(){return this._snapLines.value??ev}clear(){this.lines.length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}get snapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let r=e.getShapePageTransform(t.id);if(!r)return;let n=this.editor.getShapeGeometry(t).snapPoints;return n.map((e,n)=>{let{x:i,y:o}=Matrix2d.applyToPoint(r,e);return{x:i,y:o,id:`${t.id}:${n}`}})})}get snapThreshold(){return 8/this.editor.zoomLevel}get snappableShapes(){let{editor:e}=this,{selectedShapeIds:t,renderingBounds:r}=e,n=[],collectSnappableShapesFromParent=i=>{let o=e.getSortedChildIdsForParent(i);for(let i of o){if(t.includes(i))continue;let o=e.getShape(i);if(!o)continue;let a=e.getShapeUtil(o);if(!a.canSnap(o))continue;let l=e.getShapePageBounds(i);if(l&&r.includes(l)){if(e.isShapeOfType(o,"group")){collectSnappableShapesFromParent(i);continue}n.push({id:i,pageBounds:l,isClosed:e.getShapeGeometry(o).isClosed})}}};return collectSnappableShapesFromParent(this.currentCommonAncestor??e.currentPageId),n}get currentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.selectedShapes)}get snappablePoints(){let{snappableShapes:e,snapPointsCache:t}=this,r=[];return e.forEach(e=>{let n=t.get(e.id);n&&r.push(...n)}),r}get visibleGaps(){var e,t,r,n,i,o;let a,l;let d=[],c=[],u=this.snappableShapes.sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let n=0;n<u.length;n++){a=u[n];for(let i=n+1;i<u.length;i++)l=u[i],a.pageBounds.maxX<l.pageBounds.minX&&(e=a.pageBounds.minY,t=a.pageBounds.maxY,r=l.pageBounds.minY,e<l.pageBounds.maxY&&r<t)&&d.push({startNode:a,endNode:l,startEdge:[new Vec2d_Vec2d(a.pageBounds.maxX,a.pageBounds.minY),new Vec2d_Vec2d(a.pageBounds.maxX,a.pageBounds.maxY)],endEdge:[new Vec2d_Vec2d(l.pageBounds.minX,l.pageBounds.minY),new Vec2d_Vec2d(l.pageBounds.minX,l.pageBounds.maxY)],length:l.pageBounds.minX-a.pageBounds.maxX,breadthIntersection:rangeIntersection(a.pageBounds.minY,a.pageBounds.maxY,l.pageBounds.minY,l.pageBounds.maxY)})}let p=u.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let e=0;e<p.length;e++){a=p[e];for(let t=e+1;t<p.length;t++)l=p[t],a.pageBounds.maxY<l.pageBounds.minY&&(n=a.pageBounds.minX,i=a.pageBounds.maxX,o=l.pageBounds.minX,n<l.pageBounds.maxX&&o<i)&&c.push({startNode:a,endNode:l,startEdge:[new Vec2d_Vec2d(a.pageBounds.minX,a.pageBounds.maxY),new Vec2d_Vec2d(a.pageBounds.maxX,a.pageBounds.maxY)],endEdge:[new Vec2d_Vec2d(l.pageBounds.minX,l.pageBounds.minY),new Vec2d_Vec2d(l.pageBounds.maxX,l.pageBounds.minY)],length:l.pageBounds.minY-a.pageBounds.maxY,breadthIntersection:rangeIntersection(a.pageBounds.minX,a.pageBounds.maxX,l.pageBounds.minX,l.pageBounds.maxX)})}return{horizontal:d,vertical:c}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:n}){let{snappablePoints:i,snapThreshold:o}=this,a=t.clone().translate(n),l=r.map(({x:e,y:t},r)=>({id:"selection:"+r,x:e+n.x,y:t+n.y})),d=[],c=[],u=new Vec2d_Vec2d(o,o);this.collectPointSnaps({minOffset:u,nearestSnapsX:d,nearestSnapsY:c,otherNodeSnapPoints:i,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c,minOffset:u});let p=new Vec2d_Vec2d("x"===e?0:d[0]?.nudge??0,"y"===e?0:c[0]?.nudge??0);u.x=0,u.y=0,d.length=0,c.length=0,l.forEach(e=>{e.x+=p.x,e.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:u,nearestSnapsX:d,nearestSnapsY:c,otherNodeSnapPoints:i,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c,minOffset:u});let h=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:c}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:c});return this._snapLines.set([...f,...h]),{nudge:p}}get outlinesInPageSpace(){return this.snappableShapes.map(({id:e,isClosed:t})=>{let r=deepCopy(this.editor.getShapeGeometry(e).vertices);t&&r.push(r[0]);let n=this.editor.getShapePageTransform(e);if(!n)throw Error("No page transform");return Matrix2d.applyToPoints(n,r)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){let r,n,i,o;let{outlinesInPageSpace:a,snapThreshold:l}=this,d=l,c=null,u=[...a,...t];for(let t of u)for(let a=0;a<t.length-1;a++)r=t[a],n=t[a+1],i=Vec2d_Vec2d.NearestPointOnLineSegment(r,n,e),!isNaN(o=Vec2d_Vec2d.Dist(e,i))&&o<d&&(d=o,c=i);return c?(this._snapLines.set([{id:uniqueId(),type:"points",points:[c]}]),Vec2d_Vec2d.Sub(c,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:n,isResizingFromCenter:i}){let{snapThreshold:o}=this,{box:a,scaleX:l,scaleY:d}=Box2d_Box2d.Resize(e,r,i?2*t.x:t.x,i?2*t.y:t.y,n),c=r;l<0&&(c=flipSelectionHandleX(c)),d<0&&(c=flipSelectionHandleY(c)),i&&(a.center=e.center);let u="top"===c||"bottom"===c,p="left"===c||"right"===c,h=getResizeSnapPointsForHandle(c,a),f=this.snappablePoints,g=[],m=[],y=new Vec2d_Vec2d(o,o);this.collectPointSnaps({minOffset:y,nearestSnapsX:g,nearestSnapsY:m,otherNodeSnapPoints:f,selectionSnapPoints:h});let b=new Vec2d_Vec2d(u?0:g[0]?.nudge??0,p?0:m[0]?.nudge??0);if(n&&isSelectionCorner(c)&&0!==b.len()){let t=g.length&&m.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":g.length?"x":"y",r=e.aspectRatio;"x"===t?(m.length=0,b.y=b.x/r,("bottom_left"===c||"top_right"===c)&&(b.y=-b.y)):(g.length=0,b.x=b.y*r,("bottom_left"===c||"top_right"===c)&&(b.x=-b.x))}let v=Vec2d_Vec2d.Add(t,b),{box:S}=Box2d_Box2d.Resize(e,r,i?2*v.x:v.x,i?2*v.y:v.y,n);i&&(S.center=e.center);let x=getResizeSnapPointsForHandle("any",S);g.length=0,m.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:g,nearestSnapsY:m,otherNodeSnapPoints:f,selectionSnapPoints:x});let w=this.getPointSnapLines({nearestSnapsX:g,nearestSnapsY:m});return this._snapLines.set([...w]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:n,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=Vec2d_Vec2d.Sub(o,e),a=Math.abs(t.x),l=Math.abs(t.y);round(a)<=round(r.x)&&(round(a)<round(r.x)&&(n.length=0),n.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),r.x=a),round(l)<=round(r.y)&&(round(l)<round(r.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),r.y=l)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:n}){var i,o,a,l,d,c,u,p,h;let{horizontal:f,vertical:g}=this.visibleGaps;for(let n of f){if(i=n.breadthIntersection[0],o=n.breadthIntersection[1],a=e.minY,!(i<e.maxY)||!(a<o))continue;let l=n.startEdge[0].x+n.length/2,d=l-e.center.x,c=n.length>e.width;if(c&&round(Math.abs(d))<=round(t.x)){round(Math.abs(d))<round(t.x)&&(r.length=0),t.x=Math.abs(d);let e={type:"gap_center",gap:n,nudge:d},i=r.find(({type:e})=>"gap_center"===e),o=i&&rangeIntersection(n.breadthIntersection[0],n.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>n.length&&o?r[r.indexOf(i)]=e:i&&o||r.push(e)}let u=n.startNode.pageBounds.minX-n.length,p=e.maxX,h=u-p;round(Math.abs(h))<=round(t.x)&&(round(Math.abs(h))<round(t.x)&&(r.length=0),t.x=Math.abs(h),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"left",nudge:h}));let f=n.endNode.pageBounds.maxX+n.length,g=e.minX,m=f-g;round(Math.abs(m))<=round(t.x)&&(round(Math.abs(m))<round(t.x)&&(r.length=0),t.x=Math.abs(m),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"right",nudge:m}))}for(let r of g){if(l=r.breadthIntersection[0],d=r.breadthIntersection[1],c=e.minX,!(l<e.maxX)||!(c<d))continue;let i=r.startEdge[0].y+r.length/2,o=i-e.center.y,a=r.length>e.height;if(a&&round(Math.abs(o))<=round(t.y)){round(Math.abs(o))<round(t.y)&&(n.length=0),t.y=Math.abs(o);let e={type:"gap_center",gap:r,nudge:o},i=n.find(({type:e})=>"gap_center"===e),a=i&&(u=i.gap.breadthIntersection[0],p=i.gap.breadthIntersection[1],h=r.breadthIntersection[0],u<r.breadthIntersection[1]&&h<p);i&&i.gap.length>r.length&&a?n[n.indexOf(i)]=e:i&&a||n.push(e);continue}let f=r.startNode.pageBounds.minY-r.length,g=e.maxY,m=f-g;round(Math.abs(m))<=round(t.y)&&(round(Math.abs(m))<round(t.y)&&(n.length=0),t.y=Math.abs(m),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"top",nudge:m}));let y=r.endNode.pageBounds.maxY+r.length,b=e.minY,v=y-b;round(Math.abs(v))<=round(t.y)&&(round(Math.abs(v))<round(t.y)&&(n.length=0),t.y=Math.abs(v),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"bottom",nudge:v}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let r={},n={};if(e.length>0){for(let t of e)if("points"===t.type){let e=round(t.points.otherPoint.x);r[e]||(r[e]=[]),r[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=round(e.points.otherPoint.y);n[t]||(n[t]=[]),n[t].push(e.points)}}return Object.values(r).concat(Object.values(n)).map(e=>({id:uniqueId(),type:"points",points:dedupe(e.map(e=>Vec2d_Vec2d.From(e.otherPoint)).concat(e.map(e=>Vec2d_Vec2d.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){let{vertical:n,horizontal:i}=this.visibleGaps,o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(let r of t){if("points"===r.type)continue;let{gap:{breadthIntersection:t,startEdge:n,startNode:l,endNode:d,length:c,endEdge:u}}=r;switch(r.type){case"gap_center":{let r=(c-e.width)/2,p=rangeIntersection(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:uniqueId(),gaps:[...findAdjacentGaps(i,l.id,r,"backward",p),{startEdge:n,endEdge:o.left},{startEdge:o.right,endEdge:u},...findAdjacentGaps(i,d.id,r,"forward",p)]});break}case"gap_duplicate":{let p=rangeIntersection(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:uniqueId(),gaps:"left"===r.protrusionDirection?[{startEdge:o.right,endEdge:n.map(e=>e.clone().addXY(-l.pageBounds.width,0))},{startEdge:n,endEdge:u},...findAdjacentGaps(i,d.id,c,"forward",p)]:[...findAdjacentGaps(i,l.id,c,"backward",p),{startEdge:n,endEdge:u},{startEdge:u.map(e=>e.clone().addXY(r.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(r.length>0)for(let t of r){if("points"===t.type)continue;let{gap:{breadthIntersection:r,startEdge:i,startNode:l,endNode:d,length:c,endEdge:u}}=t;switch(t.type){case"gap_center":{let d=(c-e.height)/2,p=rangeIntersection(r[0],r[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:uniqueId(),gaps:[...findAdjacentGaps(n,l.id,d,"backward",p),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:u},...findAdjacentGaps(n,t.gap.endNode.id,d,"forward",p)]});break}case"gap_duplicate":{let p=rangeIntersection(r[0],r[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:uniqueId(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-l.pageBounds.height))},{startEdge:i,endEdge:u},...findAdjacentGaps(n,d.id,c,"forward",p)]:[...findAdjacentGaps(n,l.id,c,"backward",p),{startEdge:i,endEdge:u},{startEdge:u.map(e=>e.clone().addXY(0,d.pageBounds.height)),endEdge:o.top}]})}}}return dedupeGapSnaps(a),a}};function getResizeSnapPointsForHandle(e,t){let{minX:r,maxX:n,minY:i,maxY:o}=t,a=[];switch(e){case"top":case"left":case"top_left":case"any":a.push({id:"top_left",handle:"top_left",x:r,y:i})}switch(e){case"top":case"right":case"top_right":case"any":a.push({id:"top_right",handle:"top_right",x:n,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":a.push({id:"bottom_right",handle:"bottom_right",x:n,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":a.push({id:"bottom_left",handle:"bottom_left",x:r,y:o})}return a}__decorateClass([computed],SnapManager.prototype,"snapPointsCache",1),__decorateClass([computed],SnapManager.prototype,"snapThreshold",1),__decorateClass([computed],SnapManager.prototype,"snappableShapes",1),__decorateClass([computed],SnapManager.prototype,"currentCommonAncestor",1),__decorateClass([computed],SnapManager.prototype,"snappablePoints",1),__decorateClass([computed],SnapManager.prototype,"visibleGaps",1),__decorateClass([computed],SnapManager.prototype,"outlinesInPageSpace",1);let n2=/\r?\n|\r/g;function normalizeTextForDom(e){return e.replace(n2,"\n").split("\n").map(e=>e||" ").join("\n")}let n3={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},n5=/\s/;let TextManager=class TextManager{constructor(e){this.editor=e}getTextElement(){let e=document.querySelector(".tl-text-measure");e?.remove();let t=document.createElement("div");return this.editor.getContainer().appendChild(t),t.id=`__textMeasure_${uniqueId()}`,t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,t}measureText=(e,t)=>{let r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth??null),r.style.setProperty("padding",t.padding),r.textContent=normalizeTextForDom(e);let n=r.getBoundingClientRect();return{x:0,y:0,w:n.width,h:n.height}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let r=[],n=e.getBoundingClientRect(),i=-n.left,o=-n.top,a=new Range,l=e.childNodes[0],d=0,c=null,u=null,p=0,h=!1;for(let n of e.childNodes)if(n.nodeType===Node.TEXT_NODE)for(let e of n.textContent??""){a.setStart(l,d),a.setEnd(l,d+e.length);let n=a.getClientRects(),f=n[n.length-1],g=f.top+o,m=f.left+i,y=f.right+i,b=n5.test(e);if(b===u&&g===p&&c)c.box.w=y-c.box.x,c.text+=e;else{if(c){if(t&&g!==p){h=!0;break}r.push(c)}c={box:{x:m,y:g,w:f.width,h:f.height},text:e}}u=b,p=g,d+=e.length}return c&&r.push(c),{spans:r,didTruncate:h}}measureTextSpans(e,t){if(""===e)return[];let r="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow,n=this.getTextElement(),i=Math.ceil(t.width-2*t.padding);n.style.setProperty("width",`${i}px`),n.style.setProperty("height","min-content"),n.style.setProperty("dir","ltr"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",n3[t.textAlign]),r&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all")),e=normalizeTextForDom(e),n.textContent=e;let{spans:o,didTruncate:a}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:r});if("truncate-ellipsis"===t.overflow&&a){n.textContent="…";let r=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${i-r}px`),n.textContent=e;let o=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,a=o[o.length-1];return o.push({text:"…",box:{x:Math.min(a.box.x+a.box.w,t.width-t.padding-r),y:a.box.y,w:r,h:a.box.h}}),o}return n.remove(),o}};let TickManager=class TickManager{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}raf;isPaused=!0;last=0;t=0;start=()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()};tick=()=>{if(this.isPaused)return;let e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)};dispose=()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)};prevPoint=new Vec2d_Vec2d;updatePointerVelocity=e=>{let{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:n}}}=this;if(0===e)return;let i=Vec2d_Vec2d.Sub(r,t);this.prevPoint=r.clone();let o=i.len(),a=o?i.div(o):new Vec2d_Vec2d(0,0),l=n.clone().lrp(a.mul(o/e),.5);.01>Math.abs(l.x)&&(l.x=0),.01>Math.abs(l.y)&&(l.y=0),n.equals(l)||(this.editor.inputs.pointerVelocity=l)}};var n4=Object.defineProperty,n8=Object.getOwnPropertyDescriptor,UserPreferencesManager_decorateClass=(e,t,r,n)=>{for(var i,o=n>1?void 0:n?n8(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&n4(t,r,o),o};let UserPreferencesManager=class UserPreferencesManager{constructor(e,t){this.user=e,this.inferDarkMode=t}updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.value,...e})};get userPreferences(){return{id:this.id,name:this.name,locale:this.locale,color:this.color,isDarkMode:this.isDarkMode,animationSpeed:this.animationSpeed,isSnapMode:this.isSnapMode}}get isDarkMode(){return this.user.userPreferences.value.isDarkMode??(!!this.inferDarkMode&&userPrefersDarkUI())}get animationSpeed(){return this.user.userPreferences.value.animationSpeed??nB.animationSpeed}get id(){return this.user.userPreferences.value.id}get name(){return this.user.userPreferences.value.name??nB.name}get locale(){return this.user.userPreferences.value.locale??nB.locale}get color(){return this.user.userPreferences.value.color??nB.color}get isSnapMode(){return this.user.userPreferences.value.isSnapMode??nB.isSnapMode}};function getIsArrowStraight(e){return 8>Math.abs(e.props.bend)}function getBoundShapeInfoForTerminal(e,t){if("point"===t.type)return;let r=e.getShape(t.boundShapeId),n=e.getShapePageTransform(r),i=e.getShapeGeometry(r),o=i instanceof Group2d?i.children[0].vertices:i.vertices;return{shape:r,transform:n,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:o}}function getArrowTerminalInArrowSpace(e,t,r){if("point"===r.type)return Vec2d_Vec2d.From(r);let n=e.getShape(r.boundShapeId);if(!n)return new Vec2d_Vec2d(0,0);{let{point:i,size:o}=e.getShapeGeometry(n).bounds,a=Vec2d_Vec2d.Add(i,Vec2d_Vec2d.MulV(r.normalizedAnchor,o)),l=Matrix2d.applyToPoint(e.getShapePageTransform(n),a),d=Matrix2d.applyToPoint(Matrix2d.Inverse(t),l);return d}}function getArrowTerminalsInArrowSpace(e,t){let r=e.getShapePageTransform(t),n=getArrowTerminalInArrowSpace(e,r,t.props.start),i=getArrowTerminalInArrowSpace(e,r,t.props.end);return{start:n,end:i}}UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"userPreferences",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"isDarkMode",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"animationSpeed",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"id",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"name",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"locale",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"color",1),UserPreferencesManager_decorateClass([computed],UserPreferencesManager.prototype,"isSnapMode",1);let n6={s:2,m:3.5,l:5,xl:10};function getStraightArrowInfo(e,t){let{start:r,end:n,arrowheadStart:i,arrowheadEnd:o}=t.props,a=getArrowTerminalsInArrowSpace(e,t),l=a.start.clone(),d=a.end.clone(),c=Vec2d_Vec2d.Med(l,d),u=Vec2d_Vec2d.Sub(d,l).uni(),p=getBoundShapeInfoForTerminal(e,r),h=getBoundShapeInfoForTerminal(e,n),f=e.getShapePageTransform(t);updateArrowheadPointWithBoundShape(d,a.start,f,h),updateArrowheadPointWithBoundShape(l,a.end,f,p);let g=0,m=0,y=p&&h&&p.shape===h.shape;p&&h&&!y&&!p.isExact&&!h.isExact&&(h.didIntersect&&!p.didIntersect?p.isClosed&&l.setTo(d.clone().add(u.clone().mul(32))):!h.didIntersect&&h.isClosed&&d.setTo(l.clone().sub(u.clone().mul(32))));let b=Vec2d_Vec2d.Sub(d,l).uni(),v=!Vec2d_Vec2d.Equals(b,u);y||(p&&"none"!==i&&!p.isExact&&(g=10+n6[t.props.size]/2+("size"in p.shape.props?n6[p.shape.props.size]/2:0)),!h||"none"===o||h.isExact||(m=10+n6[t.props.size]/2+("size"in h.shape.props?n6[h.shape.props.size]/2:0)));let S=l.clone().add(b.clone().mul(g*(v?-1:1))),x=d.clone().sub(b.clone().mul(m*(v?-1:1))),w=Vec2d_Vec2d.Dist(S,x);w<32&&(0!==g&&0!==m?(g*=-1.5,m*=-1.5):0!==g?g*=-2:0!==m?m*=-2:w<10&&(p?g=-(10-w):h&&(m=-(10-w)))),l.add(b.clone().mul(g*(v?-1:1))),d.sub(b.clone().mul(m*(v?-1:1))),v?(p&&h&&d.setTo(Vec2d_Vec2d.Add(l,b.clone().mul(-32))),c.setTo(Vec2d_Vec2d.Med(a.start,a.end))):c.setTo(Vec2d_Vec2d.Med(l,d));let _=Vec2d_Vec2d.Dist(l,d);return{isStraight:!0,start:{handle:a.start,point:l,arrowhead:t.props.arrowheadStart},end:{handle:a.end,point:d,arrowhead:t.props.arrowheadEnd},middle:c,isValid:_>0,length:_}}function updateArrowheadPointWithBoundShape(e,t,r,n){let i;if(void 0===n||n.isExact)return;let o=Matrix2d.applyToPoint(r,t),a=Matrix2d.applyToPoint(r,e),l=Matrix2d.applyToPoint(Matrix2d.Inverse(n.transform),o),d=Matrix2d.applyToPoint(Matrix2d.Inverse(n.transform),a),c=n.isClosed,u=(c?intersectLineSegmentPolygon:intersectLineSegmentPolyline)(l,d,n.outline);if(null!==u&&(i=u.sort((e,t)=>Vec2d_Vec2d.Dist(e,l)-Vec2d_Vec2d.Dist(t,l))[0]??(c?void 0:d)),void 0===i)return;let p=Matrix2d.applyToPoint(n.transform,i),h=Matrix2d.applyToPoint(Matrix2d.Inverse(r),p);e.setTo(h),n.didIntersect=!0}function getStraightArrowHandlePath(e){return getArrowPath(e.start.handle,e.end.handle)}function getSolidStraightArrowPath(e){return getArrowPath(e.start.point,e.end.point)}function getArrowPath(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function getCurvedArrowInfo(e,t,r=0){let{arrowheadEnd:n,arrowheadStart:i}=t.props,o=t.props.bend+r;if(Math.abs(o)>Math.abs(10*t.props.bend))return getStraightArrowInfo(e,t);let a=getArrowTerminalsInArrowSpace(e,t),l=Vec2d_Vec2d.Med(a.start,a.end),d=Vec2d_Vec2d.Sub(a.end,a.start).uni(),c=Vec2d_Vec2d.Add(l,d.per().mul(-o)),u=getBoundShapeInfoForTerminal(e,t.props.start),p=getBoundShapeInfoForTerminal(e,t.props.end),h=a.start.clone(),f=a.end.clone(),g=c.clone(),m=t.props.bend<0,y=m?clockwiseAngleDist:counterClockwiseAngleDist,b=getArcInfo(h,f,g),v=Vec2d_Vec2d.Angle(b.center,h),S=Vec2d_Vec2d.Angle(b.center,f),x=y(v,S);if(0===b.length||0===b.size||!isSafeFloat(b.length)||!isSafeFloat(b.size))return getStraightArrowInfo(e,t);let w=h.clone(),_=f.clone(),P=g.clone(),E=e.getShapePageTransform(t),C=0,k=0;if(u&&!u.isExact){let r;let n=Matrix2d.applyToPoint(E,w),o=Matrix2d.applyToPoint(E,b.center),a=Matrix2d.applyToPoint(E,_),l=Matrix2d.Inverse(u.transform),d=Matrix2d.applyToPoint(l,n),c=Matrix2d.applyToPoint(l,o),p=Matrix2d.applyToPoint(l,a),{isClosed:h}=u,f=h?intersectCirclePolygon:intersectCirclePolyline,g=f(c,b.radius,u.outline);if(g){let e=c.angle(d),t=c.angle(p),n=y(e,t);g=g.filter(t=>y(e,c.angle(t))<=n);let i=.25*n;g.sort(h?(t,r)=>Math.abs(y(e,c.angle(t))-i)<Math.abs(y(e,c.angle(r))-i)?-1:1:(t,r)=>y(e,c.angle(t))<y(e,c.angle(r))?-1:1),r=g[0]??(h?void 0:d)}else r=h?void 0:d;r&&(w.setTo(e.getPointInShapeSpace(t,Matrix2d.applyToPoint(u.transform,r))),u.didIntersect=!0,"none"!==i&&(C=10+n6[t.props.size]/2+("size"in u.shape.props?n6[u.shape.props.size]/2:0)))}if(p&&!p.isExact){let r;let i=Matrix2d.applyToPoint(E,w),o=Matrix2d.applyToPoint(E,_),a=Matrix2d.applyToPoint(E,b.center),l=Matrix2d.Inverse(p.transform),d=Matrix2d.applyToPoint(l,i),c=Matrix2d.applyToPoint(l,a),u=Matrix2d.applyToPoint(l,o),h=p.isClosed,f=h?intersectCirclePolygon:intersectCirclePolyline,g=f(c,b.radius,p.outline);if(g){let e=c.angle(d),t=c.angle(u),n=y(e,t),i=.75*n;(g=g.filter(t=>y(e,c.angle(t))<=n)).sort(h?(t,r)=>Math.abs(y(e,c.angle(t))-i)<Math.abs(y(e,c.angle(r))-i)?-1:1:(t,r)=>y(e,c.angle(t))<y(e,c.angle(r))?-1:1),r=g[0]?g[0]:h?void 0:u}else r=h?void 0:u;r&&(_.setTo(e.getPointInShapeSpace(t,Matrix2d.applyToPoint(p.transform,r))),p.didIntersect=!0,"none"!==n&&(k=10+n6[t.props.size]/2+("size"in p.shape.props?n6[p.shape.props.size]/2:0)))}let I=Vec2d_Vec2d.Angle(b.center,w),T=Vec2d_Vec2d.Angle(b.center,_),A=y(I,T),$=A*b.radius,M=w.clone(),D=_.clone();if(0!==C){let e=C/$*(m?1:-1),t=Vec2d_Vec2d.FromAngle(I+A*e);M.setTo(b.center).add(t.mul(b.radius))}if(0!==k){let e=k/$*(m?-1:1),t=Vec2d_Vec2d.FromAngle(T+A*e);D.setTo(b.center).add(t.mul(b.radius))}let V=Vec2d_Vec2d.Dist(M,D);if(V<32&&(0!==C&&0!==k?(C*=-1.5,k*=-1.5):0!==C?C*=-2:0!==k?k*=-2:V<10&&(u?C=-(10-V):p&&(k=-(10-V)))),0!==C){let e=C/$*(m?1:-1),t=Vec2d_Vec2d.FromAngle(I+A*e);w.setTo(b.center).add(t.mul(b.radius))}if(0!==k){let e=k/$*(m?-1:1),t=Vec2d_Vec2d.FromAngle(T+A*e);_.setTo(b.center).add(t.mul(b.radius))}if(u&&p&&!u.isExact&&!p.isExact){if($=(A=y(I=Vec2d_Vec2d.Angle(b.center,w),T=Vec2d_Vec2d.Angle(b.center,_)))*b.radius,u.shape===p.shape)$<100&&(w.setTo(h),_.setTo(f),P.setTo(g));else if(u&&!u.didIntersect&&w.setTo(h),p&&!p.didIntersect||y(v,I)>y(v,T)){let e=Math.min(.9,32/$)*(m?1:-1),t=Vec2d_Vec2d.FromAngle(I+A*e);_.setTo(b.center).add(t.mul(b.radius))}}placeCenterHandle(b.center,b.radius,w,_,P,x,m),w.equals(_)&&(w.setTo(P.clone().addXY(1,1)),_.setTo(P.clone().subXY(1,1))),h.setTo(w),f.setTo(_),g.setTo(P);let R=getArcInfo(h,f,g);return{isStraight:!1,start:{point:h,handle:a.start,arrowhead:t.props.arrowheadStart},end:{point:f,handle:a.end,arrowhead:t.props.arrowheadEnd},middle:g,handleArc:b,bodyArc:R,isValid:0!==R.length&&isFinite(R.center.x)&&isFinite(R.center.y)}}function getCurvedArrowHandlePath(e){let{start:t,end:r,handleArc:{radius:n,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.handle.x},${t.handle.y} A${n} ${n} 0 ${i} ${o} ${r.handle.x},${r.handle.y}`}function getSolidCurvedArrowPath(e){let{start:t,end:r,bodyArc:{radius:n,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.point.x},${t.point.y} A${n} ${n} 0 ${i} ${o} ${r.point.x},${r.point.y}`}function getArcInfo(e,t,r){let n=-2*(e.x*(t.y-r.y)-e.y*(t.x-r.x)+t.x*r.y-r.x*t.y),i={x:((e.x*e.x+e.y*e.y)*(r.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-r.y)+(r.x*r.x+r.y*r.y)*(t.y-e.y))/n,y:((e.x*e.x+e.y*e.y)*(t.x-r.x)+(t.x*t.x+t.y*t.y)*(r.x-e.x)+(r.x*r.x+r.y*r.y)*(e.x-t.x))/n},o=Vec2d_Vec2d.Dist(i,e),a=+Vec2d_Vec2d.Clockwise(e,r,t),l=Math.hypot(e.y-t.y,e.x-t.x),d=Math.hypot(t.y-r.y,t.x-r.x),c=Math.hypot(r.y-e.y,r.x-e.x),u=2*Math.acos((d*d+c*c-l*l)/(2*d*c)),p=+(r8>u),h=(r9-u)*(a?1:-1);return{center:i,radius:o,size:h,length:h*o,largeArcFlag:p,sweepFlag:a}}function placeCenterHandle(e,t,r,n,i,o,a){let l=Vec2d_Vec2d.Angle(e,r),d=Vec2d_Vec2d.Angle(e,n),c=clockwiseAngleDist(l,d);a||(c=r9-c);let u=Vec2d_Vec2d.FromAngle(l+c*(.5*(a?1:-1)));if(i.setTo(e).add(u.mul(t)),c>o){i.rotWith(e,r8);let t=n.clone();n.setTo(r),r.setTo(t)}}let n9={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};var n7=Object.defineProperty,ie=Object.getOwnPropertyDescriptor;let StateNode=class StateNode{constructor(e,t){this.editor=e;let{id:r,children:n,initial:i}=this.constructor;this.id=r,this.current=Atom_atom("toolState"+this.id,void 0),this.path=computed("toolPath"+this.id,()=>{let e=this.current.value;return this.id+(e?`.${e.path.value}`:"")}),this.parent=t??{},this.parent?n&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(n().map(e=>[e.id,new e(this.editor,this)])),this.current.set(this.children[this.initial])):this.type="leaf":(this.type="root",n&&i&&(this.initial=i,this.children=Object.fromEntries(n().map(e=>[e.id,new e(this.editor,this)])),this.current.set(this.children[this.initial])))}path;static id;static initial;static children;id;current;type;shapeType;initial;children;parent;isActive=!1;transition=(e,t)=>{let r=e.split("."),n=this;for(let e=0;e<r.length;e++){let i=r[e],o=n.current.value,a=n.children?.[i];if(!a)throw Error(`${n.id} - no child state exists with the id ${i}.`);if(o?.id!==a.id&&(o?.exit(t,i),n.current.set(a),a.enter(t,o?.id||"initial"),!a.isActive))break;n=a}return this};handleEvent=e=>{let t=n9[e.name],r=this.current.value;this[t]?.(e),this.current.value===r&&this.isActive&&r?.handleEvent(e)};enter=(e,t)=>{if(this.isActive=!0,this.onEnter?.(e,t),this.children&&this.initial&&this.isActive){let r=this.children[this.initial];this.current.set(r),r.enter(e,t)}};exit=(e,t)=>{this.isActive=!1,this.onExit?.(e,t),this.isActive||this.current.value?.exit(e,t)};_currentToolIdMask=Atom_atom("curent tool id mask",void 0);get currentToolIdMask(){return this._currentToolIdMask.value}set currentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onEnter;onExit};((e,t,r,n)=>{for(var i,o=n>1?void 0:n?ie(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&n7(t,r,o)})([computed],StateNode.prototype,"currentToolIdMask",1);let RootState=class RootState extends StateNode{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.current.value;t&&t.current.value?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}};var it=Object.defineProperty,ir=Object.getOwnPropertyDescriptor,Editor_decorateClass=(e,t,r,n)=>{for(var i,o=n>1?void 0:n?ir(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&it(t,r,o),o};let Editor=class Editor extends nq.EventEmitter{constructor({store:e,user:t,shapeUtils:r,tools:n,getContainer:i,initialState:o,inferDarkMode:a}){super(),this.store=e,this.snaps=new SnapManager(this),this.user=new UserPreferencesManager(t??createTLUser(),a??!1),this.getContainer=i??(()=>document.body),this.textMeasure=new TextManager(this);let NewRoot=class NewRoot extends RootState{static initial=o??""};this.root=new NewRoot(this),this.root.children={};let l=checkShapesAndAddCore(r),d=new Set(Object.keys(e.schema.types.shape.migrations.subTypeMigrations));for(let e of l){if(!d.has(e.type))throw Error(`Editor and store have different shapes: "${e.type}" was passed into the editor but not the schema`);d.delete(e.type)}if(d.size>0)throw Error(`Editor and store have different shapes: "${[...d][0]}" is present in the store schema but not provided to the editor`);let c={},u={},p=new Map;for(let e of l){let t=new e(this);c[e.type]=t;let r=getShapePropKeysByStyle(e.props??{});for(let t of(u[e.type]=r,r.keys()))if(p.has(t.id)){if(p.get(t.id)!==t)throw Error(`Multiple style props with id "${t.id}" in use. Style prop IDs must be unique.`)}else p.set(t.id,t)}for(let e of(this.shapeUtils=c,this.styleProps=u,[...n])){if(object_hasOwnProperty(this.root.children,e.id))throw Error(`Can't override tool with id "${e.id}"`);this.root.children[e.id]=new e(this,this.root)}this.environment=new EnvironmentManager(this);let h=new Set,reparentArrow=e=>{let t,r,n;let i=this.getShape(e);if(!i)return;let{start:o,end:a}=i.props,l="binding"===o.type?this.getShape(o.boundShapeId):void 0,d="binding"===a.type?this.getShape(a.boundShapeId):void 0,c=this.getAncestorPageId(i);if(!c)return;if(l&&d)t=this.findCommonAncestor([l,d])??c;else{if(!l&&!d)return;t=c}t&&t!==i.parentId&&this.reparentShapes([e],t);let u=this.getShape(e);if(!u)throw Error("no reparented arrow");let p=this.getShapeNearestSibling(u,l),h=this.getShapeNearestSibling(u,d);if(p&&h)r=p.index>h.index?p:h;else if(p&&!h)r=p;else{if(!h||p)return;r=h}let f=this.getSortedChildIdsForParent(r.parentId).map(e=>this.getShape(e)).filter(e=>e.index>r.index);if(f.length){let e=f.find(e=>"arrow"!==e.type);if(u.index>r.index&&(!e||u.index<e.index))return;n=getIndexBetween(r.index,f[0].index)}else n=getIndexAbove(r.index);n!==u.index&&this.updateShapes([{id:e,type:"arrow",index:n}])},unbindArrowTerminal=(e,t)=>{let{x:r,y:n}=getArrowTerminalsInArrowSpace(this,e)[t];this.store.put([{...e,props:{...e.props,[t]:{type:"point",x:r,y:n}}}])},arrowDidUpdate=e=>{for(let t of["start","end"]){let r=e.props[t];if("binding"!==r.type)continue;let n=this.getShape(r.boundShapeId),i=this.getAncestorPageId(e)===this.getAncestorPageId(n);n&&i||unbindArrowTerminal(e,t)}reparentArrow(e.id)},cleanupInstancePageState=(e,t)=>{let r=null,n=e.selectedShapeIds.filter(e=>!t.has(e));n.length!==e.selectedShapeIds.length&&(r||(r={...e}),r.selectedShapeIds=n);let i=e.erasingShapeIds.filter(e=>!t.has(e));i.length!==e.erasingShapeIds.length&&(r||(r={...e}),r.erasingShapeIds=i),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(r||(r={...e}),r.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(r||(r={...e}),r.editingShapeId=null);let o=e.hintingShapeIds.filter(e=>!t.has(e));return o.length!==e.hintingShapeIds.length&&(r||(r={...e}),r.hintingShapeIds=o),e.focusedGroupId&&t.has(e.focusedGroupId)&&(r||(r={...e}),r.focusedGroupId=null),r};if(this.sideEffects=new SideEffectManager(this),this.sideEffects.registerBatchCompleteHandler(()=>{for(let e of h){h.delete(e);let t=this.getShape(e);if(!t)continue;let r=this.getShapeUtil(t),n=r.onChildrenChange?.(t);n?.length&&this.updateShapes(n,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",e=>{e.parentId&&isShapeId(e.parentId)&&h.add(e.parentId);let t=this._arrowBindingsIndex.value[e.id];if(t?.length)for(let{arrowId:e,handleId:r}of t){let t=this.getShape(e);t&&unbindArrowTerminal(t,r)}let r=new Set([e.id]),n=compact(this.pageStates.map(e=>cleanupInstancePageState(e,r)));n.length&&this.store.put(n)}),this.sideEffects.registerBeforeDeleteHandler("page",e=>{if(this.instanceState.currentPageId!==e.id)return;let t=this.pages.find(t=>t.id!==e.id)?.id;if(!t)return;this.store.put([{...this.instanceState,currentPageId:t}]);let r=e6.createId(e.id),n=tx.createId(e.id);this.store.remove([r,n])}),this.sideEffects.registerAfterChangeHandler("shape",(e,t)=>{if(this.isShapeOfType(t,"arrow")&&arrowDidUpdate(t),e.parentId!==t.parentId){let reparentBoundArrows=e=>{let t=this._arrowBindingsIndex.value[e];if(t?.length)for(let e of t)reparentArrow(e.arrowId)};reparentBoundArrows(t.id),this.visitDescendants(t.id,reparentBoundArrows)}if(e.parentId!==t.parentId&&isPageId(t.parentId)){let r=new Set([e.id]);for(let n of(this.visitDescendants(e.id,e=>{r.add(e)}),this.pageStates)){if(n.pageId===t.parentId)continue;let e=cleanupInstancePageState(n,r);e&&this.store.put([e])}}e.parentId&&isShapeId(e.parentId)&&h.add(e.parentId),t.parentId!==e.parentId&&isShapeId(t.parentId)&&h.add(t.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e?.selectedShapeIds!==t?.selectedShapeIds){let e=t.selectedShapeIds.filter(e=>{let r=this.getShape(e)?.parentId;for(;isShapeId(r);){if(t.selectedShapeIds.includes(r))return!1;r=this.getShape(r)?.parentId}return!0}),r=null;if(e.length>0){let t=this.findCommonAncestor(compact(e.map(e=>this.getShape(e))),e=>this.isShapeOfType(e,"group"));t&&(r=t)}else t?.focusedGroupId&&(r=t.focusedGroupId);(e.length!==t.selectedShapeIds.length||r!==t.focusedGroupId)&&this.store.put([{...t,selectedShapeIds:e,focusedGroupId:r??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",e=>{this.isShapeOfType(e,"arrow")&&arrowDidUpdate(e)}),this.sideEffects.registerAfterCreateHandler("page",e=>{let t=e6.createId(e.id),r=tx.createId(e.id);this.store.has(t)||this.store.put([e6.create({id:t})]),this.store.has(r)||this.store.put([tx.create({id:r,pageId:e.id})])}),this._currentPageShapeIds=deriveShapeIdsInCurrentPage(this.store,()=>this.currentPageId),this._parentIdsToChildIds=parentsToChildren(this.store),this.disposables.add(this.store.listen(e=>{this.emit("change",e)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),o&&void 0===this.root.children[o])throw Error(`No state found for initialState "${o}".`);this.root.enter(void 0,"initial"),this.instanceState.followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}store;root;disposables=new Set;_tickManager=new TickManager(this);snaps;user;textMeasure;environment;getContainer;sideEffects;dispose(){this.disposables.forEach(e=>e()),this.disposables.clear()}shapeUtils;styleProps;getShapeUtil(e){let t="string"==typeof e?e:e.type,r=getOwnProperty(this.shapeUtils,t);return eM(r,`No shape util found for type "${t}"`),r}history=new HistoryManager(this,e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)});undo(){return this.history.undo(),this}get canUndo(){return this.history.numUndos>0}redo(){return this.history.redo(),this}get canRedo(){return this.history.numRedos>0}mark(e,t,r){return this.history.mark(e,t,r),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}batch(e){return this.history.batch(e),this}get _arrowBindingsIndex(){return arrowBindingsIndex(this)}getArrowsBoundTo(e){return this._arrowBindingsIndex.value[e]||ev}get arrowInfoCache(){return this.store.createComputedCache("arrow infoCache",e=>getIsArrowStraight(e)?getStraightArrowInfo(this,e):getCurvedArrowInfo(this,e))}getArrowInfo(e){let t="string"==typeof e?e:e.id;return this.arrowInfoCache.get(t)}annotateError(e,{origin:t,willCrashApp:r,tags:n,extras:i}){let o=this.createErrorAnnotations(t,r);return annotateError(e,{tags:{...o.tags,...n},extras:{...o.extras,...i}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.path.value,selectedShapes:this.selectedShapes,editingShape:this.editingShapeId?this.getShape(this.editingShapeId):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}_crashingError=null;get crashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}isIn(e){let t=e.split(".").reverse(),r=this.root;for(;t.length>0;){let e=t.pop();if(!e)return!0;let n=r.current.value;if(n?.id===e){if(0===t.length)return!0;r=n;continue}break}return!1}isInAny(...e){return e.some(e=>this.isIn(e))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}get currentTool(){return this.root.current.value}get currentToolId(){let{currentTool:e}=this;return e?e.currentToolIdMask??e.id:""}getStateDescendant(e){let t=e.split(".").reverse(),r=this.root;for(;t.length>0;){let e=t.pop();if(!e)break;let n=r.children?.[e];if(!n)return;r=n}return r}get documentSettings(){return this.store.get(tR)}updateDocumentSettings(e){return this.store.put([{...this.documentSettings,...e}]),this}get instanceState(){return this.store.get(tg)}updateInstanceState(e,t){return this._updateInstanceState(e,{ephemeral:!0,squashing:!0,...t}),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}_updateInstanceState=this.history.createCommand("updateInstanceState",(e,t)=>{let r=this.store.get(this.instanceState.id),n={...r,...e};return{data:{prev:r,next:n},ephemeral:!1,squashing:!1,...t}},{do:({next:e})=>{this.store.put([e])},undo:({prev:e})=>{this.store.put([e])},squash:({prev:e},{next:t})=>({prev:e,next:t})});_isChangingStyleTimeout=-1;get openMenus(){return this.instanceState.openMenus}addOpenMenu(e){let t=new Set(this.openMenus);return t.has(e)||(t.add(e),this.updateInstanceState({openMenus:[...t]})),this}deleteOpenMenu(e){let t=new Set(this.openMenus);return t.has(e)&&(t.delete(e),this.updateInstanceState({openMenus:[...t]})),this}get isMenuOpen(){return this.openMenus.length>0}setCursor=e=>(this.updateInstanceState({cursor:{...this.instanceState.cursor,...e}},{ephemeral:!0}),this);get pageStates(){return this._pageStates.value}get _pageStates(){return this.store.query.records("instance_page_state")}get currentPageState(){return this.store.get(this._currentPageStateId)}get _currentPageStateId(){return tx.createId(this.currentPageId)}updateCurrentPageState(e,t){return this._setInstancePageState(e,t),this}_setInstancePageState=this.history.createCommand("setInstancePageState",(e,t)=>{let r=this.store.get(e.id??this.currentPageState.id);return{data:{prev:r,partial:e},...t}},{do:({prev:e,partial:t})=>{this.store.update(e.id,e=>({...e,...t}))},undo:({prev:e})=>{this.store.update(e.id,()=>e)}});get selectedShapeIds(){return this.currentPageState.selectedShapeIds}get selectedShapes(){let{selectedShapeIds:e}=this.currentPageState;return compact(e.map(e=>this.store.get(e)))}setSelectedShapes(e,t){let r=e.map(e=>"string"==typeof e?e:e.id);return this._setSelectedShapes(r,t),this}_setSelectedShapes=this.history.createCommand("setSelectedShapes",(e,t)=>{let{selectedShapeIds:r}=this.currentPageState,n=new Set(r);return e.length===n.size&&e.every(e=>n.has(e))?null:{data:{selectedShapeIds:e,prevSelectedShapeIds:r},preservesRedoStack:!0,...t}},{do:({selectedShapeIds:e})=>{this.store.put([{...this.currentPageState,selectedShapeIds:e}])},undo:({prevSelectedShapeIds:e})=>{this.store.put([{...this.currentPageState,selectedShapeIds:e}])},squash:({prevSelectedShapeIds:e},{selectedShapeIds:t})=>({selectedShapeIds:t,prevSelectedShapeIds:e})});isAncestorSelected(e){let t="string"==typeof e?e:e?.id??null,r=this.getShape(t);if(!r)return!1;let{selectedShapeIds:n}=this;return!!this.findShapeAncestor(r,e=>n.includes(e.id))}select(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.setSelectedShapes(t),this}deselect(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id),{selectedShapeIds:r}=this;return r.length>0&&t.length>0&&this.setSelectedShapes(r.filter(e=>!t.includes(e))),this}selectAll(){let e=this.getSortedChildIdsForParent(this.currentPageId);return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.selectedShapeIds.length>0&&this.setSelectedShapes([]),this}get onlySelectedShape(){let{selectedShapes:e}=this;return 1===e.length?e[0]:null}get selectionPageBounds(){let{currentPageState:{selectedShapeIds:e}}=this;return 0===e.length?null:Box2d_Box2d.Common(compact(e.map(e=>this.getShapePageBounds(e))))}get selectionRotation(){let{selectedShapeIds:e}=this;if(0===e.length)return 0;if(1===e.length)return this.getShapePageTransform(this.selectedShapeIds[0]).rotation();let t=e.map(e=>this.getShapePageTransform(e).rotation());return t.every(e=>Math.abs(e-t[0])<Math.PI/180)?this.getShapePageTransform(e[0]).rotation():0}get selectionRotatedPageBounds(){let{selectedShapeIds:e}=this;if(0===e.length)return;let{selectionRotation:t}=this;if(0===t)return this.selectionPageBounds;if(1===e.length){let t=this.getShapeGeometry(e[0]).bounds.clone(),r=this.getShapePageTransform(e[0]);return t.point=r.applyToPoint(t.point),t}let r=Box2d_Box2d.FromPoints(this.selectedShapeIds.flatMap(e=>{let t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).vertices):[]}).map(e=>Vec2d_Vec2d.Rot(e,-t)));return r.point=r.point.rot(t),r}get focusedGroupId(){return this.currentPageState.focusedGroupId??this.currentPageId}get focusedGroup(){let{focusedGroupId:e}=this;return e?this.getShape(e):void 0}setFocusedGroup(e){let t="string"==typeof e?e:e?.id??null;if(null!==t){let e=this.getShape(t);if(!e)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(e,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${e.type}`)}return t===this.focusedGroupId||this._setFocusedGroupId(t),this}_setFocusedGroupId=this.history.createCommand("setFocusedGroupId",e=>{let t=this.currentPageState.focusedGroupId;if(t!==e)return{data:{prev:t,next:e},preservesRedoStack:!0,squashing:!0}},{do:({next:e})=>{this.store.update(this.currentPageState.id,t=>({...t,focusedGroupId:e}))},undo:({prev:e})=>{this.store.update(this.currentPageState.id,t=>({...t,focusedGroupId:e}))},squash:({prev:e},{next:t})=>({prev:e,next:t})});popFocusedGroupId(){let{focusedGroup:e}=this;if(e){let t=this.findShapeAncestor(e,e=>this.isShapeOfType(e,"group"));this.setFocusedGroup(t?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}get editingShapeId(){return this.currentPageState.editingShapeId}get editingShape(){let{editingShapeId:e}=this;return e?this.getShape(e):void 0}setEditingShape(e){let t="string"==typeof e?e:e?.id??null;if(t!==this.editingShapeId){if(t){let e=this.getShape(t);if(e&&this.getShapeUtil(e).canEdit(e))return this._setInstancePageState({editingShapeId:t}),this}this._setInstancePageState({editingShapeId:null})}return this}get hoveredShapeId(){return this.currentPageState.hoveredShapeId}get hoveredShape(){let{hoveredShapeId:e}=this;return e?this.getShape(e):void 0}setHoveredShape(e){let t="string"==typeof e?e:e?.id??null;return t===this.hoveredShapeId||this.updateCurrentPageState({hoveredShapeId:t},{ephemeral:!0}),this}get hintingShapeIds(){return this.currentPageState.hintingShapeIds}get hintingShapes(){let{hintingShapeIds:e}=this;return compact(e.map(e=>this.getShape(e)))}setHintingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.updateCurrentPageState({hintingShapeIds:dedupe(t)},{ephemeral:!0}),this}get erasingShapeIds(){return this.currentPageState.erasingShapeIds}get erasingShapes(){let{erasingShapeIds:e}=this;return compact(e.map(e=>this.getShape(e)))}setErasingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);t.sort();let{erasingShapeIds:r}=this;if(t.length===r.length){for(let e=0;e<t.length;e++)if(t[e]!==r[e]){this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});return this}get croppingShapeId(){return this.currentPageState.croppingShapeId}setCroppingShape(e){let t="string"==typeof e?e:e?.id??null;if(t!==this.croppingShapeId){if(t){let e=this.getShape(t),r=this.getShapeUtil(e);e&&r.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:t})}else this.updateCurrentPageState({croppingShapeId:null})}return this}get cameraId(){return e6.createId(this.currentPageId)}get camera(){return this.store.get(this.cameraId)}get zoomLevel(){return this.camera.z}_setCamera(e){let t=this.camera;return t.x===e.x&&t.y===e.y&&t.z===e.z||this.batch(()=>{this.store.put([{...t,...e}]);let{currentScreenPoint:r}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:r,pointerId:nb.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.instanceState.isPenMode??!1}),this._tickCameraState()}),this}setCamera(e,t){let r=Number.isFinite(e.x)?e.x:0,n=Number.isFinite(e.y)?e.y:0,i=Number.isFinite(e.z)?e.z:this.zoomLevel;if(this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),t){let{width:e,height:o}=this.viewportScreenBounds;return this._animateToViewport(new Box2d_Box2d(-r,-n,e/i,o/i),t)}return this._setCamera({x:r,y:n,z:i}),this}centerOnPoint(e,t){if(!this.instanceState.canMoveCamera)return this;let{viewportPageBounds:{width:r,height:n},camera:i}=this;return this.setCamera({x:-(e.x-r/2),y:-(e.y-n/2),z:i.z},t),this}zoomToContent(){let e=this.selectionPageBounds??this.currentPageBounds;return e&&this.zoomToBounds(e,Math.min(1,this.zoomLevel),{duration:220}),this}zoomToFit(e){if(!this.instanceState.canMoveCamera)return this;let t=[...this.currentPageShapeIds];if(t.length<=0)return this;let r=Box2d_Box2d.Common(compact(t.map(e=>this.getShapePageBounds(e))));return this.zoomToBounds(r,void 0,e),this}resetZoom(e=this.viewportScreenCenter,t){if(!this.instanceState.canMoveCamera)return this;let{x:r,y:n,z:i}=this.camera,{x:o,y:a}=e;return this.setCamera({x:r+(o/1-o)-(o/i-o),y:n+(a/1-a)-(a/i-a),z:1},t),this}zoomIn(e=this.viewportScreenCenter,t){if(!this.instanceState.canMoveCamera)return this;let{x:r,y:n,z:i}=this.camera,o=nd;for(let e=1;e<ns.length;e++){let t=ns[e-1],r=ns[e];if(!(r-i<=(r-t)/2)){o=r;break}}let{x:a,y:l}=e;return this.setCamera({x:r+(a/o-a)-(a/i-a),y:n+(l/o-l)-(l/i-l),z:o},t),this}zoomOut(e=this.viewportScreenCenter,t){if(!this.instanceState.canMoveCamera)return this;let{x:r,y:n,z:i}=this.camera,o=nl;for(let e=ns.length-1;e>0;e--){let t=ns[e-1],r=ns[e];if(!(r-i>=(r-t)/2)){o=t;break}}let{x:a,y:l}=e;return this.setCamera({x:r+(a/o-a)-(a/i-a),y:n+(l/o-l)-(l/i-l),z:o},t),this}zoomToSelection(e){if(!this.instanceState.canMoveCamera)return this;let{selectionPageBounds:t}=this;return t&&this.zoomToBounds(t,Math.max(1,this.zoomLevel),e),this}panZoomIntoView(e,t){if(!this.instanceState.canMoveCamera||e.length<=0)return this;let r=Box2d_Box2d.Common(compact(e.map(e=>this.getShapePageBounds(e)))),{viewportPageBounds:n}=this;if(n.h<r.h||n.w<r.w)this.zoomToBounds(r,this.camera.z,t);else{let e=this.viewportPageBounds.clone().expandBy(-32/this.zoomLevel),n=0,i=0;e.maxY<r.maxY?i=e.maxY-r.maxY:e.minY>r.minY&&(i=e.minY-r.minY),e.maxX<r.maxX?n=e.maxX-r.maxX:e.minX>r.minX&&(n=e.minX-r.minX);let{camera:o}=this;this.setCamera({x:o.x+n,y:o.y+i,z:o.z},t)}return this}zoomToBounds(e,t,r){if(!this.instanceState.canMoveCamera)return this;let{viewportScreenBounds:n}=this,i=Math.min(256,.28*n.width),o=clamp(Math.min((n.width-i)/e.width,(n.height-i)/e.height),nl,nd);return void 0!==t&&(o=Math.min(t,o)),this.setCamera({x:-e.minX+(n.width-e.width*o)/2/o,y:-e.minY+(n.height-e.height*o)/2/o,z:o},r),this}pan(e,t){if(!this.instanceState.canMoveCamera)return this;let{x:r,y:n,z:i}=this.camera;return this.setCamera({x:r+e.x/i,y:n+e.y/i,z:i},t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_viewportAnimation=null;_animateViewport(e){if(!this._viewportAnimation)return;let cancel=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",cancel),this._viewportAnimation=null};this.once("stop-camera-animation",cancel),this._viewportAnimation.elapsed+=e;let{elapsed:t,easing:r,duration:n,start:i,end:o}=this._viewportAnimation;if(t>n){this._setCamera({x:-o.x,y:-o.y,z:this.viewportScreenBounds.width/o.width}),cancel();return}let a=n-t,l=r(1-a/n),d=i.minX+(o.minX-i.minX)*l,c=i.minY+(o.minY-i.minY)*l,u=i.maxX+(o.maxX-i.maxX)*l;this._setCamera({x:-d,y:-c,z:this.viewportScreenBounds.width/(u-d)})}_animateToViewport(e,t={}){let{duration:r=0,easing:n=r3.easeInOutCubic}=t,{user:{animationSpeed:i},viewportPageBounds:o}=this;return(this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),0===r||0===i)?this._setCamera({x:-e.x,y:-e.y,z:this.viewportScreenBounds.width/e.width}):(this._viewportAnimation={elapsed:0,duration:r/i,easing:n,start:o.clone(),end:e.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(e={}){if(!this.instanceState.canMoveCamera)return this;this.stopCameraAnimation();let{animationSpeed:t}=this.user;if(0===t)return this;let{speed:r,friction:n,direction:i,speedThreshold:o=.01}=e,a=Math.min(r,1),cancel=()=>{this.removeListener("tick",moveCamera),this.removeListener("stop-camera-animation",cancel)};this.once("stop-camera-animation",cancel);let moveCamera=e=>{let{x:t,y:r,z:l}=this.camera,d=Vec2d_Vec2d.Mul(i,a*e/l);(a*=1-n)<o?cancel():this._setCamera({x:t+d.x,y:r+d.y,z:l})};return this.addListener("tick",moveCamera),this}animateToUser(e){let t=this.store.query.records("instance_presence",()=>({userId:{eq:e}})),r=[...t.value].sort((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp).pop();return r&&this.batch(()=>{null!==this.instanceState.followingUserId&&this.stopFollowingUser();let t=r.currentPageId===this.currentPageId;t||this.setCurrentPage(r.currentPageId),this.centerOnPoint(r.cursor,t?{duration:500}:void 0);let{highlightedUserIds:n}=this.instanceState;this.updateInstanceState({highlightedUserIds:[...n,e]}),setTimeout(()=>{let t=[...this.instanceState.highlightedUserIds],r=t.indexOf(e);r<0||(t.splice(r,1),this.updateInstanceState({highlightedUserIds:t}))},3e3)}),this}animateToShape(e,t=ng){if(!this.instanceState.canMoveCamera)return this;let r=this.viewportScreenBounds.clone().expandBy(-32),n=r.width/r.height,i=this.getShapePageBounds(e);if(!i)return this;let o=i.width/i.height,a=i.clone(),l=i.width/r.width;return a.width+=(r.minX+r.maxX)*l,a.height+=(r.minY+r.maxY)*l,a.x-=r.minX*l,a.y-=r.minY*l,o>n?(a.height=i.width/n,a.y-=(a.height-i.height)/2):(a.width=i.height*n,a.x-=(a.width-i.width)/2),this._animateToViewport(a,t)}_willSetInitialBounds=!0;updateViewportScreenBounds(e=!1){let t=this.getContainer();if(!t)return this;let r=t.getBoundingClientRect(),n=new Box2d_Box2d(r.left||r.x,r.top||r.y,Math.max(r.width,1),Math.max(r.height,1)),i=n.equals(this.viewportScreenBounds),{_willSetInitialBounds:o}=this;if(i)this._willSetInitialBounds=!1;else if(o)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:n.toJson()},{squashing:!0,ephemeral:!0});else if(e&&!this.instanceState.followingUserId){let e=this.viewportPageCenter;this.updateInstanceState({screenBounds:n.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(e)}else this.updateInstanceState({screenBounds:n.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}get viewportScreenBounds(){let{x:e,y:t,w:r,h:n}=this.instanceState.screenBounds;return new Box2d_Box2d(e,t,r,n)}get viewportScreenCenter(){return this.viewportScreenBounds.center}get viewportPageBounds(){let{w:e,h:t}=this.viewportScreenBounds,{x:r,y:n,z:i}=this.camera;return new Box2d_Box2d(-r,-n,e/i,t/i)}get viewportPageCenter(){return this.viewportPageBounds.center}screenToPage(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(tg),{x:r,y:n,z:i=1}=this.camera;return{x:(e.x-t.x)/i-r,y:(e.y-t.y)/i-n,z:e.z??.5}}pageToScreen(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(tg),{x:r,y:n,z:i=1}=this.camera;return{x:(e.x+r)*i+t.x,y:(e.y+n)*i+t.y,z:e.z??.5}}startFollowingUser(e){let t=this.store.query.records("instance_presence",()=>({userId:{eq:e}})),r=this.user.id;if(r||console.warn("You should set the userId for the current instance before following a user"),t.value.some(e=>e.followingUserId===r))return this;transact(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:e},{ephemeral:!0})});let cancel=()=>{this.removeListener("frame",moveTowardsUser),this.removeListener("stop-following",cancel)},n=!1,moveTowardsUser=()=>{let i=[...t.value].sort((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp).pop();if(!i){this.stopFollowingUser();return}let o=i.currentPageId===this.currentPageId,a=o?.5:1;if(!o){this.stopFollowingUser(),this.setCurrentPage(i.currentPageId),this.startFollowingUser(e);return}let{center:l,width:d,height:c}=this.viewportPageBounds,u=Box2d_Box2d.From(i.screenBounds),p=u.width/i.camera.z,h=u.height/i.camera.z,f=new Vec2d_Vec2d(p/2-i.camera.x,h/2-i.camera.y),g=i.followingUserId===r,m=d+(p-d)*a,y=c+(h-c)*a,b=clamp(this.camera.z*(g?c/y:Math.min(d/m,c/y)),nl,nd),v=this.viewportScreenBounds.w/b,S=this.viewportScreenBounds.h/b,x=f.sub(l),w=Vec2d_Vec2d.Add(l,Vec2d_Vec2d.Mul(x,a)),_=Vec2d_Vec2d.Sub(w,l).len(),P=Math.abs(b-this.camera.z);if(_<.1&&P<.005){n=!0;return}n&&_<.2&&P<.05||(n=!1,this.stopCameraAnimation(),this._setCamera({x:-(w.x-v/2),y:-(w.y-S/2),z:b}))};return this.once("stop-following",cancel),this.addListener("frame",moveTowardsUser),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}_cameraState=Atom_atom("camera state","idle");get cameraState(){return this._cameraState.value}_cameraStateTimeoutRemaining=0;_lastUpdateRenderingBoundsTimestamp=Date.now();_decayCameraStateTimeout=e=>{this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())};_tickCameraState=()=>{this._cameraStateTimeoutRemaining=64;let e=Date.now();"idle"===this._cameraState.__unsafe__getWithoutCapture()?(this._lastUpdateRenderingBoundsTimestamp=e,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):e-this._lastUpdateRenderingBoundsTimestamp>620&&this.updateRenderingBounds()};getUnorderedRenderingShapes(e){let t=[],r=2*nn,n=nn,i=this.editingShapeId,o=this.selectedShapeIds,a=this.erasingShapeIds,l=this.renderingBoundsExpanded,d=Number.isFinite(this.renderingBoundsMargin),addShapeById=(c,u,p)=>{let h=this.getShape(c);if(!h)return;u*=h.opacity;let f=!1,g=!1,m=this.getShapeUtil(h),y=this.getShapeMaskedPageBounds(c);e&&((g=!p&&a.includes(c))&&(u*=.32),f=d&&m.canUnmount(h)&&i!==c&&(void 0===y||!l.includes(y)&&!o.includes(c))),t.push({id:c,shape:h,util:m,index:r,backgroundIndex:n,opacity:u,isCulled:f,maskedPageBounds:y}),r+=1,n+=1;let b=this.getSortedChildIdsForParent(c);if(!b.length)return;let v=null;for(let e of(m.providesBackgroundForChildren(h)&&(v=n,n=r,r+=nn),b))addShapeById(e,u,p||g);null!==v&&(n=v)};for(let e of this.getSortedChildIdsForParent(this.currentPageId))addShapeById(e,1,!1);return t}get renderingShapes(){let e=this.getUnorderedRenderingShapes(!0);return e.sort(sortById)}get renderingBounds(){return this._renderingBounds.value}_renderingBounds=Atom_atom("rendering viewport",new Box2d_Box2d);get renderingBoundsExpanded(){return this._renderingBoundsExpanded.value}_renderingBoundsExpanded=Atom_atom("rendering viewport expanded",new Box2d_Box2d);updateRenderingBounds(){let{viewportPageBounds:e}=this;return e.equals(this._renderingBounds.__unsafe__getWithoutCapture())||(this._renderingBounds.set(e.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(e.clone().expandBy(this.renderingBoundsMargin/this.zoomLevel)):this._renderingBoundsExpanded.set(e)),this}renderingBoundsMargin=100;get _pages(){return this.store.query.records("page")}get pages(){return this._pages.value.sort(reordering_sortByIndex)}get currentPage(){let e=this.getPage(this.currentPageId);return e}get currentPageId(){return this.instanceState.currentPageId}getPage(e){return this.store.get("string"==typeof e?e:e.id)}_currentPageShapeIds;get currentPageShapeIds(){return this._currentPageShapeIds.value}getPageShapeIds(e){let t="string"==typeof e?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(r.map(e=>e.id))}setCurrentPage(e,t){let r="string"==typeof e?e:e.id;return this._setCurrentPageId(r,t),this}_setCurrentPageId=this.history.createCommand("setCurrentPage",(e,t)=>{if(!this.store.has(e)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:e,fromId:this.currentPageId},squashing:!0,preservesRedoStack:!0,...t}},{do:({toId:e})=>{if(this.store.has(e)){if(!this.pageStates.find(t=>t.pageId===e)){let t=e6.create({id:e6.createId(e)});this.store.put([t,tx.create({id:tx.createId(e),pageId:e})])}this.store.put([{...this.instanceState,currentPageId:e}]),this.updateRenderingBounds()}},undo:({fromId:e})=>{this.store.has(e)&&(this.store.put([{...this.instanceState,currentPageId:e}]),this.updateRenderingBounds())},squash:({fromId:e},{toId:t})=>({toId:t,fromId:e})});updatePage(e,t){return this._updatePage(e,t),this}_updatePage=this.history.createCommand("updatePage",(e,t)=>{if(this.instanceState.isReadonly)return null;let r=this.getPage(e.id);return r?{data:{prev:r,partial:e},...t}:null},{do:({partial:e})=>{this.store.update(e.id,t=>({...t,...e}))},undo:({prev:e,partial:t})=>{this.store.update(t.id,()=>e)},squash:(e,t)=>({prev:{...e.prev,...t.prev},partial:t.partial})});createPage(e){return this._createPage(e),this}_createPage=this.history.createCommand("createPage",e=>{if(this.instanceState.isReadonly||this.pages.length>=ni)return null;let{pages:t}=this,r=getIncrementedName(e.name??"Page",t.map(e=>e.name)),n=e.index;(!n||t.some(e=>e.index===n))&&(n=getIndexAbove(t[t.length-1].index));let i=tp.create({meta:{},...e,name:r,index:n}),o=e6.create({id:e6.createId(i.id)}),a=tx.create({id:tx.createId(i.id),pageId:i.id});return{data:{newPage:i,newTabPageState:a,newCamera:o}}},{do:({newPage:e,newTabPageState:t,newCamera:r})=>{this.store.put([e,r,t])},undo:({newPage:e,newTabPageState:t,newCamera:r})=>{1!==this.pages.length&&this.store.remove([t.id,e.id,r.id])}});deletePage(e){let t="string"==typeof e?e:e.id;return this._deletePage(t),this}_deletePage=this.history.createCommand("delete_page",e=>{if(this.instanceState.isReadonly)return null;let{pages:t}=this;if(1===t.length)return null;let r=this.getPage(e),n=this.pageStates.filter(t=>t.pageId===e);if(!r)return null;if(e===this.currentPageId){let r=t.findIndex(t=>t.id===e),n=t[r-1]??t[r+1];this.setCurrentPage(n.id)}return{data:{id:e,deletedPage:r,deletedPageStates:n}}},{do:({deletedPage:e,deletedPageStates:t})=>{let{pages:r}=this;if(1!==r.length){if(e.id===this.currentPageId){let t=r.findIndex(t=>t.id===e.id),n=r[t-1]??r[t+1];this.setCurrentPage(n.id)}this.store.remove(t.map(e=>e.id)),this.store.remove([e.id]),this.updateRenderingBounds()}},undo:({deletedPage:e,deletedPageStates:t})=>{this.store.put([e]),this.store.put(t),this.updateRenderingBounds()}});duplicatePage(e,t=tp.createId()){if(this.pages.length>=ni)return this;let r="string"==typeof e?e:e.id,n=this.getPage(r);if(!n)return this;let i={...this.camera},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(n.id));return this.batch(()=>{let{pages:e}=this,r=getIndexBetween(n.index,e[e.indexOf(n)+1]?.index);if(this.createPage({name:n.name+" Copy",id:t,index:r}),this.setCurrentPage(t),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t,r){let n="string"==typeof e?e:e.id;return this.instanceState.isReadonly||this.updatePage({id:n,name:t},r),this}get _assets(){return this.store.query.records("asset")}get assets(){return this._assets.value}createAssets(e){return this._createAssets(e),this}_createAssets=this.history.createCommand("createAssets",e=>this.instanceState.isReadonly||e.length<=0?null:{data:{assets:e}},{do:({assets:e})=>{this.store.put(e)},undo:({assets:e})=>{this.store.remove(e.map(e=>e.id))}});updateAssets(e){return this._updateAssets(e),this}_updateAssets=this.history.createCommand("updateAssets",e=>{if(!this.instanceState.isReadonly&&!(e.length<=0))return{data:{snapshots:{},assets:e}}},{do:({assets:e,snapshots:t})=>{this.store.put(e.map(e=>{let r=this.store.get(e.id);return t[e.id]=r,{...r,...e}}))},undo:({snapshots:e})=>{this.store.put(Object.values(e))}});deleteAssets(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this._deleteAssets(t),this}_deleteAssets=this.history.createCommand("deleteAssets",e=>{if(this.instanceState.isReadonly||e.length<=0)return;let t=compact(e.map(e=>this.store.get(e)));return{data:{ids:e,prev:t}}},{do:({ids:e})=>{this.store.remove(e)},undo:({prev:e})=>{this.store.put(e)}});getAsset(e){return this.store.get("string"==typeof e?e:e.id)}get _shapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._shapeGeometryCache.get("string"==typeof e?e:e.id)}get _shapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",e=>this.getShapeUtil(e).getOutlineSegments(e))}getShapeOutlineSegments(e){return this._shapeOutlineSegmentsCache.get("string"==typeof e?e:e.id)??ev}get _shapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e))}getShapeHandles(e){return this._shapeHandlesCache.get("string"==typeof e?e:e.id)}getShapeLocalTransform(e){let t="string"==typeof e?e:e.id,r=this.getShape(t);if(!r)throw Error("Editor.getTransform: shape not found");return Matrix2d.Identity().translate(r.x,r.y).rotate(r.rotation)}get _shapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(isPageId(e.parentId))return this.getShapeLocalTransform(e);let t=this._shapePageTransformCache.get(e.parentId)??Matrix2d.Identity();return Matrix2d.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){let t="string"==typeof e?e:e.id,r=this.getShape(t);return!r||isPageId(r.parentId)?Matrix2d.Identity():this._shapePageTransformCache.get(r.parentId)??Matrix2d.Identity()}getShapePageTransform(e){let t="string"==typeof e?e:this.getShape(e).id;return this._shapePageTransformCache.get(t)??Matrix2d.Identity()}get _shapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{let t=this._shapePageTransformCache.get(e.id);if(!t)return new Box2d_Box2d;let r=Box2d_Box2d.FromPoints(Matrix2d.applyToPoints(t,this.getShapeGeometry(e).vertices));return r})}getShapePageBounds(e){return this._shapePageBoundsCache.get("string"==typeof e?e:e.id)}get _shapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{let t=this._shapeMaskCache.get(e.id);if(!t)return;let r=this._shapePageTransformCache.get(e.id);if(!r)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";let n=Matrix2d.applyToPoints(Matrix2d.Inverse(r),t);return`polygon(${n.map(e=>`${e.x}px ${e.y}px`).join(",")})`})}getShapeClipPath(e){return this._shapeClipPathCache.get("string"==typeof e?e:e.id)}get _shapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(isPageId(e.parentId))return;let t=this.getShapeAncestors(e.id).filter(e=>this.isShapeOfType(e,"frame"));if(0===t.length)return;let r=t.map(e=>this._shapePageTransformCache.get(e.id).applyToPoints(this.getShapeGeometry(e).vertices)).reduce((e,t)=>{if(!(t&&e))return;let r=intersectPolygonPolygon(e,t);return r?r.map(Vec2d_Vec2d.Cast):[]});return r})}getShapeMask(e){return this._shapeMaskCache.get("string"==typeof e?e:e.id)}getShapeMaskedPageBounds(e){"string"!=typeof e&&(e=e.id);let t=this._shapePageBoundsCache.get(e);if(!t)return;let r=this._shapeMaskCache.get(e);if(r){let e=intersectPolygonPolygon(r,t.corners);if(!e)return;return Box2d_Box2d.FromPoints(e)}return t}getShapeAncestors(e,t=[]){let r="string"==typeof e?e:e.id,n=this.getShape(r);if(!n)return t;let i=n.parentId;if(isPageId(i))return t.reverse(),t;let o=this.store.get(i);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){let r="string"==typeof e?e:e.id,n=this.getShape(r);if(!n)return;let i=n.parentId;if(isPageId(i))return;let o=this.getShape(i);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){let r="string"==typeof e?e:e?.id,n=r&&this.getShape(r);return!!n&&(n.parentId===t||this.hasAncestor(this.getShapeParent(n),t))}findCommonAncestor(e,t){if(0===e.length)return;let r="string"==typeof e[0]?e:e.map(e=>e.id),n=compact(r.map(e=>this.getShape(e)));if(1===n.length){let e=n[0].parentId;if(isPageId(e))return;return t?this.findShapeAncestor(n[0],t)?.id:e}let[i,...o]=n,a=this.getShapeParent(i);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(o.every(e=>this.hasAncestor(e,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){let t="string"==typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}get currentPageBounds(){let e;return this.currentPageShapeIds.forEach(t=>{let r=this.getShapeMaskedPageBounds(t);r&&(e=e?e.expand(r):r.clone())}),e}getSelectedShapeAtPoint(e){let{selectedShapeIds:t}=this;return this.currentPageShapesSorted.filter(e=>"group"!==e.type&&t.includes(e.id)).reverse().find(t=>this.isPointInShape(t,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){let{viewportPageBounds:r,zoomLevel:n}=this,{filter:i,margin:o=0,hitLabels:a=!1,hitInside:l=!1,hitFrameInside:d=!1}=t,c=1/0,u=null,p=1/0,h=null,f=(t.renderingOnly?this.currentPageRenderingShapesSorted:this.currentPageShapesSorted).filter(t=>{if(this.isShapeOfType(t,"group"))return!1;let r=this.getShapeMask(t);return(!r||!!pointInPolygon(e,r))&&(!i||i(t))});for(let t=f.length-1;t>=0;t--){let i;let g=f[t],m=this.getShapeGeometry(g),y=m instanceof Group2d,b=this.getPointInShapeSpace(g,e);if((this.isShapeOfType(g,"arrow")||this.isShapeOfType(g,"geo")&&"none"===g.props.fill)&&g.props.text.trim()){for(let e of m.children)if(e.isLabel&&e.isPointInBounds(b))return g}if(this.isShapeOfType(g,"frame")){let e=m.distanceToPoint(b,l);if(Math.abs(e)<=o)return h||g;if(m.hitTestPoint(b,0,!0))return h||u||(d?g:void 0);continue}if(y){let e=1/0;for(let t of m.children){if(t.isLabel&&!a)continue;let r=t.distanceToPoint(b,l);r<e&&(e=r)}i=e}else i=0===o&&(m.bounds.w<1||m.bounds.h<1)?m.distanceToPoint(b,l):m.bounds.containsPoint(b,o)?m.distanceToPoint(b,l):1/0;if(m.isClosed){if(i<=o){if(m.isFilled||y&&m.children[0].isFilled)return h||g;if(this.getShapePageBounds(g).contains(r))continue;if(Math.abs(i)<o)Math.abs(i)<p&&(p=Math.abs(i),h=g);else if(!h){let{area:e}=m;e<c&&(c=e,u=g)}}}else if(i<nv/n)return g}return h||u||void 0}getShapesAtPoint(e,t={}){return this.currentPageShapes.filter(r=>this.isPointInShape(r,e,t))}isPointInShape(e,t,r={}){let{hitInside:n=!1,margin:i=0}=r,o="string"==typeof e?e:e.id,a=this.getShapeMask(o);return(!a||!!pointInPolygon(t,a))&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),i,n)}getPointInShapeSpace(e,t){let r="string"==typeof e?e:e.id;return this._shapePageTransformCache.get(r).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){let r="string"==typeof e?e:e.id,n=this.getShape(r);if(!n)return new Vec2d_Vec2d(0,0);if(isPageId(n.parentId))return Vec2d_Vec2d.From(t);let i=this.getShapePageTransform(n.parentId);return i?i.clone().invert().applyToPoint(t):Vec2d_Vec2d.From(t)}get currentPageShapes(){return Array.from(this.currentPageShapeIds,e=>this.store.get(e))}get currentPageShapesSorted(){let e=new Set(this.currentPageShapes.sort(reordering_sortByIndex)),t=[];function pushShapeWithDescendants(r){t.push(r),e.delete(r),e.forEach(e=>{e.parentId===r.id&&pushShapeWithDescendants(e)})}return e.forEach(e=>{let t=this.getShape(e.parentId);isShape(t)||pushShapeWithDescendants(e)}),t}get currentPageRenderingShapesSorted(){return this.renderingShapes.filter(({isCulled:e})=>!e).sort((e,t)=>e.index-t.index).map(({shape:e})=>e)}isShapeOfType(e,t){let r="string"==typeof e?this.getShape(e):e;return r.type===t}getShape(e){let t="string"==typeof e?e:e.id;if(isShapeId(t))return this.store.get(t)}getShapeParent(e){let t="string"==typeof e?e:e?.id;if(!t)return;let r=this.getShape(t);if(void 0!==r&&isShapeId(r.parentId))return this.store.get(r.parentId)}getShapeNearestSibling(e,t){if(!t)return;if(t.parentId===e.parentId)return t;let r=this.findShapeAncestor(t,t=>t.parentId===e.parentId);return r}isShapeInPage(e,t=this.currentPageId){let r="string"==typeof e?e:e.id,n=this.getShape(r);if(!n)return!1;let i=!1;if(n.parentId===t)i=!0;else{let e=this.getShape(n.parentId);for(;e;){if(e.parentId===t){i=!0;break}e=this.getShape(e.parentId)}}return i}getAncestorPageId(e){let t="string"==typeof e?e:e?.id,r=t&&this.getShape(t);if(r)return isPageId(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}_parentIdsToChildIds;reparentShapes(e,t,r){let n="string"==typeof e[0]?e:e.map(e=>e.id),i=[],o=isPageId(t)?Matrix2d.Identity():this.getShapePageTransform(t),a=o.rotation(),l=[],d=compact(this.getSortedChildIdsForParent(t).map(e=>this.getShape(e)));if(r){let e=d.find(e=>e.index===r);if(e){let t=d[d.indexOf(e)+1];l=t?generateNKeysBetween(r,t.index,n.length):getIndicesAbove(r,n.length)}else{let e=d.sort(reordering_sortByIndex).find(e=>e.index>r);l=e?generateNKeysBetween(r,e.index,n.length):getIndicesAbove(r,n.length)}}else{let e=d.length&&d[d.length-1];l=e?getIndicesAbove(e.index,n.length):getIndices(n.length)}let c=o.clone().invert(),u=compact(n.map(e=>this.getShape(e))),p=u.filter(e=>e.isLocked);p.length&&this.updateShapes(p.map(({id:e,type:t})=>({id:e,type:t,isLocked:!1})));for(let e=0;e<u.length;e++){let r=u[e],n=this.getShapePageTransform(r);if(!n)continue;let o=n.point();if(!o)continue;let d=c.applyToPoint(o),p=n.rotation()-a;i.push({id:r.id,type:r.type,parentId:t,x:d.x,y:d.y,rotation:p,index:l[e],isLocked:r.isLocked})}return this.updateShapes(i),this}getHighestIndexForParent(e){let t="string"==typeof e?e:e.id,r=this._parentIdsToChildIds.value[t];if(!r||0===r.length)return"a1";let n=this.getShape(r[r.length-1]);return getIndexAbove(n.index)}_childIdsCache=new WeakMapCache;getSortedChildIdsForParent(e){let t="string"==typeof e?e:e.id,r=this._parentIdsToChildIds.value[t];return r?this._childIdsCache.get(r,()=>r):ev}visitDescendants(e,t){let r="string"==typeof e?e:e.id,n=this.getSortedChildIdsForParent(r);for(let e of n)!1!==t(e)&&this.visitDescendants(e,t);return this}getShapeAndDescendantIds(e){let t=new Set,r=[...e];for(;r.length>0;){let e=r.pop();if(!e)break;if(!t.has(e))for(let n of(t.add(e),this.getSortedChildIdsForParent(e)))r.push(n)}return t}getDroppingOverShape(e,t=[]){let{currentPageShapesSorted:r}=this;for(let n=r.length-1;n>=0;n--){let i=r[n];if(!this.getShapeUtil(i).canDropShapes(i,t)||t.find(e=>e.id===i.id||this.hasAncestor(i,e.id)))continue;let o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,t){let r="string"==typeof e?e:e.id,n=this.getShape(r),i=n,o=n,{focusedGroup:a}=this;for(;o;){if(this.isShapeOfType(o,"group")&&a?.id!==o.id&&!this.hasAncestor(a,o.id)&&(t?.(o)??!0))i=o;else if(a?.id===o.id)break;o=this.getShapeParent(o)}return i}rotateShapesBy(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(r.length<=0)return this;let n=getRotationSnapshot({editor:this});return n&&applyRotationToSnapshotShapes({delta:t,snapshot:n,editor:this,stage:"one-off"}),this}nudgeShapes(e,t,r){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(n.length<=0)return this;let i=[];for(let e of n){let r=this.getShape(e);if(!r)throw Error(`Could not find a shape with the id ${e}.`);let n=Vec2d_Vec2d.Cast(t),o=this.getShapeParentTransform(r);o&&n.rot(-o.rotation());let a=this.getShapeUtil(r).onTranslateStart?.(r);i.push(a?{...a,x:r.x+n.x,y:r.y+n.y}:{id:e,x:r.x+n.x,y:r.y+n.y,type:r.type})}return this.updateShapes(i,{squashing:!0,...r}),this}duplicateShapes(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(r.length<=0)return this;let n=new Set(r),i=[],o=[...r];for(;o.length>0;){let e=o.pop();if(!e)break;i.push(e),this.getSortedChildIdsForParent(e).forEach(e=>o.push(e))}i.reverse();let a=new Map(i.map(e=>[e,createShapeId()])),l=compact(i.map(e=>{let r=this.getShape(e);if(!r)return null;let i=a.get(e),o=0,l=0;if(t&&n.has(e)){let e=this.getShapeParentTransform(r),n=new Vec2d_Vec2d(t.x,t.y).rot(-e.rotation());o=n.x,l=n.y}let d=r.parentId??this.currentPageId,c=this.getSortedChildIdsForParent(d),u=c.indexOf(r.id),p=c[u+1],h=p?this.getShape(p):null,f=h?getIndexBetween(r.index,h.index):getIndexAbove(r.index),g=deepCopy(r);if(this.isShapeOfType(r,"arrow")&&this.isShapeOfType(g,"arrow")){let e,t;let n=this.getArrowInfo(r);if("binding"===r.props.start.type&&!(e=a.get(r.props.start.boundShapeId))){if(n?.isValid){let{x:e,y:t}=n.start.point;g.props.start={type:"point",x:e,y:t}}else{let{start:e}=getArrowTerminalsInArrowSpace(this,r);g.props.start={type:"point",x:e.x,y:e.y}}}if("binding"===r.props.end.type&&!(t=a.get(r.props.end.boundShapeId))){if(n?.isValid){let{x:e,y:t}=n.end.point;g.props.end={type:"point",x:e,y:t}}else{let{end:e}=getArrowTerminalsInArrowSpace(this,r);g.props.start={type:"point",x:e.x,y:e.y}}}let i=getIsArrowStraight(g)?getStraightArrowInfo(this,g):getCurvedArrowInfo(this,g);if(n?.isValid&&i?.isValid&&!getIsArrowStraight(r)){let e=Vec2d_Vec2d.Med(n.start.handle,n.end.handle),t=Vec2d_Vec2d.Dist(n.middle,e),r=Vec2d_Vec2d.Dist(i.middle,e);g.props.bend<0?g.props.bend+=r-t:g.props.bend-=r-t}"binding"===g.props.start.type&&e&&(g.props.start.boundShapeId=e),"binding"===g.props.end.type&&t&&(g.props.end.boundShapeId=t)}return{...g,id:i,x:r.x+o,y:r.y+l,index:f}}));return l.forEach(e=>{isShapeId(e.parentId)&&a.has(e.parentId)&&(e.parentId=a.get(e.parentId))}),this.history.batch(()=>{let e=l.length+this.currentPageShapeIds.size>nn;e&&alertMaxShapes(this);let r=e?l.slice(0,nn-this.currentPageShapeIds.size):l,n=r.map(e=>e.id);if(this.createShapes(r),this.setSelectedShapes(n),void 0!==t){let{viewportPageBounds:e,selectionPageBounds:t}=this;t&&!e.contains(t)&&this.centerOnPoint(t.center,{duration:na})}}),this}moveShapesToPage(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(0===r.length||this.instanceState.isReadonly)return this;let{currentPageId:n}=this;if(t===n||!this.store.has(t))return this;let i=this.getContentFromCurrentPage(r);if(!i)return this;if(this.getPageShapeIds(t).size+i.shapes.length>nn)return alertMaxShapes(this,t),this;let o=this.camera.z;return this.history.batch(()=>{this.deleteShapes(r),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.camera,z:o}),this.centerOnPoint(this.selectionRotatedPageBounds.center)}),this}toggleLock(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||0===t.length)return this;let r=!0,n=!0,i=[];for(let e of t){let t=this.getShape(e);t&&(i.push(t),t.isLocked?n=!1:r=!1)}return this.batch(()=>{n?(this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!1}))):this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0})))}),this}sendToBack(e){let t="string"==typeof e[0]?e:e.map(e=>e.id),r=getReorderingShapesChanges(this,"toBack",t);return r&&this.updateShapes(r),this}sendBackward(e){let t="string"==typeof e[0]?e:e.map(e=>e.id),r=getReorderingShapesChanges(this,"backward",t);return r&&this.updateShapes(r),this}bringForward(e){let t="string"==typeof e[0]?e:e.map(e=>e.id),r=getReorderingShapesChanges(this,"forward",t);return r&&this.updateShapes(r),this}bringToFront(e){let t="string"==typeof e[0]?e:e.map(e=>e.id),r=getReorderingShapesChanges(this,"toFront",t);return r&&this.updateShapes(r),this}flipShapes(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly)return this;let n=compact(r.map(e=>this.getShape(e)));if(!n.length)return this;n=compact(n.map(e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map(e=>this.getShape(e)):e).flat());let i=Box2d_Box2d.Common(compact(n.map(e=>this.getShapePageBounds(e)))).center;return this.batch(()=>{for(let e of n){let r=this.getShapeGeometry(e).bounds,n=this.getShapePageTransform(e.id);n&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:r,initialPageTransform:n,initialShape:e,mode:"scale_shape",scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,t,r){let n,i,o,a,l;let d="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly)return this;let c=compact(d.map(e=>this.getShape(e)).filter(e=>!(!e||this.isShapeOfType(e,"arrow")&&("binding"===e.props.start.type||"binding"===e.props.end.type)))),u=c.length;if(0===r&&u<3||u<2)return this;let p=Object.fromEntries(c.map(e=>[e.id,this.getShapePageBounds(e)]));if("horizontal"===t?(n="x",i="minX",o="maxX",a="width"):(n="y",i="minY",o="maxY",a="height"),0===r){let e=[];c.sort((e,t)=>p[e.id][i]-p[t.id][i]);for(let t=0;t<u-1;t++){let r=c[t],n=c[t+1],a=p[r.id],l=p[n.id],d=l[i]-a[o],u=e.find(e=>e.gap===d);u?u.count++:e.push({gap:d,count:1})}let t=0;e.forEach(e=>{e.count>t&&(t=e.count,l=e.gap)}),1===t&&(l=Math.max(0,e.reduce((e,t)=>e+t.gap*t.count,0)/(u-1)))}else l=r;let h=[],f=p[c[0].id][o];return c.forEach((e,t)=>{if(0===t)return;let r={x:0,y:0};r[n]=f+l-p[e.id][n];let i=this.getShapeParent(e),o=i?Vec2d_Vec2d.Rot(r,-this.getShapePageTransform(i).decompose().rotation):r,d=this.getShapeUtil(e).onTranslateStart?.(e);h.push(d?{...d,[n]:e[n]+o[n]}:{id:e.id,type:e.type,[n]:e[n]+o[n]}),f+=p[e.id][a]+l}),this.updateShapes(h),this}packShapes(e,t){let r,n,i;let o="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||o.length<2)return this;let a=compact(o.map(e=>this.getShape(e)).filter(e=>!(!e||this.isShapeOfType(e,"arrow")&&("binding"===e.props.start.type||"binding"===e.props.end.type)))),l={},d={},c,u,p=0;for(let e=0;e<a.length;e++)c=a[e],u=this.getShapePageBounds(c),l[c.id]=u,d[c.id]=u.clone(),p+=u.width*u.height;let h=Box2d_Box2d.Common(compact(Object.values(l))),f=h.width;a.sort((e,t)=>l[t.id].height-l[e.id].height);let g=Math.max(Math.ceil(Math.sqrt(p/.95)),f),m=[new Box2d_Box2d(h.x,h.y,g,1/0)],y=0,b=0;for(let e=0;e<a.length;e++){u=d[(c=a[e]).id];for(let e=m.length-1;e>=0;e--)if(r=m[e],!(u.width>r.width)&&!(u.height>r.height)){u.x=r.x,u.y=r.y,b=Math.max(b,u.maxY),y=Math.max(y,u.maxX),u.width===r.width&&u.height===r.height?(n=m.pop(),e<m.length&&(m[e]=n)):u.height===r.height?(r.x+=u.width+t,r.width-=u.width+t):(u.width===r.width||m.push(new Box2d_Box2d(r.x+(u.width+t),r.y,r.width-(u.width+t),u.height)),r.y+=u.height+t,r.height-=u.height+t);break}}let v=Box2d_Box2d.Common(Object.values(d)),S=Vec2d_Vec2d.Sub(h.center,v.center),x=[];for(let e=0;e<a.length;e++){u=l[(c=a[e]).id],i=d[c.id];let t=Vec2d_Vec2d.Sub(i.point,u.point).add(S),r=this.getShapeParentTransform(c);r&&t.rot(-r.rotation());let n={id:c.id,type:c.type,x:c.x+t.x,y:c.y+t.y},o=this.getShapeUtil(c).onTranslateStart?.({...c,...n});o?x.push({...n,...o}):x.push(n)}return x.length&&this.updateShapes(x),this}alignShapes(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||r.length<2)return this;let n=compact(r.map(e=>this.getShape(e))),i=Object.fromEntries(n.map(e=>[e.id,this.getShapePageBounds(e)])),o=Box2d_Box2d.Common(compact(Object.values(i))),a=[];return n.forEach(e=>{let r=i[e.id];if(!r)return;let n={x:0,y:0};switch(t){case"top":n.y=o.minY-r.minY;break;case"center-vertical":n.y=o.midY-r.minY-r.height/2;break;case"bottom":n.y=o.maxY-r.minY-r.height;break;case"left":n.x=o.minX-r.minX;break;case"center-horizontal":n.x=o.midX-r.minX-r.width/2;break;case"right":n.x=o.maxX-r.minX-r.width}let l=this.getShapeParent(e),d=l?Vec2d_Vec2d.Rot(n,-this.getShapePageTransform(l).decompose().rotation):n,c=this.getShapeUtil(e).onTranslateStart?.(e);a.push(c?{...c,x:e.x+d.x,y:e.y+d.y}:{id:e.id,type:e.type,x:e.x+d.x,y:e.y+d.y})}),this.updateShapes(a),this}distributeShapes(e,t){let r,n,i,o,a;let l="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||l.length<3)return this;let d=l.length,c=compact(l.map(e=>this.getShape(e))),u=Object.fromEntries(c.map(e=>[e.id,this.getShapePageBounds(e)]));"horizontal"===t?(r="x",n="minX",i="maxX",o="midX",a="width"):(r="y",n="minY",i="maxY",o="midY",a="height");let p=[],h=c.sort((e,t)=>u[e.id][n]-u[t.id][n])[0],f=c.sort((e,t)=>u[t.id][i]-u[e.id][i])[0],g=u[h.id][o],m=(u[f.id][o]-g)/(d-1),y=g+m;return c.filter(e=>e!==h&&e!==f).sort((e,t)=>u[e.id][o]-u[t.id][o]).forEach((e,t)=>{let n={x:0,y:0};n[r]=y+m*t-u[e.id][a]/2-u[e.id][r];let i=this.getShapeParent(e),o=i?Vec2d_Vec2d.Rot(n,-this.getShapePageTransform(i).rotation()):n,l=this.getShapeUtil(e).onTranslateStart?.(e);p.push(l?{...l,[r]:e[r]+o[r]}:{id:e.id,type:e.type,[r]:e[r]+o[r]})}),this.updateShapes(p),this}stretchShapes(e,t){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||r.length<2)return this;let n=compact(r.map(e=>this.getShape(e))),i=Object.fromEntries(r.map(e=>[e,this.getShapeGeometry(e).bounds])),o=Object.fromEntries(r.map(e=>[e,this.getShapePageBounds(e)])),a=Box2d_Box2d.Common(compact(Object.values(o)));switch(t){case"vertical":this.batch(()=>{for(let e of n){let t=this.getShapePageTransform(e).rotation();if(t%r9)continue;let r=i[e.id],n=o[e.id],l=new Vec2d_Vec2d(0,a.minY-n.minY),d=this.getShapeParentTransform(e);d&&l.rot(-d.rotation());let{x:c,y:u}=Vec2d_Vec2d.Add(l,e);this.updateShapes([{id:e.id,type:e.type,x:c,y:u}],{squashing:!0});let p=new Vec2d_Vec2d(1,a.height/n.height);this.resizeShape(e.id,p,{initialBounds:r,scaleOrigin:new Vec2d_Vec2d(n.center.x,a.minY),scaleAxisRotation:0})}});break;case"horizontal":this.batch(()=>{for(let e of n){let t=i[e.id],r=o[e.id],n=this.getShapePageTransform(e).rotation();if(n%r9)continue;let l=new Vec2d_Vec2d(a.minX-r.minX,0),d=this.getShapeParentTransform(e);d&&l.rot(-d.rotation());let{x:c,y:u}=Vec2d_Vec2d.Add(l,e);this.updateShapes([{id:e.id,type:e.type,x:c,y:u}],{squashing:!0});let p=new Vec2d_Vec2d(a.width/r.width,1);this.resizeShape(e.id,p,{initialBounds:t,scaleOrigin:new Vec2d_Vec2d(a.minX,r.center.y),scaleAxisRotation:0})}})}return this}resizeShape(e,t,r={}){let n="string"==typeof e?e:e.id;if(this.instanceState.isReadonly)return this;Number.isFinite(t.x)||(t=new Vec2d_Vec2d(1,t.y)),Number.isFinite(t.y)||(t=new Vec2d_Vec2d(t.x,1));let i=r.initialShape??this.getShape(n);if(!i)return this;let o=r.scaleOrigin??this.getShapePageBounds(n)?.center;if(!o)return this;let a=r.initialPageTransform?Matrix2d.Cast(r.initialPageTransform):this.getShapePageTransform(n);if(!a)return this;let l=a.rotation();if(null==l)return this;let d=r.scaleAxisRotation??l,c=r.initialBounds??this.getShapeGeometry(n).bounds;if(!c)return this;if(!areAnglesCompatible(l,d))return this._resizeUnalignedShape(n,t,{...r,initialBounds:c,scaleOrigin:o,scaleAxisRotation:d,initialPageTransform:a,initialShape:i});let u=this.getShapeUtil(i);if(u.isAspectRatioLocked(i)&&(t=Math.abs(t.x)>Math.abs(t.y)?new Vec2d_Vec2d(t.x,Math.sign(t.y)*Math.abs(t.x)):new Vec2d_Vec2d(Math.sign(t.x)*Math.abs(t.y),t.y)),u.onResize&&u.canResize(i)){let e=this._scalePagePoint(Matrix2d.applyToPoint(a,new Vec2d_Vec2d(0,0)),o,t,d),p=this.getPointInParentSpace(i.id,e),h=new Vec2d_Vec2d(t.x,t.y),f=approximately((l-d)%Math.PI,0);h.x=f?t.x:t.y,h.y=f?t.y:t.x;let g=Matrix2d.applyToPoint(a,new Vec2d_Vec2d),{x:m,y}=this.getPointInParentSpace(i.id,g);this.updateShapes([{id:n,type:i.type,x:p.x,y:p.y,...u.onResize({...i,x:m,y},{newPoint:p,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:h.x,scaleY:h.y,initialBounds:c,initialShape:i})}],{squashing:!0})}else{let e=Matrix2d.applyToPoint(a,c.center),r=this._scalePagePoint(e,o,t,d),l=this.getPointInParentSpace(i.id,e),u=this.getPointInParentSpace(i.id,r),p=Vec2d_Vec2d.Sub(u,l);this.updateShapes([{id:n,type:i.type,x:i.x+p.x,y:i.y+p.y}],{squashing:!0})}return this}_scalePagePoint(e,t,r,n){let i=Vec2d_Vec2d.RotWith(e,t,-n).sub(t),o=Vec2d_Vec2d.MulV(i,r),a=Vec2d_Vec2d.Add(o,t).rotWith(t,n);return a}_resizeUnalignedShape(e,t,r){let{type:n}=r.initialShape,i=new Vec2d_Vec2d(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?i.x=Math.sign(t.x)*Math.abs(t.y):i.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,i,{initialShape:r.initialShape,initialBounds:r.initialBounds}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=Matrix2d.Decompose(r.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:n,rotation:t}],{squashing:!0})}let o=Matrix2d.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(o,r.scaleOrigin,t,r.scaleAxisRotation),l=this.getShapePageBounds(e),d=this.getShapePageTransform(e),c=l.center,u=d.point();if(!c||!u)return this;let p=Vec2d_Vec2d.Sub(a,c),h=Vec2d_Vec2d.Add(u,p),{x:f,y:g}=this.getPointInParentSpace(e,h);return this.updateShapes([{id:e,type:n,x:f,y:g}],{squashing:!0}),this}getInitialMetaForShape(e){return{}}createShape(e){return this._createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(e),this}_createShapes=this.history.createCommand("createShapes",e=>{if(this.instanceState.isReadonly||e.length<=0)return null;let{currentPageShapeIds:t}=this,r=e.length+t.size>nn;if(r){alertMaxShapes(this);return}return 0===e.length?null:{data:{currentPageId:this.currentPageId,partials:e.map(e=>e.id?e:{...e,id:createShapeId()})}}},{do:({partials:e})=>{let{focusedGroupId:t}=this,{currentPageShapesSorted:r}=this;e=e.map(n=>{if(!n.parentId||!(this.store.has(n.parentId)||e.some(e=>e.id===n.parentId))){let e=this.focusedGroupId;for(let t=r.length-1;t>=0;t--){let i=r[t];if(this.getShapeUtil(i).canReceiveNewChildrenOfType(i,n.type)&&this.isPointInShape(i,{x:n.x??0,y:n.y??0},{margin:0,hitInside:!0})){e=i.id;break}}let i=n.parentId;if(e===n.id&&(e=t),e!==i&&((n={...n}).parentId=e,isShapeId(e))){let t=this.getPointInShapeSpace(this.getShape(e),{x:n.x??0,y:n.y??0});n.x=t.x,n.y=t.y,n.rotation=-this.getShapePageTransform(e).rotation()+(n.rotation??0)}}return n});let n=new Map,i=[];for(let r of e){let e=this.getShapeUtil(r),o=r.index;if(!o){let e=r.parentId??t;n.has(e)||n.set(e,this.getHighestIndexForParent(e)),o=n.get(e),n.set(e,getIndexAbove(o))}let a=e.getDefaultProps();for(let[e,t]of this.styleProps[r.type])a[t]=this.getStyleForNextShape(e);let l=this.store.schema.types.shape.create({...r,index:o,opacity:r.opacity??this.instanceState.opacityForNextShape,parentId:r.parentId??t,props:"props"in r?{...a,...r.props}:a});if(void 0===l.index)throw Error("no index!");let d=this.getShapeUtil(l).onBeforeCreate?.(l);d&&(l=d),i.push(l)}i.forEach(e=>{e.meta={...this.getInitialMetaForShape(e),...e.meta}}),this.store.put(i)},undo:({partials:e})=>{this.store.remove(e.map(e=>e.id))}});animatingShapes=new Map;animateShape(e,t){return this.animateShapes([e],t)}animateShapes(e,t={}){let r,n;let{duration:i=500,easing:o=r3.linear}=t,a=uniqueId(),l=i,d=[];e.forEach(e=>{if(!e)return;let t={partial:e,values:[]},r=this.getShape(e.id);if(r){for(let n of["x","y","rotation"])void 0!==e[n]&&r[n]!==e[n]&&t.values.push({prop:n,from:r[n],to:e[n]});d.push(t),this.animatingShapes.set(r.id,a)}});let handleTick=t=>{if((l-=t)<0){let{animatingShapes:t}=this,r=e.filter(e=>e&&t.get(e.id)===a);r.length&&this.updateShapes(r,{squashing:!1}),this.removeListener("tick",handleTick);return}r=o(1-l/i);let{animatingShapes:c}=this;try{let e=[];for(let t=0;t<d.length;t++)n=d[t],c.get(n.partial.id)===a&&e.push({id:n.partial.id,type:n.partial.type,...n.values.reduce((e,{prop:t,from:n,to:i})=>(e[t]=n+(i-n)*r,e),{})});this._updateShapes(e,{squashing:!0})}catch(e){}};return this.addListener("tick",handleTick),this}groupShapes(e,t=createShapeId()){if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.instanceState.isReadonly)return this;let r="string"==typeof e[0]?e:e.map(e=>e.id);if(r.length<=1)return this;let n=compact(this._getUnlockedShapeIds(r).map(e=>this.getShape(e))),i=n.sort(reordering_sortByIndex).map(e=>e.id),o=Box2d_Box2d.Common(compact(n.map(e=>this.getShapePageBounds(e)))),{x:a,y:l}=o.point,d=this.findCommonAncestor(n)??this.currentPageId;if("select"!==this.currentToolId)return this;this.isIn("select.idle")||this.cancel();let c=n.filter(e=>e.parentId===d).sort(reordering_sortByIndex),u=c[c.length-1]?.index;return this.batch(()=>{this.createShapes([{id:t,type:"group",parentId:d,index:u,x:a,y:l,opacity:1,props:{}}]),this.reparentShapes(i,t),this.select(t)}),this}ungroupShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(this.instanceState.isReadonly||0===t.length||"select"!==this.currentToolId)return this;this.isIn("select.idle")||this.cancel();let r=new Set,n=compact(t.map(e=>this.getShape(e))),i=[];return n.forEach(e=>{this.isShapeOfType(e,"group")?i.push(e):r.add(e.id)}),0===i.length||this.batch(()=>{let e;for(let t=0,n=i.length;t<n;t++){e=i[t];let n=this.getSortedChildIdsForParent(e.id);for(let e=0,t=n.length;e<t;e++)r.add(n[e]);this.reparentShapes(n,e.parentId,e.index)}this.deleteShapes(i.map(e=>e.id)),this.select(...r)}),this}updateShape(e,t){return this.updateShapes([e],t),this}updateShapes(e,t){let r=compact(e);return this.animatingShapes.size>0&&r.forEach(e=>this.animatingShapes.delete(e.id)),r=r.filter(e=>{let t=this.getShape(e.id);return!(!t||this.isShapeOrAncestorLocked(t)&&!Object.hasOwn(e,"isLocked"))}),this._updateShapes(r,t),this}_updateShapes=this.history.createCommand("updateShapes",(e,t)=>{if(this.instanceState.isReadonly)return null;let r=compact(e),n=Object.fromEntries(compact(r.map(({id:e})=>this.getShape(e))).map(e=>[e.id,e]));if(r.length<=0)return null;let i=compact(r.map(e=>{let t=n[e.id];if(!t)return null;let r=null;for(let[n,i]of Object.entries(e))if(void 0!==i)switch(n){case"id":case"type":continue;default:if(i!==t[n]){if(r||(r={...t}),"props"===n){let e={...t.props};for(let[t,r]of Object.entries(i))void 0!==r&&(e[t]=r);r.props=e}else if("meta"===n){let e={...t.meta};for(let[t,r]of Object.entries(i))void 0!==r&&(e[t]=r);r.meta=e}else r[n]=i}}return r??t})),o=Object.fromEntries(i.map(e=>[e.id,e]));return{data:{snapshots:n,updates:o},...t}},{do:({updates:e})=>{let t=Object.values(e);for(let e=0;e<t.length;e++){let r=t[e],n=this.store.get(r.id);if(!n)continue;let i=this.getShapeUtil(r).onBeforeUpdate?.(n,r);i&&(t[e]=i)}this.store.put(t)},undo:({snapshots:e})=>{this.store.put(Object.values(e))},squash:(e,t)=>({snapshots:{...t.snapshots,...e.snapshots},updates:{...e.updates,...t.updates}})});_getUnlockedShapeIds(e){return e.filter(e=>!this.getShape(e)?.isLocked)}deleteShapes(e){if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds("string"==typeof e[0]?e:e.map(e=>e.id))),this}deleteShape(e){return this.deleteShapes(["string"==typeof e?e:e.id]),this}_deleteShapes=this.history.createCommand("delete_shapes",e=>{if(this.instanceState.isReadonly||0===e.length)return null;let t=[...this.currentPageState.selectedShapeIds],r=new Set(e);for(let t of e)this.visitDescendants(t,e=>{r.add(e)});let n=[...r],i=this._arrowBindingsIndex.value,o=compact(n.flatMap(e=>{let t=this.getShape(e),r=i[e];return r&&r.length>0?r.map(({arrowId:e})=>this.getShape(e)).concat(t):t})),a=t.filter(e=>!r.has(e));return{data:{deletedIds:n,snapshots:o,prevSelectedShapeIds:t,postSelectedShapeIds:a}}},{do:({deletedIds:e,postSelectedShapeIds:t})=>{this.store.remove(e),this.store.update(this.currentPageState.id,e=>({...e,selectedShapeIds:t}))},undo:({snapshots:e,prevSelectedShapeIds:t})=>{this.store.put(e),this.store.update(this.currentPageState.id,e=>({...e,selectedShapeIds:t}))}});_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){let r=this._parentIdsToChildIds.value[e.id];if(r)for(let e=0,n=r.length;e<n;e++)this._extractSharedStyles(this.getShape(r[e]),t)}else for(let[r,n]of this.styleProps[e.type])t.applyValue(r,getOwnProperty(e.props,n))}_selectionSharedStyles=computed("_selectionSharedStyles",()=>{let{selectedShapes:e}=this,t=new SharedStyleMap;for(let r of e)this._extractSharedStyles(r,t);return t});getStyleForNextShape(e){let t=this.instanceState.stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){let r=this.styleProps[e.type].get(t);if(void 0!==r)return getOwnProperty(e.props,r)}get sharedStyles(){if(this.isIn("select")&&this.selectedShapeIds.length>0)return this._selectionSharedStyles.value;let e=this.root.current.value,t=new SharedStyleMap;if(e.shapeType)for(let r of this.styleProps[e.shapeType].keys())t.applyValue(r,this.getStyleForNextShape(r));return t}get sharedOpacity(){if(this.isIn("select")&&this.selectedShapeIds.length>0){let e=[],addShape=t=>{let r=this.getShape(t);if(r){if(this.isShapeOfType(r,"group"))for(let e of this.getSortedChildIdsForParent(r.id))addShape(e);else e.push(r)}};for(let e of this.selectedShapeIds)addShape(e);let t=null;for(let r of e)if(null===t)t=r.opacity;else if(t!==r.opacity)return{type:"mixed"};if(null!==t)return{type:"shared",value:t}}return{type:"shared",value:this.instanceState.opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e,t){let{selectedShapes:r}=this;if(r.length>0){let n=[],addShapeById=e=>{if(this.isShapeOfType(e,"group")){let t=this.getSortedChildIdsForParent(e);for(let e of t)addShapeById(this.getShape(e))}else n.push(e)};for(let e of r)addShapeById(e);this.updateShapes(n.map(t=>({id:t.id,type:t.type,opacity:e})),t)}return this}setStyleForNextShapes(e,t,r){let{instanceState:{stylesForNextShape:n}}=this;return this.updateInstanceState({stylesForNextShape:{...n,[e.id]:t}},r),this}setStyleForSelectedShapes(e,t,r){let{selectedShapes:n}=this;if(n.length>0){let i=[],addShapeById=r=>{if(this.isShapeOfType(r,"group")){let e=this.getSortedChildIdsForParent(r.id);for(let t of e)addShapeById(this.getShape(t))}else{let n=this.getShapeUtil(r),o=this.styleProps[r.type].get(e);if(o){let e={id:r.id,type:r.type,props:{[o]:t}};i.push({util:n,originalShape:r,updatePartial:e})}}};for(let e of n)addShapeById(e);this.updateShapes(i.map(({updatePartial:e})=>e),r)}return this}externalAssetContentHandlers={file:null,url:null};registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}externalContentHandlers={text:null,files:null,embed:null,"svg-text":null,url:null};registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(!t||0===t.length)return;let r={},n=dedupe(t.map(e=>this.getShape(e)).sort(reordering_sortByIndex).flatMap(e=>{let t=[e];return this.visitDescendants(e.id,e=>{t.push(this.getShape(e))}),t}));n=n.map(e=>{if(r[e.id]=this.getShapePageTransform(e.id),e=eL(e),this.isShapeOfType(e,"arrow")){let t="binding"===e.props.start.type?e.props.start.boundShapeId:void 0,r="binding"===e.props.end.type?e.props.end.boundShapeId:void 0,i=this.getArrowInfo(e);if("binding"===e.props.start.type&&!n.some(e=>e.id===t)){if(i?.isValid){let{x:t,y:r}=i.start.point;e.props.start={type:"point",x:t,y:r}}else{let{start:t}=getArrowTerminalsInArrowSpace(this,e);e.props.start={type:"point",x:t.x,y:t.y}}}if("binding"===e.props.end.type&&!n.some(e=>e.id===r)){if(i?.isValid){let{x:t,y:r}=i.end.point;e.props.end={type:"point",x:t,y:r}}else{let{end:t}=getArrowTerminalsInArrowSpace(this,e);e.props.end={type:"point",x:t.x,y:t.y}}}let o=getIsArrowStraight(e)?getStraightArrowInfo(this,e):getCurvedArrowInfo(this,e);if(i?.isValid&&o?.isValid&&!getIsArrowStraight(e)){let t=Vec2d_Vec2d.Med(i.start.handle,i.end.handle),r=Vec2d_Vec2d.Dist(i.middle,t),n=Vec2d_Vec2d.Dist(o.middle,t);e.props.bend<0?e.props.bend+=n-r:e.props.bend-=n-r}}return e});let i=[];n.forEach(e=>{if(void 0===n.find(t=>t.id===e.parentId)){let t=this.getShapePageTransform(e.id),r=t.point(),n=t.rotation();e.x=r.x,e.y=r.y,e.rotation=n,e.parentId=this.currentPageId,i.push(e.id)}});let o=new Set;return n.forEach(e=>{"assetId"in e.props&&null!==e.props.assetId&&o.add(e.props.assetId)}),{shapes:n,rootShapeIds:i,schema:this.store.schema.serialize(),assets:compact(Array.from(o).map(e=>this.getAsset(e)))}}putContentOntoCurrentPage(e,t={}){if(this.instanceState.isReadonly)return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");let{select:r=!1,preserveIds:n=!1,preservePosition:i=!1}=t,{point:o}=t,{currentPageId:a}=this,{assets:l,shapes:d,rootShapeIds:c}=e,u=new Map(d.map(e=>[e.id,createShapeId()])),p=this.currentPageId,h=1/0,f=[];for(let e of this.selectedShapes){if(0===h)break;let t=this.isShapeOfType(e,"frame"),r=this.getShapeAncestors(e);t&&r.push(e);let n=t?r.length+1:r.length;if(n<h)h=n,f=r,p=t?e.id:e.parentId;else if(n===h){if(f.length!==r.length)throw Error(`Ancestors: ${f.length} !== ${r.length}`);if(0===f.length){p=a;break}p=a;for(let e=0;e<f.length&&r[e]===f[e];e++)p=r[e].id}}let g=!1;if(!isPageId(p)){let e=this.getShape(p);if(e){if(this.viewportPageBounds.includes(this.getShapePageBounds(e))){if(1===c.length){let t=d.find(e=>e.id===c[0]);this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===e?.props.w&&t.props.h===e?.props.h&&(g=!0)}}else p=a}else p=a}g||(g=u.has(p)),g&&(p=this.getShape(p).parentId);let m=this.getHighestIndexForParent(p),y=[],b=d.map(e=>{let t;if(n)t=deepCopy(e),u.set(e.id,e.id);else{let r=u.get(e.id);t=deepCopy({...e,id:r})}if(c.includes(e.id)&&(t.parentId=a,y.push(t)),u.has(t.parentId)?t.parentId=u.get(e.parentId):(c.push(t.id),t.index=m,m=getIndexAbove(m)),this.isShapeOfType(t,"arrow")){if("binding"===t.props.start.type){let e=u.get(t.props.start.boundShapeId);t.props.start=e?{...t.props.start,boundShapeId:e}:{type:"point",x:0,y:0}}if("binding"===t.props.end.type){let e=u.get(t.props.end.boundShapeId);t.props.end=e?{...t.props.end,boundShapeId:e}:{type:"point",x:0,y:0}}}return t});if(b.length+this.currentPageShapeIds.size>nn)return alertMaxShapes(this),this;let v=[];if(l){for(let t=0;t<l.length;t++){let r=l[t],n=this.store.schema.migratePersistedRecord(r,e.schema);if("success"===n.type)l[t]=n.value;else throw Error(`Could not put content:
could not migrate content for asset:
${r.id}
${r.type}
reason:${n.reason}`)}let t=[];v=l.filter(e=>!this.store.has(e.id)).map(e=>(("image"===e.type||"video"===e.type)&&(e.props.src&&e.props.src?.startsWith("data:image")?(t.push(eL(e)),e.props.src=null):t.push(eL(e))),e)),Promise.allSettled(t.map(async e=>{let t=await dataUrlToFile(e.props.src,e.props.name,e.props.mimeType??"image/png"),r=await this.getAssetForExternalContent({type:"file",file:t});return r?[e,r]:null})).then(e=>{this.updateAssets(compact(e.map(e=>"fulfilled"===e.status&&e.value?{...e.value[1],id:e.value[0].id}:void 0)))})}for(let t=0;t<b.length;t++){let r=b[t],n=this.store.schema.migratePersistedRecord(r,e.schema);if("success"===n.type)b[t]=n.value;else throw Error(`Could not put content:
could not migrate content for shape:
${r.id}, ${r.type}
reason:${n.reason}`)}return this.batch(()=>{v.length>0&&this.createAssets(v),this.createShapes(b),r&&this.select(...y.map(e=>e.id)),p!==a&&this.reparentShapes(y.map(e=>e.id),p);let e=b.map(e=>this.getShape(e.id)),t=Box2d_Box2d.Common(e.map(e=>this.getShapePageBounds(e)));if(void 0===o){if(isPageId(p)){let{viewportPageBounds:e}=this;o=i||e.includes(Box2d_Box2d.From(t))?t.center:e.center}else{let e=this.getShape(p);o=Matrix2d.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}}if(1===y.length){let e=y[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(o).some(t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h);)o.x+=t.w+16}let n=Box2d_Box2d.Common(compact(y.map(({id:e})=>this.getShapePageBounds(e)))).center,l=Vec2d_Vec2d.Sub(o,n);this.updateShapes(y.map(({id:e})=>{let t=this.getShape(e),r=this.getShapeParentTransform(e).decompose().rotation,n=Vec2d_Vec2d.Rot(l,-r);return{id:t.id,type:t.type,x:t.x+n.x,y:t.y+n.y}}))}),this}async getSvg(e,t={}){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(0===r.length)return;if(!window.document)throw Error("No document");let{scale:n=1,background:i=!1,padding:o=nh,preserveAspectRatio:a=!1}=t,l=getDefaultColorTheme({isDarkMode:this.user.isDarkMode}),d=this.getShapeAndDescendantIds(r),c=this.getUnorderedRenderingShapes(!1).filter(({id:e})=>d.has(e)),u=null;for(let{maskedPageBounds:e}of c)e&&(u?u.union(e):u=e.clone());if(!u)return;let p=1===r.length&&this.isShapeOfType(this.getShape(r[0]),"frame")?r[0]:null;p||u.expandBy(o);let h=u.width*n,f=u.height*n,g=window.document.createElementNS("http://www.w3.org/2000/svg","svg");a&&g.setAttribute("preserveAspectRatio",a),g.setAttribute("direction","ltr"),g.setAttribute("width",h+""),g.setAttribute("height",f+""),g.setAttribute("viewBox",`${u.minX} ${u.minY} ${u.width} ${u.height}`),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),i?p?g.style.setProperty("background",l.solid):g.style.setProperty("background-color",l.background):g.style.setProperty("background-color","transparent");try{document.body.focus?.()}catch(e){}let m=window.document.createElementNS("http://www.w3.org/2000/svg","defs");g.append(m);let y=new Map,b={addExportDef:e=>{if(y.has(e.key))return;let t=(async()=>{let t=await e.getElement();if(!t)return;let r=document.createComment(`def: ${e.key}`);for(let e of(m.appendChild(r),Array.isArray(t)?t:[t]))m.appendChild(e)})();y.set(e.key,t)}},v=(await Promise.all(c.map(async({id:e,opacity:t,index:r,backgroundIndex:n})=>{if(e===p)return[];let i=this.getShape(e);if(this.isShapeOfType(i,"group"))return[];let o=this.getShapeUtil(i),a=await o.toSvg?.(i,b),d=await o.toBackgroundSvg?.(i,b);if(a){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(a),a=e}if(d){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(d),d=e}if(!a&&!d){let e=this.getShapePageBounds(i),t=window.document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width",e.width+""),t.setAttribute("height",e.height+""),t.setAttribute("fill",l.solid),t.setAttribute("stroke",l.grey.pattern),t.setAttribute("stroke-width","1"),a=t}let c=this.getShapePageTransform(i).toCssString();"scale"in i.props&&1!==i.props.scale&&(c=`${c} scale(${i.props.scale}, ${i.props.scale})`),a?.setAttribute("transform",c),d?.setAttribute("transform",c),a?.setAttribute("opacity",t+""),d?.setAttribute("opacity",t+"");let u=this.getShapeMask(i.id);if(u){let e=document.createElementNS("http://www.w3.org/2000/svg","clipPath");m.appendChild(e);let t=uniqueId();e.id=t;let r=document.createElementNS("http://www.w3.org/2000/svg","path");if(r.setAttribute("d",`M${u.map(({x:e,y:t})=>`${e},${t}`).join("L")}Z`),e.appendChild(r),a){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path",`url(#${t})`),e.appendChild(a),a=e}if(d){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path",`url(#${t})`),e.appendChild(d),d=e}}let h=[];return a&&h.push({zIndex:r,element:a}),d&&h.push({zIndex:n,element:d}),h}))).flat();for(let{element:e}of(await Promise.all(y.values()),v.sort((e,t)=>e.zIndex-t.zIndex)))g.appendChild(e);return g}inputs={originPagePoint:new Vec2d_Vec2d,originScreenPoint:new Vec2d_Vec2d,previousPagePoint:new Vec2d_Vec2d,previousScreenPoint:new Vec2d_Vec2d,currentPagePoint:new Vec2d_Vec2d,currentScreenPoint:new Vec2d_Vec2d,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new Vec2d_Vec2d};_updateInputsFromEvent(e){let{previousScreenPoint:t,previousPagePoint:r,currentScreenPoint:n,currentPagePoint:i}=this.inputs,{screenBounds:o}=this.store.unsafeGetWithoutCapture(tg),{x:a,y:l,z:d}=e.point,{x:c,y:u,z:p}=this.camera;t.setTo(n),r.setTo(i),n.set(a,l),i.set((a-o.x)/p-c,(l-o.y)/p-u,d??.5),this.inputs.isPen="pointer"===e.type&&e.isPen,"pointer_down"===e.name&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:tC,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===nb.CAMERA_MOVE?this.store.get(tC)?.lastActivityTimestamp??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}_clickManager=new ClickManager(this);cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_prevCursor="default";_shiftKeyTimeout=-1;_setShiftKeyTimeout=()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})};_altKeyTimeout=-1;_setAltKeyTimeout=()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})};_ctrlKeyTimeout=-1;_setCtrlKeyTimeout=()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})};_restoreToolId="select";_pinchStart=1;_didPinch=!1;_selectedShapeIdsAtPointerDown=[];capturedPointerId=null;dispatch=e=>{if(this.crashingError)return this;let{inputs:t}=this,{type:r}=e;return this.batch(()=>{if("misc"===e.type){("cancel"===e.name||"complete"===e.name)&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(e);return}e.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));let{originPagePoint:n,originScreenPoint:i,currentPagePoint:o,currentScreenPoint:a}=t;switch(t.isPointing||(t.isDragging=!1),r){case"pinch":if(!this.instanceState.canMoveCamera)return;switch(this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;t.isEditing||(this._pinchStart=this.camera.z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds),this._didPinch=!0,t.isPinching=!0,this.interrupt());return;case"pinch":{if(!t.isPinching)return;let{point:{x:r,y:n,z:i=1},delta:{x:o,y:a}}=e,{camera:{x:l,y:d,z:c}}=this,u=Math.min(nd,Math.max(nl,i));this.setCamera({x:l+o/c-r/c+r/u,y:d+a/c-n/c+n/u,z:u});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;let{_selectedShapeIdsAtPointerDown:e}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(e,{squashing:!0})}));return}}case"wheel":if(!this.instanceState.canMoveCamera)return;if(this.isMenuOpen);else{if(t.ctrlKey){let{x:t,y:r}=this.inputs.currentScreenPoint,{x:n,y:i,z:o}=this.camera,a=Math.min(nd,Math.max(nl,o+(e.delta.z??0)*o));this.setCamera({x:n+(t/a-t)-(t/o-t),y:i+(r/a-r)-(r/o-r),z:a});return}this.pan(e.delta),!t.isDragging&&t.isPointing&&n.dist(o)>(this.instanceState.isCoarsePointer?6:np)/this.zoomLevel&&(t.isDragging=!0)}break;case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);let{isPen:r}=e;switch(e.name){case"pointer_down":if(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds,0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,this.instanceState.isPenMode){if(!r)return}else r&&this.updateInstanceState({isPenMode:!0});if(5===e.button?(this._restoreToolId=this.currentToolId,this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;i.setTo(a),n.setTo(o);break;case"pointer_move":if(!r&&this.instanceState.isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){let{currentScreenPoint:e,previousScreenPoint:t}=this.inputs;this.pan(Vec2d_Vec2d.Sub(e,t));return}!t.isDragging&&t.isPointing&&n.dist(o)>(this.instanceState.isCoarsePointer?6:np)/this.zoomLevel&&(t.isDragging=!0);break;case"pointer_up":if(t.buttons.delete(e.button),t.isPointing=!1,t.isDragging=!1,this.isMenuOpen||!r&&this.instanceState.isPenMode)return;this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning?1===e.button?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nm}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(t.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nm}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):0===e.button&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nm}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),e.name){case"key_down":t.keys.add(e.code),e.ctrlKey||"Space"!==e.code||(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break;case"key_up":t.keys.delete(e.code),"Space"!==e.code||this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))}}if("pointer"===e.type&&(1===e.button?e.name="middle_click":2===e.button&&(e.name="right_click"),e.isPen===this.instanceState.isPenMode))switch(e.name){case"pointer_down":{let t=this._clickManager.transformPointerDownEvent(e);if(e.name!==t.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),this.emit("event",t);return}break}case"pointer_up":{let t=this._clickManager.transformPointerUpEvent(e);if(e.name!==t.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),this.emit("event",t);return}break}case"pointer_move":this._clickManager.handleMove()}this.root.handleEvent(e),this.emit("event",e)}),this}};function alertMaxShapes(e,t=e.currentPageId){let r=e.getPage(t).name;e.emit("max-shapes",{name:r,pageId:t,count:nn})}function useIsDarkMode(){let e=useEditor();return useValue("isDarkMode",()=>e.user.isDarkMode,[e])}Editor_decorateClass([computed],Editor.prototype,"canUndo",1),Editor_decorateClass([computed],Editor.prototype,"canRedo",1),Editor_decorateClass([computed],Editor.prototype,"_arrowBindingsIndex",1),Editor_decorateClass([computed],Editor.prototype,"arrowInfoCache",1),Editor_decorateClass([computed],Editor.prototype,"currentTool",1),Editor_decorateClass([computed],Editor.prototype,"currentToolId",1),Editor_decorateClass([computed],Editor.prototype,"documentSettings",1),Editor_decorateClass([computed],Editor.prototype,"instanceState",1),Editor_decorateClass([computed],Editor.prototype,"openMenus",1),Editor_decorateClass([computed],Editor.prototype,"isMenuOpen",1),Editor_decorateClass([computed],Editor.prototype,"pageStates",1),Editor_decorateClass([computed],Editor.prototype,"_pageStates",1),Editor_decorateClass([computed],Editor.prototype,"currentPageState",1),Editor_decorateClass([computed],Editor.prototype,"_currentPageStateId",1),Editor_decorateClass([computed],Editor.prototype,"selectedShapeIds",1),Editor_decorateClass([computed],Editor.prototype,"selectedShapes",1),Editor_decorateClass([computed],Editor.prototype,"onlySelectedShape",1),Editor_decorateClass([computed],Editor.prototype,"selectionPageBounds",1),Editor_decorateClass([computed],Editor.prototype,"selectionRotation",1),Editor_decorateClass([computed],Editor.prototype,"selectionRotatedPageBounds",1),Editor_decorateClass([computed],Editor.prototype,"focusedGroupId",1),Editor_decorateClass([computed],Editor.prototype,"focusedGroup",1),Editor_decorateClass([computed],Editor.prototype,"editingShapeId",1),Editor_decorateClass([computed],Editor.prototype,"editingShape",1),Editor_decorateClass([computed],Editor.prototype,"hoveredShapeId",1),Editor_decorateClass([computed],Editor.prototype,"hoveredShape",1),Editor_decorateClass([computed],Editor.prototype,"hintingShapeIds",1),Editor_decorateClass([computed],Editor.prototype,"hintingShapes",1),Editor_decorateClass([computed],Editor.prototype,"erasingShapeIds",1),Editor_decorateClass([computed],Editor.prototype,"erasingShapes",1),Editor_decorateClass([computed],Editor.prototype,"cameraId",1),Editor_decorateClass([computed],Editor.prototype,"camera",1),Editor_decorateClass([computed],Editor.prototype,"zoomLevel",1),Editor_decorateClass([computed],Editor.prototype,"viewportScreenBounds",1),Editor_decorateClass([computed],Editor.prototype,"viewportScreenCenter",1),Editor_decorateClass([computed],Editor.prototype,"viewportPageBounds",1),Editor_decorateClass([computed],Editor.prototype,"viewportPageCenter",1),Editor_decorateClass([computed],Editor.prototype,"cameraState",1),Editor_decorateClass([computed],Editor.prototype,"renderingShapes",1),Editor_decorateClass([computed],Editor.prototype,"renderingBounds",1),Editor_decorateClass([computed],Editor.prototype,"renderingBoundsExpanded",1),Editor_decorateClass([computed],Editor.prototype,"_pages",1),Editor_decorateClass([computed],Editor.prototype,"pages",1),Editor_decorateClass([computed],Editor.prototype,"_assets",1),Editor_decorateClass([computed],Editor.prototype,"_shapeGeometryCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapeOutlineSegmentsCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapeHandlesCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapePageTransformCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapePageBoundsCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapeClipPathCache",1),Editor_decorateClass([computed],Editor.prototype,"_shapeMaskCache",1),Editor_decorateClass([computed],Editor.prototype,"currentPageBounds",1),Editor_decorateClass([computed],Editor.prototype,"currentPageShapes",1),Editor_decorateClass([computed],Editor.prototype,"currentPageShapesSorted",1),Editor_decorateClass([computed],Editor.prototype,"currentPageRenderingShapesSorted",1),Editor_decorateClass([computed({isEqual:(e,t)=>e.equals(t)})],Editor.prototype,"sharedStyles",1),Editor_decorateClass([computed],Editor.prototype,"sharedOpacity",1);let ii="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",io="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",ia='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function getCursorCss(e,t,r,n,i,o=16,a=16){let l=(-r-t)*(r8/180),d=Math.sin(l),c=Math.cos(l);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*c-1*d}' dy='${1*d+1*c}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+r} 16 16)${n?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${a}, pointer`}let is={none:()=>"none",default:(e,t,r)=>getCursorCss('<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',e,0,t,r,12,8),pointer:(e,t,r)=>getCursorCss('<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',e,0,t,r,14,10),cross:(e,t,r)=>getCursorCss('<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',e,0,t,r),move:(e,t,r)=>getCursorCss('<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',e,0,t,r),grab:(e,t,r)=>getCursorCss('<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',e,0,t,r),grabbing:(e,t,r)=>getCursorCss("<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",e,0,t,r),text:(e,t,r)=>getCursorCss('<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',e,0,t,r,4,10),"ew-resize":(e,t,r)=>getCursorCss(io,e,0,t,r),"ns-resize":(e,t,r)=>getCursorCss(io,e,90,t,r),"nesw-resize":(e,t,r)=>getCursorCss(ii,e,0,t,r),"nwse-resize":(e,t,r)=>getCursorCss(ii,e,90,t,r),"nwse-rotate":(e,t,r)=>getCursorCss(ia,e,0,t,r),"nesw-rotate":(e,t,r)=>getCursorCss(ia,e,90,t,r),"senw-rotate":(e,t,r)=>getCursorCss(ia,e,180,t,r),"swne-rotate":(e,t,r)=>getCursorCss(ia,e,270,t,r),"zoom-in":(e,t,r)=>getCursorCss('<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',e,0,t,r),"zoom-out":(e,t,r)=>getCursorCss('<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',e,0,t,r)};function getCursor(e,t=0,r="black"){return is[e](radiansToDegrees(t),!1,r)}let il=["default","pointer","cross","move","grab","grabbing","text"];function useCursor(){let e=useEditor(),t=useContainer(),r=useIsDarkMode();useQuickReactor("useCursor",()=>{let{type:n,rotation:i}=e.instanceState.cursor;if(il.includes(n)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${n})`);return}t.style.setProperty("--tl-cursor",getCursor(n,i,r?"white":"black"))},[e,t,r])}function useDarkMode(){let e=useEditor(),t=useContainer(),r=useIsDarkMode(),n=useValue(rZ.forceSrgb);T.useEffect(()=>{r?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),n?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,n,r])}function useEvent(e){let t=(0,T.useRef)();return(0,T.useLayoutEffect)(()=>{t.current=e}),(0,T.useDebugValue)(e),(0,T.useCallback)((...e)=>{let r=t.current;return eM(r,"fn does not exist"),r(...e)},[])}function useFocusEvents(e){let t=useEditor(),r=useContainer();(0,T.useLayoutEffect)(()=>{e?(t.instanceState.isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.instanceState.isFocused&&t.updateInstanceState({isFocused:!1})},[t,r,e])}function useForceUpdate(){let[e,t]=(0,T.useState)(0);(0,T.useEffect)(()=>t(e=>e+1),[])}let id="TLDRAW_TAB_ID_v2",ic=globalThis.window;function iOS(){return!!ic&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(ic.navigator.platform)||ic.navigator.userAgent.includes("Mac")&&"ontouchend"in document)}let iu=ic?.[id]??ic?.sessionStorage[id]??"TLDRAW_INSTANCE_STATE_V1_"+uniqueId();ic&&(ic[id]=iu,iOS()?ic.sessionStorage[id]=iu:delete ic.sessionStorage[id]),ic?.addEventListener("beforeunload",()=>{ic.sessionStorage[id]=iu});let ip=object({version:eG,currentPageId:tl,isFocusMode:eQ,exportBackground:eQ,isDebugMode:eQ,isToolLocked:eQ,isGridMode:eQ,pageStates:arrayOf(object({pageId:tl,camera:object({x:eG,y:eG,z:eG}),selectedShapeIds:arrayOf(ty),focusedGroupId:ty.nullable()}))}),ih=defineMigrations({currentVersion:0});function migrateAndValidateSessionStateSnapshot(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;let t=migrate({value:e,fromVersion:e.version,toVersion:0,migrations:ih});if("error"===t.type)return console.warn(t.reason),null;let r={...t.value,version:0};try{ip.validate(r)}catch(e){return console.warn(e),null}return r}function createSessionStateSnapshotSignal(e){let t=e.query.ids("page");return computed("sessionStateSnapshot",()=>{let r=e.get(tg);if(!r)return null;let n=[...t.value];return{version:0,currentPageId:r.currentPageId,exportBackground:r.exportBackground,isFocusMode:r.isFocusMode,isDebugMode:r.isDebugMode,isToolLocked:r.isToolLocked,isGridMode:r.isGridMode,pageStates:n.map(t=>{let r=e.get(tx.createId(t)),n=e.get(e6.createId(t));return{pageId:t,camera:{x:n?.x??0,y:n?.y??0,z:n?.z??1},selectedShapeIds:r?.selectedShapeIds??[],focusedGroupId:r?.focusedGroupId??null}})}})}function loadSessionStateSnapshotIntoStore(e,t){let r=migrateAndValidateSessionStateSnapshot(t);if(!r)return;let n=e.allRecords().filter(e=>"instance_page_state"===e.typeName||"camera"===e.typeName),i={added:{},updated:{},removed:{...objectMapFromEntries(n.map(e=>[e.id,e]))}};e.has(tg)&&(i.removed[tg]=e.get(tg));let o={removed:{},updated:{},added:{[tg]:e.schema.types.instance.create({id:tg,currentPageId:r.currentPageId,isDebugMode:r.isDebugMode,isFocusMode:r.isFocusMode,isToolLocked:r.isToolLocked,isGridMode:r.isGridMode,exportBackground:r.exportBackground})}};for(let e of r.pageStates){let t=e6.createId(e.pageId),r=tx.createId(e.pageId);o.added[t]=e6.create({id:e6.createId(e.pageId),x:e.camera.x,y:e.camera.y,z:e.camera.z}),o.added[r]=tx.create({id:tx.createId(e.pageId),pageId:e.pageId,selectedShapeIds:e.selectedShapeIds,focusedGroupId:e.focusedGroupId})}transact(()=>{e.applyDiff(squashRecordDiffs([i,o])),e.ensureStoreIsUsable()})}function extractSessionStateFromLegacySnapshot(e){let t=[];for(let r of Object.values(e))r.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(r);let r=t.filter(e=>"instance"===e.typeName&&e.id!==tg)[0];if(!r)return null;let n={version:0,currentPageId:r.currentPageId,exportBackground:!!r.exportBackground,isFocusMode:!!r.isFocusMode,isDebugMode:!!r.isDebugMode,isToolLocked:!!r.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===r.id).map(t=>{let r=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:r.x,y:r.y,z:r.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return ip.validate(n),n}catch(e){return null}}function showCantWriteToIndexDbAlert(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function showCantReadFromIndexDbAlert(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}let instanceOfAny=(e,t)=>t.some(t=>e instanceof t);function getIdbProxyableTypes(){return p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return h||(h=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let ig=new WeakMap,im=new WeakMap,iy=new WeakMap,ib=new WeakMap,iv=new WeakMap;function promisifyRequest(e){let t=new Promise((t,r)=>{let unlisten=()=>{e.removeEventListener("success",success),e.removeEventListener("error",error)},success=()=>{t(wrap(e.result)),unlisten()},error=()=>{r(e.error),unlisten()};e.addEventListener("success",success),e.addEventListener("error",error)});return t.then(t=>{t instanceof IDBCursor&&ig.set(t,e)}).catch(()=>{}),iv.set(t,e),t}function cacheDonePromiseForTransaction(e){if(im.has(e))return;let t=new Promise((t,r)=>{let unlisten=()=>{e.removeEventListener("complete",complete),e.removeEventListener("error",error),e.removeEventListener("abort",error)},complete=()=>{t(),unlisten()},error=()=>{r(e.error||new DOMException("AbortError","AbortError")),unlisten()};e.addEventListener("complete",complete),e.addEventListener("error",error),e.addEventListener("abort",error)});im.set(e,t)}let iS={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return im.get(e);if("objectStoreNames"===t)return e.objectStoreNames||iy.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return wrap(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function replaceTraps(e){iS=e(iS)}function wrapFunction(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap(ig.get(this))}:function(...t){return wrap(e.apply(unwrap(this),t))}:function(t,...r){let n=e.call(unwrap(this),t,...r);return iy.set(n,t.sort?t.sort():[t]),wrap(n)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes()))?new Proxy(e,iS):e}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(ib.has(e))return ib.get(e);let t=transformCachableValue(e);return t!==e&&(ib.set(e,t),iv.set(t,e)),t}let unwrap=e=>iv.get(e);function openDB(e,t,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){let a=indexedDB.open(e,t),l=wrap(a);return n&&a.addEventListener("upgradeneeded",e=>{n(wrap(a.result),e.oldVersion,e.newVersion,wrap(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),l.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}function deleteDB(e,{blocked:t}={}){let r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",e=>t(e.oldVersion,e)),wrap(r).then(()=>void 0)}let ix=["get","getKey","getAll","getAllKeys","count"],iw=["put","add","delete","clear"],i_=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(i_.get(t))return i_.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=iw.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ix.includes(r)))return;let method=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),a=o.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&o.done]))[0]};return i_.set(t,method),method}replaceTraps(e=>({...e,get:(t,r,n)=>getMethod(t,r)||e.get(t,r,n),has:(t,r)=>!!getMethod(t,r)||e.has(t,r)}));let iP="TLDRAW_DOCUMENT_v2",iE="TLDRAW_DB_NAME_INDEX_v2",iC={Records:"records",Schema:"schema",SessionState:"session_state"};async function withDb(e,t){addDbName(e);let r=await openDB(e,3,{upgrade(e){e.objectStoreNames.contains(iC.Records)||e.createObjectStore(iC.Records),e.objectStoreNames.contains(iC.Schema)||e.createObjectStore(iC.Schema),e.objectStoreNames.contains(iC.SessionState)||e.createObjectStore(iC.SessionState)}});try{return await t(r)}finally{r.close()}}async function loadDataFromStore({persistenceKey:e,sessionId:t,didCancel:r}){let n=iP+e;if(getAllIndexDbNames().includes(n))return await pruneSessionState({persistenceKey:e,didCancel:r}),await withDb(n,async e=>{if(r?.())return;let n=e.transaction([iC.Records,iC.Schema,iC.SessionState],"readonly"),i=n.objectStore(iC.Records),o=n.objectStore(iC.Schema),a=n.objectStore(iC.SessionState),l=t?(await a.get(t))?.snapshot:null;if(!l){let e=await a.getAll();l=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}let d={records:await i.getAll(),schema:await o.get(iC.Schema),sessionStateSnapshot:l};if(r?.()){n.abort();return}return await n.done,d})}async function storeChangesInIndexedDb({persistenceKey:e,schema:t,changes:r,sessionId:n,sessionStateSnapshot:i,didCancel:o}){let a=iP+e;await withDb(a,async e=>{let a=e.transaction([iC.Records,iC.Schema,iC.SessionState],"readwrite"),l=a.objectStore(iC.Records),d=a.objectStore(iC.Schema),c=a.objectStore(iC.SessionState);for(let[e,t]of Object.entries(r.added))await l.put(t,e);for(let[e,t]of Object.values(r.updated))await l.put(t,t.id);for(let e of Object.keys(r.removed))await l.delete(e);if(d.put(t.serialize(),iC.Schema),i&&n?c.put({snapshot:i,updatedAt:Date.now(),id:n},n):(i||n)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return a.abort();await a.done})}async function storeSnapshotInIndexedDb({persistenceKey:e,schema:t,snapshot:r,sessionId:n,sessionStateSnapshot:i,didCancel:o}){let a=iP+e;await withDb(a,async e=>{let a=e.transaction([iC.Records,iC.Schema,iC.SessionState],"readwrite"),l=a.objectStore(iC.Records),d=a.objectStore(iC.Schema),c=a.objectStore(iC.SessionState);for(let[e,t]of(await l.clear(),Object.entries(r)))await l.put(t,e);if(d.put(t.serialize(),iC.Schema),i&&n?c.put({snapshot:i,updatedAt:Date.now(),id:n},n):(i||n)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return a.abort();await a.done})}async function pruneSessionState({persistenceKey:e,didCancel:t}){await withDb(iP+e,async e=>{let r=e.transaction([iC.SessionState],"readwrite"),n=r.objectStore(iC.SessionState),i=(await n.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(i.length<10){await r.done;return}let o=i.slice(0,i.length-10);for(let{id:e}of o)await n.delete(e);if(t?.())return r.abort();await r.done})}function getAllIndexDbNames(){let e=JSON.parse(window?.localStorage.getItem(iE)||"[]")??[];return Array.isArray(e)?e:[]}function addDbName(e){let t=new Set(getAllIndexDbNames());t.add(e),window?.localStorage.setItem(iE,JSON.stringify([...t]))}let ik=Symbol("UPDATE_INSTANCE_STATE"),msg=e=>e;let BroadcastChannelMock=class BroadcastChannelMock{onmessage;constructor(e){}postMessage(e){}close(){}};let iI="undefined"==typeof BroadcastChannel?BroadcastChannelMock:BroadcastChannel;let TLLocalSyncClient=class TLLocalSyncClient{constructor(e,{persistenceKey:t,sessionId:r=iu,onLoad:n,onLoadError:i},o=new iI(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=createSessionStateSnapshotSignal(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(msg({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(ik),this.schedulePersist()},{scope:"session"})),this.connect(n,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let r;this.debug("connecting");try{r=await loadDataFromStore({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(e){t(e),showCantReadFromIndexDbAlert(),"undefined"!=typeof window&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){let e=Object.fromEntries(r.records.map(e=>[e.id,e])),n=r.sessionStateSnapshot??extractSessionStateFromLegacySnapshot(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:r.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName)),"initialize")}),n&&loadSessionStateSnapshotIntoStore(this.store,n)}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let r=compareSchemas(this.serializedSchema,e.schema??this.store.schema.serializeEarliestVersion());if(-1===r){let e=Date.now()-this.initTime;if(e<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}if(1===r){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===e.type&&(this.debug("applying diff"),transact(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){eM(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await storeSnapshotInIndexedDb({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value});else{let t=squashRecordDiffs(e.filter(e=>e!==ik));await storeChangesInIndexedDb({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),showCantWriteToIndexDbAlert(),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}};function createTLStore({initialData:e,defaultName:t="",...r}){let n="schema"in r&&r.schema?r.schema:createTLSchema({shapes:currentPageShapesToShapeMap(checkShapesAndAddCore("shapeUtils"in r&&r.shapeUtils?r.shapeUtils:[]))});return new Store({schema:n,initialData:e,props:{defaultName:t}})}function currentPageShapesToShapeMap(e){return Object.fromEntries(e.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function useTLStore(e){let[t,r]=(0,T.useState)(()=>{let t=createTLStore(e);return e.snapshot&&t.loadSnapshot(e.snapshot),t}),n=(0,T.useRef)(e);if((0,T.useEffect)(()=>void(n.current=e)),Object.keys(n.current).some(t=>n.current[t]!==e[t])){let t=createTLStore(e);return e.snapshot&&t.loadSnapshot(e.snapshot),r(t),t}return t}function useLocalStore({persistenceKey:e,sessionId:t,...r}){let[n,i]=(0,T.useState)(null),o=useTLStore(r);return(0,T.useEffect)(()=>{let r=uniqueId();if(!e){i({id:r,storeWithStatus:{status:"not-synced",store:o}});return}i({id:r,storeWithStatus:{status:"loading"}});let setStoreWithStatus=e=>{i(t=>t?.id===r?{id:r,storeWithStatus:e}:t)},n=new TLLocalSyncClient(o,{sessionId:t,persistenceKey:e,onLoad(){setStoreWithStatus({store:o,status:"synced-local"})},onLoadError(e){setStoreWithStatus({status:"error",error:e})}});return()=>{i(e=>e?.id===r?null:e),n.close()}},[e,o,t]),n?.storeWithStatus??{status:"loading"}}let iT=!1;if("undefined"!=typeof window){let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),r=!!e.match(/WebKit/i);iT=t&&r&&!e.match(/CriOS/i)}function useSafariFocusOutFix(){let e=useEditor();T.useEffect(()=>{if(iT)return document.addEventListener("focusout",handleFocusOut),()=>document.removeEventListener("focusout",handleFocusOut);function handleFocusOut(t){(t.target instanceof HTMLInputElement&&"text"===t.target.type||t.target instanceof HTMLTextAreaElement)&&e.complete()}},[e])}function useZoomCss(){let e=useEditor(),t=useContainer();T.useEffect(()=>{let setScale=e=>t.style.setProperty("--tl-zoom",e.toString()),r=debounce(setScale,100),n=new EffectScheduler("useZoomCss",()=>{let t=e.currentPageShapeIds.size;t<300?setScale(e.zoomLevel):r(e.zoomLevel)});return n.attach(),n.execute(),()=>{n.detach()}},[e,t])}let iA=[],i$=[],iM=(0,T.memo)(function({store:e,components:t,className:r,user:n,...i}){let[o,a]=T.useState(null),l=(0,T.useMemo)(()=>n??createTLUser(),[n]),d=t?.ErrorFallback===void 0?DefaultErrorFallback:t?.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??iA,tools:i.tools??i$};return(0,I.jsx)("div",{ref:a,draggable:!1,className:eb("tl-container tl-theme__light",r),onPointerDown:stopEventPropagation,tabIndex:-1,children:(0,I.jsx)(OptionalErrorBoundary,{fallback:d,onError:e=>annotateError(e,{tags:{origin:"react.tldraw-before-app"}}),children:o&&(0,I.jsx)(ContainerProvider,{container:o,children:(0,I.jsx)(EditorComponentsProvider,{overrides:t,children:e?e instanceof Store?(0,I.jsx)(TldrawEditorWithReadyStore,{...c,store:e,user:l}):(0,I.jsx)(iD,{...c,store:e,user:l}):(0,I.jsx)(TldrawEditorWithOwnStore,{...c,store:e,user:l})})})})})});function TldrawEditorWithOwnStore(e){let{defaultName:t,snapshot:r,initialData:n,shapeUtils:i,persistenceKey:o,sessionId:a,user:l}=e,d=useLocalStore({shapeUtils:i,initialData:n,persistenceKey:o,sessionId:a,defaultName:t,snapshot:r});return(0,I.jsx)(iD,{...e,store:d,user:l})}let iD=(0,T.memo)(function({store:e,user:t,...r}){let n=useContainer();switch((0,T.useLayoutEffect)(()=>{t.userPreferences.value.isDarkMode&&(n.classList.remove("tl-theme__light"),n.classList.add("tl-theme__dark"))},[n,t.userPreferences.value.isDarkMode]),e.status){case"error":throw e.error;case"loading":return(0,I.jsx)(LoadingScreen,{children:"Connecting..."})}return(0,I.jsx)(TldrawEditorWithReadyStore,{...r,store:e.store,user:t})});function TldrawEditorWithReadyStore({onMount:e,children:t,store:r,tools:n,shapeUtils:i,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:d}){let{ErrorFallback:c}=useEditorComponents(),u=useContainer(),[p,h]=(0,T.useState)(null);(0,T.useLayoutEffect)(()=>{let e=new Editor({store:r,shapeUtils:i,tools:n,getContainer:()=>u,user:o,initialState:a,inferDarkMode:d});return window.app=e,window.editor=e,h(e),()=>{e.dispose()}},[u,i,n,r,o,a,d]);let f=(0,T.useSyncExternalStore)((0,T.useCallback)(e=>p?(p.on("crash",e),()=>p.off("crash",e)):()=>{},[p]),()=>p?.crashingError??null);return p?(0,I.jsx)(OptionalErrorBoundary,{fallback:c,onError:e=>p.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:f?(0,I.jsx)(Crash,{crashingError:f}):(0,I.jsx)(rQ.Provider,{value:p,children:(0,I.jsx)(Layout,{autoFocus:l,onMount:e,children:t})})}):null}function Layout({children:e,onMount:t,autoFocus:r}){useZoomCss(),useCursor(),useDarkMode(),useSafariFocusOutFix(),useForceUpdate(),useFocusEvents(r),useOnMount(t),useDPRMultiple();let n=useEditor();return n.updateViewportScreenBounds(),e??(0,I.jsx)(Canvas,{})}function Crash({crashingError:e}){throw e}function LoadingScreen({children:e}){let{Spinner:t}=useEditorComponents();return(0,I.jsxs)("div",{className:"tl-loading",children:[t?(0,I.jsx)(t,{}):null,e]})}function ErrorScreen({children:e}){return(0,I.jsx)("div",{className:"tl-loading",children:e})}function useOnMount(e){let t=useEditor(),r=useEvent(t=>{let r=e?.(t);return t.emit("mount"),window.tldrawReady=!0,r});T.useLayoutEffect(()=>{if(t)return r?.(t)},[t,r])}function HTMLContainer({children:e,className:t="",...r}){return(0,I.jsx)("div",{...r,className:`tl-html-container ${t}`,children:e})}let iV=track(function({x:e=0,y:t=0,rotation:r=0,...n}){let i=useEditor(),o=(0,T.useRef)(null);return(0,T.useLayoutEffect)(()=>{let{x:n,y:a,z:l}=i.camera,d=o.current;d&&void 0!==n&&(d.style.transform=`translate(${n}px, ${a}px) scale(${l}) rotate(${r}rad) translate(${e}px, ${t}px)`)},[i.camera,e,t,r]),(0,I.jsx)("div",{ref:o,...n,className:eb("tl-positioned",n.className)})});function resizeBox(e,t,r={}){let{newPoint:n,handle:i,scaleX:o,scaleY:a}=t,{minWidth:l=1,maxWidth:d=1/0,minHeight:c=1,maxHeight:u=1/0}=r,p=e.props.w*o,h=e.props.h*a,f=new Vec2d_Vec2d(0,0);if(p>0){if(p<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=p-l;break;case"top":case"bottom":f.x=(p-l)/2;break;default:f.x=0}p=l}}else if(f.x=p,(p=-p)<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=-p;break;default:f.x=-l}p=l}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":f.y=h-c;break;case"right":case"left":f.y=(h-c)/2;break;default:f.y=0}h=c}}else if(f.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":f.y=-h;break;default:f.y=-c}h=c}let{x:g,y:m}=f.rot(e.rotation).add(n);return{x:g,y:m,props:{w:Math.min(d,p),h:Math.min(u,h)}}}let BaseBoxShapeUtil=class BaseBoxShapeUtil extends ShapeUtil{getGeometry(e){return new Rectangle2d({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,t)=>resizeBox(e,t)};function getArrowPoints(e,t,r){let n;let i="end"===t?e.end.point:e.start.point,o="end"===t?e.start.point:e.end.point,a=e.isStraight?Vec2d_Vec2d.Dist(o,i):Math.abs(e.bodyArc.length),l=Math.max(Math.min(a/5,3*r),r);if(e.isStraight)n=Vec2d_Vec2d.Nudge(i,o,l);else{let r=intersectCircleCircle(i,l,e.handleArc.center,e.handleArc.radius);n="end"===t?e.handleArc.sweepFlag?r[0]:r[1]:e.handleArc.sweepFlag?r[1]:r[0]}return{point:i,int:n}}function getArrowhead({point:e,int:t}){let r=Vec2d_Vec2d.RotWith(t,e,r8/6),n=Vec2d_Vec2d.RotWith(t,e,-r8/6);return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${n.x} ${n.y}`}function getTriangleHead({point:e,int:t}){let r=Vec2d_Vec2d.RotWith(t,e,r8/6),n=Vec2d_Vec2d.RotWith(t,e,-r8/6);return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${n.x} ${n.y} Z`}function getInvertedTriangleHead({point:e,int:t}){let r=Vec2d_Vec2d.Sub(t,e).div(2),n=Vec2d_Vec2d.Add(e,Vec2d_Vec2d.Rot(r,r6)),i=Vec2d_Vec2d.Sub(e,Vec2d_Vec2d.Rot(r,r6));return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}function getDotHead({point:e,int:t}){let r=Vec2d_Vec2d.Lrp(e,t,.45),n=Vec2d_Vec2d.Dist(r,e);return`M ${r.x-n},${r.y}
  a ${n},${n} 0 1,0 ${2*n},0
  a ${n},${n} 0 1,0 -${2*n},0 `}function getDiamondHead({point:e,int:t}){let r=Vec2d_Vec2d.Lrp(e,t,.75),n=Vec2d_Vec2d.RotWith(r,e,r8/4),i=Vec2d_Vec2d.RotWith(r,e,-r8/4),o=Vec2d_Vec2d.Lrp(n,i,.5);return o.add(Vec2d_Vec2d.Sub(o,e)),`M ${o.x} ${o.y} L ${n.x} ${n.y} ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function getSquareHead({int:e,point:t}){let r=Vec2d_Vec2d.Lrp(t,e,.85),n=Vec2d_Vec2d.Sub(r,t).div(2),i=Vec2d_Vec2d.Add(t,Vec2d_Vec2d.Rot(n,r6)),o=Vec2d_Vec2d.Sub(t,Vec2d_Vec2d.Rot(n,r6)),a=Vec2d_Vec2d.Add(r,Vec2d_Vec2d.Rot(n,r6)),l=Vec2d_Vec2d.Sub(r,Vec2d_Vec2d.Rot(n,r6));return`M ${i.x} ${i.y} L ${a.x} ${a.y} L ${l.x} ${l.y} L ${o.x} ${o.y} Z`}function getBarHead({int:e,point:t}){let r=Vec2d_Vec2d.Sub(e,t).div(2),n=Vec2d_Vec2d.Add(t,Vec2d_Vec2d.Rot(r,r6)),i=Vec2d_Vec2d.Sub(t,Vec2d_Vec2d.Rot(r,r6));return`M ${n.x} ${n.y} L ${i.x} ${i.y}`}function getArrowheadPathForType(e,t,r){let n="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===n)return;let i=getArrowPoints(e,t,r);if(i){switch(n){case"bar":return getBarHead(i);case"square":return getSquareHead(i);case"diamond":return getDiamondHead(i);case"dot":return getDotHead(i);case"inverted":return getInvertedTriangleHead(i);case"arrow":return getArrowhead(i);case"triangle":return getTriangleHead(i)}return""}}let Idle=class Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let Pointing=class Pointing extends StateNode{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{let{isMenuOpen:e}=this.editor;this.wasFocusedOnEnter=!e};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,n=createShapeId();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:r,x:t.x,y:t.y,props:{w:1,h:1}}]).select(n),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);let t=this.parent.shapeType,r=createShapeId();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);let n=this.editor.getShape(r),{w:i,h:o}=this.editor.getShapeUtil(n).getDefaultProps(),a=new Vec2d_Vec2d(i/2,o/2),l=this.editor.getShapeParentTransform(n);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:r,type:t,x:n.x-a.x,y:n.y-a.y}]),this.editor.setSelectedShapes([r]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle",{})}};let BaseBoxShapeTool=class BaseBoxShapeTool extends StateNode{static id="box";static initial="idle";static children=()=>[Idle,Pointing]};function useIsCropping(e){let t=useEditor();return useValue("isCropping",()=>t.croppingShapeId===e,[t,e])}function useIsEditing(e){let t=useEditor();return useValue("isEditing",()=>t.editingShapeId===e,[t,e])}function useSelectionEvents(e){let t=useEditor(),r=(0,T.useMemo)(function(){let r,n;return{onPointerDown:r=>{if(r.isKilled)return;if(2===r.button){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...getPointerInfo(r)});return}if(0!==r.button)return;let n=loopToHtmlElement(r.currentTarget);function releaseCapture(){n.removeEventListener("pointerup",releaseCapture),releasePointerCapture(n,r)}setPointerCapture(n,r),n.addEventListener("pointerup",releaseCapture),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...getPointerInfo(r)}),stopEventPropagation(r)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===r&&i.clientY===n||(r=i.clientX,n=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...getPointerInfo(i)}))},onPointerUp:r=>{r.isKilled||0!==r.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...getPointerInfo(r)})}}},[t,e]);return r}function getVerticesCountForLength(e,t=20){return Math.max(8,Math.ceil(e/t))}let Arc2d=class Arc2d extends Geometry2d{_center;radius;start;end;measure;length;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});let{center:t,radius:r,sweepFlag:n,largeArcFlag:i,start:o,end:a}=e;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=Vec2d_Vec2d.Angle(t,o),this.angleEnd=Vec2d_Vec2d.Angle(t,a),this.measure=getArcMeasure(this.angleStart,this.angleEnd,n,i),this.length=this.measure*r,this.start=o,this.end=a,this._center=t,this.radius=r}nearestPoint(e){let t;let{_center:r,measure:n,radius:i,angleEnd:o,angleStart:a,start:l,end:d}=this,c=getPointInArcT(n,a,o,r.angle(e));if(c<=0)return l;if(c>=1)return d;let u=r.clone().add(e.clone().sub(r).uni().mul(i)),p=1/0;for(let r of[l,d,u])e.dist(r)<p&&(t=r,p=e.dist(r));if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,r){let{_center:n,radius:i,measure:o,angleStart:a,angleEnd:l}=this,d=intersectLineSegmentCircle(e,t,n,i);return null!==d&&d.some(e=>{let t=getPointInArcT(o,a,l,n.angle(e));return t>=0&&t<=1})}getVertices(){let{_center:e,measure:t,length:r,radius:n,angleStart:i}=this,o=[];for(let a=0,l=getVerticesCountForLength(Math.abs(r));a<l+1;a++){let r=a/l*t,d=i+r;o.push(e.clone().add(new Vec2d_Vec2d(Math.cos(d),Math.sin(d)).mul(n)))}return o}};function getPointInArcT(e,t,r,n){let i;if(!(Math.abs(e)>r8))return(i=shortAngleDist(t,n))/e;{i=shortAngleDist(t,n);let o=shortAngleDist(n,r);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}}function getArcMeasure(e,t,r,n){let i=2*((t-e)%r9)%r9-(t-e)%r9;return n?(r9-Math.abs(i))*(r?1:-1):i}let Circle2d=class Circle2d extends Geometry2d{constructor(e){super({isClosed:!0,...e}),this.config=e;let{x:t=0,y:r=0,radius:n}=e;this.x=t,this.y=r,this._center=new Vec2d_Vec2d(n+t,n+r),this.radius=n}_center;radius;x;y;getBounds(){return new Box2d_Box2d(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){let{_center:e,radius:t}=this,r=r9*t,n=[];for(let i=0,o=getVerticesCountForLength(r);i<o;i++){let r=i/o*r9;n.push(e.clone().add(Vec2d_Vec2d.FromAngle(r).mul(t)))}return n}nearestPoint(e){let{_center:t,radius:r}=this;return t.equals(e)?Vec2d_Vec2d.AddXY(t,r,0):t.clone().add(e.clone().sub(t).uni().mul(r))}hitTestLineSegment(e,t,r){let{_center:n,radius:i}=this;return null!==intersectLineSegmentCircle(e,t,n,i)}};let CubicBezier2d=class CubicBezier2d extends Polyline2d{a;b;c;d;constructor(e){let{start:t,cp1:r,cp2:n,end:i}=e;super({...e,points:[t,i]}),this.a=t,this.b=r,this.c=n,this.d=i}getVertices(){let e=[],{a:t,b:r,c:n,d:i}=this;for(let o=0;o<=10;o++){let a=o/10;e.push(new Vec2d_Vec2d((1-a)*(1-a)*(1-a)*t.x+3*((1-a)*(1-a))*a*r.x+3*(1-a)*(a*a)*n.x+a*a*a*i.x,(1-a)*(1-a)*(1-a)*t.y+3*((1-a)*(1-a))*a*r.y+3*(1-a)*(a*a)*n.y+a*a*a*i.y))}return e}midPoint(){return getAtT(this,.5)}nearestPoint(e){let t;let r=1/0;for(let n of this.segments){let i=n.nearestPoint(e),o=i.dist(e);o<r&&(t=i,r=o)}if(!t)throw Error("nearest point not found");return t}};function getAtT(e,t){let{a:r,b:n,c:i,d:o}=e;return new Vec2d_Vec2d((1-t)*(1-t)*(1-t)*r.x+3*((1-t)*(1-t))*t*n.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*r.y+3*((1-t)*(1-t))*t*n.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}let CubicSpline2d=class CubicSpline2d extends Geometry2d{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{points:e}=this,t=e.length,r=t-2;for(let n=0;n<t-1;n++){let t=0===n?e[0]:e[n-1],i=e[n],o=e[n+1],a=n===r?o:e[n+2],l=0===n?t:new Vec2d_Vec2d(i.x+(o.x-t.x)/6*1.25,i.y+(o.y-t.y)/6*1.25),d=n===r?o:new Vec2d_Vec2d(o.x-(a.x-i.x)/6*1.25,o.y-(a.y-i.y)/6*1.25);this._segments.push(new CubicBezier2d({start:i,cp1:l,cp2:d,end:o}))}}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){let e=this.segments.reduce((e,t)=>e.concat(t.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t;let r=1/0;for(let n of this.segments){let i=n.nearestPoint(e),o=i.dist(e);o<r&&(t=i,r=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,r){return this.segments.some(n=>n.hitTestLineSegment(e,t,r))}};let Ellipse2d=class Ellipse2d extends Geometry2d{constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:r}=e;this.w=t,this.h=r}w;h;_edges;get edges(){if(!this._edges){let{vertices:e}=this;this._edges=[];for(let t=0,r=e.length;t<r;t++){let n=e[t],i=e[(t+1)%r];this._edges.push(new Edge2d({start:n,end:i}))}}return this._edges}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),r=e/2,n=t/2,i=Math.pow(r-n,2)/Math.pow(r+n,2),o=r8*(r+n)*(1+3*i/(10+Math.sqrt(4-3*i))),a=getVerticesCountForLength(o),l=r9/a,d=Math.cos(l),c=Math.sin(l),u=0,p=1,h=0,f=1,g=Array(a);for(let e=0;e<a;e++)g[e]=new Vec2d_Vec2d(r+r*p,n+n*u),h=c*p+d*u,f=d*p-c*u,u=h,p=f;return g}nearestPoint(e){let t;let r=1/0;for(let n of this.edges){let i=n.nearestPoint(e),o=i.dist(e);o<r&&(t=i,r=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,r){return this.edges.some(n=>n.hitTestLineSegment(e,t,r))}getBounds(){return new Box2d_Box2d(0,0,this.w,this.h)}};let Stadium2d=class Stadium2d extends Ellipse2d{constructor(e){super({...e}),this.config=e}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),r=e/2,n=t/2,i=Array(18);if(t>e)for(let e=0;e<9;e++){let n=-r8+r8*e/8,o=r8*e/8;i[e]=new Vec2d_Vec2d(r+r*Math.cos(n),r+r*Math.sin(n)),i[e+9]=new Vec2d_Vec2d(r+r*Math.cos(o),t-r+r*Math.sin(o))}else for(let r=0;r<9;r++){let o=-r6+r8*r/8,a=r6+-(r8*r)/8;i[r]=new Vec2d_Vec2d(e-n+n*Math.cos(o),t-n+n*Math.sin(o)),i[r+9]=new Vec2d_Vec2d(n-n*Math.cos(a),t-n+n*Math.sin(a))}return i}};async function hardReset({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(getAllIndexDbNames().map(e=>deleteDB(e))),localStorage.clear(),e&&window.location.reload()}function openWindow(e,t="_blank"){nr.openWindow(e,t)}"undefined"!=typeof window&&(window.__tldraw__hardReset=hardReset),r(3318),r(205),r(443),r(1680),r(8714);let iR=(0,T.createContext)(null);function AssetUrlsProvider({assetUrls:e,children:t}){return(0,I.jsx)(iR.Provider,{value:e,children:t})}function useAssetUrls(){let e=(0,T.useContext)(iR);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let ij={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrowheads","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},iO={locale:"en",label:"English",messages:ij};async function fetchTranslation(e,t){let r=await fetch(t.translations.en);if(!r.ok)return console.warn("No main translations found."),iO;if("en"===e)return iO;let n=rq.find(t=>t.locale===e);if(!n)return console.warn(`No translation found for locale ${e}`),iO;let i=await fetch(t.translations[n.locale]),o=await i.json();if(!o)return console.warn(`No messages found for locale ${e}`),iO;let a=[];for(let e in iO.messages)o[e]||a.push(e);return a.length,{locale:e,label:n.label,messages:{...iO.messages,...o}}}let iL=T.createContext({}),useCurrentTranslation=()=>T.useContext(iL),iF=track(function({overrides:e,children:t}){let r=useEditor(),n=r.user.locale,i=useAssetUrls(),[o,a]=T.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...ij,...e.en}}:{locale:"en",label:"English",messages:ij});return T.useEffect(()=>{let t=!1;return async function(){let r=await fetchTranslation(n,i);r&&!t&&(e&&e[n]?a({...r,messages:{...r.messages,...e[n]}}):a(r))}(),()=>{t=!0}},[i,n,e]),(0,I.jsx)(iL.Provider,{value:o,children:t})});function useTranslation(){let e=useCurrentTranslation();return T.useCallback(function(t){return e.messages[t]??t},[e])}function Spinner(e){return(0,I.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,I.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,I.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,I.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,I.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}let iN=(0,T.memo)(function({small:e,invertIcon:t,icon:r,color:n,className:i,...o}){let a=useAssetUrls(),l=a.icons[r],d=(0,T.useRef)(null);return(0,T.useLayoutEffect)(()=>{d?.current&&(d.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[d,l]),(0,I.jsx)("div",{...o,ref:d,className:eb("tlui-icon",{"tlui-icon__small":e},i),style:{color:n,mask:`url(${l}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),iz="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,iB=iz?"⌘":"Ctrl",iU=iz?"⌥":"Alt";function kbd(e){return e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,iB).replace(/\?/g,iU).replace(/!/g,"⇧");return t[0].toUpperCase()+t.slice(1)})}function kbdStr(e){return"— "+e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,iB).replace(/\?/g,iU).replace(/!/g,"⇧");return t[0].toUpperCase()+t.slice(1)}).join(" ")}function Kbd({children:e}){return(0,I.jsx)("kbd",{className:"tlui-kbd",children:kbd(e).map((e,t)=>(0,I.jsx)("span",{children:e},t))})}let iH=T.forwardRef(function({label:e,icon:t,invertIcon:r,iconLeft:n,smallIcon:i,kbd:o,isChecked:a=!1,type:l="normal",children:d,spinner:c,...u},p){let h=useTranslation(),f=e?h(e):"";return(0,I.jsxs)("button",{ref:p,draggable:!1,type:"button",...u,title:u.title??f,className:eb("tlui-button",`tlui-button__${l}`,u.className),children:[n&&(0,I.jsx)(iN,{icon:n,className:"tlui-icon-left",small:!0}),d,e&&(0,I.jsxs)("span",{draggable:!1,children:[f,a&&(0,I.jsx)(iN,{icon:"check"})]}),o&&(0,I.jsx)(Kbd,{children:o}),t&&!c&&(0,I.jsx)(iN,{icon:t,small:!!e||i,invertIcon:r}),c&&(0,I.jsx)(Spinner,{})]})});function Header({className:e,children:t}){return(0,I.jsx)("div",{className:eb("tlui-dialog__header",e),children:t})}function Title({className:e,children:t}){return(0,I.jsx)(ef,{dir:"ltr",className:eb("tlui-dialog__header__title",e),children:t})}function CloseButton(){return(0,I.jsx)("div",{className:"tlui-dialog__header__close",children:(0,I.jsx)(eg,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,I.jsx)(iH,{"aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,I.jsx)(iN,{small:!0,icon:"cross-2"})})})})}function Body({className:e,children:t,style:r}){return(0,I.jsx)("div",{className:eb("tlui-dialog__body",e),style:r,children:t})}function Footer({className:e,children:t}){return(0,I.jsx)("div",{className:eb("tlui-dialog__footer",e),children:t})}function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(e){let t=e+"CollectionProvider",[r,n]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(t),[i,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),a=e+"CollectionSlot",l=T.forwardRef((e,t)=>{let{scope:r,children:n}=e,i=o(a,r),l=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,i.collectionRef);return T.createElement(R,{ref:l},n)}),d=e+"CollectionItemSlot",c="data-radix-collection-item",u=T.forwardRef((e,t)=>{let{scope:r,children:n,...i}=e,a=T.useRef(null),l=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,a),u=o(d,r);return T.useEffect(()=>(u.itemMap.set(a,{ref:a,...i}),()=>void u.itemMap.delete(a))),T.createElement(R,{[c]:"",ref:l},n)});return[{Provider:e=>{let{scope:t,children:r}=e,n=T.useRef(null),o=T.useRef(new Map).current;return T.createElement(i,{scope:t,itemMap:o,collectionRef:n},r)},Slot:l,ItemSlot:u},function(t){let r=o(e+"CollectionConsumer",t),n=T.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${c}]`)),n=Array.from(r.itemMap.values()),i=n.sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current));return i},[r.collectionRef,r.itemMap]);return n},n]}let iG=(0,T.createContext)(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(e){let t=(0,T.useContext)(iG);return e||t||"ltr"}let iW=["top","right","bottom","left"],iK=Math.min,iq=Math.max,iY=Math.round,iX=Math.floor,createCoords=e=>({x:e,y:e}),iZ={left:"right",right:"left",bottom:"top",top:"bottom"},iQ={start:"end",end:"start"};function floating_ui_utils_evaluate(e,t){return"function"==typeof e?e(t):e}function floating_ui_utils_getSide(e){return e.split("-")[0]}function floating_ui_utils_getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return"x"===e?"y":"x"}function getAxisLength(e){return"y"===e?"height":"width"}function floating_ui_utils_getSideAxis(e){return["top","bottom"].includes(floating_ui_utils_getSide(e))?"y":"x"}function floating_ui_utils_getAlignmentSides(e,t,r){void 0===r&&(r=!1);let n=floating_ui_utils_getAlignment(e),i=getOppositeAxis(floating_ui_utils_getSideAxis(e)),o=getAxisLength(i),a="x"===i?n===(r?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[o]>t.floating[o]&&(a=getOppositePlacement(a)),[a,getOppositePlacement(a)]}function getExpandedPlacements(e){let t=getOppositePlacement(e);return[floating_ui_utils_getOppositeAlignmentPlacement(e),t,floating_ui_utils_getOppositeAlignmentPlacement(t)]}function floating_ui_utils_getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,e=>iQ[e])}function getSideList(e,t,r){let n=["left","right"],i=["right","left"];switch(e){case"top":case"bottom":if(r)return t?i:n;return t?n:i;case"left":case"right":return t?["top","bottom"]:["bottom","top"];default:return[]}}function getOppositeAxisPlacements(e,t,r,n){let i=floating_ui_utils_getAlignment(e),o=getSideList(floating_ui_utils_getSide(e),"start"===r,n);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(floating_ui_utils_getOppositeAlignmentPlacement)))),o}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,e=>iZ[e])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function floating_ui_utils_getPaddingObject(e){return"number"!=typeof e?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function floating_ui_utils_rectToClientRect(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function computeCoordsFromPlacement(e,t,r){let n,{reference:i,floating:o}=e,a=floating_ui_utils_getSideAxis(t),l=getOppositeAxis(floating_ui_utils_getSideAxis(t)),d=getAxisLength(l),c=floating_ui_utils_getSide(t),u="y"===a,p=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,f=i[d]/2-o[d]/2;switch(c){case"top":n={x:p,y:i.y-o.height};break;case"bottom":n={x:p,y:i.y+i.height};break;case"right":n={x:i.x+i.width,y:h};break;case"left":n={x:i.x-o.width,y:h};break;default:n={x:i.x,y:i.y}}switch(floating_ui_utils_getAlignment(t)){case"start":n[l]-=f*(r&&u?-1:1);break;case"end":n[l]+=f*(r&&u?-1:1)}return n}let computePosition=async(e,t,r)=>{let{placement:n="bottom",strategy:i="absolute",middleware:o=[],platform:a}=r,l=o.filter(Boolean),d=await (null==a.isRTL?void 0:a.isRTL(t)),c=await a.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:p}=computeCoordsFromPlacement(c,n,d),h=n,f={},g=0;for(let r=0;r<l.length;r++){let{name:o,fn:m}=l[r],{x:y,y:b,data:v,reset:S}=await m({x:u,y:p,initialPlacement:n,placement:h,strategy:i,middlewareData:f,rects:c,platform:a,elements:{reference:e,floating:t}});if(u=null!=y?y:u,p=null!=b?b:p,f={...f,[o]:{...f[o],...v}},S&&g<=50){g++,"object"==typeof S&&(S.placement&&(h=S.placement),S.rects&&(c=!0===S.rects?await a.getElementRects({reference:e,floating:t,strategy:i}):S.rects),{x:u,y:p}=computeCoordsFromPlacement(c,h,d)),r=-1;continue}}return{x:u,y:p,placement:h,strategy:i,middlewareData:f}};async function detectOverflow(e,t){var r;void 0===t&&(t={});let{x:n,y:i,platform:o,rects:a,elements:l,strategy:d}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:h=!1,padding:f=0}=floating_ui_utils_evaluate(t,e),g=floating_ui_utils_getPaddingObject(f),m=l[h?"floating"===p?"reference":"floating":p],y=floating_ui_utils_rectToClientRect(await o.getClippingRect({element:null==(r=await (null==o.isElement?void 0:o.isElement(m)))||r?m:m.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(l.floating)),boundary:c,rootBoundary:u,strategy:d})),b="floating"===p?{...a.floating,x:n,y:i}:a.reference,v=await (null==o.getOffsetParent?void 0:o.getOffsetParent(l.floating)),S=await (null==o.isElement?void 0:o.isElement(v))&&await (null==o.getScale?void 0:o.getScale(v))||{x:1,y:1},x=floating_ui_utils_rectToClientRect(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:b,offsetParent:v,strategy:d}):b);return{top:(y.top-x.top+g.top)/S.y,bottom:(x.bottom-y.bottom+g.bottom)/S.y,left:(y.left-x.left+g.left)/S.x,right:(x.right-y.right+g.right)/S.x}}let arrow=e=>({name:"arrow",options:e,async fn(t){let{x:r,y:n,placement:i,rects:o,platform:a,elements:l,middlewareData:d}=t,{element:c,padding:u=0}=floating_ui_utils_evaluate(e,t)||{};if(null==c)return{};let p=floating_ui_utils_getPaddingObject(u),h={x:r,y:n},f=getOppositeAxis(floating_ui_utils_getSideAxis(i)),g=getAxisLength(f),m=await a.getDimensions(c),y="y"===f,b=y?"clientHeight":"clientWidth",v=o.reference[g]+o.reference[f]-h[f]-o.floating[g],S=h[f]-o.reference[f],x=await (null==a.getOffsetParent?void 0:a.getOffsetParent(c)),w=x?x[b]:0;w&&await (null==a.isElement?void 0:a.isElement(x))||(w=l.floating[b]||o.floating[g]);let _=w/2-m[g]/2-1,P=iK(p[y?"top":"left"],_),E=iK(p[y?"bottom":"right"],_),C=w-m[g]-E,k=w/2-m[g]/2+(v/2-S/2),I=iq(P,iK(k,C)),T=!d.arrow&&null!=floating_ui_utils_getAlignment(i)&&k!=I&&o.reference[g]/2-(k<P?P:E)-m[g]/2<0,A=T?k<P?k-P:k-C:0;return{[f]:h[f]+A,data:{[f]:I,centerOffset:k-I-A,...T&&{alignmentOffset:A}},reset:T}}});function getSideOffsets(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function isAnySideFullyClipped(e){return iW.some(t=>e[t]>=0)}async function convertValueToCoords(e,t){let{placement:r,platform:n,elements:i}=e,o=await (null==n.isRTL?void 0:n.isRTL(i.floating)),a=floating_ui_utils_getSide(r),l=floating_ui_utils_getAlignment(r),d="y"===floating_ui_utils_getSideAxis(r),c=["left","top"].includes(a)?-1:1,u=o&&d?-1:1,p=floating_ui_utils_evaluate(t,e),{mainAxis:h,crossAxis:f,alignmentAxis:g}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return l&&"number"==typeof g&&(f="end"===l?-1*g:g),d?{x:f*u,y:h*c}:{x:h*c,y:f*u}}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var t;return(null==e?void 0:null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function getDocumentElement(e){var t;return null==(t=(isNode(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function isNode(e){return e instanceof Node||e instanceof getWindow(e).Node}function isElement(e){return e instanceof Element||e instanceof getWindow(e).Element}function isHTMLElement(e){return e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement}function isShadowRoot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot)}function isOverflowElement(e){let{overflow:t,overflowX:r,overflowY:n,display:i}=floating_ui_utils_dom_getComputedStyle(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(i)}function isTableElement(e){return["table","td","th"].includes(getNodeName(e))}function isContainingBlock(e){let t=isWebKit(),r=floating_ui_utils_dom_getComputedStyle(e);return"none"!==r.transform||"none"!==r.perspective||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||["transform","perspective","filter"].some(e=>(r.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(r.contain||"").includes(e))}function getContainingBlock(e){let t=getParentNode(e);for(;isHTMLElement(t)&&!isLastTraversableNode(t);){if(isContainingBlock(t))return t;t=getParentNode(t)}return null}function isWebKit(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(e){return["html","body","#document"].includes(getNodeName(e))}function floating_ui_utils_dom_getComputedStyle(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function getParentNode(e){if("html"===getNodeName(e))return e;let t=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(t)?t.host:t}function getNearestOverflowAncestor(e){let t=getParentNode(e);return isLastTraversableNode(t)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement(t)&&isOverflowElement(t)?t:getNearestOverflowAncestor(t)}function getOverflowAncestors(e,t,r){var n;void 0===t&&(t=[]),void 0===r&&(r=!0);let i=getNearestOverflowAncestor(e),o=i===(null==(n=e.ownerDocument)?void 0:n.body),a=getWindow(i);return o?t.concat(a,a.visualViewport||[],isOverflowElement(i)?i:[],a.frameElement&&r?getOverflowAncestors(a.frameElement):[]):t.concat(i,getOverflowAncestors(i,[],r))}function getCssDimensions(e){let t=floating_ui_utils_dom_getComputedStyle(e),r=parseFloat(t.width)||0,n=parseFloat(t.height)||0,i=isHTMLElement(e),o=i?e.offsetWidth:r,a=i?e.offsetHeight:n,l=iY(r)!==o||iY(n)!==a;return l&&(r=o,n=a),{width:r,height:n,$:l}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){let t=unwrapElement(e);if(!isHTMLElement(t))return createCoords(1);let r=t.getBoundingClientRect(),{width:n,height:i,$:o}=getCssDimensions(t),a=(o?iY(r.width):r.width)/n,l=(o?iY(r.height):r.height)/i;return a&&Number.isFinite(a)||(a=1),l&&Number.isFinite(l)||(l=1),{x:a,y:l}}let iJ=createCoords(0);function getVisualOffsets(e){let t=getWindow(e);return isWebKit()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:iJ}function shouldAddVisualOffsets(e,t,r){return void 0===t&&(t=!1),!!r&&(!t||r===getWindow(e))&&t}function getBoundingClientRect(e,t,r,n){void 0===t&&(t=!1),void 0===r&&(r=!1);let i=e.getBoundingClientRect(),o=unwrapElement(e),a=createCoords(1);t&&(n?isElement(n)&&(a=getScale(n)):a=getScale(e));let l=shouldAddVisualOffsets(o,r,n)?getVisualOffsets(o):createCoords(0),d=(i.left+l.x)/a.x,c=(i.top+l.y)/a.y,u=i.width/a.x,p=i.height/a.y;if(o){let e=getWindow(o),t=n&&isElement(n)?getWindow(n):n,r=e.frameElement;for(;r&&n&&t!==e;){let e=getScale(r),t=r.getBoundingClientRect(),n=floating_ui_utils_dom_getComputedStyle(r),i=t.left+(r.clientLeft+parseFloat(n.paddingLeft))*e.x,o=t.top+(r.clientTop+parseFloat(n.paddingTop))*e.y;d*=e.x,c*=e.y,u*=e.x,p*=e.y,d+=i,c+=o,r=getWindow(r).frameElement}}return floating_ui_utils_rectToClientRect({width:u,height:p,x:d,y:c})}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{rect:t,offsetParent:r,strategy:n}=e,i=isHTMLElement(r),o=getDocumentElement(r);if(r===o)return t;let a={scrollLeft:0,scrollTop:0},l=createCoords(1),d=createCoords(0);if((i||!i&&"fixed"!==n)&&(("body"!==getNodeName(r)||isOverflowElement(o))&&(a=getNodeScroll(r)),isHTMLElement(r))){let e=getBoundingClientRect(r);l=getScale(r),d.x=e.x+r.clientLeft,d.y=e.y+r.clientTop}return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-a.scrollLeft*l.x+d.x,y:t.y*l.y-a.scrollTop*l.y+d.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getWindowScrollBarX(e){return getBoundingClientRect(getDocumentElement(e)).left+getNodeScroll(e).scrollLeft}function getDocumentRect(e){let t=getDocumentElement(e),r=getNodeScroll(e),n=e.ownerDocument.body,i=iq(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=iq(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight),a=-r.scrollLeft+getWindowScrollBarX(e),l=-r.scrollTop;return"rtl"===floating_ui_utils_dom_getComputedStyle(n).direction&&(a+=iq(t.clientWidth,n.clientWidth)-i),{width:i,height:o,x:a,y:l}}function getViewportRect(e,t){let r=getWindow(e),n=getDocumentElement(e),i=r.visualViewport,o=n.clientWidth,a=n.clientHeight,l=0,d=0;if(i){o=i.width,a=i.height;let e=isWebKit();(!e||e&&"fixed"===t)&&(l=i.offsetLeft,d=i.offsetTop)}return{width:o,height:a,x:l,y:d}}function getInnerBoundingClientRect(e,t){let r=getBoundingClientRect(e,!0,"fixed"===t),n=r.top+e.clientTop,i=r.left+e.clientLeft,o=isHTMLElement(e)?getScale(e):createCoords(1),a=e.clientWidth*o.x,l=e.clientHeight*o.y,d=i*o.x,c=n*o.y;return{width:a,height:l,x:d,y:c}}function getClientRectFromClippingAncestor(e,t,r){let n;if("viewport"===t)n=getViewportRect(e,r);else if("document"===t)n=getDocumentRect(getDocumentElement(e));else if(isElement(t))n=getInnerBoundingClientRect(t,r);else{let r=getVisualOffsets(e);n={...t,x:t.x-r.x,y:t.y-r.y}}return floating_ui_utils_rectToClientRect(n)}function hasFixedPositionAncestor(e,t){let r=getParentNode(e);return!(r===t||!isElement(r)||isLastTraversableNode(r))&&("fixed"===floating_ui_utils_dom_getComputedStyle(r).position||hasFixedPositionAncestor(r,t))}function getClippingElementAncestors(e,t){let r=t.get(e);if(r)return r;let n=getOverflowAncestors(e,[],!1).filter(e=>isElement(e)&&"body"!==getNodeName(e)),i=null,o="fixed"===floating_ui_utils_dom_getComputedStyle(e).position,a=o?getParentNode(e):e;for(;isElement(a)&&!isLastTraversableNode(a);){let t=floating_ui_utils_dom_getComputedStyle(a),r=isContainingBlock(a);r||"fixed"!==t.position||(i=null);let l=o?!r&&!i:!r&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||isOverflowElement(a)&&!r&&hasFixedPositionAncestor(e,a);l?n=n.filter(e=>e!==a):i=t,a=getParentNode(a)}return t.set(e,n),n}function getClippingRect(e){let{element:t,boundary:r,rootBoundary:n,strategy:i}=e,o="clippingAncestors"===r?getClippingElementAncestors(t,this._c):[].concat(r),a=[...o,n],l=a[0],d=a.reduce((e,r)=>{let n=getClientRectFromClippingAncestor(t,r,i);return e.top=iq(n.top,e.top),e.right=iK(n.right,e.right),e.bottom=iK(n.bottom,e.bottom),e.left=iq(n.left,e.left),e},getClientRectFromClippingAncestor(t,l,i));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function getDimensions(e){return getCssDimensions(e)}function getRectRelativeToOffsetParent(e,t,r){let n=isHTMLElement(t),i=getDocumentElement(t),o="fixed"===r,a=getBoundingClientRect(e,!0,o,t),l={scrollLeft:0,scrollTop:0},d=createCoords(0);if(n||!n&&!o){if(("body"!==getNodeName(t)||isOverflowElement(i))&&(l=getNodeScroll(t)),n){let e=getBoundingClientRect(t,!0,o,t);d.x=e.x+t.clientLeft,d.y=e.y+t.clientTop}else i&&(d.x=getWindowScrollBarX(i))}return{x:a.left+l.scrollLeft-d.x,y:a.top+l.scrollTop-d.y,width:a.width,height:a.height}}function getTrueOffsetParent(e,t){return isHTMLElement(e)&&"fixed"!==floating_ui_utils_dom_getComputedStyle(e).position?t?t(e):e.offsetParent:null}function getOffsetParent(e,t){let r=getWindow(e);if(!isHTMLElement(e))return r;let n=getTrueOffsetParent(e,t);for(;n&&isTableElement(n)&&"static"===floating_ui_utils_dom_getComputedStyle(n).position;)n=getTrueOffsetParent(n,t);return n&&("html"===getNodeName(n)||"body"===getNodeName(n)&&"static"===floating_ui_utils_dom_getComputedStyle(n).position&&!isContainingBlock(n))?r:n||getContainingBlock(e)||r}let getElementRects=async function(e){let{reference:t,floating:r,strategy:n}=e,i=this.getOffsetParent||getOffsetParent,o=this.getDimensions;return{reference:getRectRelativeToOffsetParent(t,await i(r),n),floating:{x:0,y:0,...await o(r)}}};function isRTL(e){return"rtl"===floating_ui_utils_dom_getComputedStyle(e).direction}let i0={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement:getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement:isElement,isRTL};function observeMove(e,t){let r,n=null,i=getDocumentElement(e);function cleanup(){clearTimeout(r),n&&n.disconnect(),n=null}function refresh(o,a){void 0===o&&(o=!1),void 0===a&&(a=1),cleanup();let{left:l,top:d,width:c,height:u}=e.getBoundingClientRect();if(o||t(),!c||!u)return;let p=iX(d),h=iX(i.clientWidth-(l+c)),f=iX(i.clientHeight-(d+u)),g=iX(l),m={rootMargin:-p+"px "+-h+"px "+-f+"px "+-g+"px",threshold:iq(0,iK(1,a))||1},y=!0;function handleObserve(e){let t=e[0].intersectionRatio;if(t!==a){if(!y)return refresh();t?refresh(!1,t):r=setTimeout(()=>{refresh(!1,1e-7)},100)}y=!1}try{n=new IntersectionObserver(handleObserve,{...m,root:i.ownerDocument})}catch(e){n=new IntersectionObserver(handleObserve,m)}n.observe(e)}return refresh(!0),cleanup}function autoUpdate(e,t,r,n){let i;void 0===n&&(n={});let{ancestorScroll:o=!0,ancestorResize:a=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:d="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,u=unwrapElement(e),p=o||a?[...u?getOverflowAncestors(u):[],...getOverflowAncestors(t)]:[];p.forEach(e=>{o&&e.addEventListener("scroll",r,{passive:!0}),a&&e.addEventListener("resize",r)});let h=u&&d?observeMove(u,r):null,f=-1,g=null;l&&(g=new ResizeObserver(e=>{let[n]=e;n&&n.target===u&&g&&(g.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{g&&g.observe(t)})),r()}),u&&!c&&g.observe(u),g.observe(t));let m=c?getBoundingClientRect(e):null;function frameLoop(){let t=getBoundingClientRect(e);m&&(t.x!==m.x||t.y!==m.y||t.width!==m.width||t.height!==m.height)&&r(),m=t,i=requestAnimationFrame(frameLoop)}return c&&frameLoop(),r(),()=>{p.forEach(e=>{o&&e.removeEventListener("scroll",r),a&&e.removeEventListener("resize",r)}),h&&h(),g&&g.disconnect(),g=null,c&&cancelAnimationFrame(i)}}let floating_ui_dom_computePosition=(e,t,r)=>{let n=new Map,i={platform:i0,...r},o={...i.platform,_c:n};return computePosition(e,t,{...i,platform:o})},floating_ui_react_dom_arrow=e=>{function isRef(e){return({}).hasOwnProperty.call(e,"current")}return{name:"arrow",options:e,fn(t){let{element:r,padding:n}="function"==typeof e?e(t):e;if(r&&isRef(r)){if(null!=r.current)return arrow({element:r.current,padding:n}).fn(t)}else if(r)return arrow({element:r,padding:n}).fn(t);return{}}}};var i1="undefined"!=typeof document?T.useLayoutEffect:T.useEffect;function deepEqual(e,t){let r,n,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!deepEqual(e[n],t[n]))return!1;return!0}if((r=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!({}).hasOwnProperty.call(t,i[n]))return!1;for(n=r;0!=n--;){let r=i[n];if(("_owner"!==r||!e.$$typeof)&&!deepEqual(e[r],t[r]))return!1}return!0}return e!=e&&t!=t}function getDPR(e){if("undefined"==typeof window)return 1;let t=e.ownerDocument.defaultView||window;return t.devicePixelRatio||1}function roundByDPR(e,t){let r=getDPR(e);return Math.round(t*r)/r}function useLatestRef(e){let t=T.useRef(e);return i1(()=>{t.current=e}),t}function useFloating(e){void 0===e&&(e={});let{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:i,elements:{reference:o,floating:a}={},transform:l=!0,whileElementsMounted:d,open:c}=e,[u,p]=T.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[h,f]=T.useState(n);deepEqual(h,n)||f(n);let[g,m]=T.useState(null),[y,b]=T.useState(null),v=T.useCallback(e=>{e!=_.current&&(_.current=e,m(e))},[m]),S=T.useCallback(e=>{e!==P.current&&(P.current=e,b(e))},[b]),x=o||g,w=a||y,_=T.useRef(null),P=T.useRef(null),E=T.useRef(u),C=useLatestRef(d),k=useLatestRef(i),I=T.useCallback(()=>{if(!_.current||!P.current)return;let e={placement:t,strategy:r,middleware:h};k.current&&(e.platform=k.current),floating_ui_dom_computePosition(_.current,P.current,e).then(e=>{let t={...e,isPositioned:!0};A.current&&!deepEqual(E.current,t)&&(E.current=t,V.flushSync(()=>{p(t)}))})},[h,t,r,k]);i1(()=>{!1===c&&E.current.isPositioned&&(E.current.isPositioned=!1,p(e=>({...e,isPositioned:!1})))},[c]);let A=T.useRef(!1);i1(()=>(A.current=!0,()=>{A.current=!1}),[]),i1(()=>{if(x&&(_.current=x),w&&(P.current=w),x&&w){if(C.current)return C.current(x,w,I);I()}},[x,w,I,C]);let $=T.useMemo(()=>({reference:_,floating:P,setReference:v,setFloating:S}),[v,S]),M=T.useMemo(()=>({reference:x,floating:w}),[x,w]),D=T.useMemo(()=>{let e={position:r,left:0,top:0};if(!M.floating)return e;let t=roundByDPR(M.floating,u.x),n=roundByDPR(M.floating,u.y);return l?{...e,transform:"translate("+t+"px, "+n+"px)",...getDPR(M.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:n}},[r,l,M.floating,u.x,u.y]);return T.useMemo(()=>({...u,update:I,refs:$,elements:M,floatingStyles:D}),[u,I,$,M,D])}let i2=(0,T.forwardRef)((e,t)=>{let{children:r,width:n=10,height:i=5,...o}=e;return(0,T.createElement)(O.svg,_extends({},o,{ref:t,width:n,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?r:(0,T.createElement)("polygon",{points:"0,0 30,0 15,10"}))});function $db6c3485150b8e66$export$1ab7ae714698c4b8(e){let[t,r]=(0,T.useState)(void 0);return $(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;r({width:n,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}let i3="Popper",[i5,i4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(i3),[i8,i6]=i5(i3),i9=(0,T.forwardRef)((e,t)=>{let{__scopePopper:r,virtualRef:n,...i}=e,o=i6("PopperAnchor",r),a=(0,T.useRef)(null),l=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,a);return(0,T.useEffect)(()=>{o.onAnchorChange((null==n?void 0:n.current)||a.current)}),n?null:(0,T.createElement)(O.div,_extends({},i,{ref:l}))}),i7="PopperContent",[oe,ot]=i5(i7),or=(0,T.forwardRef)((e,t)=>{var r,n,i,o,a,l,d,c;let{__scopePopper:u,side:p="bottom",sideOffset:h=0,align:f="center",alignOffset:g=0,arrowPadding:m=0,avoidCollisions:y=!0,collisionBoundary:b=[],collisionPadding:v=0,sticky:S="partial",hideWhenDetached:x=!1,updatePositionStrategy:w="optimized",onPlaced:_,...P}=e,E=i6(i7,u),[C,k]=(0,T.useState)(null),I=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>k(e)),[A,M]=(0,T.useState)(null),D=$db6c3485150b8e66$export$1ab7ae714698c4b8(A),V=null!==(r=null==D?void 0:D.width)&&void 0!==r?r:0,R=null!==(n=null==D?void 0:D.height)&&void 0!==n?n:0,j="number"==typeof v?v:{top:0,right:0,bottom:0,left:0,...v},L=Array.isArray(b)?b:[b],F=L.length>0,N={padding:j,boundary:L.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:F},{refs:z,floatingStyles:B,placement:U,isPositioned:H,middlewareData:G}=useFloating({strategy:"fixed",placement:p+("center"!==f?"-"+f:""),whileElementsMounted:(...e)=>{let t=autoUpdate(...e,{animationFrame:"always"===w});return t},elements:{reference:E.anchor},middleware:[function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){let{x:r,y:n}=t,i=await convertValueToCoords(t,e);return{x:r+i.x,y:n+i.y,data:i}}}}({mainAxis:h+R,alignmentAxis:g}),y&&function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:r,y:n,placement:i}=t,{mainAxis:o=!0,crossAxis:a=!1,limiter:l={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...d}=floating_ui_utils_evaluate(e,t),c={x:r,y:n},u=await detectOverflow(t,d),p=floating_ui_utils_getSideAxis(floating_ui_utils_getSide(i)),h=getOppositeAxis(p),f=c[h],g=c[p];if(o){let e=f+u["y"===h?"top":"left"],t=f-u["y"===h?"bottom":"right"];f=iq(e,iK(f,t))}if(a){let e="y"===p?"top":"left",t="y"===p?"bottom":"right",r=g+u[e],n=g-u[t];g=iq(r,iK(g,n))}let m=l.fn({...t,[h]:f,[p]:g});return{...m,data:{x:m.x-r,y:m.y-n}}}}}({mainAxis:!0,crossAxis:!1,limiter:"partial"===S?function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:r,y:n,placement:i,rects:o,middlewareData:a}=t,{offset:l=0,mainAxis:d=!0,crossAxis:c=!0}=floating_ui_utils_evaluate(e,t),u={x:r,y:n},p=floating_ui_utils_getSideAxis(i),h=getOppositeAxis(p),f=u[h],g=u[p],m=floating_ui_utils_evaluate(l,t),y="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(d){let e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+y.mainAxis,r=o.reference[h]+o.reference[e]-y.mainAxis;f<t?f=t:f>r&&(f=r)}if(c){var b,v;let e="y"===h?"width":"height",t=["top","left"].includes(floating_ui_utils_getSide(i)),r=o.reference[p]-o.floating[e]+(t&&(null==(b=a.offset)?void 0:b[p])||0)+(t?0:y.crossAxis),n=o.reference[p]+o.reference[e]+(t?0:(null==(v=a.offset)?void 0:v[p])||0)-(t?y.crossAxis:0);g<r?g=r:g>n&&(g=n)}return{[h]:f,[p]:g}}}}():void 0,...N}),y&&function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,n,i,o,a;let{placement:l,middlewareData:d,rects:c,initialPlacement:u,platform:p,elements:h}=t,{mainAxis:f=!0,crossAxis:g=!0,fallbackPlacements:m,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:v=!0,...S}=floating_ui_utils_evaluate(e,t);if(null!=(r=d.arrow)&&r.alignmentOffset)return{};let x=floating_ui_utils_getSide(l),w=floating_ui_utils_getSide(u)===u,_=await (null==p.isRTL?void 0:p.isRTL(h.floating)),P=m||(w||!v?[getOppositePlacement(u)]:getExpandedPlacements(u));m||"none"===b||P.push(...getOppositeAxisPlacements(u,v,b,_));let E=[u,...P],C=await detectOverflow(t,S),k=[],I=(null==(n=d.flip)?void 0:n.overflows)||[];if(f&&k.push(C[x]),g){let e=floating_ui_utils_getAlignmentSides(l,c,_);k.push(C[e[0]],C[e[1]])}if(I=[...I,{placement:l,overflows:k}],!k.every(e=>e<=0)){let e=((null==(i=d.flip)?void 0:i.index)||0)+1,t=E[e];if(t)return{data:{index:e,overflows:I},reset:{placement:t}};let r=null==(o=I.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:o.placement;if(!r)switch(y){case"bestFit":{let e=null==(a=I.map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:a[0];e&&(r=e);break}case"initialPlacement":r=u}if(l!==r)return{reset:{placement:r}}}return{}}}}({...N}),function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){let r,n;let{placement:i,rects:o,platform:a,elements:l}=t,{apply:d=()=>{},...c}=floating_ui_utils_evaluate(e,t),u=await detectOverflow(t,c),p=floating_ui_utils_getSide(i),h=floating_ui_utils_getAlignment(i),f="y"===floating_ui_utils_getSideAxis(i),{width:g,height:m}=o.floating;"top"===p||"bottom"===p?(r=p,n=h===(await (null==a.isRTL?void 0:a.isRTL(l.floating))?"start":"end")?"left":"right"):(n=p,r="end"===h?"top":"bottom");let y=m-u[r],b=g-u[n],v=!t.middlewareData.shift,S=y,x=b;if(f){let e=g-u.left-u.right;x=h||v?iK(b,e):e}else{let e=m-u.top-u.bottom;S=h||v?iK(y,e):e}if(v&&!h){let e=iq(u.left,0),t=iq(u.right,0),r=iq(u.top,0),n=iq(u.bottom,0);f?x=g-2*(0!==e||0!==t?e+t:iq(u.left,u.right)):S=m-2*(0!==r||0!==n?r+n:iq(u.top,u.bottom))}await d({...t,availableWidth:x,availableHeight:S});let w=await a.getDimensions(l.floating);return g!==w.width||m!==w.height?{reset:{rects:!0}}:{}}}}({...N,apply:({elements:e,rects:t,availableWidth:r,availableHeight:n})=>{let{width:i,height:o}=t.reference,a=e.floating.style;a.setProperty("--radix-popper-available-width",`${r}px`),a.setProperty("--radix-popper-available-height",`${n}px`),a.setProperty("--radix-popper-anchor-width",`${i}px`),a.setProperty("--radix-popper-anchor-height",`${o}px`)}}),A&&floating_ui_react_dom_arrow({element:A,padding:m}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:V,arrowHeight:R}),x&&function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:r}=t,{strategy:n="referenceHidden",...i}=floating_ui_utils_evaluate(e,t);switch(n){case"referenceHidden":{let e=await detectOverflow(t,{...i,elementContext:"reference"}),n=getSideOffsets(e,r.reference);return{data:{referenceHiddenOffsets:n,referenceHidden:isAnySideFullyClipped(n)}}}case"escaped":{let e=await detectOverflow(t,{...i,altBoundary:!0}),n=getSideOffsets(e,r.floating);return{data:{escapedOffsets:n,escaped:isAnySideFullyClipped(n)}}}default:return{}}}}}({strategy:"referenceHidden",...N})]}),[W,K]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(U),q=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_);$(()=>{H&&(null==q||q())},[H,q]);let Y=null===(i=G.arrow)||void 0===i?void 0:i.x,X=null===(o=G.arrow)||void 0===o?void 0:o.y,Z=(null===(a=G.arrow)||void 0===a?void 0:a.centerOffset)!==0,[Q,J]=(0,T.useState)();return $(()=>{C&&J(window.getComputedStyle(C).zIndex)},[C]),(0,T.createElement)("div",{ref:z.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:H?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[null===(l=G.transformOrigin)||void 0===l?void 0:l.x,null===(d=G.transformOrigin)||void 0===d?void 0:d.y].join(" ")},dir:e.dir},(0,T.createElement)(oe,{scope:u,placedSide:W,onArrowChange:M,arrowX:Y,arrowY:X,shouldHideArrow:Z},(0,T.createElement)(O.div,_extends({"data-side":W,"data-align":K},P,{ref:I,style:{...P.style,animation:H?void 0:"none",opacity:null!==(c=G.hide)&&void 0!==c&&c.referenceHidden?0:void 0}}))))}),on={top:"bottom",right:"left",bottom:"top",left:"right"},oi=(0,T.forwardRef)(function(e,t){let{__scopePopper:r,...n}=e,i=ot("PopperArrow",r),o=on[i.placedSide];return(0,T.createElement)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0}},(0,T.createElement)(i2,_extends({},n,{ref:t,style:{...n.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(e){return null!==e}let $cf1ac5d9fe0e8206$var$transformOrigin=e=>({name:"transformOrigin",options:e,fn(t){var r,n,i,o,a;let{placement:l,rects:d,middlewareData:c}=t,u=(null===(r=c.arrow)||void 0===r?void 0:r.centerOffset)!==0,p=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[f,g]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(l),m={start:"0%",center:"50%",end:"100%"}[g],y=(null!==(n=null===(i=c.arrow)||void 0===i?void 0:i.x)&&void 0!==n?n:0)+p/2,b=(null!==(o=null===(a=c.arrow)||void 0===a?void 0:a.y)&&void 0!==o?o:0)+h/2,v="",S="";return"bottom"===f?(v=u?m:`${y}px`,S=`${-h}px`):"top"===f?(v=u?m:`${y}px`,S=`${d.floating.height+h}px`):"right"===f?(v=`${-h}px`,S=u?m:`${b}px`):"left"===f&&(v=`${d.floating.width+h}px`,S=u?m:`${b}px`),{data:{x:v,y:S}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(e){let[t,r="center"]=e.split("-");return[t,r]}let $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=e=>{let{__scopePopper:t,children:r}=e,[n,i]=(0,T.useState)(null);return(0,T.createElement)(i8,{scope:t,anchor:n,onAnchorChange:i},r)},oo="rovingFocusGroup.onEntryFocus",oa={bubbles:!1,cancelable:!0},os="RovingFocusGroup",[ol,od,oc]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2(os),[ou,op]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(os,[oc]),[oh,of]=ou(os),og=(0,T.forwardRef)((e,t)=>(0,T.createElement)(ol.Provider,{scope:e.__scopeRovingFocusGroup},(0,T.createElement)(ol.Slot,{scope:e.__scopeRovingFocusGroup},(0,T.createElement)(om,_extends({},e,{ref:t}))))),om=(0,T.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:n,loop:i=!1,dir:o,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:d,onEntryFocus:c,...u}=e,p=(0,T.useRef)(null),h=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,p),f=$f631663db3294ace$export$b39126d51d94e6f3(o),[g=null,m]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:a,defaultProp:l,onChange:d}),[y,b]=(0,T.useState)(!1),v=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(c),S=od(r),x=(0,T.useRef)(!1),[w,_]=(0,T.useState)(0);return(0,T.useEffect)(()=>{let e=p.current;if(e)return e.addEventListener(oo,v),()=>e.removeEventListener(oo,v)},[v]),(0,T.createElement)(oh,{scope:r,orientation:n,dir:f,loop:i,currentTabStopId:g,onItemFocus:(0,T.useCallback)(e=>m(e),[m]),onItemShiftTab:(0,T.useCallback)(()=>b(!0),[]),onFocusableItemAdd:(0,T.useCallback)(()=>_(e=>e+1),[]),onFocusableItemRemove:(0,T.useCallback)(()=>_(e=>e-1),[])},(0,T.createElement)(O.div,_extends({tabIndex:y||0===w?-1:0,"data-orientation":n},u,{ref:h,style:{outline:"none",...e.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onMouseDown,()=>{x.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocus,e=>{let t=!x.current;if(e.target===e.currentTarget&&t&&!y){let t=new CustomEvent(oo,oa);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=S().filter(e=>e.focusable),t=e.find(e=>e.active),r=e.find(e=>e.id===g),n=[t,r,...e].filter(Boolean),i=n.map(e=>e.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(i)}}x.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onBlur,()=>b(!1))})))}),oy=(0,T.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:n=!0,active:i=!1,tabStopId:o,...a}=e,l=$1746a345f3d73bb7$export$f680877a34711e37(),d=o||l,c=of("RovingFocusGroupItem",r),u=c.currentTabStopId===d,p=od(r),{onFocusableItemAdd:h,onFocusableItemRemove:f}=c;return(0,T.useEffect)(()=>{if(n)return h(),()=>f()},[n,h,f]),(0,T.createElement)(ol.ItemSlot,{scope:r,id:d,focusable:n,active:i},(0,T.createElement)(O.span,_extends({tabIndex:u?0:-1,"data-orientation":c.orientation},a,{ref:t,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onMouseDown,e=>{n?c.onItemFocus(d):e.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocus,()=>c.onItemFocus(d)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){c.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=$d7bdfb9eb0fdf311$var$getFocusIntent(e,c.orientation,c.dir);if(void 0!==t){e.preventDefault();let r=p().filter(e=>e.focusable),n=r.map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();let r=n.indexOf(e.currentTarget);n=c.loop?$d7bdfb9eb0fdf311$var$wrapArray(n,r+1):n.slice(r+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(n))}})})))}),ob={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function $d7bdfb9eb0fdf311$var$getFocusIntent(e,t,r){let n=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(e.key,r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(n))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(n)))return ob[n]}function $d7bdfb9eb0fdf311$var$focusFirst(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function $d7bdfb9eb0fdf311$var$wrapArray(e,t){return e.map((r,n)=>e[(t+n)%e.length])}let ov=["Enter"," "],oS=["ArrowUp","PageDown","End"],ox=["ArrowDown","PageUp","Home",...oS],ow={ltr:[...ov,"ArrowRight"],rtl:[...ov,"ArrowLeft"]},o_={ltr:["ArrowLeft"],rtl:["ArrowRight"]},oP="Menu",[oE,oC,ok]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2(oP),[oI,oT]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(oP,[ok,i4,op]),oA=i4(),o$=op(),[oM,oD]=oI(oP),[oV,oR]=oI(oP),oj=(0,T.forwardRef)((e,t)=>{let{__scopeMenu:r,...n}=e,i=oA(r);return(0,T.createElement)(i9,_extends({},i,n,{ref:t}))}),oO="MenuPortal",[oL,oF]=oI(oO,{forceMount:void 0}),oN="MenuContent",[oz,oB]=oI(oN),oU=(0,T.forwardRef)((e,t)=>{let r=oF(oN,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,o=oD(oN,e.__scopeMenu),a=oR(oN,e.__scopeMenu);return(0,T.createElement)(oE.Provider,{scope:e.__scopeMenu},(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:n||o.open},(0,T.createElement)(oE.Slot,{scope:e.__scopeMenu},a.modal?(0,T.createElement)(oH,_extends({},i,{ref:t})):(0,T.createElement)(oG,_extends({},i,{ref:t})))))}),oH=(0,T.forwardRef)((e,t)=>{let r=oD(oN,e.__scopeMenu),n=(0,T.useRef)(null),i=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,n);return(0,T.useEffect)(()=>{let e=n.current;if(e)return(0,X.hideOthers)(e)},[]),(0,T.createElement)(oW,_extends({},e,{ref:i,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)}))}),oG=(0,T.forwardRef)((e,t)=>{let r=oD(oN,e.__scopeMenu);return(0,T.createElement)(oW,_extends({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)}))}),oW=(0,T.forwardRef)((e,t)=>{let{__scopeMenu:r,loop:n=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:a,disableOutsidePointerEvents:l,onEntryFocus:d,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:h,onDismiss:f,disableOutsideScroll:g,...m}=e,y=oD(oN,r),b=oR(oN,r),v=oA(r),S=o$(r),x=oC(r),[w,_]=(0,T.useState)(null),P=(0,T.useRef)(null),E=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,P,y.onContentChange),C=(0,T.useRef)(0),k=(0,T.useRef)(""),I=(0,T.useRef)(0),A=(0,T.useRef)(null),$=(0,T.useRef)("right"),M=(0,T.useRef)(0),D=g?Y.RemoveScroll:T.Fragment,V=g?{as:R,allowPinchZoom:!0}:void 0,handleTypeaheadSearch=e=>{var t,r;let n=k.current+e,i=x().filter(e=>!e.disabled),o=document.activeElement,a=null===(t=i.find(e=>e.ref.current===o))||void 0===t?void 0:t.textValue,l=i.map(e=>e.textValue),d=$6cc32821e9371a1c$var$getNextMatch(l,n,a),c=null===(r=i.find(e=>e.textValue===d))||void 0===r?void 0:r.ref.current;(function updateSearch(e){k.current=e,window.clearTimeout(C.current),""!==e&&(C.current=window.setTimeout(()=>updateSearch(""),1e3))})(n),c&&setTimeout(()=>c.focus())};(0,T.useEffect)(()=>()=>window.clearTimeout(C.current),[]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();let j=(0,T.useCallback)(e=>{var t,r;let n=$.current===(null===(t=A.current)||void 0===t?void 0:t.side);return n&&$6cc32821e9371a1c$var$isPointerInGraceArea(e,null===(r=A.current)||void 0===r?void 0:r.area)},[]);return(0,T.createElement)(oz,{scope:r,searchRef:k,onItemEnter:(0,T.useCallback)(e=>{j(e)&&e.preventDefault()},[j]),onItemLeave:(0,T.useCallback)(e=>{var t;j(e)||(null===(t=P.current)||void 0===t||t.focus(),_(null))},[j]),onTriggerLeave:(0,T.useCallback)(e=>{j(e)&&e.preventDefault()},[j]),pointerGraceTimerRef:I,onPointerGraceIntentChange:(0,T.useCallback)(e=>{A.current=e},[])},(0,T.createElement)(D,V,(0,T.createElement)(G,{asChild:!0,trapped:i,onMountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(o,e=>{var t;e.preventDefault(),null===(t=P.current)||void 0===t||t.focus()}),onUnmountAutoFocus:a},(0,T.createElement)(N,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:h,onDismiss:f},(0,T.createElement)(og,_extends({asChild:!0},S,{dir:b.dir,orientation:"vertical",loop:n,currentTabStopId:w,onCurrentTabStopIdChange:_,onEntryFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(d,e=>{b.isUsingKeyboardRef.current||e.preventDefault()})}),(0,T.createElement)(or,_extends({role:"menu","aria-orientation":"vertical","data-state":$6cc32821e9371a1c$var$getOpenState(y.open),"data-radix-menu-content":"",dir:b.dir},v,m,{ref:E,style:{outline:"none",...m.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(m.onKeyDown,e=>{let t=e.target,r=t.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,i=1===e.key.length;r&&("Tab"===e.key&&e.preventDefault(),!n&&i&&handleTypeaheadSearch(e.key));let o=P.current;if(e.target!==o||!ox.includes(e.key))return;e.preventDefault();let a=x().filter(e=>!e.disabled),l=a.map(e=>e.ref.current);oS.includes(e.key)&&l.reverse(),$6cc32821e9371a1c$var$focusFirst(l)}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(C.current),k.current="")}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(e=>{let t=e.target,r=M.current!==e.clientX;if(e.currentTarget.contains(t)&&r){let t=e.clientX>M.current?"right":"left";$.current=t,M.current=e.clientX}}))})))))))}),oK=(0,T.forwardRef)((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,T.createElement)(O.div,_extends({role:"group"},n,{ref:t}))}),oq=((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,T.createElement)(O.div,_extends({},n,{ref:t}))},"MenuItem"),oY="menu.itemSelect",oX=(0,T.forwardRef)((e,t)=>{let{disabled:r=!1,onSelect:n,...i}=e,o=(0,T.useRef)(null),a=oR(oq,e.__scopeMenu),l=oB(oq,e.__scopeMenu),d=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,o),c=(0,T.useRef)(!1);return(0,T.createElement)(oZ,_extends({},i,{ref:d,disabled:r,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onClick,()=>{let e=o.current;if(!r&&e){let t=new CustomEvent(oY,{bubbles:!0,cancelable:!0});e.addEventListener(oY,e=>null==n?void 0:n(e),{once:!0}),$8927f6f2acc4f386$export$6d1a0317bde7de7f(e,t),t.defaultPrevented?c.current=!1:a.onClose()}}),onPointerDown:t=>{var r;null===(r=e.onPointerDown)||void 0===r||r.call(e,t),c.current=!0},onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerUp,e=>{var t;c.current||null===(t=e.currentTarget)||void 0===t||t.click()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{let t=""!==l.searchRef.current;!r&&(!t||" "!==e.key)&&ov.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))}),oZ=(0,T.forwardRef)((e,t)=>{let{__scopeMenu:r,disabled:n=!1,textValue:i,...o}=e,a=oB(oq,r),l=o$(r),d=(0,T.useRef)(null),c=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,d),[u,p]=(0,T.useState)(!1),[h,f]=(0,T.useState)("");return(0,T.useEffect)(()=>{let e=d.current;if(e){var t;f((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}},[o.children]),(0,T.createElement)(oE.ItemSlot,{scope:r,disabled:n,textValue:null!=i?i:h},(0,T.createElement)(oy,_extends({asChild:!0},l,{focusable:!n}),(0,T.createElement)(O.div,_extends({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0},o,{ref:c,onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(e=>{if(n)a.onItemLeave(e);else if(a.onItemEnter(e),!e.defaultPrevented){let t=e.currentTarget;t.focus()}})),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerLeave,$6cc32821e9371a1c$var$whenMouse(e=>a.onItemLeave(e))),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocus,()=>p(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onBlur,()=>p(!1))}))))}),oQ=(0,T.forwardRef)((e,t)=>{let{checked:r=!1,onCheckedChange:n,...i}=e;return(0,T.createElement)(o2,{scope:e.__scopeMenu,checked:r},(0,T.createElement)(oX,_extends({role:"menuitemcheckbox","aria-checked":$6cc32821e9371a1c$var$isIndeterminate(r)?"mixed":r},i,{ref:t,"data-state":$6cc32821e9371a1c$var$getCheckedState(r),onSelect:$e42e1063c40fb3ef$export$b9ecd428b558ff10(i.onSelect,()=>null==n?void 0:n(!!$6cc32821e9371a1c$var$isIndeterminate(r)||!r),{checkForDefaultPrevented:!1})})))}),[oJ,o0]=oI("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),o1=((e,t)=>{let{value:r,onValueChange:n,...i}=e,o=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(n);return(0,T.createElement)(oJ,{scope:e.__scopeMenu,value:r,onValueChange:o},(0,T.createElement)(oK,_extends({},i,{ref:t})))},"MenuItemIndicator"),[o2,o3]=oI(o1,{checked:!1}),o5=(0,T.forwardRef)((e,t)=>{let{__scopeMenu:r,forceMount:n,...i}=e,o=o3(o1,r);return(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:n||$6cc32821e9371a1c$var$isIndeterminate(o.checked)||!0===o.checked},(0,T.createElement)(O.span,_extends({},i,{ref:t,"data-state":$6cc32821e9371a1c$var$getCheckedState(o.checked)})))}),o4=((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,T.createElement)(O.div,_extends({role:"separator","aria-orientation":"horizontal"},n,{ref:t}))},"MenuSub"),[o8,o6]=oI(o4),o9="MenuSubTrigger",o7=(0,T.forwardRef)((e,t)=>{let r=oD(o9,e.__scopeMenu),n=oR(o9,e.__scopeMenu),i=o6(o9,e.__scopeMenu),o=oB(o9,e.__scopeMenu),a=(0,T.useRef)(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:d}=o,c={__scopeMenu:e.__scopeMenu},u=(0,T.useCallback)(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return(0,T.useEffect)(()=>u,[u]),(0,T.useEffect)(()=>{let e=l.current;return()=>{window.clearTimeout(e),d(null)}},[l,d]),(0,T.createElement)(oj,_extends({asChild:!0},c),(0,T.createElement)(oZ,_extends({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":$6cc32821e9371a1c$var$getOpenState(r.open)},e,{ref:$6ed0406888f73fc4$export$43e446d32b3d21af(t,i.onTriggerChange),onClick:t=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(t=>{o.onItemEnter(t),t.defaultPrevented||e.disabled||r.open||a.current||(o.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerLeave,$6cc32821e9371a1c$var$whenMouse(e=>{var t,n;u();let i=null===(t=r.content)||void 0===t?void 0:t.getBoundingClientRect();if(i){let t=null===(n=r.content)||void 0===n?void 0:n.dataset.side,a="right"===t,d=i[a?"left":"right"],c=i[a?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+(a?-5:5),y:e.clientY},{x:d,y:i.top},{x:c,y:i.top},{x:c,y:i.bottom},{x:d,y:i.bottom}],side:t}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,t=>{let i=""!==o.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&ow[n.dir].includes(t.key)){var a;r.onOpenChange(!0),null===(a=r.content)||void 0===a||a.focus(),t.preventDefault()}})})))}),ae=(0,T.forwardRef)((e,t)=>{let r=oF(oN,e.__scopeMenu),{forceMount:n=r.forceMount,...i}=e,o=oD(oN,e.__scopeMenu),a=oR(oN,e.__scopeMenu),l=o6("MenuSubContent",e.__scopeMenu),d=(0,T.useRef)(null),c=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,d);return(0,T.createElement)(oE.Provider,{scope:e.__scopeMenu},(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:n||o.open},(0,T.createElement)(oE.Slot,{scope:e.__scopeMenu},(0,T.createElement)(oW,_extends({id:l.contentId,"aria-labelledby":l.triggerId},i,{ref:c,align:"start",side:"rtl"===a.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;a.isUsingKeyboardRef.current&&(null===(t=d.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocusOutside,e=>{e.target!==l.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onEscapeKeyDown,e=>{a.onClose(),e.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=o_[a.dir].includes(e.key);if(t&&r){var n;o.onOpenChange(!1),null===(n=l.trigger)||void 0===n||n.focus(),e.preventDefault()}})})))))});function $6cc32821e9371a1c$var$getOpenState(e){return e?"open":"closed"}function $6cc32821e9371a1c$var$isIndeterminate(e){return"indeterminate"===e}function $6cc32821e9371a1c$var$getCheckedState(e){return $6cc32821e9371a1c$var$isIndeterminate(e)?"indeterminate":e?"checked":"unchecked"}function $6cc32821e9371a1c$var$focusFirst(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function $6cc32821e9371a1c$var$wrapArray(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function $6cc32821e9371a1c$var$getNextMatch(e,t,r){let n=t.length>1&&Array.from(t).every(e=>e===t[0]),i=n?t[0]:t,o=r?e.indexOf(r):-1,a=$6cc32821e9371a1c$var$wrapArray(e,Math.max(o,0)),l=1===i.length;l&&(a=a.filter(e=>e!==r));let d=a.find(e=>e.toLowerCase().startsWith(i.toLowerCase()));return d!==r?d:void 0}function $6cc32821e9371a1c$var$isPointInPolygon(e,t){let{x:r,y:n}=e,i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){let a=t[e].x,l=t[e].y,d=t[o].x,c=t[o].y,u=l>n!=c>n&&r<(d-a)*(n-l)/(c-l)+a;u&&(i=!i)}return i}function $6cc32821e9371a1c$var$isPointerInGraceArea(e,t){if(!t)return!1;let r={x:e.clientX,y:e.clientY};return $6cc32821e9371a1c$var$isPointInPolygon(r,t)}function $6cc32821e9371a1c$var$whenMouse(e){return t=>"mouse"===t.pointerType?e(t):void 0}let $6cc32821e9371a1c$export$be92b6f5f03c0fe9=e=>{let{__scopeMenu:t,open:r=!1,children:n,dir:i,onOpenChange:o,modal:a=!0}=e,l=oA(t),[d,c]=(0,T.useState)(null),u=(0,T.useRef)(!1),p=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(o),h=$f631663db3294ace$export$b39126d51d94e6f3(i);return(0,T.useEffect)(()=>{let handleKeyDown=()=>{u.current=!0,document.addEventListener("pointerdown",handlePointer,{capture:!0,once:!0}),document.addEventListener("pointermove",handlePointer,{capture:!0,once:!0})},handlePointer=()=>u.current=!1;return document.addEventListener("keydown",handleKeyDown,{capture:!0}),()=>{document.removeEventListener("keydown",handleKeyDown,{capture:!0}),document.removeEventListener("pointerdown",handlePointer,{capture:!0}),document.removeEventListener("pointermove",handlePointer,{capture:!0})}},[]),(0,T.createElement)($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,l,(0,T.createElement)(oM,{scope:t,open:r,onOpenChange:p,content:d,onContentChange:c},(0,T.createElement)(oV,{scope:t,onClose:(0,T.useCallback)(()=>p(!1),[p]),isUsingKeyboardRef:u,dir:h,modal:a},n)))},$6cc32821e9371a1c$export$602eac185826482c=e=>{let{__scopeMenu:t,forceMount:r,children:n,container:i}=e,o=oD(oO,t);return(0,T.createElement)(oL,{scope:t,forceMount:r},(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:r||o.open},(0,T.createElement)(K,{asChild:!0,container:i},n)))},$6cc32821e9371a1c$export$d7a01e11500dfb6f=e=>{let{__scopeMenu:t,children:r,open:n=!1,onOpenChange:i}=e,o=oD(o4,t),a=oA(t),[l,d]=(0,T.useState)(null),[c,u]=(0,T.useState)(null),p=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(i);return(0,T.useEffect)(()=>(!1===o.open&&p(!1),()=>p(!1)),[o.open,p]),(0,T.createElement)($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,a,(0,T.createElement)(oM,{scope:t,open:n,onOpenChange:p,content:c,onContentChange:u},(0,T.createElement)(o8,{scope:t,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerId:$1746a345f3d73bb7$export$f680877a34711e37(),trigger:l,onTriggerChange:d},r)))},at="DropdownMenu",[ar,an]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(at,[oT]),ai=oT(),[ao,aa]=ar(at),as=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,disabled:n=!1,...i}=e,o=aa("DropdownMenuTrigger",r),a=ai(r);return(0,T.createElement)(oj,_extends({asChild:!0},a),(0,T.createElement)(O.button,_extends({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n},i,{ref:$6ed0406888f73fc4$export$43e446d32b3d21af(t,o.triggerRef),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDown,e=>{n||0!==e.button||!1!==e.ctrlKey||(o.onOpenToggle(),o.open||e.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})))}),al=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=aa("DropdownMenuContent",r),o=ai(r),a=(0,T.useRef)(!1);return(0,T.createElement)(oU,_extends({id:i.contentId,"aria-labelledby":i.triggerId},o,n,{ref:t,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onCloseAutoFocus,e=>{var t;a.current||null===(t=i.triggerRef.current)||void 0===t||t.focus(),a.current=!1,e.preventDefault()}),onInteractOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;(!i.modal||n)&&(a.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),ad=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(oK,_extends({},i,n,{ref:t}))}),ac=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(oX,_extends({},i,n,{ref:t}))}),au=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(oQ,_extends({},i,n,{ref:t}))}),ap=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(o5,_extends({},i,n,{ref:t}))}),ah=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(o7,_extends({},i,n,{ref:t}))}),af=(0,T.forwardRef)((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,i=ai(r);return(0,T.createElement)(ae,_extends({},i,n,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),$d08ef79370b62062$export$be92b6f5f03c0fe9=e=>{let{__scopeDropdownMenu:t,children:r,dir:n,open:i,defaultOpen:o,onOpenChange:a,modal:l=!0}=e,d=ai(t),c=(0,T.useRef)(null),[u=!1,p]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:i,defaultProp:o,onChange:a});return(0,T.createElement)(ao,{scope:t,triggerId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:c,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:u,onOpenChange:p,onOpenToggle:(0,T.useCallback)(()=>p(e=>!e),[p]),modal:l},(0,T.createElement)($6cc32821e9371a1c$export$be92b6f5f03c0fe9,_extends({},d,{open:u,onOpenChange:p,dir:n,modal:l}),r))},$d08ef79370b62062$export$602eac185826482c=e=>{let{__scopeDropdownMenu:t,...r}=e,n=ai(t);return(0,T.createElement)($6cc32821e9371a1c$export$602eac185826482c,_extends({},n,r))},$d08ef79370b62062$export$d7a01e11500dfb6f=e=>{let{__scopeDropdownMenu:t,children:r,open:n,onOpenChange:i,defaultOpen:o}=e,a=ai(t),[l=!1,d]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:n,defaultProp:o,onChange:i});return(0,T.createElement)($6cc32821e9371a1c$export$d7a01e11500dfb6f,_extends({},a,{open:l,onOpenChange:d}),r)},defaultEventHandler=()=>void 0,ag=T.createContext({});function UiEventsProvider({onEvent:e,children:t}){return(0,I.jsx)(ag.Provider,{value:e??defaultEventHandler,children:t})}function useUiEvents(){let e=T.useContext(ag);return e??defaultEventHandler}function useMenuIsOpen(e,t){let r=useEditor(),n=(0,T.useRef)(!1),i=useUiEvents(),o=(0,T.useCallback)(i=>{n.current=i,r.batch(()=>{i?(r.complete(),r.addOpenMenu(e)):r.updateInstanceState({openMenus:r.openMenus.filter(t=>!t.startsWith(e))}),t?.(i)})},[r,e,t]);(0,T.useEffect)(()=>(n.current&&(i("open-menu",{source:"unknown",id:e}),r.addOpenMenu(e)),()=>{n.current&&(r.deleteOpenMenu(e),r.openMenus.forEach(t=>{t.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),r.deleteOpenMenu(t))}),n.current=!1)}),[r,e,i]);let a=useValue("is menu open",()=>r.openMenus.includes(e),[r,e]);return[a,o]}function Root({id:e,children:t,modal:r=!1}){let[n,i]=useMenuIsOpen(e);return(0,I.jsx)($d08ef79370b62062$export$be92b6f5f03c0fe9,{open:n,dir:"ltr",modal:r,onOpenChange:i,children:t})}function Trigger({children:e,"data-testid":t}){return(0,I.jsx)(as,{dir:"ltr","data-testid":t,asChild:!0,onTouchEnd:e=>preventDefault(e),children:e})}function Content({side:e="bottom",align:t="start",sideOffset:r=8,alignOffset:n=8,children:i}){let o=useContainer();return(0,I.jsx)($d08ef79370b62062$export$602eac185826482c,{dir:"ltr",container:o,children:(0,I.jsx)(al,{className:"tlui-menu",align:t,sideOffset:r,side:e,alignOffset:n,collisionPadding:4,children:i})})}function Sub({id:e,children:t}){let[r,n]=useMenuIsOpen(e);return(0,I.jsx)($d08ef79370b62062$export$d7a01e11500dfb6f,{open:r,onOpenChange:n,children:t})}function SubTrigger({label:e,"data-testid":t,"data-direction":r}){return(0,I.jsx)(ah,{dir:"ltr","data-direction":r,"data-testid":t,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button tlui-menu__submenu__trigger",label:e,icon:"chevron-right"})})}function SubContent({alignOffset:e=0,sideOffset:t=5,children:r}){let n=useContainer();return(0,I.jsx)($d08ef79370b62062$export$602eac185826482c,{container:n,dir:"ltr",children:(0,I.jsx)(af,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,children:r})})}function Group({children:e,size:t="medium"}){return(0,I.jsx)(ad,{dir:"ltr",className:"tlui-menu__group","data-size":t,children:e})}function Indicator(){return(0,I.jsx)(ap,{dir:"ltr",asChild:!0,children:(0,I.jsx)(iN,{icon:"check"})})}function Item({noClose:e,...t}){return(0,I.jsx)(ac,{dir:"ltr",asChild:!0,onClick:e||void 0!==t.isChecked?preventDefault:void 0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",...t})})}function CheckboxItem({children:e,onSelect:t,...r}){return(0,I.jsxs)(au,{dir:"ltr",className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",onSelect:e=>{t?.(e),preventDefault(e)},...r,children:[(0,I.jsx)("div",{className:"tlui-menu__checkbox-item__check",style:{transformOrigin:"75% center",transform:`scale(${r.checked?1:.5})`,opacity:r.checked?1:.5},children:(0,I.jsx)(iN,{small:!0,icon:r.checked?"check":"checkbox-empty"})}),e]})}function RadioItem({children:e,onSelect:t,...r}){return(0,I.jsxs)(au,{dir:"ltr",className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",onSelect:e=>{t?.(e),preventDefault(e)},...r,children:[(0,I.jsx)(ap,{dir:"ltr",className:"tlui-menu__checkbox-item__check",children:(0,I.jsx)(iN,{icon:"check"})}),e]})}let TldrawHandles=({children:e})=>{let t=useEditor(),r=useValue("shouldDisplayHandles",()=>t.isInAny("select.idle","select.pointing_handle"),[t]);return r?(0,I.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null},TldrawHoveredShapeIndicator=({shapeId:e})=>{let t=useEditor(),r=useValue("show hovered",()=>t.isIn("select.editing_shape")?t.hoveredShapeId!==t.editingShapeId:t.isInAny("select.idle"),[t]);return r?(0,I.jsx)(r2,{className:"tl-user-indicator__hovered",id:e}):null},{PI:am}=Math,ay=am+1e-4;function getStrokeOutlinePoints_getStrokeOutlinePoints(e,t={}){let r;let{size:n=16,smoothing:i=.5,start:o={},end:a={},last:l=!1}=t,{cap:d=!0}=o,{cap:c=!0}=a;if(0===e.length||n<=0)return[];let u=e[0],p=e[e.length-1],h=p.runningLength,f=!1===o.taper?0:!0===o.taper?Math.max(n,h):o.taper,g=!1===a.taper?0:!0===a.taper?Math.max(n,h):a.taper,m=Math.pow(n*i,2),y=[],b=[],v=e[0].vector,S=e[0].point,x=S,w=S,_=x,P=!1;for(let t=0;t<e.length;t++){r=e[t];let{point:n,vector:i}=e[t],o=r.vector.dpr(v),a=(t<e.length-1?e[t+1]:e[t]).vector,l=t<e.length-1?a.dpr(r.vector):1,d=o<0&&!P,c=null!==l&&l<.2;if(d||c){if(l>-.62&&h-r.runningLength>r.radius){let e=v.clone().mul(r.radius),t=v.clone().cpr(a);t<0?(w=Vec2d_Vec2d.Add(n,e),_=Vec2d_Vec2d.Sub(n,e)):(w=Vec2d_Vec2d.Sub(n,e),_=Vec2d_Vec2d.Add(n,e)),y.push(w),b.push(_)}else{let e=v.clone().mul(r.radius).per(),t=Vec2d_Vec2d.Sub(r.input,e);for(let e=1/13,n=0;n<1;n+=e)w=Vec2d_Vec2d.RotWith(t,r.input,ay*n),y.push(w),_=Vec2d_Vec2d.RotWith(t,r.input,ay+-(ay*n)),b.push(_)}S=w,x=_,c&&(P=!0);continue}if(P=!1,r===u||r===p){let e=Vec2d_Vec2d.Per(i).mul(r.radius);y.push(Vec2d_Vec2d.Sub(n,e)),b.push(Vec2d_Vec2d.Add(n,e));continue}let f=Vec2d_Vec2d.Lrp(a,i,l).per().mul(r.radius);w=Vec2d_Vec2d.Sub(n,f),(t<=1||Vec2d_Vec2d.Dist2(S,w)>m)&&(y.push(w),S=w),_=Vec2d_Vec2d.Add(n,f),(t<=1||Vec2d_Vec2d.Dist2(x,_)>m)&&(b.push(_),x=_),v=i}let E=u.point,C=e.length>1?e[e.length-1].point:Vec2d_Vec2d.AddXY(u.point,1,1);if(1===e.length&&(!(f||g)||l)){let e=Vec2d_Vec2d.Add(E,Vec2d_Vec2d.Sub(E,C).uni().per().mul(-u.radius)),t=[];for(let r=1/13,n=r;n<=1;n+=r)t.push(Vec2d_Vec2d.RotWith(e,E,2*ay*n));return t}let k=[];if(f||g&&1===e.length);else if(d)for(let e=1/8,t=e;t<=1;t+=e){let e=Vec2d_Vec2d.RotWith(b[0],E,ay*t);k.push(e)}else{let e=Vec2d_Vec2d.Sub(y[0],b[0]),t=Vec2d_Vec2d.Mul(e,.5),r=Vec2d_Vec2d.Mul(e,.51);k.push(Vec2d_Vec2d.Sub(E,t),Vec2d_Vec2d.Sub(E,r),Vec2d_Vec2d.Add(E,r),Vec2d_Vec2d.Add(E,t))}let I=[],T=p.vector.clone().per().neg();if(g||f&&1===e.length)I.push(C);else if(c){let e=Vec2d_Vec2d.Add(C,Vec2d_Vec2d.Mul(T,p.radius));for(let t=1/29,r=t;r<1;r+=t)I.push(Vec2d_Vec2d.RotWith(e,C,3*ay*r))}else I.push(Vec2d_Vec2d.Add(C,Vec2d_Vec2d.Mul(T,p.radius)),Vec2d_Vec2d.Add(C,Vec2d_Vec2d.Mul(T,.99*p.radius)),Vec2d_Vec2d.Sub(C,Vec2d_Vec2d.Mul(T,.99*p.radius)),Vec2d_Vec2d.Sub(C,Vec2d_Vec2d.Mul(T,p.radius)));return y.concat(I,b.reverse(),k)}function getStrokePoints(e,t={}){let r,n;let{streamline:i=.5,size:o=16,simulatePressure:a=!1}=t;if(0===e.length)return[];let l=.15+(1-i)*.85,d=e.map(Vec2d_Vec2d.From),c=0;if(!a){let e=d[0];for(;e&&!(e.z>=.025);)d.shift(),e=d[0]}if(!a){let e=d[d.length-1];for(;e&&!(e.z>=.01);)d.pop(),e=d[d.length-1]}if(0===d.length)return[{point:Vec2d_Vec2d.From(e[0]),input:Vec2d_Vec2d.From(e[0]),pressure:a?.5:.15,vector:new Vec2d_Vec2d(1,1),distance:0,runningLength:0,radius:1}];let u=d[1];for(;u&&!(Vec2d_Vec2d.Dist(u,d[0])>o/3);)d[0].z=Math.max(d[0].z,u.z),d.splice(1,1),u=d[1];let p=d.pop();for(u=d[d.length-1];u&&!(Vec2d_Vec2d.Dist(u,p)>o/3);)d.pop(),u=d[d.length-1],c++;d.push(p);let h=t.last||!t.simulatePressure||d.length>1&&Vec2d_Vec2d.Dist(d[d.length-1],d[d.length-2])<o||c>0;if(2===d.length&&t.simulatePressure){let e=d[1];d=d.slice(0,-1);for(let t=1;t<5;t++){let r=Vec2d_Vec2d.Lrp(d[0],e,t/4);r.z=(d[0].z+(e.z-d[0].z))*t/4,d.push(r)}}let f=[{point:d[0],input:d[0],pressure:a?.5:d[0].z,vector:new Vec2d_Vec2d(1,1),distance:0,runningLength:0,radius:1}],g=0,m=f[0];h&&i>0&&d.push(d[d.length-1].clone());for(let e=1,i=d.length;e<i;e++)if(r=!l||t.last&&e===i-1?d[e].clone():d[e].clone().lrp(m.point,1-l),!m.point.equals(r)){if(g+=n=Vec2d_Vec2d.Dist(r,m.point),e<4&&g<o)continue;m={input:d[e],point:r,pressure:a?.5:d[e].z,vector:Vec2d_Vec2d.Sub(m.point,r).uni(),distance:n,runningLength:g,radius:1},f.push(m)}if(f[1]?.vector&&(f[0].vector=f[1].vector.clone()),g<1){let e=Math.max(.5,...f.map(e=>e.pressure));f.forEach(t=>t.pressure=e)}return f}let{min:ab}=Math;function setStrokePointRadii(e,t){let r,n;let{size:i=16,thinning:o=.5,simulatePressure:a=!0,easing:l=e=>e,start:d={},end:c={}}=t,{easing:u=r3.easeOutQuad}=d,{easing:p=r3.easeOutCubic}=c,h=e[e.length-1].runningLength,f=e[0].pressure;if(!a&&h<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*l(.5-o*(.5-e.pressure))}),e}{let t;for(let r=0,o=e.length;r<o&&!((n=e[r]).runningLength>5*i);r++){let e=ab(1,n.distance/i);if(a){let r=ab(1,1-e);t=ab(1,f+(r-f)*(.275*e))}else t=ab(1,f+(n.pressure-f)*.5);f+=(t-f)*.5}for(let t=0;t<e.length;t++){if(n=e[t],o){let{pressure:e}=n,t=ab(1,n.distance/i);if(a){let r=ab(1,1-t);e=ab(1,f+(r-f)*(.275*t))}else e=ab(1,f+(e-f)*(.275*t));n.radius=i*l(.5-o*(.5-e)),f=e}else n.radius=i/2;void 0===r&&(r=n.radius)}}let g=!1===d.taper?0:!0===d.taper?Math.max(i,h):d.taper,m=!1===c.taper?0:!0===c.taper?Math.max(i,h):c.taper;if(g||m)for(let t=0;t<e.length;t++){n=e[t];let{runningLength:r}=n,i=r<g?u(r/g):1,o=h-r<m?p((h-r)/m):1;n.radius=Math.max(.01,n.radius*Math.min(i,o))}return e}function getStroke(e,t={}){return getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getStrokePoints(e,t),t),t)}let TldrawScribble=({scribble:e,zoom:t,color:r,opacity:n,className:i})=>{let o;if(!e.points.length)return null;let a=getStroke(e.points,{size:e.size/t,start:{taper:!0,easing:r3.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});if(a.length<4){let r=e.size/t/2,{x:n,y:i}=e.points[e.points.length-1];o=`M ${n-r},${i} a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 ${-(2*r)},0`}else o=getSvgPathFromPoints_getSvgPathFromPoints(a);return(0,I.jsx)("svg",{className:i?eb("tl-overlays__item",i):i,children:(0,I.jsx)("path",{className:"tl-scribble",d:o,fill:r??`var(--color-${e.color})`,opacity:n??e.opacity})})},TldrawSelectionBackground=({bounds:e,rotation:t})=>{let r=useEditor(),n=useValue("should display",()=>r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[r]);return n?(0,I.jsx)(DefaultSelectionBackground,{bounds:e,rotation:t}):null};function useReadonly(){let e=useEditor();return useValue("isReadonlyMode",()=>e.instanceState.isReadonly,[e])}function CropHandles({size:e,width:t,height:r,hideAlternateHandles:n}){let i=toDomPrecision(e/3),o=i/2;return(0,I.jsxs)("svg",{className:"tl-overlays__item",children:[(0,I.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${toDomPrecision(0-o)},${toDomPrecision(e)} 
						${toDomPrecision(0-o)},${toDomPrecision(0-o)} 
						${toDomPrecision(e)},${toDomPrecision(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,I.jsx)("line",{className:eb("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:toDomPrecision(t/2-e),y1:toDomPrecision(0-o),x2:toDomPrecision(t/2+e),y2:toDomPrecision(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,I.jsx)("polyline",{className:eb("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${toDomPrecision(t-e)},${toDomPrecision(0-o)} 
						${toDomPrecision(t+o)},${toDomPrecision(0-o)} 
						${toDomPrecision(t+o)},${toDomPrecision(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,I.jsx)("line",{className:eb("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:toDomPrecision(t+o),y1:toDomPrecision(r/2-e),x2:toDomPrecision(t+o),y2:toDomPrecision(r/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,I.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${toDomPrecision(t+o)},${toDomPrecision(r-e)} 
						${toDomPrecision(t+o)},${toDomPrecision(r+o)}
						${toDomPrecision(t-e)},${toDomPrecision(r+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,I.jsx)("line",{className:eb("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:toDomPrecision(t/2-e),y1:toDomPrecision(r+o),x2:toDomPrecision(t/2+e),y2:toDomPrecision(r+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,I.jsx)("polyline",{className:eb("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${toDomPrecision(0+e)},${toDomPrecision(r+o)} 
						${toDomPrecision(0-o)},${toDomPrecision(r+o)}
						${toDomPrecision(0-o)},${toDomPrecision(r-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,I.jsx)("line",{className:eb("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:toDomPrecision(0-o),y1:toDomPrecision(r/2-e),x2:toDomPrecision(0-o),y2:toDomPrecision(r/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}let av="undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1,aS=track(function({bounds:e,rotation:t}){let r=useEditor(),n=(0,T.useRef)(null),i=useReadonly(),o=useSelectionEvents("top"),a=useSelectionEvents("right"),l=useSelectionEvents("bottom"),d=useSelectionEvents("left"),c=useSelectionEvents("top_left"),u=useSelectionEvents("top_right"),p=useSelectionEvents("bottom_right"),h=useSelectionEvents("bottom_left"),f=!r.isMenuOpen&&"default"===r.instanceState.cursor.type,g=r.instanceState.isCoarsePointer,m=r.selectedShapes,y=r.onlySelectedShape,b=y&&r.isShapeOrAncestorLocked(y),v=y?r.getShapeUtil(y).expandSelectionOutlinePx(y):0;if(useTransform(n,e?.x,e?.y,1,r.selectionRotation,{x:-v,y:-v}),!e)return null;e=e.clone().expandBy(v).zeroFix();let S=r.zoomLevel,x=r.instanceState.isChangingStyle,w=e.width,_=e.height,P=8/S,E=w<2*P,C=_<2*P,k=w<4*P,A=_<4*P,$=w<5*P,M=_<5*P,D=g?1.75:1,V=6/S*D,R=(k?V/2:V)*(.75*D),j=(A?V/2:V)*(.75*D),O=(!y||!r.getShapeUtil(y).hideSelectionBoundsFg(y))&&!x,L=O&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||O&&r.isIn("select.resizing")&&y&&r.isShapeOfType(y,"text");y&&L&&av&&r.isShapeOfType(y,"embed")&&(L=!1);let F=r.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!x&&!i,N=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!x&&!i,z=!g&&!(E||C)&&(N||F)&&(!y||!r.getShapeUtil(y).hideRotateHandle(y))&&!b,B=g&&(!k||!A)&&(N||F)&&(!y||!r.getShapeUtil(y).hideRotateHandle(y))&&!b,U=N&&(!y||r.getShapeUtil(y).canResize(y)&&!r.getShapeUtil(y).hideResizeHandles(y))&&!F&&!b,H=E||C,G=E&&C,W=$||M,K=U||F,q=!z,Y=!N||!K,X=!N||!K||H,Z=!N||!K||H,Q=!N||!K||G&&!F,J=g;J&&m.every(e=>r.getShapeUtil(e).isAspectRatioLocked(e))&&(J=!1);let ee=!0;F?ee=W:U&&(ee=H||G||J);let et=Math.min(24/S,_-3*j),er=N&&g&&y&&r.isShapeOfType(y,"text")&&et*S>=4;return(0,I.jsxs)("svg",{ref:n,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:[L&&(0,I.jsx)("rect",{className:eb("tl-selection__fg__outline"),width:toDomPrecision(w),height:toDomPrecision(_)}),(0,I.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:V,corner:"top_left_rotate",cursor:f?getCursor("nwse-rotate",t):void 0,isHidden:q}),(0,I.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-right",cx:w+3*V,cy:0,targetSize:V,corner:"top_right_rotate",cursor:f?getCursor("nesw-rotate",t):void 0,isHidden:q}),(0,I.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:_+3*V,targetSize:V,corner:"bottom_left_rotate",cursor:f?getCursor("swne-rotate",t):void 0,isHidden:q}),(0,I.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-right",cx:w+3*V,cy:_+3*V,targetSize:V,corner:"bottom_right_rotate",cursor:f?getCursor("senw-rotate",t):void 0,isHidden:q}),(0,I.jsx)(MobileRotateHandle,{"data-testid":"selection.rotate.mobile",cx:k?-(1.5*V):w/2,cy:k?_/2:-(1.5*V),size:P,isHidden:!N||!B}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:toDomPrecision(0-(A?2*j:j)),width:toDomPrecision(w),height:toDomPrecision(Math.max(1,2*j)),style:f?{cursor:getCursor("ns-resize",t)}:void 0,...o}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:toDomPrecision(w-(k?0:R)),y:0,height:toDomPrecision(_),width:toDomPrecision(Math.max(1,2*R)),style:f?{cursor:getCursor("ew-resize",t)}:void 0,...a}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:toDomPrecision(_-(A?0:j)),width:toDomPrecision(w),height:toDomPrecision(Math.max(1,2*j)),style:f?{cursor:getCursor("ns-resize",t)}:void 0,...l}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:toDomPrecision(0-(k?2*R:R)),y:0,height:toDomPrecision(_),width:toDomPrecision(Math.max(1,2*R)),style:f?{cursor:getCursor("ew-resize",t)}:void 0,...d}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":Y}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:toDomPrecision(0-(k?2*R:1.5*R)),y:toDomPrecision(0-(A?2*j:1.5*j)),width:toDomPrecision(3*R),height:toDomPrecision(3*j),style:f?{cursor:getCursor("nwse-resize",t)}:void 0,...c}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":X}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:toDomPrecision(w-(k?0:1.5*R)),y:toDomPrecision(0-(A?2*j:1.5*j)),width:toDomPrecision(3*R),height:toDomPrecision(3*j),style:f?{cursor:getCursor("nesw-resize",t)}:void 0,...u}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:toDomPrecision(w-(k?R:1.5*R)),y:toDomPrecision(_-(A?j:1.5*j)),width:toDomPrecision(3*R),height:toDomPrecision(3*j),style:f?{cursor:getCursor("nwse-resize",t)}:void 0,...p}),(0,I.jsx)("rect",{className:eb("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:toDomPrecision(0-(k?3*R:1.5*R)),y:toDomPrecision(_-(A?0:1.5*j)),width:toDomPrecision(3*R),height:toDomPrecision(3*j),style:f?{cursor:getCursor("nesw-resize",t)}:void 0,...h}),U&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("rect",{"data-testid":"selection.resize.top-left",className:eb("tl-corner-handle",{"tl-hidden":Y}),"aria-label":"top_left handle",x:toDomPrecision(0-P/2),y:toDomPrecision(0-P/2),width:toDomPrecision(P),height:toDomPrecision(P)}),(0,I.jsx)("rect",{"data-testid":"selection.resize.top-right",className:eb("tl-corner-handle",{"tl-hidden":X}),"aria-label":"top_right handle",x:toDomPrecision(w-P/2),y:toDomPrecision(0-P/2),width:toDomPrecision(P),height:toDomPrecision(P)}),(0,I.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:eb("tl-corner-handle",{"tl-hidden":Q}),"aria-label":"bottom_right handle",x:toDomPrecision(w-P/2),y:toDomPrecision(_-P/2),width:toDomPrecision(P),height:toDomPrecision(P)}),(0,I.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:eb("tl-corner-handle",{"tl-hidden":Z}),"aria-label":"bottom_left handle",x:toDomPrecision(0-P/2),y:toDomPrecision(_-P/2),width:toDomPrecision(P),height:toDomPrecision(P)})]}),er&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:toDomPrecision(0-P/4),y:toDomPrecision(_/2-et/2),rx:P/4,width:toDomPrecision(P/2),height:toDomPrecision(et)}),(0,I.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:P/4,x:toDomPrecision(w-P/4),y:toDomPrecision(_/2-et/2),width:toDomPrecision(P/2),height:toDomPrecision(et)})]}),F&&(0,I.jsx)(CropHandles,{size:P,width:w,height:_,hideAlternateHandles:W})]})}),RotateCornerHandle=function({cx:e,cy:t,targetSize:r,corner:n,cursor:i,isHidden:o,"data-testid":a}){let l=useSelectionEvents(n);return(0,I.jsx)("rect",{className:eb("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${n} target`,pointerEvents:"all",x:toDomPrecision(e-3*r),y:toDomPrecision(t-3*r),width:toDomPrecision(Math.max(1,3*r)),height:toDomPrecision(Math.max(1,3*r)),cursor:i,...l})},ax=Math.sqrt(Math.PI),MobileRotateHandle=function({cx:e,cy:t,size:r,isHidden:n,"data-testid":i}){let o=useSelectionEvents("mobile_rotate"),a=useEditor(),l=useValue("zoom level",()=>a.zoomLevel,[a]);return(0,I.jsxs)("g",{children:[(0,I.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:eb("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":n}),cx:e,cy:t,r:Math.max(14*(1/l),20/Math.max(1,l)),...o}),(0,I.jsx)("circle",{className:eb("tl-mobile-rotate__fg",{"tl-hidden":n}),cx:e,cy:t,r:r/ax})]})},aw={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},a_={s:2,m:3.5,l:5,xl:10},aP={s:18,m:24,l:36,xl:44},aE={s:18,m:22,l:26,xl:32},aC={s:18,m:20,l:24,xl:28},ak={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};var aI=r(1507);let aT=null;function getBrowserCanvasMaxSize(){return aT||(aT=calculateBrowserCanvasMaxSize()),aT}async function calculateBrowserCanvasMaxSize(){let e=await aI.maxWidth({usePromise:!0}),t=await aI.maxHeight({usePromise:!0}),r=await aI.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:r.width*r.height}}function getDataBlocksLength(e,t){let r=0;for(;e[t+r];)r+=e[t+r]+1;return r+1}function isGIF(e){let t=new TextDecoder("ascii"),r=t.decode(e.slice(0,3));return"GIF"===r}function isAnimated(e){let t,r;let n=new Uint8Array(e),i=0,o=0;if(!isGIF(e))return!1;for(t=128&n[10],r=7&n[10],i+=13+(t?3*Math.pow(2,r+1):0);o<2&&i<n.length;)switch(n[i]){case 44:o+=1,t=128&n[i+9],r=7&n[i+9],i+=10+(t?3*Math.pow(2,r+1):0),i+=getDataBlocksLength(n,i+1)+1;break;case 33:i+=2,i+=getDataBlocksLength(n,i);break;default:i=n.length}return o>1}function containBoxSize(e,t){let r=e.w/t.w,n=e.h/t.h;return r<=1&&n<=1?e:r>n?{w:e.w/r,h:e.h/r}:{w:e.w/n,h:e.h/n}}async function getResizedImageDataUrl(e,t,r){return await new Promise(n=>{let i=new Image;i.onload=async()=>{let e=document.createElement("canvas"),o=e.getContext("2d");if(!o)return;let a=await getBrowserCanvasMaxSize(),l=2*t,d=2*r,c=i.width/i.height;if(l>a.maxWidth&&(d=(l=a.maxWidth)/c),d>a.maxHeight&&(l=(d=a.maxHeight)*c),l*d>a.maxArea){let e=Math.sqrt(a.maxArea/(l*d));l*=e,d*=e}e.width=l,e.height=d,o.drawImage(i,0,0,e.width,e.height);let u=e.toDataURL();n(u)},i.crossOrigin="anonymous",i.src=e})}let aA=["image/jpeg","image/png","image/gif","image/svg+xml"],a$=["video/mp4","video/quicktime"];async function isGifAnimated(e){return await new Promise((t,r)=>{let n=new FileReader;n.onerror=()=>r(n.error),n.onload=()=>{t(!!n.result&&isAnimated(n.result))},n.readAsArrayBuffer(e)})}function escapeStringRegexp(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function matchEmbedUrl(e){let t=new URL(e).host.replace("www.","");for(let r of rp)if(checkHostnames(r.hostnames,t)){let t=r.fromEmbedUrl(e);if(t)return{definition:r,url:t,embedUrl:e}}}let globlikeRegExp=e=>e.split("*").map(e=>escapeStringRegexp(e)).join(".+"),checkHostnames=(e,t)=>!!e.find(e=>{let r=new RegExp(globlikeRegExp(e));return t.match(r)});function matchUrl(e){let t=new URL(e).host.replace("www.","");for(let r of rp)if(checkHostnames(r.hostnames,t)){let t=r.toEmbedUrl(e);if(t)return{definition:r,embedUrl:t,url:e}}}function getEmbedInfoUnsafely(e){let t=matchUrl(e)??matchEmbedUrl(e);return t}function getEmbedInfo(e){try{return getEmbedInfoUnsafely(e)}catch(e){console.error(e)}}let TextHelpers=class TextHelpers{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let r=e.ownerDocument,n=r.activeElement;n!==e&&e.focus(),r.execCommand("insertText",!1,t)||TextHelpers.insertTextFirefox(e,t),n===r.body?e.blur():n instanceof HTMLElement&&n!==e&&n.focus()}static set(e,t){e.select(),TextHelpers.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){let{selectionStart:n,selectionEnd:i}=e,o=TextHelpers.getSelection(e);TextHelpers.insert(e,t+o+(r??t)),e.selectionStart=(n||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,r){let n=0;e.value.replace(t,(...t)=>{let i=n+t[t.length-2],o=t[0].length;e.selectionStart=i,e.selectionEnd=i+o;let a="string"==typeof r?r:r(...t);return TextHelpers.insert(e,a),e.selectionStart=i,n+=a.length-o,a})}static findLineEnd(e,t){let r=e.lastIndexOf("\n",t-1)+1;return"	"!==e.charAt(r)?t:r+1}static indent(e){let{selectionStart:t,selectionEnd:r,value:n}=e,i=n.slice(t,r),o=/\n/g.exec(i)?.length;if(o&&o>0){let i=n.lastIndexOf("\n",t-1)+1,o=e.value.slice(i,r-1),a=o.replace(/^|\n/g,"$&  "),l=a.length-o.length;e.setSelectionRange(i,r-1),TextHelpers.insert(e,a),e.setSelectionRange(t+1,r+l)}else TextHelpers.insert(e,"  ")}static unindent(e){let{selectionStart:t,selectionEnd:r,value:n}=e,i=n.lastIndexOf("\n",t-1)+1,o=TextHelpers.findLineEnd(n,r),a=e.value.slice(i,o),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=a.length-l.length;e.setSelectionRange(i,o),TextHelpers.insert(e,l);let c=/\t| {1,2}/.exec(n.slice(i,t)),u=c?c[0].length:0,p=t-u;e.setSelectionRange(t-u,Math.max(p,r-d))}static indentCE(e){let t=window.getSelection(),r=e.innerText,n=getCaretIndex(e)??0,i=getCaretIndex(e)??0,o=r.slice(n,i),a=/\n/g.exec(o)?.length;if(a&&a>0){let o=r.lastIndexOf("\n",n-1)+1,a=r.slice(o,i-1),l=a.replace(/^|\n/g,"$&  "),d=l.length-a.length;t&&t.setBaseAndExtent(e,n+1,e,i+d)}else{let t=window.getSelection();e.innerText=r.slice(0,n)+"  "+r.slice(n),t?.setBaseAndExtent(e,n+1,e,n+2)}}static unindentCE(e){let t=window.getSelection(),r=e.innerText,n=getCaretIndex(e)??0,i=getCaretIndex(e)??0,o=r.lastIndexOf("\n",n-1)+1,a=TextHelpers.findLineEnd(r,i),l=r.slice(o,a),d=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=l.length-d.length;if(t){t.setBaseAndExtent(e,o,e,a);let l=/\t| {1,2}/.exec(r.slice(o,n)),d=l?l[0].length:0,u=n-d;t.setBaseAndExtent(e,n-d,e,Math.max(u,i-c))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(TextHelpers.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(TextHelpers.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}};function getCaretIndex(e){if(void 0===window.getSelection)return;let t=window.getSelection();if(!t)return;let r=0;if(0!==t.rangeCount){let n=t.getRangeAt(0),i=n.cloneRange();i.selectNodeContents(e),i.setEnd(n.endContainer,n.endOffset),r=i.toString().length}return r}let aM=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function isRightToLeftLanguage(e){return aM.test(e)}function replaceTabsWithSpaces(e){return e.replace(/\t/g,"  ")}function stripCommonMinimumIndentation(e){let t=e.split("\n");for(;0===t[0].trim().length;)t.shift();let r=1/0;for(let e of t)if(e.trim().length>0){let t=e.length-e.trimStart().length;r=Math.min(r,t)}return t.map(e=>e.slice(r)).join("\n")}function stripTrailingWhitespace(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function cleanupText(e){return stripTrailingWhitespace(stripCommonMinimumIndentation(replaceTabsWithSpaces(e)))}let truncateStringWithEllipsis=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...";function registerDefaultExternalContentHandlers(e,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:i}){e.registerExternalAssetHandler("file",async({file:e})=>await new Promise((o,a)=>{n.includes(e.type)||i.includes(e.type)||(console.warn(`File type not allowed: ${e.type}`),a()),e.size>r&&(console.warn(`File size too big: ${(e.size/1024).toFixed()}kb > ${(r/1024).toFixed()}kb`),a());let l=new FileReader;l.onerror=()=>a(l.error),l.onload=async()=>{let r,i,a=l.result;"video/quicktime"===e.type&&a.includes("video/quicktime")&&(a=a.replace("video/quicktime","video/mp4"));let d=n.includes(e.type);if(d?(r=await MediaHelpers.getImageSizeFromSrc(a),i="image/gif"===e.type&&await isGifAnimated(e)):(i=!0,r=await MediaHelpers.getVideoSizeFromSrc(a)),isFinite(t)){let n=containBoxSize(r,{w:t,h:t});r!==n&&("image/jpeg"===e.type||"image/png"===e.type)&&(a=await getResizedImageDataUrl(a,r.w,r.h)),r=n}let c=tK.createId(getHashForString(a)),u=tK.create({id:c,type:d?"image":"video",typeName:"asset",props:{name:e.name,src:a,w:r.w,h:r.h,mimeType:e.type,isAnimated:i}});o(u)},l.readAsDataURL(e)})),e.registerExternalAssetHandler("url",async({url:e})=>{let t;try{let r=await fetch(e,{method:"GET",mode:"no-cors"}),n=await r.text(),i=new DOMParser().parseFromString(n,"text/html");t={image:i.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",title:i.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??truncateStringWithEllipsis(e,32),description:i.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}}catch(r){console.error(r),t={image:"",title:truncateStringWithEllipsis(e,32),description:""}}return{id:tK.createId(getHashForString(e)),typeName:"asset",type:"bookmark",props:{src:e,description:t.description,image:t.image,title:t.title},meta:{}}}),e.registerExternalContentHandler("svg-text",async({point:t,text:r})=>{let n=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter),i=new DOMParser().parseFromString(r,"image/svg+xml").querySelector("svg");if(!i)throw Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0");if(!(o&&a)){document.body.appendChild(i);let e=i.getBoundingClientRect();document.body.removeChild(i),o=e.width,a=e.height}let l=await e.getAssetForExternalContent({type:"file",file:new File([r],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");createShapesForAssets(e,[l],n)}),e.registerExternalContentHandler("embed",({point:t,url:r,embed:n})=>{let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter),{width:o,height:a}=n,l=createShapeId(),d={id:l,type:"embed",x:i.x-(o||450)/2,y:i.y-(a||450)/2,props:{w:o,h:a,url:r}};e.createShapes([d]).select(l)}),e.registerExternalContentHandler("files",async({point:t,files:o})=>{let a=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter),l=new Vec2d_Vec2d(a.x,a.y),d=[];await Promise.all(o.map(async(t,o)=>{if(t.size>r)return console.warn(`File size too big: ${(t.size/1024).toFixed()}kb > ${(r/1024).toFixed()}kb`),null;if(!t.type)throw Error("No mime type");if(!n.concat(i).includes(t.type))return console.warn(`${t.name} not loaded - Extension not allowed.`),null;try{let r=await e.getAssetForExternalContent({type:"file",file:t});if(!r)throw Error("Could not create an asset");d[o]=r}catch(e){return console.error(e),null}})),createShapesForAssets(e,compact(d),l)}),e.registerExternalContentHandler("text",async({point:t,text:r})=>{let n,i,o;let a=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter),l=e.getShapeUtil("text").getDefaultProps(),d=cleanupText(r),c="middle",u=d.split("\n").length>1,p=isRightToLeftLanguage(d);u&&(c=u?p?"end":"start":"middle");let h=e.textMeasure.measureText(d,{...aw,fontFamily:ak[l.font],fontSize:aP[l.size],maxWidth:null}),f=Math.min(u?.9*e.viewportPageBounds.width:920,Math.max(200,.9*e.viewportPageBounds.width));if(h.w>f){let t=e.textMeasure.measureText(d,{...aw,fontFamily:ak[l.font],fontSize:aP[l.size],maxWidth:f});n=t.w,i=t.h,o=!1,c=p?"end":"start"}else n=h.w,i=h.h,o=!0;a.y-i/2<e.viewportPageBounds.minY+40&&(a.y=e.viewportPageBounds.minY+40+i/2),e.createShapes([{id:createShapeId(),type:"text",x:a.x-n/2,y:a.y-i/2,props:{text:d,align:c,autoSize:o,w:n}}])}),e.registerExternalContentHandler("url",async({point:t,url:r})=>{let n=getEmbedInfo(r);if(n)return e.putExternalContent({type:"embed",url:n.url,point:t,embed:n.definition});let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.viewportPageCenter),o=tK.createId(getHashForString(r)),a=e.getAsset(o),l=!1;if(!a){l=!0;let t=await e.getAssetForExternalContent({type:"url",url:r});if(!t)throw Error("Could not create an asset");a=t}e.batch(()=>{l&&e.createAssets([a]),createShapesForAssets(e,[a],i)})})}async function createShapesForAssets(e,t,r){if(!t.length)return;let n=Vec2d_Vec2d.From(r),i=[];for(let e of t)switch(e.type){case"bookmark":i.push({id:createShapeId(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:e.id,url:e.props.src}}),n.x+=300;break;case"image":i.push({id:createShapeId(),type:"image",x:n.x-e.props.w/2,y:n.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),n.x+=e.props.w;break;case"video":i.push({id:createShapeId(),type:"video",x:n.x-e.props.w/2,y:n.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),n.x+=e.props.w}e.batch(()=>{let n=t.filter(t=>!e.getAsset(t.id));n.length&&e.createAssets(n),e.createShapes(i).select(...i.map(e=>e.id));let{viewportPageBounds:o}=e,{selectionPageBounds:a}=e;if(a){let t=a.center.sub(r);e.updateShapes(e.selectedShapes.map(r=>{let n=e.getShapeParentTransform(r).decompose().rotation,i=Vec2d_Vec2d.Rot(t,-n);return{id:r.id,type:r.type,x:r.x-i.x,y:r.y-i.y}}))}(a=e.selectionPageBounds)&&!o.contains(a)&&e.zoomToSelection()})}let Idle_Idle=class Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;let{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}}};let Pointing_Pointing=class Pointing_Pointing extends StateNode{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;let e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>"end"===e.id),isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle",{})}createArrowShape(){let{originPagePoint:e}=this.editor.inputs,t=createShapeId();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);let r=this.editor.getShape(t);if(!r)throw Error("expected shape");let n=this.editor.getShapeHandles(r);if(!n)throw Error("expected handles for arrow");let i=this.editor.getShapeUtil("arrow"),o=n.find(e=>"start"===e.id),a=i.onHandleChange?.(r,{handle:{...o,x:0,y:0},isPrecise:!0});if(a){let e=a.props?.start;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([a],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){let e=this.shape;if(!e)throw Error("expected shape");let t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");let r={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{let n=this.editor.getShapeUtil("arrow"),i=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),o=t.find(e=>"end"===e.id),a=n.onHandleChange?.(r,{handle:{...o,x:i.x,y:i.y},isPrecise:!1});if(a){let e=a.props?.end;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([a],{squashing:!0})}}{let e=this.editor.getShapeUtil("arrow"),n=t.find(e=>"start"===e.id),i=e.onHandleChange?.(r,{handle:{...n,x:0,y:0},isPrecise:this.didTimeout});i&&this.editor.updateShapes([i],{squashing:!0})}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.isActive&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}};let ArrowShapeTool=class ArrowShapeTool extends StateNode{static id="arrow";static initial="idle";static children=()=>[Idle_Idle,Pointing_Pointing];shapeType="arrow"};let Drawing=class Drawing extends StateNode{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.isMenuOpen,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{let{editor:{inputs:e}}=this;if(this.isPen!==e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?Vec2d_Vec2d.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.zoomLevel?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())};onKeyDown=e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()};onKeyUp=e=>{if("Shift"===e.key)switch(this.editor.snaps.clear(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateShapes()};onExit=()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;let r=a_[t],n=e[0].points[0],i=e[e.length-1],o=i.points[i.points.length-1];return n!==o&&this.currentLineLength>4*r&&Vec2d_Vec2d.Dist(n,o)<2*r}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+uniqueId(),this.editor.mark(this.markId),this.isPen=t;let r=this.isPen?1.25*this.info.point.z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let r=last(t.props.segments);if(!r)throw Error("Expected a previous segment!");let n=last(r.points);if(!n)throw Error("Expected a previous point!");let{x:i,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),a=this.isPen?1.25*this.info.point.z:.5,l={type:this.segmentMode,points:[{x:n.x,y:n.y,z:+a.toFixed(2)},{x:i,y:o,z:+a.toFixed(2)}]},d=Matrix2d.applyToPoint(this.editor.getShapePageTransform(t.id),n);this.pagePointWhereCurrentSegmentChanged=d,this.pagePointWhereNextSegmentChanged=null;let c=[...t.props.segments,l];this.currentLineLength=this.getLineLength(c);let u={id:t.id,type:this.shapeType,props:{segments:c}};this.canClose()&&(u.props.isClosed=this.getIsClosed(c,t.props.size)),this.editor.updateShapes([u]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let n=createShapeId();this.editor.createShapes([{id:n,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+r.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(n)}updateShapes(){let{inputs:e}=this.editor,{initialShape:t}=this;if(!t)return;let{id:r,props:{size:n}}=t,i=this.editor.getShape(r);if(!i)return;let{segments:o}=i.props,{x:a,y:l,z:d}=this.editor.getPointInShapeSpace(i,e.currentPagePoint).toFixed(),c={x:a,y:l,z:this.isPen?+(1.25*d).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");let a=Vec2d_Vec2d.Dist(t,e.currentPagePoint)>np;if(a){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=last(o);if(!t)throw Error("Expected a previous segment!");let a=last(t.points);if(!a)throw Error("Expected a previous last point!");let l=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=Vec2d_Vec2d.Dist(a,l),e={type:"straight",points:[{...a},l]};let t=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=Matrix2d.applyToPoint(t,a)}else e={type:"straight",points:[l,c]};let d={id:r,type:this.shapeType,props:{segments:[...o,e]}};this.canClose()&&(d.props.isClosed=this.getIsClosed(o,n)),this.editor.updateShapes([d],{squashing:!0})}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");let i=Vec2d_Vec2d.Dist(t,e.currentPagePoint)>np;if(i){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=o.slice(),t=e[e.length-1],i=last(t.points);if(!i)throw Error("No previous point!");let a={type:"free",points:[...Vec2d_Vec2d.PointsBetween(i,c,6).map(e=>e.toFixed().toJson())]},l=[...e,a];this.currentLineLength=this.getLineLength(l);let d={id:r,type:this.shapeType,props:{segments:l}};this.canClose()&&(d.props.isClosed=this.getIsClosed(l,n)),this.editor.updateShapes([d],{squashing:!0})}break}case"straight":{let e,t;let a=o.slice(),l=a[a.length-1],{pagePointWhereCurrentSegmentChanged:d}=this,{currentPagePoint:c,ctrlKey:u}=this.editor.inputs;if(!d)throw Error("We should have a point where the segment changed");let p=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(p=!u,this.didJustShiftClickToExtendPreviousShapeLine=!1):p=!u;let h=this.editor.getPointInShapeSpace(i,c).toFixed().toJson(),f=!1,g=this.editor.user.isSnapMode?!u:u;if(g&&a.length>2){let e;let r=8/this.editor.zoomLevel;for(let n=0,i=o.length-2;n<i;n++){let i=o[n];if(!i)break;if("free"===i.type)continue;let a=i.points[0],l=last(i.points);if(!(a&&l))continue;let d=Vec2d_Vec2d.NearestPointOnLineSegment(a,l,h),c=Vec2d_Vec2d.Dist(d,h);if(c<r){e=d.toFixed().toJson(),r=c,t=i;break}}e&&(f=!0,h=e)}if(f&&t){let e=this.editor.getShapePageTransform(i),r=t.points[0],n=last(t.points);if(!n)throw Error("Expected a last point!");let o=Matrix2d.applyToPoint(e,r),a=Matrix2d.applyToPoint(e,n),l=Matrix2d.applyToPoint(e,h);this.editor.snaps.setLines([{id:uniqueId(),type:"points",points:[o,l,a]}])}else{if(this.editor.snaps.clear(),p){let t=Vec2d_Vec2d.Angle(d,c),r=snapAngle(t,24),n=r-t;e=Vec2d_Vec2d.RotWith(c,d,n)}else e=c;h=this.editor.getPointInShapeSpace(i,e).toFixed().toJson()}this.currentLineLength+=Vec2d_Vec2d.Dist(l.points[0],h),a[a.length-1]={...l,type:"straight",points:[l.points[0],h]};let m={id:r,type:this.shapeType,props:{segments:a}};this.canClose()&&(m.props.isClosed=this.getIsClosed(o,n)),this.editor.updateShapes([m],{squashing:!0});break}case"free":{let e=o.slice(),t=e[e.length-1],i=[...t.points];if(i.length&&this.mergeNextPoint){let{z:e}=i[i.length-1];i[i.length-1]={x:c.x,y:c.y,z:e?Math.max(e,c.z):c.z}}else this.currentLineLength+=Vec2d_Vec2d.Dist(i[i.length-1],c),i.push(c);e[e.length-1]={...t,points:i},this.currentLineLength=this.getLineLength(e);let a={id:r,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(a.props.isClosed=this.getIsClosed(e,n)),this.editor.updateShapes([a],{squashing:!0}),i.length>500){this.editor.updateShapes([{id:r,type:this.shapeType,props:{isComplete:!0}}]);let{currentPagePoint:e}=this.editor.inputs,t=createShapeId();this.editor.createShapes([{id:t,type:this.shapeType,x:toFixed(e.x),y:toFixed(e.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(1.25*d).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(t)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let r of e)for(let e=0;e<r.points.length-1;e++){let n=r.points[e],i=r.points[e+1];t+=Vec2d_Vec2d.Sub(i,n).len2()}return Math.sqrt(t)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle",{}))}cancel(){this.parent.transition("idle",this.info)}};let toolStates_Idle_Idle=class toolStates_Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let DrawShapeTool=class DrawShapeTool extends StateNode{static id="draw";static initial="idle";static children=()=>[toolStates_Idle_Idle,Drawing];shapeType="draw";onExit=()=>{let e=this.children.drawing;e.initialShape=void 0}};let FrameShapeTool=class FrameShapeTool extends BaseBoxShapeTool{static id="frame";static initial="idle";shapeType="frame"};let geo_toolStates_Idle_Idle=class geo_toolStates_Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;let{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}};let toolStates_Pointing_Pointing=class toolStates_Pointing_Pointing extends StateNode{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,r=createShapeId();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(rx)}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs,t=createShapeId();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(rx),w:1,h:1}}]);let r=this.editor.getShape(t);if(!r)return;let n="star"===r.props.geo?getStarBounds(5,200,200):"cloud"===r.props.geo?new Box2d_Box2d(0,0,300,180):new Box2d_Box2d(0,0,200,200),i=n.center,o=this.editor.getShapeParentTransform(r);o&&i.rot(-o.rotation()),this.editor.select(t),this.editor.updateShapes([{id:r.id,type:"geo",x:r.x-i.x,y:r.y-i.y,props:{geo:this.editor.getStyleForNextShape(rx),w:n.width,h:n.height}}]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle",{})}};let GeoShapeTool=class GeoShapeTool extends StateNode{static id="geo";static initial="idle";static children=()=>[geo_toolStates_Idle_Idle,toolStates_Pointing_Pointing];shapeType="geo"};let HighlightShapeTool=class HighlightShapeTool extends StateNode{static id="highlight";static initial="idle";static children=()=>[toolStates_Idle_Idle,Drawing];shapeType="highlight";onExit=()=>{let e=this.children.drawing;e.initialShape=void 0}};let line_toolStates_Idle_Idle=class line_toolStates_Idle_Idle extends StateNode{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}};let line_toolStates_Pointing_Pointing=class line_toolStates_Pointing_Pointing extends StateNode{static id="pointing";shape={};markId;onEnter=e=>{let{inputs:t}=this.editor,{currentPagePoint:r}=t;this.markId=void 0;let n=e.shapeId&&this.editor.getShape(e.shapeId);if(n&&t.shiftKey){let e,t;this.markId=`creating:${n.id}`,this.editor.mark(this.markId),this.shape=n;let i=this.editor.getShapeHandles(this.shape);if(!i)return;let o=i.filter(e=>"vertex"===e.type).sort(reordering_sortByIndex),a=o[o.length-1],l=o[o.length-2],d=Matrix2d.applyToPoint(this.editor.getShapeParentTransform(this.shape),new Vec2d_Vec2d(this.shape.x,this.shape.y)),c=Vec2d_Vec2d.Sub(r,d);2>Vec2d_Vec2d.Dist(a,l)||2>Vec2d_Vec2d.Dist(c,a)?(e=a.index,a.id,t={...a,x:c.x+.1,y:c.y+.1}):t={id:"handle:"+(e=getIndexAbove(a.index)),type:"vertex",index:e,x:c.x+.1,y:c.y+.1,canBind:!1};let u=eL(this.shape.props.handles);u[t.id]=t,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:u}}])}else{let e=createShapeId();this.markId=`creating:${e}`,this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:r.x,y:r.y}]),this.editor.select(e),this.shape=this.editor.getShape(e)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){let e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let t=last(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle",{}),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}};let LineShapeTool=class LineShapeTool extends StateNode{static id="line";static initial="idle";static children=()=>[line_toolStates_Idle_Idle,line_toolStates_Pointing_Pointing];shapeType="line"};let note_toolStates_Idle_Idle=class note_toolStates_Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let note_toolStates_Pointing_Pointing=class note_toolStates_Pointing_Pointing extends StateNode{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{this.wasFocusedOnEnter=!this.editor.isMenuOpen,this.wasFocusedOnEnter&&(this.shape=this.createShape())};onPointerMove=e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,isCreating:!0,editAfterComplete:!0,onInteractionEnd:"note"}))};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){let{inputs:{originPagePoint:e}}=this.editor,t=createShapeId();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);let r=this.editor.getShape(t),n=this.editor.getShapeGeometry(r).bounds;return this.editor.updateShapes([{id:t,type:"note",x:r.x-n.width/2,y:r.y-n.height/2}]),this.editor.getShape(t)}};let NoteShapeTool=class NoteShapeTool extends StateNode{static id="note";static initial="idle";static children=()=>[note_toolStates_Idle_Idle,note_toolStates_Pointing_Pointing];shapeType="note"};function updateHoveredId(e){let t;let r=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:nv/e.zoomLevel,renderingOnly:!0});if(!r)return e.setHoveredShape(null);let n=e.getOutermostSelectableShape(r);return t=n===r?r:n.id===e.focusedGroupId||e.selectedShapeIds.includes(n.id)?r:n,e.setHoveredShape(t.id)}let text_toolStates_Idle_Idle=class text_toolStates_Idle_Idle extends StateNode{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":updateHoveredId(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyDown=e=>{if("Enter"===e.key){if(this.editor.instanceState.isReadonly)return null;let{onlySelectedShape:t}=this.editor;t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.current.value.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}};let text_toolStates_Pointing_Pointing=class text_toolStates_Pointing_Pointing extends StateNode{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{inputs:{originPagePoint:t}}=this.editor,r=createShapeId();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(r),this.shape=this.editor.getShape(r),this.shape&&this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},editAfterComplete:!0,onInteractionEnd:"text"})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");let e=createShapeId(),{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:r,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.current.value?.transition("editing_shape",{})}cancel(){this.parent.transition("idle",{}),this.editor.bailToMark(this.markId)}};let TextShapeTool=class TextShapeTool extends StateNode{static id="text";static initial="idle";static children=()=>[text_toolStates_Idle_Idle,text_toolStates_Pointing_Pointing];shapeType="text"};let aD=[TextShapeTool,DrawShapeTool,GeoShapeTool,NoteShapeTool,LineShapeTool,FrameShapeTool,ArrowShapeTool,HighlightShapeTool];function useDefaultColorTheme(){return getDefaultColorTheme({isDarkMode:useIsDarkMode()})}let aV=T.memo(function({theme:e,d:t,color:r,fill:n}){switch(n){case"none":return null;case"solid":return(0,I.jsx)("path",{fill:e[r].semi,d:t});case"semi":return(0,I.jsx)("path",{fill:e.solid,d:t});case"pattern":return(0,I.jsx)(PatternFill,{theme:e,color:r,fill:n,d:t})}}),PatternFill=function({d:e,color:t,theme:r}){let n=useEditor(),i=useValue("zoomLevel",()=>n.zoomLevel,[n]),o=n.zoomLevel<=.18;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("path",{fill:r[t].pattern,d:e}),(0,I.jsx)("path",{fill:o?r[t].semi:`url(#${nf[`${Math.ceil(i)}_${r.id}`]})`,d:e})]})};function getShapeFillSvg({d:e,color:t,fill:r,theme:n}){if("none"===r)return;if("pattern"===r){let r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",e),i.setAttribute("fill",n[t].pattern);let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",e),o.setAttribute("fill","url(#hash_pattern)"),r.appendChild(i),r.appendChild(o),r}let i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",e),r){case"semi":i.setAttribute("fill",n.solid);break;case"solid":i.setAttribute("fill",n[t].semi)}return i}function getSvgWithShapeFill(e,t){if(!t)return e;{let r=document.createElementNS("http://www.w3.org/2000/svg","g");return r.appendChild(t),r.appendChild(e),r}}function correctSpacesToNbsp(e){return e.replace(/\s/g,"\xa0")}function createTextSvgElementFromSpans(e,t,r){let{padding:n=0}=r,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",r.fontSize+"px"),i.setAttribute("font-family",r.fontFamily),i.setAttribute("font-style",r.fontStyle),i.setAttribute("font-weight",r.fontWeight),i.setAttribute("line-height",r.lineHeight*r.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),0===t.length)return i;let o=Box2d_Box2d.From(t[0].box);for(let{box:e}of t)o.union(e);let a=n+(r.offsetX??0),l=(r.offsetY??0)+r.fontSize/2+("start"===r.verticalTextAlign?n:"end"===r.verticalTextAlign?r.height-n-o.height:(Math.ceil(r.height)-o.height)/2),d=null;for(let{text:e,box:r}of t){let t=null!==d&&r.y>d;if(t){let e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttribute("alignment-baseline","mathematical"),e.setAttribute("x",a+"px"),e.setAttribute("y",r.y+l+"px"),e.textContent="\n",i.appendChild(e)}let n=document.createElementNS("http://www.w3.org/2000/svg","tspan");n.setAttribute("alignment-baseline","mathematical"),n.setAttribute("x",r.x+a+"px"),n.setAttribute("y",r.y+l+"px");let o=correctSpacesToNbsp(e);n.textContent=o,i.appendChild(n),d=r.y}return r.stroke&&r.strokeWidth&&(i.setAttribute("stroke",r.stroke),i.setAttribute("stroke-width",r.strokeWidth+"px")),r.fill&&i.setAttribute("fill",r.fill),i}function getFontDefForExport(e){return{key:`${t5.id}:${e}`,getElement:async()=>{let t=findFont(e);if(!t)return null;let r=t.$$_url,n=t.$$_fontface;if(!r||!n)return null;let i=await (await fetch(r)).blob(),o=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=t,r.readAsDataURL(i)}),a=n.replace(r,o),l=document.createElementNS("http://www.w3.org/2000/svg","style");return l.textContent=a,l}}}function findFont(e){let t=t4[e];for(let e of document.fonts)if(t.includes(e.family))return e;return null}function getFillDefForExport(e,t){return{key:`${t5.id}:${e}`,getElement:async()=>{if("pattern"!==e)return null;let r=8/12,n=document.createElement("div");return n.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${1*r}" y1="${3*r}" x2="${3*r}" y2="${1*r}" />
								<line x1="${5*r}" y1="${7*r}" x2="${7*r}" y2="${5*r}" />
								<line x1="${9*r}" y1="${11*r}" x2="${11*r}" y2="${9*r}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${t.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(n.querySelectorAll("defs > *"))}}}function getFillDefForCanvas(){return{key:`${t5.id}:pattern`,component:PatternFillDefForCanvas}}let generateImage=(e,t,r)=>new Promise((n,i)=>{let o=8*t*e,a=document.createElement("canvas");a.width=o,a.height=o;let l=a.getContext("2d");if(!l)return;l.fillStyle=r?"#212529":"#f8f9fa",l.fillRect(0,0,o,o),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*t*e;let d=8/12,s=r=>r*t*e;l.beginPath(),l.moveTo(s(1*d),s(3*d)),l.lineTo(s(3*d),s(1*d)),l.moveTo(s(5*d),s(7*d)),l.lineTo(s(7*d),s(5*d)),l.moveTo(s(9*d),s(11*d)),l.lineTo(s(11*d),s(9*d)),l.stroke(),a.toBlob(e=>{!e||rZ.throwToBlob.value?i():n(e)})}),canvasBlob=(e,t)=>{let r=document.createElement("canvas");r.width=e[0],r.height=e[1];let n=r.getContext("2d");return n?(t(n),r.toDataURL()):""},getDefaultPatterns=()=>{let e=[];for(let t=1;t<=Math.ceil(nd);t++){let r=canvasBlob([1,1],e=>{e.fillStyle=tJ.lightMode.black.semi,e.fillRect(0,0,1,1)}),n=canvasBlob([1,1],e=>{e.fillStyle=tJ.darkMode.black.semi,e.fillRect(0,0,1,1)});e.push({zoom:t,url:r,darkMode:!1}),e.push({zoom:t,url:n,darkMode:!0})}return e};function usePattern(){let e=useEditor(),t=e.instanceState.devicePixelRatio,[r,n]=(0,T.useState)(!1),i=(0,T.useMemo)(()=>getDefaultPatterns(),[]),[o,a]=(0,T.useState)(i);(0,T.useEffect)(()=>{let e=[];for(let r=1;r<=Math.ceil(nd);r++)e.push(generateImage(t,r,!1).then(e=>({zoom:r,url:URL.createObjectURL(e),darkMode:!1}))),e.push(generateImage(t,r,!0).then(e=>({zoom:r,url:URL.createObjectURL(e),darkMode:!0})));let r=!1;return Promise.all(e).then(e=>{r||(a(e),n(!0))}),()=>{r=!0,n(!1)}},[t]);let l=(0,I.jsx)(I.Fragment,{children:o.map(e=>{let t=e.zoom+(e.darkMode?"_dark":"_light");return(0,I.jsx)("pattern",{id:nf[t],width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,I.jsx)("image",{href:e.url,width:8,height:8})},t)})});return{defs:l,isReady:r}}function PatternFillDefForCanvas(){let e=useEditor(),t=(0,T.useRef)(null),{defs:r,isReady:n}=usePattern();return(0,T.useEffect)(()=>{if(n&&e.environment.isSafari){let e=findHtmlLayerParent(t.current);e&&requestAnimationFrame(()=>{e.style.display="none",requestAnimationFrame(()=>{e.style.display=""})})}},[e,n]),(0,I.jsx)("g",{ref:t,children:r})}function findHtmlLayerParent(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?findHtmlLayerParent(e.parentElement):null}function getPerfectDashProps_getPerfectDashProps(e,t,r={}){let{closed:n=!1,snap:i=1,start:o="outset",end:a="outset",lengthRatio:l=2,style:d="dashed"}=r,c=0,u=0,p=1,h=0,f=0;switch(d){case"dashed":p=1,c=Math.min(t*l,e/4);break;case"dotted":c=t/(p=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return n||("outset"===o?(e+=c/2,f+=c/2):"skip"===o&&(e-=c,f-=c),"outset"===a?e+=c/2:"skip"!==a||(e-=c)),u=Math.floor(e/c/(2*p)),(u-=u%i)<3&&"dashed"===d?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(c=e/(u=Math.max(u,3))/(2*p),n?(f=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:f.toString()}}function useEditableText(e,t,r){let n=useEditor(),i=(0,T.useRef)(null),o=(0,T.useRef)(!1),a=(0,T.useRef)(),l=useValue("isEditing",()=>n.editingShapeId===e,[n,e]);(0,T.useEffect)(()=>{let e=i.current;e&&l&&document.activeElement!==e&&e.focus()},[l]);let d=(0,T.useCallback)(()=>{let t=o.current;o.current=!1,requestAnimationFrame(()=>{let r=i.current;if(!r)return;let o=n.getShape(e);o&&(r.value=o.props.text,r.value.length&&!t&&r.select())})},[n,e]),c=(0,T.useCallback)(()=>{let t=a.current;requestAnimationFrame(()=>{let r=i.current,{editingShapeId:a}=n;if(r&&a){if(a===e){if(t){if(t.length){o.current=!0,r.focus();let e=window.getSelection();e&&t.forEach(t=>e.addRange(t))}else r.focus()}else r.focus()}}else window.getSelection()?.removeAllRanges(),n.complete()})},[n,e]),u=(0,T.useCallback)(e=>{if(l)switch((e.ctrlKey||e.metaKey)&&stopEventPropagation(e),e.key){case"Enter":(e.ctrlKey||e.metaKey)&&n.complete();break;case"Tab":preventDefault(e),e.shiftKey?TextHelpers.unindent(e.currentTarget):TextHelpers.indent(e.currentTarget)}},[n,l]),p=(0,T.useCallback)(r=>{if(!l)return;let i=TextHelpers.normalizeText(r.currentTarget.value),o=i.replace(/\t/g,"  ");if(o!==i){let e=r.currentTarget.selectionStart;r.currentTarget.value=o,r.currentTarget.selectionStart=e+(o.length-i.length),r.currentTarget.selectionEnd=e+(o.length-i.length),i=o}n.updateShapes([{id:e,type:t,props:{text:i}}])},[n,e,t,l]),h=0===r.trim().length;(0,T.useEffect)(()=>{if(!l)return;let e=i.current;if(e){let updateSelection2=function(){let e=window.getSelection?.();if(e&&"None"!==e.type){let t=[];if(e)for(let r=0;r<e.rangeCount;r++)t.push(e.getRangeAt?.(r));a.current=t}};return document.addEventListener("selectionchange",updateSelection2),()=>{document.removeEventListener("selectionchange",updateSelection2)}}},[l]);let f=(0,T.useCallback)(t=>{n.dispatch({...getPointerInfo(t),type:"pointer",name:"pointer_down",target:"shape",shape:n.getShape(e)}),stopEventPropagation(t)},[n,e]);return{rInput:i,isEditing:l,handleFocus:d,handleBlur:c,handleKeyDown:u,handleChange:p,handleInputPointerDown:f,handleDoubleClick:stopEventPropagation,isEmpty:h}}let aR=T.memo(function({id:e,text:t,size:r,font:n,position:i,width:o,labelColor:a}){let{rInput:l,isEditing:d,handleFocus:c,handleBlur:u,handleKeyDown:p,handleChange:h,isEmpty:f,handleInputPointerDown:g,handleDoubleClick:m}=useEditableText(e,"arrow",t),y=TextHelpers.normalizeTextForDom(t),b=y.trim().length>0;return d||b?(0,I.jsx)("div",{className:"tl-arrow-label","data-font":n,"data-align":"center","data-hastext":!f,"data-isediting":d,style:{textAlign:"center",fontSize:aC[r],lineHeight:aC[r]*aw.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:a},children:(0,I.jsxs)("div",{className:"tl-arrow-label__inner",children:[(0,I.jsx)("p",{style:{width:o||"9px"},children:t?TextHelpers.normalizeTextForDom(t):" "}),d&&(0,I.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:c,onChange:h,onKeyDown:p,onBlur:u,onContextMenu:stopEventPropagation,onPointerDown:g,onDoubleClick:m})]})}):null}),aj=0;let ArrowShapeUtil=class ArrowShapeUtil extends ShapeUtil{static type="arrow";static props=rt;static migrations=rn;canEdit=()=>!0;canBind=()=>!1;canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(e){let t;let r=this.editor.getArrowInfo(e),n=r.isStraight?new Edge2d({start:Vec2d_Vec2d.From(r.start.point),end:Vec2d_Vec2d.From(r.end.point)}):new Arc2d({center:Vec2d_Vec2d.Cast(r.handleArc.center),radius:r.handleArc.radius,start:Vec2d_Vec2d.Cast(r.start.point),end:Vec2d_Vec2d.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(e.props.text.trim()){let i=n.bounds,{w:o,h:a}=this.editor.textMeasure.measureText(e.props.text,{...aw,fontFamily:ak[e.props.font],fontSize:aC[e.props.size],maxWidth:null}),l=o,d=a;if(i.width>i.height){l=Math.max(Math.min(o,64),Math.min(i.width-64,o));let{w:t,h:r}=this.editor.textMeasure.measureText(e.props.text,{...aw,fontFamily:ak[e.props.font],fontSize:aC[e.props.size],maxWidth:l});l=t,d=r}if(l>16*aC[e.props.size]){l=16*aC[e.props.size];let{w:t,h:r}=this.editor.textMeasure.measureText(e.props.text,{...aw,fontFamily:ak[e.props.font],fontSize:aC[e.props.size],maxWidth:l});l=t,d=r}t=new Rectangle2d({x:r.middle.x-l/2-4.25,y:r.middle.y-d/2-4.25,width:l+8.5,height:d+8.5,isFilled:!0,isLabel:!0})}return new Group2d({children:t?[n,t]:[n],isSnappable:!1})}getHandles(e){let t=this.editor.getArrowInfo(e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y,canBind:!0}]}onHandleChange=(e,{handle:t,isPrecise:r})=>{let n=t.id;if("middle"===n){let{start:r,end:n}=getArrowTerminalsInArrowSpace(this.editor,e),i=Vec2d_Vec2d.Sub(n,r),o=Vec2d_Vec2d.Per(i),a=Vec2d_Vec2d.Med(n,r),l=Vec2d_Vec2d.Sub(a,o),d=Vec2d_Vec2d.Add(a,o),c=Vec2d_Vec2d.NearestPointOnLineSegment(l,d,t,!1),u=Vec2d_Vec2d.Dist(c,a);return Vec2d_Vec2d.Clockwise(c,n,a)&&(u*=-1),{id:e.id,type:e.type,props:{bend:u}}}let i=deepCopy(e),o=this.editor.getShapePageTransform(i.id),a=o.applyToPoint(t);if(this.editor.inputs.ctrlKey)return i.props[n]={type:"point",x:t.x,y:t.y},i;let l=this.editor.getShapePageTransform(e.id).applyToPoint(t),d=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(!d)return i.props[n]={type:"point",x:t.x,y:t.y},i;let c=this.editor.getShapeGeometry(d),u=Box2d_Box2d.ZeroFix(c.bounds),p=this.editor.getPointInShapeSpace(d,a),h=r;if(!h){let e=i.props[n];("point"===e.type||"binding"===e.type&&d.id!==e.boundShapeId)&&(h=.5>this.editor.inputs.pointerVelocity.len())}if(h&&(h=Vec2d_Vec2d.Dist(p,u.center)>Math.max(4,Math.min(.15*Math.min(u.width,u.height),16))/this.editor.zoomLevel),!r){c.isClosed||(h=!0);let e=i.props["start"===n?"end":"start"];"binding"===e.type&&d.id===e.boundShapeId&&Vec2d_Vec2d.Equals(e.normalizedAnchor,{x:.5,y:.5})&&(h=!0)}return i.props[n]={type:"binding",boundShapeId:d.id,normalizedAnchor:h?{x:(p.x-u.minX)/u.width,y:(p.y-u.minY)/u.height}:{x:.5,y:.5},isExact:this.editor.inputs.altKey},"binding"===i.props.start.type&&"binding"===i.props.end.type&&i.props.start.boundShapeId===i.props.end.boundShapeId&&Vec2d_Vec2d.Equals(i.props.start.normalizedAnchor,i.props.end.normalizedAnchor)&&(i.props.end.normalizedAnchor.x+=.05),i};onTranslateStart=e=>{let t="binding"===e.props.start.type?e.props.start.boundShapeId:null,r="binding"===e.props.end.type?e.props.end.boundShapeId:null,{selectedShapeIds:n}=this.editor;if(t&&(n.includes(t)||this.editor.isAncestorSelected(t))||r&&(n.includes(r)||this.editor.isAncestorSelected(r)))return;let{start:i,end:o}=getArrowTerminalsInArrowSpace(this.editor,e);return{id:e.id,type:e.type,props:{...e.props,start:{type:"point",x:i.x,y:i.y},end:{type:"point",x:o.x,y:o.y}}}};onResize=(e,t)=>{let{scaleX:r,scaleY:n}=t,i=getArrowTerminalsInArrowSpace(this.editor,e),{start:o,end:a}=deepCopy(e.props),{bend:l}=e.props;"point"===o.type&&(o.x=i.start.x*r,o.y=i.start.y*n),"point"===a.type&&(a.x=i.end.x*r,a.y=i.end.y*n);let d=Math.abs(r),c=Math.abs(n);r<0&&n>=0?(0!==l&&(l*=-1*Math.max(d,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x),"binding"===a.type&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x)):r>=0&&n<0?(0!==l&&(l*=-1*Math.max(d,c)),"binding"===o.type&&(o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===a.type&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y)):r>=0&&n>=0?0!==l&&(l*=Math.max(d,c)):r<0&&n<0&&(0!==l&&(l*=Math.max(d,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x,o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===a.type&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y));let u={props:{start:o,end:a,bend:l}};return u};onDoubleClickHandle=(e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}};component(e){let t=useDefaultColorTheme(),r=this.editor.onlySelectedShape,n=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.instanceState.isReadonly,i=this.editor.getArrowInfo(e),o=Box2d_Box2d.ZeroFix(this.editor.getShapeGeometry(e).bounds),a=T.useMemo(()=>this.editor.environment.isSafari?aj+=1:0,[e]);if(!i?.isValid)return null;let l=a_[e.props.size],d=i.start.arrowhead&&getArrowheadPathForType(i,"start",l),c=i.end.arrowhead&&getArrowheadPathForType(i,"end",l),u=i.isStraight?getSolidStraightArrowPath(i):getSolidCurvedArrowPath(i),p=null;if(r===e&&n){let{strokeDasharray:t,strokeDashoffset:r}=getPerfectDashProps_getPerfectDashProps(i.isStraight?Vec2d_Vec2d.Dist(i.start.handle,i.end.handle):Math.abs(i.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});p="binding"===e.props.start.type||"binding"===e.props.end.type?(0,I.jsx)("path",{className:"tl-arrow-hint",d:i.isStraight?getStraightArrowHandlePath(i):getCurvedArrowHandlePath(i),strokeDasharray:t,strokeDashoffset:r,strokeWidth:2,markerStart:"binding"===e.props.start.type?e.props.start.isExact?"":isPrecise(e.props.start.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:"binding"===e.props.end.type?e.props.end.isExact?"":isPrecise(e.props.end.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}let{strokeDasharray:h,strokeDashoffset:f}=getPerfectDashProps_getPerfectDashProps(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:e.props.dash}),g=e.props.text.trim()?this.editor.getShapeGeometry(e).children[1]:null,m=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),y=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead),b=(e.id+"_clip_"+a).replace(":","_");return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(SVGContainer,{id:e.id,style:{minWidth:50,minHeight:50},children:[(0,I.jsx)("defs",{children:(0,I.jsxs)("mask",{id:b,children:[(0,I.jsx)("rect",{x:toDomPrecision(-100+o.minX),y:toDomPrecision(-100+o.minY),width:toDomPrecision(o.width+200),height:toDomPrecision(o.height+200),fill:"white"}),g&&(0,I.jsx)("rect",{x:g.x,y:g.y,width:g.w,height:g.h,fill:"black",rx:4,ry:4}),d&&m&&(0,I.jsx)("path",{d:d,fill:"arrow"===i.start.arrowhead?"none":"black",stroke:"none"}),c&&y&&(0,I.jsx)("path",{d:c,fill:"arrow"===i.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,I.jsxs)("g",{fill:"none",stroke:t[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,(0,I.jsxs)("g",{mask:`url(#${b})`,children:[(0,I.jsx)("rect",{x:toDomPrecision(o.minX-100),y:toDomPrecision(o.minY-100),width:toDomPrecision(o.width+200),height:toDomPrecision(o.height+200),opacity:0}),(0,I.jsx)("path",{d:u,strokeDasharray:h,strokeDashoffset:f})]}),d&&m&&"none"!==e.props.fill&&(0,I.jsx)(aV,{theme:t,d:d,color:e.props.color,fill:e.props.fill}),c&&y&&"none"!==e.props.fill&&(0,I.jsx)(aV,{theme:t,d:c,color:e.props.color,fill:e.props.fill}),d&&(0,I.jsx)("path",{d:d}),c&&(0,I.jsx)("path",{d:c})]})]}),(0,I.jsx)(aR,{id:e.id,text:e.props.text,font:e.props.font,size:e.props.size,position:i.middle,width:g?.w??0,labelColor:t[e.props.labelColor].solid})]})}indicator(e){let{start:t,end:r}=getArrowTerminalsInArrowSpace(this.editor,e),n=this.editor.getArrowInfo(e),i=this.editor.getShapeGeometry(e),o=i.bounds,a=e.props.text.trim()?i.children[1]:null,l=useIsEditing(e.id);if(!n||Vec2d_Vec2d.Equals(t,r))return null;let d=a_[e.props.size],c=n.start.arrowhead&&getArrowheadPathForType(n,"start",d),u=n.end.arrowhead&&getArrowheadPathForType(n,"end",d),p=n.isStraight?getSolidStraightArrowPath(n):getSolidCurvedArrowPath(n),h=c&&"arrow"!==n.start.arrowhead||u&&"arrow"!==n.end.arrowhead||!!a,f=(e.id+"_clip").replace(":","_");return l&&a?(0,I.jsx)("rect",{x:toDomPrecision(a.x),y:toDomPrecision(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5}):(0,I.jsxs)("g",{children:[h&&(0,I.jsx)("defs",{children:(0,I.jsxs)("mask",{id:f,children:[(0,I.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.w+200,height:o.h+200,fill:"white"}),a&&(0,I.jsx)("rect",{x:toDomPrecision(a.x),y:toDomPrecision(a.y),width:a.w,height:a.h,fill:"black",rx:3.5,ry:3.5}),c&&(0,I.jsx)("path",{d:c,fill:"arrow"===n.start.arrowhead?"none":"black",stroke:"none"}),u&&(0,I.jsx)("path",{d:u,fill:"arrow"===n.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,I.jsxs)("g",{...h?{mask:`url(#${f})`}:void 0,children:[h&&(0,I.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.width+200,height:o.height+200,opacity:0}),(0,I.jsx)("path",{d:p})]}),c&&(0,I.jsx)("path",{d:c}),u&&(0,I.jsx)("path",{d:u}),a&&(0,I.jsx)("rect",{x:toDomPrecision(a.x),y:toDomPrecision(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{let{id:t,type:r,props:{text:n}}=e;n.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:n.trimEnd()}}])};toSvg(e,t){let r=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode});t.addExportDef(getFillDefForExport(e.props.fill,r));let n=r[e.props.color].solid,i=this.editor.getArrowInfo(e),o=a_[e.props.size],a=document.createElementNS("http://www.w3.org/2000/svg","g");if(!i)return a;let l=i.start.arrowhead&&getArrowheadPathForType(i,"start",o),d=i.end.arrowhead&&getArrowheadPathForType(i,"end",o),c=this.editor.getShapeGeometry(e),u=c.bounds,p=e.props.text.trim()?c.children[1]:null,h=(e.id+"_clip").replace(":","_");if(l||d||p){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask");t.id=h;let r=document.createElementNS("http://www.w3.org/2000/svg","rect");if(r.setAttribute("x",u.minX-100+""),r.setAttribute("y",u.minY-100+""),r.setAttribute("width",u.width+200+""),r.setAttribute("height",u.height+200+""),r.setAttribute("fill","white"),t.appendChild(r),l&&t.appendChild(getArrowheadSvgMask(l,i.start.arrowhead)),d&&t.appendChild(getArrowheadSvgMask(d,i.end.arrowhead)),p){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",p.x+""),e.setAttribute("y",p.y+""),e.setAttribute("width",p.w+""),e.setAttribute("height",p.h+""),e.setAttribute("fill","black"),t.appendChild(e)}e.appendChild(t),a.appendChild(e)}let f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("mask",`url(#${h})`),a.appendChild(f);let g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("x","-100"),g.setAttribute("y","-100"),g.setAttribute("width",u.width+200+""),g.setAttribute("height",u.height+200+""),g.setAttribute("fill","transparent"),g.setAttribute("stroke","none"),f.appendChild(g);let m=getArrowSvgPath(i.isStraight?getSolidStraightArrowPath(i):getSolidCurvedArrowPath(i),n,o),{strokeDasharray:y,strokeDashoffset:b}=getPerfectDashProps_getPerfectDashProps(i.isStraight?i.length:Math.abs(i.bodyArc.length),o,{style:e.props.dash});if(m.setAttribute("stroke-dasharray",y),m.setAttribute("stroke-dashoffset",b),f.appendChild(m),l&&a.appendChild(getArrowheadSvgPath(l,e.props.color,o,"arrow"===e.props.arrowheadStart?"none":e.props.fill,r)),d&&a.appendChild(getArrowheadSvgPath(d,e.props.color,o,"arrow"===e.props.arrowheadEnd?"none":e.props.fill,r)),p){t.addExportDef(getFontDefForExport(e.props.font));let n={fontSize:aC[e.props.size],lineHeight:aw.lineHeight,fontFamily:t4[e.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},i=createTextSvgElementFromSpans(this.editor,this.editor.textMeasure.measureTextSpans(e.props.text,n),n);i.setAttribute("fill",r[e.props.labelColor].solid);let o=Array.from(i.children);o.forEach(e=>{let t=parseFloat(e.getAttribute("x")||"0"),r=parseFloat(e.getAttribute("y")||"0");e.setAttribute("x",t+4+p.x+"px"),e.setAttribute("y",r+p.y+"px")});let l=i.cloneNode(!0);l.setAttribute("stroke-width","2"),l.setAttribute("fill",r.background),l.setAttribute("stroke",r.background),a.appendChild(l),a.appendChild(i)}return a}getCanvasSvgDefs(){return[getFillDefForCanvas()]}};function getArrowheadSvgMask(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill","arrow"===t?"none":"black"),r.setAttribute("stroke","none"),r}function getArrowSvgPath(e,t,r){let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill","none"),n.setAttribute("stroke",t),n.setAttribute("stroke-width",r+""),n}function getArrowheadSvgPath(e,t,r,n,i){let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),o.setAttribute("fill","none"),o.setAttribute("stroke",i[t].solid),o.setAttribute("stroke-width",r+"");let a=getShapeFillSvg({d:e,fill:n,color:t,theme:i});if(!a)return o;{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(a),e.appendChild(o),e}}function isPrecise(e){return .5!==e.x||.5!==e.y}let aO=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function getRotatedBoxShadow(e){let t=aO.map(t=>{let{offsetX:r,offsetY:n,blur:i,spread:o,color:a}=t,l=new Vec2d_Vec2d(r,n),{x:d,y:c}=l.rot(-e);return`${d}px ${c}px ${i}px ${o}px ${a}`});return t.join(", ")}let aL="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function HyperlinkButton({url:e,zoomLevel:t}){return(0,I.jsx)("a",{className:eb("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:stopEventPropagation,onPointerUp:stopEventPropagation,title:e,draggable:!1,children:(0,I.jsx)("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${aL}") center 100% / 100% no-repeat`,WebkitMask:`url("${aL}") center 100% / 100% no-repeat`}})})}let BookmarkShapeUtil=class BookmarkShapeUtil extends BaseBoxShapeUtil{static type="bookmark";static props=ri;static migrations=ra;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,r=this.editor.getShapePageTransform(e).rotation(),n=getHumanReadableAddress(e);return(0,I.jsx)(HTMLContainer,{children:(0,I.jsxs)("div",{className:"tl-bookmark__container",style:{boxShadow:getRotatedBoxShadow(r)},children:[(0,I.jsxs)("div",{className:"tl-bookmark__image_container",children:[t?.props.image?(0,I.jsx)("img",{className:"tl-bookmark__image",draggable:!1,src:t?.props.image,alt:t?.props.title||""}):(0,I.jsx)("div",{className:"tl-bookmark__placeholder"}),(0,I.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]}),(0,I.jsxs)("div",{className:"tl-bookmark__copy_container",children:[t?.props.title&&(0,I.jsx)("h2",{className:"tl-bookmark__heading",children:truncateStringWithEllipsis(t?.props.title||"",54)}),t?.props.description&&(0,I.jsx)("p",{className:"tl-bookmark__description",children:truncateStringWithEllipsis(t?.props.description||"",128)}),(0,I.jsx)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:stopEventPropagation,onPointerUp:stopEventPropagation,onClick:stopEventPropagation,children:truncateStringWithEllipsis(n,45)})]})]})})}indicator(e){return(0,I.jsx)("rect",{width:toDomPrecision(e.props.w),height:toDomPrecision(e.props.h),rx:"8",ry:"8"})}onBeforeCreate=e=>{updateBookmarkAssetOnUrlChange(this.editor,e)};onBeforeUpdate=(e,t)=>{if(e.props.url!==t.props.url){if(!isValidUrl(t.props.url))return{...t,props:{...t.props,url:e.props.url}};updateBookmarkAssetOnUrlChange(this.editor,t)}}};let getHumanReadableAddress=e=>{try{let t=new URL(e.props.url),r=t.pathname.replace(/\/*$/,"");return`${t.hostname}${r}`}catch(t){return e.props.url}};function updateBookmarkAssetOnUrlChange(e,t){let{url:r}=t.props,n=tK.createId(getHashForString(r));e.getAsset(n)?t.props.assetId!==n&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:n}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),aF(e,t))}let aF=debounce(async(e,t)=>{let{url:r}=t.props,n=await e.getAssetForExternalContent({type:"url",url:r});n&&e.batch(()=>{e.createAssets([n]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:n.id}}])})},500);function getSvgPathFromStrokePoints(e,t=!1){let r=e.length;if(r<2)return"";let n=e[0].point,i=e[1].point;if(2===r)return`M${precise(n)}L${precise(i)}`;let o="";for(let t=2,a=r-1;t<a;t++)o+=average(n=e[t].point,i=e[t+1].point);return t?`M${average(e[0].point,e[1].point)}Q${precise(e[1].point)}${average(e[1].point,e[2].point)}T${o}${average(e[r-1].point,e[0].point)}${average(e[0].point,e[1].point)}Z`:`M${precise(e[0].point)}Q${precise(e[1].point)}${average(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${precise(e[r-1].point)}`}function useForceSolid(){let e=useEditor();return useValue("zoom",()=>e.zoomLevel<.35,[e])}let PEN_EASING=e=>.65*e+.35*ne(e*r8/2),simulatePressureSettings=e=>({size:1+e,thinning:.5,streamline:.62+(1+e)/8*.06,smoothing:.62,easing:r3.easeOutSine,simulatePressure:!0}),realPressureSettings=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:PEN_EASING}),solidSettings=e=>({size:1+e,thinning:0,streamline:.62+(1+e)/8*.06,smoothing:.62,simulatePressure:!1,easing:r3.linear});function getHighlightFreehandSettings({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:r3.easeOutSine,last:t}}function getFreehandOptions(e,t,r,n){return{...n?solidSettings(t):"draw"===e.dash?e.isPen?realPressureSettings(t):simulatePressureSettings(t):solidSettings(t),last:e.isComplete||r}}function getPointsFromSegments(e){let t=[];for(let r of e)if("free"===r.type||r.points.length<2)t.push(...r.points.map(Vec2d_Vec2d.Cast));else{let e=Math.max(4,Math.floor(Vec2d_Vec2d.Dist(r.points[0],r.points[1])/16));t.push(...Vec2d_Vec2d.PointsBetween(r.points[0],r.points[1],e))}return t}function getDrawShapeStrokeDashArray(e,t){return({draw:"none",solid:"none",dotted:`0.1 ${2*t}`,dashed:`${2*t} ${2*t}`})[e.props.dash]}let DrawShapeUtil=class DrawShapeUtil extends ShapeUtil{static type="draw";static props=rl;static migrations=rc;hideResizeHandles=e=>getIsDot(e);hideRotateHandle=e=>getIsDot(e);hideSelectionBoundsFg=e=>getIsDot(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(e){let t=getPointsFromSegments(e.props.segments),r=a_[e.props.size];if(1===e.props.segments.length){let e=Box2d_Box2d.FromPoints(t);if(e.width<2*r&&e.height<2*r)return new Circle2d({x:-r,y:-r,radius:r,isFilled:!0})}let n=getStrokePoints(t,getFreehandOptions(e.props,r,!0,!0)).map(e=>e.point);return e.props.isClosed?new Polygon2d({points:n,isFilled:"none"!==e.props.fill}):new Polyline2d({points:n})}component(e){let t=useDefaultColorTheme(),r=useForceSolid(),n=a_[e.props.size],i=getPointsFromSegments(e.props.segments),o=e.props.isComplete||last(e.props.segments)?.type==="straight",a=n;r||e.props.isPen||"draw"!==e.props.dash||1!==i.length||(a+=rng(e.id)()*(n/6));let l=getFreehandOptions(e.props,a,o,r),d=getStrokePoints(i,l),c=d.length>1?getSvgPathFromStrokePoints(d,e.props.isClosed):getDot(i[0],a);if(!r&&"draw"===e.props.dash||d.length<2){setStrokePointRadii(d,l);let r=getStrokeOutlinePoints_getStrokeOutlinePoints(d,l);return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{theme:t,fill:e.props.isClosed?e.props.fill:"none",color:e.props.color,d:c}),(0,I.jsx)("path",{d:getSvgPathFromPoints_getSvgPathFromPoints(r,!0),strokeLinecap:"round",fill:t[e.props.color].solid})]})}return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{theme:t,color:e.props.color,fill:e.props.isClosed?e.props.fill:"none",d:c}),(0,I.jsx)("path",{d:c,strokeLinecap:"round",fill:"none",stroke:t[e.props.color].solid,strokeWidth:n,strokeDasharray:getDrawShapeStrokeDashArray(e,n),strokeDashoffset:"0"})]})}indicator(e){let t=useForceSolid(),r=a_[e.props.size],n=getPointsFromSegments(e.props.segments),i=r;t||e.props.isPen||"draw"!==e.props.dash||1!==n.length||(i+=rng(e.id)()*(r/6));let o=e.props.isComplete||last(e.props.segments)?.type==="straight",a=getFreehandOptions(e.props,i,o,!0),l=getStrokePoints(n,a),d=l.length>1?getSvgPathFromStrokePoints(l,e.props.isClosed):getDot(n[0],i);return(0,I.jsx)("path",{d:d})}toSvg(e,t){let r;let n=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode});t.addExportDef(getFillDefForExport(e.props.fill,n));let{color:i}=e.props,o=a_[e.props.size],a=getPointsFromSegments(e.props.segments),l=e.props.isComplete||last(e.props.segments)?.type==="straight",d=o;e.props.isPen||"draw"!==e.props.dash||1!==a.length||(d+=rng(e.id)()*(o/6));let c=getFreehandOptions(e.props,d,l,!1),u=getStrokePoints(a,c),p=u.length>1?getSvgPathFromStrokePoints(u,e.props.isClosed):getDot(a[0],d);if("draw"===e.props.dash||u.length<2){setStrokePointRadii(u,c);let e=getStrokeOutlinePoints_getStrokeOutlinePoints(u,c),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",getSvgPathFromPoints_getSvgPathFromPoints(e,!0)),t.setAttribute("fill",n[i].solid),t.setAttribute("stroke-linecap","round"),r=t}else{let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",p),t.setAttribute("stroke",n[i].solid),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-width",o.toString()),t.setAttribute("stroke-dasharray",getDrawShapeStrokeDashArray(e,o)),t.setAttribute("stroke-dashoffset","0"),r=t}let h=getShapeFillSvg({fill:e.props.isClosed?e.props.fill:"none",d:p,color:e.props.color,theme:n});if(h){let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(h),e.appendChild(r),e}return r}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize=(e,t)=>{let{scaleX:r,scaleY:n}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:toFixed(r*e),y:toFixed(n*t),z:i}))});return{props:{segments:i}}};expandSelectionOutlinePx(e){let t="draw"===e.props.dash?1.6:1;return a_[e.props.size]*t/2}};function getDot(e,t){let r=(t+1)*.5;return`M ${e.x} ${e.y} m -${r}, 0 a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 -${2*r},0`}function getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function resizeBox_resizeBox(e,t,r={}){let{newPoint:n,handle:i,scaleX:o,scaleY:a}=t,{minWidth:l=1,maxWidth:d=1/0,minHeight:c=1,maxHeight:u=1/0}=r,p=e.props.w*o,h=e.props.h*a,f=new Vec2d_Vec2d(0,0);if(p>0){if(p<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=p-l;break;case"top":case"bottom":f.x=(p-l)/2;break;default:f.x=0}p=l}}else if(f.x=p,(p=-p)<l){switch(i){case"top_left":case"left":case"bottom_left":f.x=-p;break;default:f.x=-l}p=l}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":f.y=h-c;break;case"right":case"left":f.y=(h-c)/2;break;default:f.y=0}h=c}}else if(f.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":f.y=-h;break;default:f.y=-c}h=c}let{x:g,y:m}=f.rot(e.rotation).add(n);return{x:g,y:m,props:{w:Math.min(d,p),h:Math.min(u,h)}}}let getSandboxPermissions=e=>Object.entries(e).filter(([e,t])=>t).map(([e])=>e).join(" ");let EmbedShapeUtil=class EmbedShapeUtil extends BaseBoxShapeUtil{static type="embed";static props=rf;static migrations=rm;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canUnmount=e=>!!getEmbedInfo(e.props.url)?.definition?.canUnmount;canResize=e=>!!getEmbedInfo(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>{let t=getEmbedInfo(e.props.url);return t?.definition.isAspectRatioLocked??!1};onResize=(e,t)=>{let r=this.isAspectRatioLocked(e),n=getEmbedInfo(e.props.url),i=n?.definition.minWidth??200,o=n?.definition.minHeight??200;if(r){let t=e.props.w/e.props.h;t>1?i*=t:o/=t}return resizeBox_resizeBox(e,t,{minWidth:i,minHeight:o})};component(e){let{w:t,h:r,url:n}=e.props,i=useIsEditing(e.id),o=(0,T.useMemo)(()=>getEmbedInfoUnsafely(n),[n]),a=useValue("is hovering",()=>{let{editingShapeId:e,hoveredShapeId:t}=this.editor.currentPageState;if(e&&t!==e){let t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1},[]),l=this.editor.getShapePageTransform(e).rotation(),d=i||a;if(o?.definition.type==="github_gist"){let n=o.url.split("/").pop();if(!n)throw Error("No gist id!");return(0,I.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:(0,I.jsx)(Gist,{id:n,width:toDomPrecision(t),height:toDomPrecision(r),isInteractive:d,pageRotation:l})})}let c=getSandboxPermissions({...rh,...o?.definition.overridePermissions??{}});return(0,I.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:o?.definition?(0,I.jsx)("iframe",{className:"tl-embed",sandbox:c,src:o.embedUrl,width:toDomPrecision(t),height:toDomPrecision(r),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:getRotatedBoxShadow(l),borderRadius:o?.definition.overrideOutlineRadius??8,background:o?.definition.backgroundColor}}):null})}indicator(e){let t=(0,T.useMemo)(()=>getEmbedInfo(e.props.url),[e.props.url]);return(0,I.jsx)("rect",{width:toDomPrecision(e.props.w),height:toDomPrecision(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8})}};function Gist({id:e,file:t,isInteractive:r,width:n,height:i,style:o,pageRotation:a}){return(0,I.jsx)("iframe",{className:"tl-embed",draggable:!1,width:toDomPrecision(n),height:toDomPrecision(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:r?"all":"none",zIndex:r?"":"-1",boxShadow:getRotatedBoxShadow(a)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${e}.js${t?`?file=${t}`:""}></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}let aN=(0,T.forwardRef)(({id:e,name:t,isEditing:r},n)=>{let i=useEditor(),o=(0,T.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(stopEventPropagation(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),a=(0,T.useCallback)(t=>{let r=i.getShape(e);if(!r)return;let n=r.props.name,o=t.currentTarget.value.trim();n!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]),l=(0,T.useCallback)(t=>{let r=i.getShape(e);if(!r)return;let n=r.props.name,o=t.currentTarget.value;n!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]);return(0,I.jsxs)("div",{className:`tl-frame-label ${r?"tl-frame-label__editing":""}`,children:[(0,I.jsx)("input",{className:"tl-frame-name-input",ref:n,style:{display:r?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:a,onChange:l}),defaultEmptyAs(t,"Frame")+String.fromCharCode(8203)]})}),FrameHeading=function({id:e,name:t,width:r,height:n}){let i;let o=useEditor(),a=canonicalizeRotation(o.getShapePageTransform(e).rotation()),l=useIsEditing(e),d=(0,T.useRef)(null),c=(0,T.useCallback)(t=>{let r=getPointerInfo(t);o.editingShapeId!==e&&(o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...r}),t.preventDefault())},[o,e]);(0,T.useEffect)(()=>{let e=d.current;e&&l&&(e.focus(),e.select(),requestAnimationFrame(()=>{document.activeElement!==e&&(e.focus(),e.select())}))},[d,l]);let u=["top","left","bottom","right"][Math.floor(((a+Math.PI/4)*(2/Math.PI)+4)%4)];switch(u){case"top":i="";break;case"right":i=`translate(${toDomPrecision(r)}px, 0px) rotate(90deg)`;break;case"bottom":i=`translate(${toDomPrecision(r)}px, ${toDomPrecision(n)}px) rotate(180deg)`;break;case"left":i=`translate(0px, ${toDomPrecision(n)}px) rotate(270deg)`}return(0,I.jsx)("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${"top"===u||"bottom"===u?Math.ceil(r):Math.ceil(n)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:c,children:(0,I.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,I.jsx)(aN,{ref:d,id:e,name:t,isEditing:l})})})};function defaultEmptyAs(e,t){return e.match(/^\s*$/)?t:e}let FrameShapeUtil=class FrameShapeUtil extends BaseBoxShapeUtil{static type="frame";static props=ry;static migrations=rb;canBind=()=>!0;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new Rectangle2d({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){let t=this.editor.getShapeGeometry(e).bounds,r=useDefaultColorTheme();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(SVGContainer,{children:(0,I.jsx)("rect",{className:"tl-frame__body",width:t.width,height:t.height,fill:r.solid,stroke:r.text})}),(0,I.jsx)(FrameHeading,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e){let t;let r=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode}),n=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),i.setAttribute("fill",r.solid),i.setAttribute("stroke",r.black.solid),i.setAttribute("stroke-width","1"),i.setAttribute("rx","1"),i.setAttribute("ry","1"),n.appendChild(i);let o=canonicalizeRotation(this.editor.getShapePageTransform(e.id).rotation()),a=["top","left","bottom","right"][Math.floor(((o+Math.PI/4)*(2/Math.PI)+4)%4)];switch(a){case"top":default:t="";break;case"right":t=`translate(${toDomPrecision(e.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":t=`translate(${toDomPrecision(e.props.w)}px, ${toDomPrecision(e.props.h)}px) rotate(180deg)`;break;case"left":t=`translate(0px, ${toDomPrecision(e.props.h)}px) rotate(270deg)`}let l={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},d=this.editor.textMeasure.measureTextSpans(defaultEmptyAs(e.props.name,"Frame")+String.fromCharCode(8203),l),c=d[0],u=last(d),p=u.box.w+u.box.x-c.box.x,h=createTextSvgElementFromSpans(this.editor,d,{offsetY:-l.height-2,...l});h.style.setProperty("transform",t);let f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-l.height-4+"px"),f.setAttribute("width",p+16+"px"),f.setAttribute("height",`${l.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),n.appendChild(f),n.appendChild(h),n}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,I.jsx)("rect",{width:toDomPrecision(t.width),height:toDomPrecision(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,t)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,t)=>!e.isLocked;onDragShapesOver=(e,t)=>t.every(t=>t.parentId===e.id)?{shouldHint:!1}:(this.editor.reparentShapes(t.map(e=>e.id),e.id),{shouldHint:!0});onDragShapesOut=(e,t)=>{let r=this.editor.getShape(e.parentId),n=r&&this.editor.isShapeOfType(r,"group");n?this.editor.reparentShapes(t,r.id):this.editor.reparentShapes(t,this.editor.currentPageId)};onResizeEnd=e=>{let t=this.editor.getShapePageBounds(e),r=this.editor.getSortedChildIdsForParent(e.id),n=[];for(let e of r){let r=this.editor.getShapePageBounds(e);t.includes(r)||n.push(e)}n.length>0&&this.editor.reparentShapes(n,this.editor.currentPageId)}};function getLegacyOffsetX(e,t,r,n){if(("start-legacy"===e||"end-legacy"===e)&&0!==r.length){let i=Box2d_Box2d.From(r[0].box);for(let{box:e}of r)i.union(e);if("start-legacy"===e)return(n-2*t-i.width)/2;if("end-legacy"===e)return-(n-2*t-i.width)/2}}function isLegacyAlign(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}let az=T.memo(function({id:e,type:t,text:r,size:n,labelColor:i,font:o,align:a,verticalAlign:l,wrap:d,bounds:c}){let{rInput:u,isEmpty:p,isEditing:h,handleFocus:f,handleChange:g,handleKeyDown:m,handleBlur:y,handleInputPointerDown:b,handleDoubleClick:v}=useEditableText(e,t,r),S=TextHelpers.normalizeTextForDom(r),x=S.length>0,w=isLegacyAlign(a),_=useDefaultColorTheme();return h||x?(0,I.jsx)("div",{className:"tl-text-label","data-font":o,"data-align":a,"data-hastext":!p,"data-isediting":h,"data-textwrap":!!d,style:{justifyContent:"middle"===a||w?"center":a,alignItems:"middle"===l?"center":l,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:(0,I.jsxs)("div",{className:"tl-text-label__inner",style:{fontSize:aE[n],lineHeight:aE[n]*aw.lineHeight+"px",minHeight:aw.lineHeight+32,minWidth:0,color:_[i].solid},children:[(0,I.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:S}),h&&(0,I.jsx)("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:r,onFocus:f,onChange:g,onKeyDown:m,onBlur:y,onContextMenu:stopEventPropagation,onPointerDown:b,onDoubleClick:v})]})}):null});function getTextLabelSvgElement({bounds:e,editor:t,font:r,shape:n}){let i={fontSize:aE[n.props.size],fontFamily:r,textAlign:n.props.align,verticalTextAlign:n.props.verticalAlign,width:Math.ceil(e.width),height:Math.ceil(e.height),padding:16,lineHeight:aw.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=t.textMeasure.measureTextSpans(n.props.text,i),a=getLegacyOffsetX(n.props.align,16,o,e.width);a&&(i.offsetX=a);let l=createTextSvgElementFromSpans(t,o,i);return l}function polygon_helpers_precise(e){return`${toDomPrecision(e.x)},${toDomPrecision(e.y)} `}function polygon_helpers_rng(e=""){let t=0,r=0,n=0,i=0;function next(){let e=t^t<<11;return t=r,r=n,n=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let r=0;r<e.length+64;r++)t^=0|e.charCodeAt(r),next();return next}function getRoundedInkyPolygonPath(e){let t,r,n,i="M",o=e.length;for(let a=0;a<o;a+=3)t=e[a],r=e[a+1],n=e[a+2],i+=`${polygon_helpers_precise(t)}L${polygon_helpers_precise(r)}Q${polygon_helpers_precise(n)}`;return i+`${polygon_helpers_precise(e[0])}`}function getRoundedPolygonPoints(e,t,r,n,i){let o;let a=[],l=polygon_helpers_rng(e),d=t[0],c=t.length;for(let e=0,u=c*i;e<u;e++){o=Vec2d_Vec2d.AddXY(t[(e+1)%c],l()*r,l()*r);let i=Vec2d_Vec2d.Sub(o,d),u=Vec2d_Vec2d.Len(i),p=Vec2d_Vec2d.Div(i,u).mul(Math.min(u/4,n));a.push(Vec2d_Vec2d.Add(d,p),Vec2d_Vec2d.Add(o,p.neg()),o),d=o}return a}function getDrawLinePathData(e,t,r){let n,i,o=`M ${polygon_helpers_precise(t[0])}L`,a=`M ${polygon_helpers_precise(t[0])}L`,l=r/3,d=2*r,c=polygon_helpers_rng(e),u=t[0],p=t[0],h=t.length;for(let e=0,r=h-1;e<r;e++){n=t[e+1],i=Vec2d_Vec2d.AddXY(t[e+1],c()*l,c()*l);let h=Vec2d_Vec2d.Sub(n,u),f=Vec2d_Vec2d.Len(h),g=Vec2d_Vec2d.Div(h,f).mul(Math.min(f/4,d)),m=Vec2d_Vec2d.Add(u,g),y=Vec2d_Vec2d.Add(n,g.neg()),b=Vec2d_Vec2d.Sub(i,p),v=Vec2d_Vec2d.Len(b),S=Vec2d_Vec2d.Div(b,v).mul(Math.min(v/4,d)),x=Vec2d_Vec2d.Add(p,S),w=Vec2d_Vec2d.Add(i,S.neg());e===r-1?(o+=`${polygon_helpers_precise(m)}L ${polygon_helpers_precise(n)}`,a+=`${polygon_helpers_precise(x)}L ${polygon_helpers_precise(i)}`):(o+=`${polygon_helpers_precise(m)}L ${polygon_helpers_precise(y)}Q ${polygon_helpers_precise(n)}`,a+=`${polygon_helpers_precise(x)}L ${polygon_helpers_precise(w)}Q ${polygon_helpers_precise(i)}`,u=n,p=i)}return[o,o+a]}function getPillCircumference(e,t){let r=Math.min(e,t)/2;return Math.PI*(2*r)+2*(Math.max(e,t)-2*r)}function getPillPoints(e,t,r){let n=Math.min(e,t)/2,i=Math.max(e,t)-2*n,o=Math.PI*(2*n)+2*i,a=o/r,l=e>t?[{type:"straight",start:new Vec2d_Vec2d(n,0),delta:new Vec2d_Vec2d(1,0)},{type:"arc",center:new Vec2d_Vec2d(e-n,n),startAngle:-r8/2},{type:"straight",start:new Vec2d_Vec2d(e-n,t),delta:new Vec2d_Vec2d(-1,0)},{type:"arc",center:new Vec2d_Vec2d(n,n),startAngle:r8/2}]:[{type:"straight",start:new Vec2d_Vec2d(e,n),delta:new Vec2d_Vec2d(0,1)},{type:"arc",center:new Vec2d_Vec2d(n,t-n),startAngle:0},{type:"straight",start:new Vec2d_Vec2d(0,t-n),delta:new Vec2d_Vec2d(0,-1)},{type:"arc",center:new Vec2d_Vec2d(n,n),startAngle:r8}],d=0,c=[];for(let e=0;e<r;e++){let e=l[0];"straight"===e.type?c.push(Vec2d_Vec2d.Add(e.start,Vec2d_Vec2d.Mul(e.delta,d))):c.push(getPointOnCircle(e.center.x,e.center.y,n,e.startAngle+d/n)),d+=a;let t="straight"===e.type?i:r8*n;for(;d>t;)d-=t,l.push(l.shift()),t="straight"===l[0].type?i:r8*n}return c}let switchSize=(e,t,r,n,i)=>{switch(e){case"s":return t;case"m":return r;case"l":return n;case"xl":return i}};function getCloudArcs(e,t,r,n){let i=rng(r),o=getPillCircumference(e,t),a=Math.max(Math.ceil(o/switchSize(n,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),l=o/a*.2,d=Math.max(e-2*l,1),c=Math.max(t-2*l,1),u=(e-d)/2,p=(t-c)/2,h=getPillCircumference(d,c)/a,f=getPillPoints(d,c,a).map(e=>e.addXY(u,p)),g=e<20?0:.3*l,m=t<20?0:.3*l,y=f.slice(0);for(let e=0;e<Math.floor(a/2);e++)y[e]=Vec2d_Vec2d.AddXY(y[e],i()*g,i()*m),y[a-e-1]=Vec2d_Vec2d.AddXY(y[a-e-1],i()*g,i()*m);let b=[];for(let r=0;r<y.length;r++){let n=r===y.length-1?0:r+1,i=y[r],o=y[n],a=f[r],l=f[n],d=Vec2d_Vec2d.Average([a,l]),c=Vec2d_Vec2d.Angle(a,l)-Math.PI/2,g=Vec2d_Vec2d.Dist(a,l),m=h-g,v=Vec2d_Vec2d.Dist(i,o),S=v/g,x=(Math.max(u,p)+m)*S,w=Vec2d_Vec2d.Add(d,Vec2d_Vec2d.FromAngle(c,x));w.x<0?w.x=0:w.x>e&&(w.x=e),w.y<0?w.y=0:w.y>t&&(w.y=t);let _=getCenterOfCircleGivenThreePoints(i,o,w),P=Vec2d_Vec2d.Dist(_||Vec2d_Vec2d.Average([i,o]),i);b.push({leftPoint:i,rightPoint:o,arcPoint:w,center:_,radius:P})}return b}function getCenterOfCircleGivenThreePoints(e,t,r){let n=e.x*(t.y-r.y)-e.y*(t.x-r.x)+t.x*r.y-r.x*t.y,i=(e.x*e.x+e.y*e.y)*(r.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-r.y)+(r.x*r.x+r.y*r.y)*(t.y-e.y),o=(e.x*e.x+e.y*e.y)*(t.x-r.x)+(t.x*t.x+t.y*t.y)*(r.x-e.x)+(r.x*r.x+r.y*r.y)*(e.x-t.x),a=-i/(2*n),l=-o/(2*n);return Number.isFinite(a)&&Number.isFinite(l)?new Vec2d_Vec2d(a,l):null}function cloudOutline(e,t,r,n){let i=[],o=getCloudArcs(e,t,r,n);for(let{center:e,radius:t,leftPoint:r,rightPoint:n}of o)i.push(...pointsOnArc(r,n,e,t,10));return i}function cloudSvgPath(e,t,r,n){let i=getCloudArcs(e,t,r,n),o=`M${toDomPrecision(i[0].leftPoint.x)},${toDomPrecision(i[0].leftPoint.y)}`;for(let{leftPoint:e,rightPoint:t,radius:r,center:n}of i){if(null===n){o+=` L${toDomPrecision(t.x)},${toDomPrecision(t.y)}`;continue}let i=isLeft(e,t,n)?"0":"1";o+=` A${toDomPrecision(r)},${toDomPrecision(r)} 0 ${i},1 ${toDomPrecision(t.x)},${toDomPrecision(t.y)}`}return o+" Z"}function inkyCloudSvgPath(e,t,r,n){let i=rng(r),o="s"===n?.5:"m"===n?.7:"l"===n?.9:1.6,mut=e=>e+i()*o*2,a=getCloudArcs(e,t,r,n),l=a.reduce((e,t)=>e+Vec2d_Vec2d.Dist(t.leftPoint,t.rightPoint),0)/a.length,d=l>15*o?e=>new Vec2d_Vec2d(mut(e.x),mut(e.y)):e=>e,c=`M${toDomPrecision(a[0].leftPoint.x)},${toDomPrecision(a[0].leftPoint.y)}`,u=d(a[0].leftPoint),p=`M${toDomPrecision(u.x)},${toDomPrecision(u.y)}`;for(let{leftPoint:e,center:t,rightPoint:r,radius:n,arcPoint:i}of a){if(null===t){c+=` L${toDomPrecision(r.x)},${toDomPrecision(r.y)}`;let e=d(r);p+=` L${toDomPrecision(e.x)},${toDomPrecision(e.y)}`,u=e;continue}let o=isLeft(e,r,t)?"0":"1";c+=` A${toDomPrecision(n)},${toDomPrecision(n)} 0 ${o},1 ${toDomPrecision(r.x)},${toDomPrecision(r.y)}`;let a=d(r),l=d(i),h=getCenterOfCircleGivenThreePoints(u,a,l);if(!h){p+=` L${toDomPrecision(a.x)},${toDomPrecision(a.y)}`,u=a;continue}let f=Math.abs(Vec2d_Vec2d.Dist(h,u));p+=` A${toDomPrecision(f)},${toDomPrecision(f)} 0 ${o},1 ${toDomPrecision(a.x)},${toDomPrecision(a.y)}`,u=a}return c+p+" Z"}function pointsOnArc(e,t,r,n,i){if(null===r)return[Vec2d_Vec2d.From(e),Vec2d_Vec2d.From(t)];let o=[],a=Vec2d_Vec2d.Angle(r,e),l=Vec2d_Vec2d.Angle(r,t),d=clockwiseAngleDist(a,l);for(let e=0;e<i;e++){let t=e/(i-1),l=a+d*t,c=getPointOnCircle(r.x,r.y,n,l);o.push(c)}return o}function isLeft(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)>0}let aB=T.memo(function({dash:e,fill:t,color:r,strokeWidth:n,w:i,h:o,id:a,size:l}){let d=useDefaultColorTheme(),c=cloudSvgPath(i,o,a,l),u=getCloudArcs(i,o,a,l);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:d,d:c,fill:t,color:r}),(0,I.jsx)("g",{strokeWidth:n,stroke:d[r].solid,fill:"none",pointerEvents:"all",children:u.map(({leftPoint:t,rightPoint:r,center:i,radius:o},a)=>{let l=i?o*canonicalizeRotation(canonicalizeRotation(Vec2d_Vec2d.Angle(i,r))-canonicalizeRotation(Vec2d_Vec2d.Angle(i,t))):Vec2d_Vec2d.Dist(t,r),{strokeDasharray:d,strokeDashoffset:c}=getPerfectDashProps_getPerfectDashProps(l,n,{style:e,start:"outset",end:"outset"});return(0,I.jsx)("path",{d:i?`M${t.x},${t.y}A${o},${o},0,0,1,${r.x},${r.y}`:`M${t.x},${t.y}L${r.x},${r.y}`,strokeDasharray:d,strokeDashoffset:c},a)})})]})});function DashStyleCloudSvg({dash:e,fill:t,color:r,theme:n,strokeWidth:i,w:o,h:a,id:l,size:d}){let c=cloudSvgPath(o,a,l,d),u=getCloudArcs(o,a,l,d),p=document.createElementNS("http://www.w3.org/2000/svg","g");for(let{leftPoint:t,rightPoint:o,center:a,radius:l}of(p.setAttribute("stroke-width",i.toString()),p.setAttribute("stroke",n[r].solid),p.setAttribute("fill","none"),u)){let r=a?l*canonicalizeRotation(canonicalizeRotation(Vec2d_Vec2d.Angle(a,o))-canonicalizeRotation(Vec2d_Vec2d.Angle(a,t))):Vec2d_Vec2d.Dist(t,o),{strokeDasharray:n,strokeDashoffset:d}=getPerfectDashProps_getPerfectDashProps(r,i,{style:e,start:"outset",end:"outset"}),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",a?`M${t.x},${t.y}A${l},${l},0,0,1,${o.x},${o.y}`:`M${t.x},${t.y}L${o.x},${o.y}`),c.setAttribute("stroke-dasharray",n.toString()),c.setAttribute("stroke-dashoffset",d.toString()),p.appendChild(c)}let h=getShapeFillSvg({d:c,fill:t,color:r,theme:n});return getSvgWithShapeFill(p,h)}let aU=T.memo(function({w:e,h:t,strokeWidth:r,dash:n,color:i,fill:o}){let a=useDefaultColorTheme(),l=e/2,d=t/2,c=Math.max(0,l),u=Math.max(0,d),p=perimeterOfEllipse(c,u),{strokeDasharray:h,strokeDashoffset:f}=getPerfectDashProps_getPerfectDashProps(p<64?2*p:p,r,{style:n,snap:4,closed:!0}),g=`M${l-c},${d}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:a,d:g,color:i,fill:o}),(0,I.jsx)("path",{d:g,strokeWidth:r,width:toDomPrecision(e),height:toDomPrecision(t),fill:"none",stroke:a[i].solid,strokeDasharray:h,strokeDashoffset:f,pointerEvents:"all"})]})});function DashStyleEllipseSvg({w:e,h:t,strokeWidth:r,dash:n,color:i,theme:o,fill:a}){let l=e/2,d=t/2,c=Math.max(0,l-r/2),u=Math.max(0,d-r/2),p=perimeterOfEllipse(c,u),{strokeDasharray:h,strokeDashoffset:f}=getPerfectDashProps_getPerfectDashProps(p<64?2*p:p,r,{style:n,snap:4,closed:!0}),g=`M${l-c},${d}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`,m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",g),m.setAttribute("stroke-width",r.toString()),m.setAttribute("width",e.toString()),m.setAttribute("height",t.toString()),m.setAttribute("fill","none"),m.setAttribute("stroke",o[i].solid),m.setAttribute("stroke-dasharray",h),m.setAttribute("stroke-dashoffset",f);let y=getShapeFillSvg({d:g,fill:a,color:i,theme:o});return getSvgWithShapeFill(m,y)}function getOvalSolidPath(e,t){if(t>e){let r=e/2;return`
    M0,${r}
    a${r},${r},0,1,1,${2*r},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${2*r},0
    Z`}let r=t/2;return`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${2*r}
    L${r},${t}
    a${r},${r},0,1,1,0,${-(2*r)}
    Z`}function getOvalPerimeter(e,t){if(e>t){let r=t/2;return perimeterOfEllipse(r,r)+(e-2*r)*2}let r=e/2;return perimeterOfEllipse(r,r)+(t-2*r)*2}let aH=T.memo(function({w:e,h:t,strokeWidth:r,dash:n,color:i,fill:o}){let a=useDefaultColorTheme(),l=getOvalSolidPath(e,t),d=getOvalPerimeter(e,t),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps_getPerfectDashProps(d<64?2*d:d,r,{style:n,snap:4,start:"outset",end:"outset",closed:!0});return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:a,d:l,color:i,fill:o}),(0,I.jsx)("path",{d:l,strokeWidth:r,width:toDomPrecision(e),height:toDomPrecision(t),fill:"none",stroke:a[i].solid,strokeDasharray:c,strokeDashoffset:u,pointerEvents:"all"})]})});function DashStyleOvalSvg({w:e,h:t,strokeWidth:r,dash:n,color:i,theme:o,fill:a}){let l=getOvalSolidPath(e,t),d=getOvalPerimeter(e,t),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps_getPerfectDashProps(d<64?2*d:d,r,{style:n,snap:4,closed:!0}),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",l),p.setAttribute("stroke-width",r.toString()),p.setAttribute("width",e.toString()),p.setAttribute("height",t.toString()),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid),p.setAttribute("stroke-dasharray",c),p.setAttribute("stroke-dashoffset",u);let h=getShapeFillSvg({d:l,fill:a,color:i,theme:o});return getSvgWithShapeFill(p,h)}let aG=T.memo(function({dash:e,fill:t,color:r,strokeWidth:n,outline:i,lines:o}){let a=useDefaultColorTheme(),l="M"+i[0]+"L"+i.slice(1)+"Z";return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:a,d:l,fill:t,color:r}),(0,I.jsxs)("g",{strokeWidth:n,stroke:a[r].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((t,r)=>{let o=i[r],a=i[(r+1)%i.length],l=Vec2d_Vec2d.Dist(o,a),{strokeDasharray:d,strokeDashoffset:c}=getPerfectDashProps_getPerfectDashProps(l,n,{style:e,start:"outset",end:"outset"});return(0,I.jsx)("line",{x1:o.x,y1:o.y,x2:a.x,y2:a.y,strokeDasharray:d,strokeDashoffset:c},r)}),o&&o.map(([t,i],o)=>{let l=Vec2d_Vec2d.Dist(t,i),{strokeDasharray:d,strokeDashoffset:c}=getPerfectDashProps_getPerfectDashProps(l,n,{style:e,start:"skip",end:"outset",snap:"dotted"===e?4:void 0});return(0,I.jsx)("path",{d:`M${t.x},${t.y}L${i.x},${i.y}`,stroke:a[r].solid,strokeWidth:n,fill:"none",strokeDasharray:d,strokeDashoffset:c},`line_fg_${o}`)})]})]})});function DashStylePolygonSvg({dash:e,fill:t,color:r,theme:n,strokeWidth:i,outline:o,lines:a}){let l=document.createElementNS("http://www.w3.org/2000/svg","g");if(l.setAttribute("stroke-width",i.toString()),l.setAttribute("stroke",n[r].solid),l.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((t,r)=>{let n=o[r],a=o[(r+1)%o.length],d=Vec2d_Vec2d.Dist(n,a),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps_getPerfectDashProps(d,i,{style:e}),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",n.x.toString()),p.setAttribute("y1",n.y.toString()),p.setAttribute("x2",a.x.toString()),p.setAttribute("y2",a.y.toString()),p.setAttribute("stroke-dasharray",c.toString()),p.setAttribute("stroke-dashoffset",u.toString()),l.appendChild(p)}),a)for(let[t,r]of a){let n=Vec2d_Vec2d.Dist(t,r),{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps_getPerfectDashProps(n,i,{style:e,start:"skip",end:"skip",snap:"dotted"===e?4:2}),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("x1",t.x.toString()),d.setAttribute("y1",t.y.toString()),d.setAttribute("x2",r.x.toString()),d.setAttribute("y2",r.y.toString()),d.setAttribute("stroke-dasharray",o.toString()),d.setAttribute("stroke-dashoffset",a.toString()),l.appendChild(d)}let d=getShapeFillSvg({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:t,color:r,theme:n});return getSvgWithShapeFill(l,d)}let aW=T.memo(function({fill:e,color:t,strokeWidth:r,w:n,h:i,id:o,size:a}){let l=useDefaultColorTheme(),d=inkyCloudSvgPath(n,i,o,a);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:l,d:d,fill:e,color:t}),(0,I.jsx)("path",{d:d,stroke:l[t].solid,strokeWidth:r,fill:"none"})]})});function DrawStyleCloudSvg({fill:e,color:t,strokeWidth:r,theme:n,w:i,h:o,id:a,size:l}){let d=inkyCloudSvgPath(i,o,a,l),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",d),c.setAttribute("stroke-width",r.toString()),c.setAttribute("stroke",n[t].solid),c.setAttribute("fill","none");let u=getShapeFillSvg({d:d,fill:e,color:t,theme:n});return getSvgWithShapeFill(c,u)}function DrawStyleEllipseSvg({id:e,w:t,h:r,strokeWidth:n,fill:i,color:o,theme:a}){let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",getEllipsePath(e,t,r,n)),l.setAttribute("fill",a[o].solid);let d=getShapeFillSvg({d:getSvgPathFromStrokePoints(getEllipseStrokePoints(e,t,r,n)),fill:i,color:o,theme:a});return getSvgWithShapeFill(l,d)}function getEllipseStrokeOptions(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function getEllipseStrokePoints(e,t,r,n){let i=rng(e),o=t/2,a=r/2,l=perimeterOfEllipse(o,a),d=[],c=r9*i(),u=r9+r6/2+Math.abs(i())*r6,p=Math.max(16,l/10);for(let e=0;e<p;e++){let n=e/(p-1),l=c+n*u,h=Math.cos(l),f=Math.sin(l);d.push(new Vec2d_Vec2d(o*h+.5*t+.05*i(),a*f+r/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?r3.easeInOutSine(n):r3.easeInExpo(n)))/2)))}return getStrokePoints(d,getEllipseStrokeOptions(n))}function getEllipsePath(e,t,r,n){let i=getEllipseStrokeOptions(n);return getSvgPathFromPoints_getSvgPathFromPoints(getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getEllipseStrokePoints(e,t,r,n),i),i))}T.memo(function({id:e,w:t,h:r,strokeWidth:n,fill:i,color:o}){let a=useDefaultColorTheme(),l=getSvgPathFromStrokePoints(getEllipseStrokePoints(e,t,r,n)),d=getEllipsePath(e,t,r,n);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:a,d:l,color:o,fill:i}),(0,I.jsx)("path",{d:d,fill:a[o].solid,strokeWidth:0,pointerEvents:"all"})]})});let aK=T.memo(function({id:e,outline:t,lines:r,fill:n,color:i,strokeWidth:o}){let a=useDefaultColorTheme(),l=getRoundedPolygonPoints(e,t,o/3,2*o,2),d=getRoundedInkyPolygonPath(l);if(r)for(let[e,t]of r)d+=`M${e.x},${e.y}L${t.x},${t.y}`;let c=getRoundedPolygonPoints(e,t,0,2*o,1),u=getRoundedInkyPolygonPath(c);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{d:u,fill:n,color:i,theme:a}),(0,I.jsx)("path",{d:d,stroke:a[i].solid,strokeWidth:o,fill:"none"})]})});function DrawStylePolygonSvg({id:e,outline:t,lines:r,fill:n,color:i,theme:o,strokeWidth:a}){let l=getRoundedPolygonPoints(e,t,a/3,2*a,2),d=getRoundedInkyPolygonPath(l);if(r)for(let[e,t]of r)d+=`M${e.x},${e.y}L${t.x},${t.y}`;let c=getRoundedPolygonPoints(e,t,0,2*a,1),u=getRoundedInkyPolygonPath(c),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",d),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid),p.setAttribute("stroke-width",a.toString());let h=getShapeFillSvg({d:u,fill:n,color:i,theme:o});return getSvgWithShapeFill(p,h)}let aq=T.memo(function({fill:e,color:t,strokeWidth:r,w:n,h:i,id:o,size:a}){let l=useDefaultColorTheme(),d=cloudSvgPath(n,i,o,a);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{theme:l,d:d,fill:e,color:t}),(0,I.jsx)("path",{d:d,stroke:l[t].solid,strokeWidth:r,fill:"none"})]})});function SolidStyleCloudSvg({fill:e,color:t,strokeWidth:r,theme:n,w:i,h:o,id:a,size:l}){let d=cloudSvgPath(i,o,a,l),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",d),c.setAttribute("stroke-width",r.toString()),c.setAttribute("stroke",n[t].solid),c.setAttribute("fill","none");let u=getShapeFillSvg({d:d,fill:e,color:t,theme:n});return getSvgWithShapeFill(c,u)}let aY=T.memo(function({w:e,h:t,strokeWidth:r,fill:n,color:i}){let o=useDefaultColorTheme(),a=e/2,l=t/2,d=Math.max(0,a),c=Math.max(0,l),u=`M${a-d},${l}a${d},${c},0,1,1,${2*d},0a${d},${c},0,1,1,-${2*d},0`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{d:u,color:i,fill:n,theme:o}),(0,I.jsx)("path",{d:u,stroke:o[i].solid,strokeWidth:r,fill:"none"})]})});function SolidStyleEllipseSvg({w:e,h:t,strokeWidth:r,fill:n,color:i,theme:o}){let a=e/2,l=t/2,d=Math.max(0,a),c=Math.max(0,l),u=`M${a-d},${l}a${d},${c},0,1,1,${2*d},0a${d},${c},0,1,1,-${2*d},0`,p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",u),p.setAttribute("stroke-width",r.toString()),p.setAttribute("width",e.toString()),p.setAttribute("height",t.toString()),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid);let h=getShapeFillSvg({d:u,fill:n,color:i,theme:o});return getSvgWithShapeFill(p,h)}let aX=T.memo(function({w:e,h:t,strokeWidth:r,fill:n,color:i}){let o=useDefaultColorTheme(),a=getOvalIndicatorPath(e,t);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{d:a,color:i,fill:n,theme:o}),(0,I.jsx)("path",{d:a,stroke:o[i].solid,strokeWidth:r,fill:"none"})]})});function SolidStyleOvalSvg({w:e,h:t,strokeWidth:r,fill:n,color:i,theme:o}){let a=getOvalIndicatorPath(e,t),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",a),l.setAttribute("stroke-width",r.toString()),l.setAttribute("width",e.toString()),l.setAttribute("height",t.toString()),l.setAttribute("fill","none"),l.setAttribute("stroke",o[i].solid);let d=getShapeFillSvg({d:a,fill:n,color:i,theme:o});return getSvgWithShapeFill(l,d)}function getOvalIndicatorPath(e,t){let r;if(t>e){let n=e/2;r=`
    M0,${n}
    a${n},${n},0,1,1,${2*n},0
    L${e},${t-n}
    a${n},${n},0,1,1,-${2*n},0
    Z`}else{let n=t/2;r=`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${2*n}
    L${n},${t}
    a${n},${n},0,1,1,0,${-(2*n)}
    Z`}return r}let aZ=T.memo(function({outline:e,lines:t,fill:r,color:n,strokeWidth:i}){let o=useDefaultColorTheme(),a="M"+e[0]+"L"+e.slice(1)+"Z";if(t)for(let[e,r]of t)a+=`M${e.x},${e.y}L${r.x},${r.y}`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(aV,{d:a,fill:r,color:n,theme:o}),(0,I.jsx)("path",{d:a,stroke:o[n].solid,strokeWidth:i,fill:"none"})]})});function SolidStylePolygonSvg({outline:e,lines:t,fill:r,color:n,strokeWidth:i,theme:o}){let a="M"+e[0]+"L"+e.slice(1)+"Z",l=a;if(t)for(let[e,r]of t)l+=`M${e.x},${e.y}L${r.x},${r.y}`;let d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("stroke-width",i.toString()),d.setAttribute("stroke",o[n].solid),d.setAttribute("fill","none");let c=getShapeFillSvg({d:a,fill:r,color:n,theme:o});return getSvgWithShapeFill(d,c)}let GeoShapeUtil=class GeoShapeUtil extends BaseBoxShapeUtil{static type="geo";static props=rw;static migrations=rP;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(e){let t;let r=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),i=r/2,o=n/2,a=a_[e.props.size],l="none"!==e.props.fill;switch(e.props.geo){case"cloud":t=new Polygon2d({points:cloudOutline(r,n,e.id,e.props.size),isFilled:l});break;case"triangle":t=new Polygon2d({points:[new Vec2d_Vec2d(i,0),new Vec2d_Vec2d(r,n),new Vec2d_Vec2d(0,n)],isFilled:l});break;case"diamond":t=new Polygon2d({points:[new Vec2d_Vec2d(i,0),new Vec2d_Vec2d(r,o),new Vec2d_Vec2d(i,n),new Vec2d_Vec2d(0,o)],isFilled:l});break;case"pentagon":t=new Polygon2d({points:getPolygonVertices(r,n,5),isFilled:l});break;case"hexagon":t=new Polygon2d({points:getPolygonVertices(r,n,6),isFilled:l});break;case"octagon":t=new Polygon2d({points:getPolygonVertices(r,n,8),isFilled:l});break;case"ellipse":t=new Ellipse2d({width:r,height:n,isFilled:l});break;case"oval":t=new Stadium2d({width:r,height:n,isFilled:l});break;case"star":{let e=r9/5/2,i=2*Math.floor(5/4),o=Math.cos(-r6+i*e)*r/2,a=Math.cos(-r6+(10-i)*e)*r/2,d=Math.sin(-r6+0*e)*n/2,c=Math.sin(-r6+2*Math.floor(2.5)*e)*n/2,u=r-Math.abs(o-a),p=n-Math.abs(c-d),h=r/2+a-(r/2-o),f=n/2+d-(n/2-c),g=(r-h)/2,m=(n-f)/2,y=(r+u)/2,b=(n+p)/2,v=1*y/2,S=1*b/2;t=new Polygon2d({points:Array.from(Array(10)).map((t,r)=>{let n=-r6+r*e;return new Vec2d_Vec2d(g+(r%2?v:y)*Math.cos(n),m+(r%2?S:b)*Math.sin(n))}),isFilled:l});break}case"rhombus":{let e=Math.min(.38*r,.38*n);t=new Polygon2d({points:[new Vec2d_Vec2d(e,0),new Vec2d_Vec2d(r,0),new Vec2d_Vec2d(r-e,n),new Vec2d_Vec2d(0,n)],isFilled:l});break}case"rhombus-2":{let e=Math.min(.38*r,.38*n);t=new Polygon2d({points:[new Vec2d_Vec2d(0,0),new Vec2d_Vec2d(r-e,0),new Vec2d_Vec2d(r,n),new Vec2d_Vec2d(e,n)],isFilled:l});break}case"trapezoid":{let e=Math.min(.38*r,.38*n);t=new Polygon2d({points:[new Vec2d_Vec2d(e,0),new Vec2d_Vec2d(r-e,0),new Vec2d_Vec2d(r,n),new Vec2d_Vec2d(0,n)],isFilled:l});break}case"arrow-right":{let e=.38*Math.min(r,n),i=.16*n;t=new Polygon2d({points:[new Vec2d_Vec2d(0,i),new Vec2d_Vec2d(r-e,i),new Vec2d_Vec2d(r-e,0),new Vec2d_Vec2d(r,n/2),new Vec2d_Vec2d(r-e,n),new Vec2d_Vec2d(r-e,n-i),new Vec2d_Vec2d(0,n-i)],isFilled:l});break}case"arrow-left":{let e=.38*Math.min(r,n),i=.16*n;t=new Polygon2d({points:[new Vec2d_Vec2d(e,0),new Vec2d_Vec2d(e,i),new Vec2d_Vec2d(r,i),new Vec2d_Vec2d(r,n-i),new Vec2d_Vec2d(e,n-i),new Vec2d_Vec2d(e,n),new Vec2d_Vec2d(0,n/2)],isFilled:l});break}case"arrow-up":{let e=.16*r,i=.38*Math.min(r,n);t=new Polygon2d({points:[new Vec2d_Vec2d(r/2,0),new Vec2d_Vec2d(r,i),new Vec2d_Vec2d(r-e,i),new Vec2d_Vec2d(r-e,n),new Vec2d_Vec2d(e,n),new Vec2d_Vec2d(e,i),new Vec2d_Vec2d(0,i)],isFilled:l});break}case"arrow-down":{let e=.16*r,i=.38*Math.min(r,n);t=new Polygon2d({points:[new Vec2d_Vec2d(e,0),new Vec2d_Vec2d(r-e,0),new Vec2d_Vec2d(r-e,n-i),new Vec2d_Vec2d(r,n-i),new Vec2d_Vec2d(r/2,n),new Vec2d_Vec2d(0,n-i),new Vec2d_Vec2d(e,n-i)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":t=new Rectangle2d({width:r,height:n,isFilled:l,isSnappable:!0})}let d=getLabelSize(this.editor,e),c=Math.min(r,Math.max(d.w,Math.min(32,Math.max(1,r-8)))),u=Math.min(n,Math.max(d.h,Math.min(32,Math.max(1,r-8)))),p=getLines(e.props,a),h=p?p.map(e=>new Polyline2d({points:e})):[];return new Group2d({children:[t,new Rectangle2d({x:"start"===e.props.align?0:"end"===e.props.align?r-c:(r-c)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?n-u:(n-u)/2,width:c,height:u,isFilled:!0,isSnappable:!1,isLabel:!0}),...h],isSnappable:!1})}onEditEnd=e=>{let{id:t,type:r,props:{text:n}}=e;n.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:n.trimEnd()}}])};component(e){let{id:t,type:r,props:n}=e,i=a_[n.size],{w:o,color:a,labelColor:l,fill:d,dash:c,growY:u,font:p,align:h,verticalAlign:f,size:g,text:m}=n;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(SVGContainer,{id:t,children:(()=>{let r=n.h+u;switch(n.geo){case"cloud":if("solid"===c)return(0,I.jsx)(aq,{color:a,fill:d,strokeWidth:i,w:o,h:r,id:t,size:g});if("dashed"===c||"dotted"===c)return(0,I.jsx)(aB,{color:a,fill:d,strokeWidth:i,w:o,h:r,id:t,size:g,dash:c});if("draw"===c)return(0,I.jsx)(aW,{color:a,fill:d,strokeWidth:i,w:o,h:r,id:t,size:g});break;case"ellipse":if("solid"===c)return(0,I.jsx)(aY,{strokeWidth:i,w:o,h:r,color:a,fill:d});if("dashed"===c||"dotted"===c)return(0,I.jsx)(aU,{id:t,strokeWidth:i,w:o,h:r,dash:c,color:a,fill:d});if("draw"===c)return(0,I.jsx)(aY,{strokeWidth:i,w:o,h:r,color:a,fill:d});break;case"oval":if("solid"===c)return(0,I.jsx)(aX,{strokeWidth:i,w:o,h:r,color:a,fill:d});if("dashed"===c||"dotted"===c)return(0,I.jsx)(aH,{id:t,strokeWidth:i,w:o,h:r,dash:c,color:a,fill:d});if("draw"===c)return(0,I.jsx)(aX,{strokeWidth:i,w:o,h:r,color:a,fill:d});break;default:{let r=this.editor.getShapeGeometry(e),n=r instanceof Group2d?r.children[0].vertices:r.vertices,o=getLines(e.props,i);if("solid"===c)return(0,I.jsx)(aZ,{fill:d,color:a,strokeWidth:i,outline:n,lines:o});if("dashed"===c||"dotted"===c)return(0,I.jsx)(aG,{dash:c,fill:d,color:a,strokeWidth:i,outline:n,lines:o});if("draw"===c)return(0,I.jsx)(aK,{id:t,fill:d,color:a,strokeWidth:i,outline:n,lines:o})}}})()}),(0,I.jsx)(az,{id:t,type:r,font:p,fill:d,size:g,align:h,verticalAlign:f,text:m,labelColor:l,wrap:!0,bounds:"cloud"===n.geo?this.getGeometry(e).bounds:void 0}),e.props.url&&(0,I.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(e){let{id:t,props:r}=e,{w:n,size:i}=r,o=r.h+r.growY,a=a_[i];switch(r.geo){case"ellipse":if("draw"===r.dash)return(0,I.jsx)("path",{d:getSvgPathFromStrokePoints(getEllipseStrokePoints(t,n,o,a))});return(0,I.jsx)("ellipse",{cx:n/2,cy:o/2,rx:n/2,ry:o/2});case"oval":return(0,I.jsx)("path",{d:getOvalIndicatorPath(n,o)});case"cloud":return(0,I.jsx)("path",{d:cloudSvgPath(n,o,t,i)});default:{let n;let i=this.editor.getShapeGeometry(e),o=i instanceof Group2d?i.children[0].vertices:i.vertices;if("draw"===r.dash){let e=getRoundedPolygonPoints(t,o,0,2*a,1);n=getRoundedInkyPolygonPath(e)}else n="M"+o[0]+"L"+o.slice(1)+"Z";let l=getLines(e.props,a);if(l)for(let[e,t]of l)n+=`M${e.x},${e.y}L${t.x},${t.y}`;return(0,I.jsx)("path",{d:n})}}}toSvg(e,t){let r;let{id:n,props:i}=e,o=a_[i.size],a=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode});switch(t.addExportDef(getFillDefForExport(e.props.fill,a)),i.geo){case"ellipse":switch(i.dash){case"draw":r=DrawStyleEllipseSvg({id:n,w:i.w,h:i.h,color:i.color,fill:i.fill,strokeWidth:o,theme:a});break;case"solid":r=SolidStyleEllipseSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:a});break;default:r=DashStyleEllipseSvg({id:n,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a})}break;case"oval":switch(i.dash){case"draw":default:r=DashStyleOvalSvg({id:n,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a});break;case"solid":r=SolidStyleOvalSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:a})}break;case"cloud":switch(i.dash){case"draw":r=DrawStyleCloudSvg({id:n,strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,theme:a});break;case"solid":r=SolidStyleCloudSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,id:n,theme:a});break;default:r=DashStyleCloudSvg({id:n,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a,size:i.size})}break;default:{let t=this.editor.getShapeGeometry(e),l=t instanceof Group2d?t.children[0].vertices:t.vertices,d=getLines(e.props,o);switch(i.dash){case"draw":r=DrawStylePolygonSvg({id:n,fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:d,theme:a});break;case"solid":r=SolidStylePolygonSvg({fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:d,theme:a});break;default:r=DashStylePolygonSvg({dash:i.dash,fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:d,theme:a})}}}if(i.text){let n=this.editor.getShapeGeometry(e).bounds;t.addExportDef(getFontDefForExport(e.props.font));let i=getTextLabelSvgElement({editor:this.editor,shape:e,font:t4[e.props.font],bounds:n}),o=i.cloneNode(!0);o.setAttribute("fill",a[e.props.labelColor].solid),o.setAttribute("stroke","none");let l=i.cloneNode(!0);l.setAttribute("stroke-width","2"),l.setAttribute("fill",a.background),l.setAttribute("stroke",a.background);let d=document.createElementNS("http://www.w3.org/2000/svg","g");if(d.append(l),d.append(o),"g"===r.nodeName)r.appendChild(d);else{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(r),e.appendChild(d),e}}return r}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize=(e,{handle:t,newPoint:r,scaleX:n,scaleY:i,initialShape:o})=>{let a=o.props.w*n,l=(o.props.h+o.props.growY)*i,d=0,c=0;if(e.props.text.trim()){let t=Math.max(Math.abs(a),51),r=Math.max(Math.abs(l),51);t<51&&51===r&&(t=51),51===t&&r<51&&(r=51);let n=getLabelSize(this.editor,{...e,props:{...e.props,w:t,h:r}}),i=Math.max(Math.abs(a),n.w)*Math.sign(a),o=Math.max(Math.abs(l),n.h)*Math.sign(l);d=Math.abs(i)-Math.abs(a),c=Math.abs(o)-Math.abs(l),a=i,l=o}let u=new Vec2d_Vec2d(0,0);n<0&&(u.x+=a),("left"===t||"top_left"===t||"bottom_left"===t)&&(u.x+=n<0?d:-d),i<0&&(u.y+=l),("top"===t||"top_left"===t||"top_right"===t)&&(u.y+=i<0?c:-c);let{x:p,y:h}=u.rot(e.rotation).add(r);return{x:p,y:h,props:{w:Math.max(Math.abs(a),1),h:Math.max(Math.abs(l),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;let t=e.props.h,r=getLabelSize(this.editor,e).h,n=null;if(r>t?n=r-t:e.props.growY&&(n=0),null!==n)return{...e,props:{...e.props,growY:n}}};onBeforeUpdate=(e,t)=>{let r=e.props.text,n=t.props.text;if(r===n&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(r&&!n)return{...t,props:{...t.props,growY:0}};let i=e.props.w,o=e.props.h,a=getLabelSize(this.editor,t),l=a.w,d=a.h;if(!r&&n&&1===n.length){let r=Math.max(i,l),n=Math.max(o,d);return e.props.w<51&&e.props.h<51&&(n=Math.max(r=Math.max(r=Math.max(r,51),n=Math.max(n,51)),n)),{...t,props:{...t.props,w:r,h:n,growY:0}}}let c=null;return(d>o?c=d-o:e.props.growY&&(c=0),null!==c)?{...t,props:{...t.props,growY:c,w:Math.max(t.props.w,l)}}:l>e.props.w?{...t,props:{...t.props,w:l}}:void 0};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}};function getLabelSize(e,t){let r=t.props.text;if(!r)return{w:0,h:0};let n=e.textMeasure.measureText("w",{...aw,fontFamily:ak[t.props.font],fontSize:aE[t.props.size],maxWidth:100}),i=e.textMeasure.measureText(r,{...aw,fontFamily:ak[t.props.font],fontSize:aE[t.props.size],minWidth:n.w+"px",maxWidth:Math.max(0,Math.ceil(n.w+({s:2,m:3.5,l:5,xl:10})[t.props.size]),Math.ceil(t.props.w-32))});return{w:i.w+32,h:i.h+32}}function getLines(e,t){switch(e.geo){case"x-box":return getXBoxLines(e.w,e.h,t,e.dash);case"check-box":return getCheckBoxLines(e.w,e.h);default:return}}function getXBoxLines(e,t,r,n){let i="draw"===n?.62:0;if("dashed"===n)return[[new Vec2d_Vec2d(0,0),new Vec2d_Vec2d(e/2,t/2)],[new Vec2d_Vec2d(e,t),new Vec2d_Vec2d(e/2,t/2)],[new Vec2d_Vec2d(0,t),new Vec2d_Vec2d(e/2,t/2)],[new Vec2d_Vec2d(e,0),new Vec2d_Vec2d(e/2,t/2)]];let clampX=t=>Math.max(0,Math.min(e,t)),clampY=e=>Math.max(0,Math.min(t,e));return[[new Vec2d_Vec2d(clampX(r*i),clampY(r*i)),new Vec2d_Vec2d(clampX(e-r*i),clampY(t-r*i))],[new Vec2d_Vec2d(clampX(r*i),clampY(t-r*i)),new Vec2d_Vec2d(clampX(e-r*i),clampY(r*i))]]}function getCheckBoxLines(e,t){let r=.82*Math.min(e,t),n=(e-r)/2,i=(t-r)/2,clampX=t=>Math.max(0,Math.min(e,t)),clampY=e=>Math.max(0,Math.min(t,e));return[[new Vec2d_Vec2d(clampX(n+.25*r),clampY(i+.52*r)),new Vec2d_Vec2d(clampX(n+.45*r),clampY(i+.82*r))],[new Vec2d_Vec2d(clampX(n+.45*r),clampY(i+.82*r)),new Vec2d_Vec2d(clampX(n+.82*r),clampY(i+.22*r))]]}function useColorSpace(){let[e,t]=(0,T.useState)(!1);(0,T.useEffect)(()=>{let e=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");t(e&&r.matches);let onChange=()=>t(e&&r.matches);return r.addEventListener("change",onChange),()=>r.removeEventListener("change",onChange)},[]);let r=useValue(rZ.forceSrgb);return r||!e?"srgb":"p3"}let HighlightShapeUtil=class HighlightShapeUtil extends ShapeUtil{static type="highlight";static props=rk;static migrations=rI;hideResizeHandles=e=>HighlightShapeUtil_getIsDot(e);hideRotateHandle=e=>HighlightShapeUtil_getIsDot(e);hideSelectionBoundsFg=e=>HighlightShapeUtil_getIsDot(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(e){let t=getStrokeWidth(e);if(HighlightShapeUtil_getIsDot(e))return new Circle2d({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});let{strokePoints:r,sw:n}=getHighlightStrokePoints(e,t,!0),i=getHighlightFreehandSettings({strokeWidth:n,showAsComplete:!0});return setStrokePointRadii(r,i),new Polygon2d({points:getStrokeOutlinePoints_getStrokeOutlinePoints(r,i),isFilled:!0})}component(e){return(0,I.jsx)(HighlightRenderer,{strokeWidth:getStrokeWidth(e),shape:e,opacity:.35})}backgroundComponent(e){return(0,I.jsx)(HighlightRenderer,{strokeWidth:getStrokeWidth(e),shape:e,opacity:.82})}indicator(e){let t;let r=useForceSolid(),n=getStrokeWidth(e),i=getPointsFromSegments(e.props.segments),o=n;r||e.props.isPen||1!==i.length||(o+=rng(e.id)()*(n/6));let a=e.props.isComplete||last(e.props.segments)?.type==="straight",l=getHighlightFreehandSettings({strokeWidth:n,showAsComplete:a}),d=getStrokePoints(i,l);return t=d.length<2?getIndicatorDot(i[0],o):getSvgPathFromStrokePoints(d,!1),(0,I.jsx)("path",{d:t})}toSvg(e){let t=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode});return highlighterToSvg(getStrokeWidth(e),e,.35,t)}toBackgroundSvg(e){let t=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode});return highlighterToSvg(getStrokeWidth(e),e,.82,t)}onResize=(e,t)=>{let{scaleX:r,scaleY:n}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:r*e,y:n*t,z:i}))});return{props:{segments:i}}}};function getShapeDot(e){return`M ${e.x} ${e.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`}function getIndicatorDot(e,t){let r=t/2;return`M ${e.x} ${e.y} m -${r}, 0 a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 -${2*r},0`}function getHighlightStrokePoints(e,t,r){let n=getPointsFromSegments(e.props.segments),i=e.props.isComplete||last(e.props.segments)?.type==="straight",o=t;r||e.props.isPen||1!==n.length||(o+=rng(e.id)()*(t/6));let a=getHighlightFreehandSettings({strokeWidth:o,showAsComplete:i}),l=getStrokePoints(n,a);return{strokePoints:l,sw:o}}function getHighlightSvgPath(e,t,r){let{strokePoints:n,sw:i}=getHighlightStrokePoints(e,t,r),o=n.length>1?getSvgPathFromStrokePoints(n,!1):getShapeDot(e.props.segments[0].points[0]);return{solidStrokePath:o,sw:i}}function HighlightRenderer({strokeWidth:e,shape:t,opacity:r}){let n=useDefaultColorTheme(),i=useForceSolid(),{solidStrokePath:o,sw:a}=getHighlightSvgPath(t,e,i),l=useColorSpace(),d=n[t.props.color].highlight[l];return(0,I.jsx)(SVGContainer,{id:t.id,style:{opacity:r},children:(0,I.jsx)("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:d,strokeWidth:a})})}function highlighterToSvg(e,t,r,n){let{solidStrokePath:i,sw:o}=getHighlightSvgPath(t,e,!1),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",i),a.setAttribute("fill","none"),a.setAttribute("stroke",n[t.props.color].highlight.srgb),a.setAttribute("stroke-width",`${o}`),a.setAttribute("opacity",`${r}`),a}function getStrokeWidth(e){return 1.12*aP[e.props.size]}function HighlightShapeUtil_getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function usePrefersReducedMotion(){let[e,t]=(0,T.useState)(!1);return(0,T.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),handler=()=>{t(e.matches)};return handler(),e.addEventListener("change",handler),()=>e.removeEventListener("change",handler)},[]),e}let loadImage=async e=>new Promise((t,r)=>{let n=new Image;n.onload=()=>t(n),n.onerror=()=>r(Error("Failed to load image")),n.crossOrigin="anonymous",n.src=e}),getStateFrame=async e=>{let t=await loadImage(e),r=document.createElement("canvas");r.width=t.width,r.height=t.height;let n=r.getContext("2d");if(n)return n.drawImage(t,0,0),r.toDataURL()};async function getDataURIFromURL(e){let t=await fetch(e),r=await t.blob();return new Promise((e,t)=>{let n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=t,n.readAsDataURL(r)})}let ImageShapeUtil=class ImageShapeUtil extends BaseBoxShapeUtil{static type="image";static props=rA;static migrations=rM;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(e){let t=getContainerStyle(e),r=useIsCropping(e.id),n=usePrefersReducedMotion(),[i,o]=(0,T.useState)(""),a=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(a?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");let l=useValue("onlySelectedShape",()=>e.id===this.editor.onlySelectedShape?.id,[this.editor]),d=l&&r&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),c=n&&(a?.props.mimeType?.includes("video")||a?.props.mimeType?.includes("gif"));return(0,T.useEffect)(()=>{if(a?.props.src&&"mimeType"in a.props&&a?.props.mimeType==="image/gif"){let e=!1,run=async()=>{let t=await getStateFrame(a.props.src);!e&&t&&o(t)};return run(),()=>{e=!0}}},[n,a?.props]),(0,I.jsxs)(I.Fragment,{children:[a?.props.src&&d&&(0,I.jsx)("div",{style:t,children:(0,I.jsx)("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!e.props.playing||c?i:a.props.src})`},draggable:!1})}),(0,I.jsx)(HTMLContainer,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:(0,I.jsxs)("div",{className:"tl-image-container",style:t,children:[a?.props.src?(0,I.jsx)("div",{className:"tl-image",style:{backgroundImage:`url(${!e.props.playing||c?i:a.props.src})`},draggable:!1}):null,a?.props.isAnimated&&!e.props.playing&&(0,I.jsx)("div",{className:"tl-image__tg",children:"GIF"})]})}),"url"in e.props&&e.props.url&&(0,I.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(e){let t=useIsCropping(e.id);return t?null:(0,I.jsx)("rect",{width:toDomPrecision(e.props.w),height:toDomPrecision(e.props.h)})}async toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),r=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=r?.props.src||"";n&&n.startsWith("http")&&(n=await getDataURIFromURL(n)||"");let i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttributeNS("http://www.w3.org/1999/xlink","href",n);let o=getContainerStyle(e),a=e.props.crop;if(o.transform&&a){let{transform:e,width:r,height:n}=o,l=[new Vec2d_Vec2d(a.topLeft.x*r,a.topLeft.y*n),new Vec2d_Vec2d(a.bottomRight.x*r,a.topLeft.y*n),new Vec2d_Vec2d(a.bottomRight.x*r,a.bottomRight.y*n),new Vec2d_Vec2d(a.topLeft.x*r,a.bottomRight.y*n)],d=document.createElementNS("http://www.w3.org/2000/svg","g");d.style.clipPath=`polygon(${l.map(e=>`${e.x}px ${e.y}px`).join(",")})`,i.setAttribute("width",r.toString()),i.setAttribute("height",n.toString()),i.style.transform=e,d.appendChild(i),t.appendChild(d)}else i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),t.appendChild(i);return t}onDoubleClick=e=>{let t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(!t)return;let r=t.props.src&&"mimeType"in t.props&&"image/gif"===t.props.mimeType;r&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{let t=e.props;if(!t||this.editor.croppingShapeId!==e.id)return;let r=deepCopy(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},n=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,o=new Vec2d_Vec2d(r.topLeft.x*n,r.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:n,h:i}};this.editor.updateShapes([a])}};function getContainerStyle(e){let t=e.props.crop,r=t?.topLeft;if(!r)return{width:e.props.w,height:e.props.h};let n=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-r.x*n,a=-r.y*i;return{transform:`translate(${o}px, ${a}px)`,width:n,height:i}}function getSvgPathForEdge(e,t){let{start:r,end:n}=e;return t?`M${toDomPrecision(r.x)},${toDomPrecision(r.y)} L${toDomPrecision(n.x)},${toDomPrecision(n.y)} `:`${toDomPrecision(n.x)},${toDomPrecision(n.y)} `}function getSvgPathForBezierCurve(e,t){let{a:r,b:n,c:i,d:o}=e;return Vec2d_Vec2d.Equals(r,o)?"":`${t?`M${toDomPrecision(r.x)},${toDomPrecision(r.y)}`:""}C${toDomPrecision(n.x)},${toDomPrecision(n.y)} ${toDomPrecision(i.x)},${toDomPrecision(i.y)} ${toDomPrecision(o.x)},${toDomPrecision(o.y)}`}function getSvgPathForCubicSpline(e,t){let r=e.segments.reduce((e,t,r)=>e+getSvgPathForBezierCurve(t,0===r),"");return t&&(r+="Z"),r}function getSvgPathForPolylineSpline(e,t){let r=e.segments.reduce((e,t,r)=>e+getSvgPathForEdge(t,0===r),"");return t&&(r+="Z"),r}function getSvgPathForLineGeometry(e,t=!1){return e instanceof Polyline2d?getSvgPathForPolylineSpline(e,t):getSvgPathForCubicSpline(e,t)}function getLineDrawFreehandOptions(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function getLineStrokePoints(e,t,r){let n=t.vertices,i=getLineDrawFreehandOptions(r);return getStrokePoints(n,i)}function getLineDrawStrokeOutlinePoints(e,t,r){let n=getLineDrawFreehandOptions(r);return getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getLineStrokePoints(e,t,r),n),n)}function getLineDrawPath(e,t,r){let n=getLineDrawStrokeOutlinePoints(e,t,r);return getSvgPathFromPoints_getSvgPathFromPoints(n)}function getLineIndicatorPath(e,t,r){if("draw"===e.props.dash){let n=getLineStrokePoints(e,t,r);return getSvgPathFromStrokePoints(n)}return getSvgPathForLineGeometry(t)}let aQ=new WeakMapCache;let LineShapeUtil=class LineShapeUtil extends ShapeUtil{static type="line";static props=rj;static migrations=rL;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(e){return getGeometryForLineShape(e)}getHandles(e){return aQ.get(e.props,()=>{let t=e.props.handles,r=getGeometryForLineShape(e),n=Object.values(t).sort(reordering_sortByIndex),i=n.slice();for(let e=0;e<r.segments.length;e++){let t=r.segments[e],o=t.midPoint(),a=getIndexBetween(n[e].index,n[e+1].index);i.push({id:`mid-${e}`,type:"create",index:a,x:o.x,y:o.y})}return i.sort(reordering_sortByIndex)})}getOutlineSegments(e){let t=this.editor.getShapeGeometry(e);return t.segments.map(e=>e.vertices)}onResize=(e,t)=>{let{scaleX:r,scaleY:n}=t,i=deepCopy(e.props.handles);return Object.values(e.props.handles).forEach(({id:e,x:t,y:o})=>{i[e].x=t*r,i[e].y=o*n}),{props:{handles:i}}};onHandleChange=(e,{handle:t})=>{let r=deepCopy(e);switch(t.id){case"start":case"end":r.props.handles[t.id]={...r.props.handles[t.id],x:t.x,y:t.y};break;default:{let n="handle:"+t.index,i=e.props.handles[n];i?r.props.handles[n]={...i,x:t.x,y:t.y}:r.props.handles[n]={id:n,type:"vertex",canBind:!1,index:t.index,x:t.x,y:t.y}}}return r};component(e){let t=useDefaultColorTheme(),r=getGeometryForLineShape(e),n=a_[e.props.size],{dash:i,color:o}=e.props;if("line"===e.props.spline){if("solid"===i){let i=r.points,a="M"+i[0]+"L"+i.slice(1);return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:a,fill:"none",color:o,theme:t}),(0,I.jsx)("path",{d:a,stroke:t[o].solid,strokeWidth:n,fill:"none"})]})}if("dashed"===i||"dotted"===i){let a=r.points,l="M"+a[0]+"L"+a.slice(1);return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:l,fill:"none",color:o,theme:t}),(0,I.jsx)("g",{stroke:t[o].solid,strokeWidth:n,children:r.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps_getPerfectDashProps(e.length,n,{style:i,start:t>0?"outset":"none",end:t<r.segments.length-1?"outset":"none"});return(0,I.jsx)("path",{strokeDasharray:o,strokeDashoffset:a,d:getSvgPathForEdge(e,!0),fill:"none"},t)})})]})}if("draw"===i){let i=r.points,[a,l]=getDrawLinePathData(e.id,i,n);return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:a,fill:"none",color:o,theme:t}),(0,I.jsx)("path",{d:l,stroke:t[o].solid,strokeWidth:n,fill:"none"})]})}}if("cubic"===e.props.spline){let a=getSvgPathForLineGeometry(r);if("solid"===i)return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:a,fill:"none",color:o,theme:t}),(0,I.jsx)("path",{strokeWidth:n,stroke:t[o].solid,fill:"none",d:a})]});if("dashed"===i||"dotted"===i)return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:a,fill:"none",color:o,theme:t}),(0,I.jsx)("g",{stroke:t[o].solid,strokeWidth:n,children:r.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps_getPerfectDashProps(e.length,n,{style:i,start:t>0?"outset":"none",end:t<r.segments.length-1?"outset":"none"});return(0,I.jsx)("path",{strokeDasharray:o,strokeDashoffset:a,d:getSvgPathForBezierCurve(e,!0),fill:"none"},t)})})]});if("draw"===i)return(0,I.jsxs)(SVGContainer,{id:e.id,children:[(0,I.jsx)(aV,{d:a,fill:"none",color:o,theme:t}),(0,I.jsx)("path",{d:getLineDrawPath(e,r,n),strokeWidth:1,stroke:t[o].solid,fill:t[o].solid})]})}}indicator(e){let t;let r=a_[e.props.size],n=getGeometryForLineShape(e),{dash:i}=e.props;if("line"===e.props.spline){let o=n.points;if("solid"===i||"dotted"===i||"dashed"===i)t="M"+o[0]+"L"+o.slice(1);else{let[n]=getDrawLinePathData(e.id,o,r);t=n}}else t=getLineIndicatorPath(e,n,r);return(0,I.jsx)("path",{d:t})}toSvg(e){let t=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode}),r=t[e.props.color].solid,n=getGeometryForLineShape(e),i=a_[e.props.size];switch(e.props.dash){case"draw":{let t;if(n instanceof CubicSpline2d)t=getLineDrawPath(e,n,i);else{let[r,o]=getDrawLinePathData(e.id,n.points,i);t=o}let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("stroke-width",i+"px"),o.setAttribute("stroke",r),o.setAttribute("fill","none"),o.setAttribute("d",t),o}case"solid":{let e;if(n instanceof CubicSpline2d)e=getSvgPathForCubicSpline(n,!1);else{let t=n.points;e="M"+t[0]+"L"+t.slice(1)}let t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("stroke-width",i+"px"),t.setAttribute("stroke",r),t.setAttribute("fill","none"),t.setAttribute("d",e),t}default:{let{segments:t}=n,o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("stroke",r),o.setAttribute("stroke-width",i.toString());let a=n instanceof CubicSpline2d?getSvgPathForBezierCurve:getSvgPathForEdge;return t.forEach((r,n)=>{let l=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:d,strokeDashoffset:c}=getPerfectDashProps_getPerfectDashProps(r.length,i,{style:e.props.dash,start:n>0?"outset":"none",end:n<t.length-1?"outset":"none"});l.setAttribute("stroke-dasharray",d.toString()),l.setAttribute("stroke-dashoffset",c.toString()),l.setAttribute("d",a(r,!0)),l.setAttribute("fill","none"),o.appendChild(l)}),o}}}};function getGeometryForLineShape(e){let{spline:t,handles:r}=e.props,n=Object.values(r).sort(reordering_sortByIndex).map(Vec2d_Vec2d.From);switch(t){case"cubic":return new CubicSpline2d({points:n});case"line":return new Polyline2d({points:n})}}let NoteShapeUtil=class NoteShapeUtil extends ShapeUtil{static type="note";static props=rF;static migrations=rz;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(e){return 200+e.props.growY}getGeometry(e){let t=this.getHeight(e);return new Rectangle2d({width:200,height:t,isFilled:!0})}component(e){let{id:t,type:r,props:{color:n,font:i,size:o,align:a,text:l,verticalAlign:d}}=e,c=useDefaultColorTheme(),u="black"===n?"yellow":n;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{position:"absolute",width:200,height:this.getHeight(e)},children:(0,I.jsxs)("div",{className:"tl-note__container",style:{color:c[u].solid,backgroundColor:c[u].solid},children:[(0,I.jsx)("div",{className:"tl-note__scrim"}),(0,I.jsx)(az,{id:t,type:r,font:i,size:o,align:a,verticalAlign:d,text:l,labelColor:"black",wrap:!0})]})}),"url"in e.props&&e.props.url&&(0,I.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(e){return(0,I.jsx)("rect",{rx:"7",width:toDomPrecision(200),height:toDomPrecision(this.getHeight(e))})}toSvg(e,t){t.addExportDef(getFontDefForExport(e.props.font));let r=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode}),n=this.editor.getShapeGeometry(e).bounds,i=document.createElementNS("http://www.w3.org/2000/svg","g"),o="black"===e.props.color?"yellow":e.props.color,a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("rx","10"),a.setAttribute("width","200"),a.setAttribute("height",n.height.toString()),a.setAttribute("fill",r[o].solid),a.setAttribute("stroke",r[o].solid),a.setAttribute("stroke-width","1"),i.appendChild(a);let l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width","200"),l.setAttribute("height",n.height.toString()),l.setAttribute("fill",r.background),l.setAttribute("opacity",".28"),i.appendChild(l);let d=getTextLabelSvgElement({editor:this.editor,shape:e,font:t4[e.props.font],bounds:n});return d.setAttribute("fill",r.text),d.setAttribute("stroke","none"),i.appendChild(d),i}onBeforeCreate=e=>getGrowY(this.editor,e,e.props.growY);onBeforeUpdate=(e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return getGrowY(this.editor,t,e.props.growY)};onEditEnd=e=>{let{id:t,type:r,props:{text:n}}=e;n.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:n.trimEnd()}}])}};function getGrowY(e,t,r=0){let n=e.textMeasure.measureText(t.props.text,{...aw,fontFamily:ak[t.props.font],fontSize:aE[t.props.size],maxWidth:166}),i=n.h+34,o=null;if(i>200?o=i-200:r&&(o=0),null!==o)return{...t,props:{...t.props,growY:o}}}function resizeScaled(e,{initialBounds:t,scaleX:r,scaleY:n,newPoint:i}){let o=Math.max(.01,Math.min(Math.abs(r),Math.abs(n))),a=new Vec2d_Vec2d(0,0);r<0&&(a.x=-(t.width*o)),n<0&&(a.y=-(t.height*o));let{x:l,y:d}=Vec2d_Vec2d.Add(i,a.rot(e.rotation));return{x:l,y:d,props:{scale:o*e.props.scale}}}let aJ=new WeakMapCache;let TextShapeUtil=class TextShapeUtil extends ShapeUtil{static type="text";static props=rB;static migrations=rH;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(e){return aJ.get(e.props,e=>getTextSize(this.editor,e))}getGeometry(e){let{scale:t}=e.props,{width:r,height:n}=this.getMinDimensions(e);return new Rectangle2d({width:r*t,height:n*t,isFilled:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){let{id:t,type:r,props:{text:n,color:i}}=e,o=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode}),{width:a,height:l}=this.getMinDimensions(e),{rInput:d,isEmpty:c,isEditing:u,handleFocus:p,handleChange:h,handleKeyDown:f,handleBlur:g,handleInputPointerDown:m,handleDoubleClick:y}=useEditableText(t,r,n);return(0,I.jsx)(HTMLContainer,{id:e.id,children:(0,I.jsxs)("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":e.props.font,"data-align":e.props.align,"data-hastext":!c,"data-isediting":u,"data-textwrap":!0,style:{fontSize:aP[e.props.size],lineHeight:aP[e.props.size]*aw.lineHeight+"px",transform:`scale(${e.props.scale})`,transformOrigin:"top left",width:Math.max(1,a),height:Math.max(aP[e.props.size]*aw.lineHeight,l),color:o[i].solid},children:[(0,I.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:n}),u?(0,I.jsx)("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:u,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:n,onFocus:p,onChange:h,onKeyDown:f,onBlur:g,onTouchEnd:stopEventPropagation,onContextMenu:stopEventPropagation,onPointerDown:m,onDoubleClick:y}):null]})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,I.jsx)("rect",{width:toDomPrecision(t.width),height:toDomPrecision(t.height)})}toSvg(e,t){t.addExportDef(getFontDefForExport(e.props.font));let r=getDefaultColorTheme({isDarkMode:this.editor.user.isDarkMode}),n=this.editor.getShapeGeometry(e).bounds,i=e.props.text,o=n.width/(e.props.scale??1),a=n.height/(e.props.scale??1),l={fontSize:aP[e.props.size],fontFamily:t4[e.props.font],textAlign:e.props.align,verticalTextAlign:"middle",width:o,height:a,padding:0,lineHeight:aw.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},d=r[e.props.color].solid,c=document.createElementNS("http://www.w3.org/2000/svg","g"),u=createTextSvgElementFromSpans(this.editor,this.editor.textMeasure.measureTextSpans(i,l),{...l,stroke:r.background,strokeWidth:2,fill:r.background,padding:0}),p=u.cloneNode(!0);return p.setAttribute("fill",d),p.setAttribute("stroke","none"),c.append(u),c.append(p),c}onResize=(e,t)=>{let{initialBounds:r,initialShape:n,scaleX:i,handle:o}=t;if("scale_shape"===t.mode||"right"!==o&&"left"!==o)return{id:e.id,type:e.type,...resizeScaled(e,t)};{let t=r.width,a=t*i,l=new Vec2d_Vec2d(0,0);a=Math.max(1,Math.abs(a)),"left"===o?(l.x=t-a,i<0&&(l.x+=a)):i<0&&(l.x-=a);let{x:d,y:c}=l.rot(e.rotation).add(n);return{id:e.id,type:e.type,x:d,y:c,props:{w:a/n.props.scale,autoSize:!1}}}};onBeforeCreate=e=>{if(!e.props.autoSize||e.props.text.trim())return;let t=this.getMinDimensions(e);return{...e,x:e.x-t.width/2,y:e.y-t.height/2}};onEditEnd=e=>{let{id:t,type:r,props:{text:n}}=e,i=e.props.text.trimEnd();0===i.length?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:n.trimEnd()}}])};onBeforeUpdate=(e,t)=>{let r;if(!t.props.autoSize)return;let n=e.props.size!==t.props.size||e.props.align!==t.props.align||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=e.props.text!==t.props.text;if(!n&&!i)return;let o=this.getMinDimensions(e),a=getTextSize(this.editor,t.props),l=o.width*e.props.scale,d=o.height*e.props.scale,c=a.width*t.props.scale,u=a.height*t.props.scale;switch(t.props.align){case"middle":r=new Vec2d_Vec2d((c-l)/2,i?0:(u-d)/2);break;case"end":r=new Vec2d_Vec2d(c-l,i?0:(u-d)/2);break;default:if(i)break;r=new Vec2d_Vec2d(0,(u-d)/2)}if(!r)return{...t,props:{...t.props,w:c}};{r.rot(t.rotation);let{x:e,y:n}=t;return{...t,x:e-r.x,y:n-r.y,props:{...t.props,w:c}}}};onDoubleClickEdge=e=>e.props.autoSize?1!==e.props.scale?{id:e.id,type:e.type,props:{scale:1}}:void 0:{id:e.id,type:e.type,props:{autoSize:!0}}};function getTextSize(e,t){let{font:r,text:n,autoSize:i,size:o,w:a}=t,l=i?16:Math.max(16,a),d=aP[o],c=e.textMeasure.measureText(n,{...aw,fontFamily:ak[r],fontSize:d,maxWidth:i?null:Math.floor(Math.max(l,a))});return i&&(c.w+=1),{width:Math.max(l,c.w),height:Math.max(d,c.h)}}let VideoShapeUtil=class VideoShapeUtil extends BaseBoxShapeUtil{static type="video";static props=rG;static migrations=rK;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return(0,I.jsx)(a0,{shape:e,videoUtil:this})}indicator(e){return(0,I.jsx)("rect",{width:toDomPrecision(e.props.w),height:toDomPrecision(e.props.h)})}toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","image");return r.setAttributeNS("http://www.w3.org/1999/xlink","href",serializeVideo(e.id)),r.setAttribute("width",e.props.w.toString()),r.setAttribute("height",e.props.h.toString()),t.appendChild(r),t}};function serializeVideo(e){let t=e.split(":")[1],r=document.querySelector(`.tl-video-shape-${t}`);if(r){let e=document.createElement("canvas");return e.width=r.videoWidth,e.height=r.videoHeight,e.getContext("2d").drawImage(r,0,0),e.toDataURL("image/png")}throw Error("Video with id "+t+" not found")}let a0=track(function(e){let{shape:t,videoUtil:r}=e,n=r.editor.getShapeGeometry(t).bounds.w*r.editor.zoomLevel>=110,i=t.props.assetId?r.editor.getAsset(t.props.assetId):null,{time:o,playing:a}=t.props,l=useIsEditing(t.id),d=usePrefersReducedMotion(),c=T.useRef(null),u=T.useCallback(e=>{let n=e.currentTarget;r.editor.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:n.currentTime}}])},[t.id,r.editor]),p=T.useCallback(e=>{let n=e.currentTarget;r.editor.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:n.currentTime}}])},[t.id,r.editor]),h=T.useCallback(e=>{let n=e.currentTarget;l&&r.editor.updateShapes([{type:"video",id:t.id,props:{time:n.currentTime}}])},[l,t.id,r.editor]),[f,g]=T.useState(!1),m=T.useCallback(e=>{let t=e.currentTarget;o!==t.currentTime&&(t.currentTime=o),a||t.pause(),g(!0)},[a,o]);return T.useEffect(()=>{let e=c.current;e&&(f&&!l&&o!==e.currentTime&&(e.currentTime=o),l&&document.activeElement!==e&&e.focus())},[l,f,o]),T.useEffect(()=>{if(d){let e=c.current;e.pause(),e.currentTime=0}},[c,d]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(HTMLContainer,{id:t.id,children:(0,I.jsx)("div",{className:"tl-counter-scaled",children:i?.props.src?(0,I.jsx)("video",{ref:c,style:l?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:l&&n,onPlay:u,onPause:p,onTimeUpdate:h,onLoadedData:m,hidden:!f,children:(0,I.jsx)("source",{src:i.props.src})}):null})}),"url"in t.props&&t.props.url&&(0,I.jsx)(HyperlinkButton,{url:t.props.url,zoomLevel:r.editor.zoomLevel})]})}),a1=[TextShapeUtil,BookmarkShapeUtil,DrawShapeUtil,GeoShapeUtil,NoteShapeUtil,LineShapeUtil,FrameShapeUtil,ArrowShapeUtil,HighlightShapeUtil,EmbedShapeUtil,ImageShapeUtil,VideoShapeUtil];function registerDefaultSideEffects(e){return[e.sideEffects.registerAfterChangeHandler("instance",(t,r)=>{t.isFocused!==r.isFocused&&(r.isFocused?e.getContainer().focus():(e.complete(),e.getContainer().blur()),e.updateViewportScreenBounds())}),e.sideEffects.registerAfterChangeHandler("instance_page_state",(t,r)=>{if(t.croppingShapeId!==r.croppingShapeId){let n=e.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!t.croppingShapeId&&r.croppingShapeId?n||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!r.croppingShapeId&&n&&e.setCurrentTool("select.idle")}t.editingShapeId!==r.editingShapeId&&(!t.editingShapeId&&r.editingShapeId?e.isIn("select.editing_shape")||e.setCurrentTool("select.editing_shape"):t.editingShapeId&&!r.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle"))})]}let ScribbleManager=class ScribbleManager{state;points;size;color;opacity;delay;timeoutMs=0;delayRemaining=0;onUpdate;onComplete;prev=null;next=null;constructor(e){let{size:t=20,color:r="accent",opacity:n=.8,delay:i=0,onComplete:o,onUpdate:a}=e;this.onUpdate=a,this.onComplete=o,this.size=t,this.color=r,this.delay=i,this.opacity=n,this.points=[],this.state="starting",this.prev=null,this.next=null,this.delayRemaining=this.delay,this.resume()}resume=()=>{this.state="active"};pause=()=>{this.state="starting"};stop=()=>{this.delayRemaining=Math.min(this.delayRemaining,200),this.state="stopping"};addPoint=(e,t)=>{let{prev:r}=this,n={x:e,y:t,z:.5};r&&1>Vec2d_Vec2d.Dist(r,n)||(this.next=n)};getScribble(){return{state:this.state,size:this.size,color:this.color,opacity:this.opacity,delay:this.delay,points:[...this.points]}}updateScribble(){this.onUpdate(this.getScribble())}tick=e=>{this.timeoutMs+=e,this.delayRemaining>0&&(this.delayRemaining=Math.max(0,this.delayRemaining-e)),this.timeoutMs>=16&&(this.timeoutMs=0);let{timeoutMs:t,state:r,prev:n,next:i,points:o}=this;switch(r){case"active":i&&i!==n?(this.prev=i,o.push(i),0===this.delayRemaining&&o.length>8&&o.shift(),this.updateScribble()):0===t&&(o.length>1?(o.shift(),this.updateScribble()):this.delayRemaining=this.delay);break;case"stopping":if(0===this.delayRemaining&&0===t){if(1===o.length){this.state="paused",this.onComplete();return}this.size*=.9,o.shift(),this.updateScribble()}}}};let Erasing=class Erasing extends StateNode{static id="erasing";info={};scribble={};markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let r=this.editor.getPointInShapeSpace(e,t),n=this.editor.getShapeGeometry(e);return n.bounds.containsPoint(r)}return!1}).map(e=>e.id)),this.startScribble(),this.update()};startScribble=()=>{this.scribble.tick&&this.editor.off("tick",this.scribble?.tick),this.scribble=new ScribbleManager({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"muted-1",size:12}),this.editor.on("tick",this.scribble.tick)};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(e,t)};onScribbleUpdate=e=>{this.editor.updateInstanceState({scribble:e})};onScribbleComplete=()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})};onExit=()=>{this.scribble.stop()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){let{zoomLevel:e,currentPageShapes:t,erasingShapeIds:r,inputs:{currentPagePoint:n,previousPagePoint:i}}=this.editor,{excludedShapeIds:o}=this;this.pushPointToScribble();let a=new Set(r);for(let r of t){if(this.editor.isShapeOfType(r,"group"))continue;let t=this.editor.getShapeMask(r.id);if(t&&!pointInPolygon(n,t))continue;let o=this.editor.getShapeGeometry(r),l=this.editor.getPointInShapeSpace(r,i),d=this.editor.getPointInShapeSpace(r,n);o.hitTestLineSegment(l,d,nv/e)&&a.add(this.editor.getOutermostSelectableShape(r).id)}this.editor.setErasingShapes([...a].filter(e=>!o.has(e)))}complete(){this.editor.deleteShapes(this.editor.currentPageState.erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};let children_Idle_Idle=class children_Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}};let children_Pointing_Pointing=class children_Pointing_Pointing extends StateNode{static id="pointing";onEnter=()=>{let{inputs:{currentPagePoint:e},currentPageShapesSorted:t,zoomLevel:r}=this.editor,n=new Set,i=n.size;for(let o=t.length,a=o-1;a>=0;a--){let o=t[a];if(!(this.editor.isShapeOrAncestorLocked(o)||this.editor.isShapeOfType(o,"group"))&&this.editor.isPointInShape(o,e,{hitInside:!1,margin:nv/r})){let e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&n.size>i)break;n.add(e.id)}}this.editor.setErasingShapes([...n])};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{erasingShapeIds:e}=this.editor;e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle",{})}};let EraserTool=class EraserTool extends StateNode{static id="eraser";static initial="idle";static children=()=>[children_Idle_Idle,children_Pointing_Pointing,Erasing];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}};let Dragging=class Dragging extends StateNode{static id="dragging";onEnter=()=>{this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};update(){let{currentScreenPoint:e,previousScreenPoint:t}=this.editor.inputs,r=Vec2d_Vec2d.Sub(e,t);(Math.abs(r.x)>0||Math.abs(r.y)>0)&&this.editor.pan(r)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:nm}),this.parent.transition("idle",{})}};let HandTool_children_Idle_Idle=class HandTool_children_Idle_Idle extends StateNode{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}};let HandTool_children_Pointing_Pointing=class HandTool_children_Pointing_Pointing extends StateNode{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle",{})}};let HandTool=class HandTool extends StateNode{static id="hand";static initial="idle";static children=()=>[HandTool_children_Idle_Idle,HandTool_children_Pointing_Pointing,Dragging];onDoubleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{duration:220,easing:r3.easeOutQuint})}};onTripleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{duration:320,easing:r3.easeOutQuint})}};onQuadrupleClick=e=>{if("settle"===e.phase){let{zoomLevel:e,inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({duration:400,easing:r3.easeOutQuint}):this.editor.resetZoom(t,{duration:320,easing:r3.easeOutQuint})}}};let LaserTool_children_Idle_Idle=class LaserTool_children_Idle_Idle extends StateNode{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}};let Lasering=class Lasering extends StateNode{static id="lasering";scribble={};onEnter=()=>{this.startScribble(),this.pushPointToScribble()};onExit=()=>{this.scribble.stop()};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};startScribble=()=>{this.scribble.tick&&this.editor.off("tick",this.scribble?.tick),this.scribble=new ScribbleManager({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"laser",opacity:.7,size:4,delay:1200}),this.editor.on("tick",this.scribble.tick)};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(e,t)};onScribbleUpdate=e=>{this.editor.updateInstanceState({scribble:e})};onScribbleComplete=()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle",{})}cancel(){this.parent.transition("idle",{})}};let LaserTool=class LaserTool extends StateNode{static id="laser";static initial="idle";static children=()=>[LaserTool_children_Idle_Idle,Lasering];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}};let Brushing=class Brushing extends StateNode{static id="brushing";info={};brush=new Box2d_Box2d;initialSelectedShapeIds=[];excludedShapeIds=new Set;initialStartShape=null;onEnter=e=>{let{altKey:t,currentPagePoint:r}=this.editor.inputs;if(t){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter(e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=this.editor.selectedShapeIds.slice(),this.initialStartShape=this.editor.getShapesAtPoint(r)[0],this.onPointerMove()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.parent.transition("idle",{})}hitTestShapes(){let e,t,r,n,i,o;let{zoomLevel:a,currentPageId:l,currentPageShapes:d,inputs:{originPagePoint:c,currentPagePoint:u,shiftKey:p,ctrlKey:h}}=this.editor;this.brush.setTo(Box2d_Box2d.FromPoints([c,u]));let f=new Set(p?this.initialSelectedShapeIds:[]),{corners:g}=this.brush,{excludedShapeIds:m}=this;for(let c=0,p=d.length;c<p;c++)if(r=d[c],!(m.has(r.id)||f.has(r.id))&&(n=this.editor.getShapePageBounds(r))){if(this.brush.contains(n)){this.handleHit(r,u,l,f,g);continue}if(!(h||this.editor.isShapeOfType(r,"frame"))&&this.brush.collides(n)){let n=this.editor.getShapeGeometry(r);if(!(i=this.editor.getShapePageTransform(r)))continue;o=i.clone().invert().applyToPoints(g);for(let i=0;i<o.length;i++)if(e=o[i],t=o[(i+1)%o.length],n.hitTestLineSegment(e,t,nv/a)){this.handleHit(r,u,l,f,g);break}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(f),{squashing:!0})}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,t,r,n,i){if(e.parentId===r){n.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(o.id);(!a||polygonsIntersect(a,i)||pointInPolygon(t,a))&&n.add(o.id)}};function getHitShapeOnCanvasPointerDown(e){let{zoomLevel:t,inputs:{currentPagePoint:r}}=e;return e.getShapeAtPoint(r,{hitInside:!1,hitLabels:!1,margin:nv/t,renderingOnly:!0})??e.getSelectedShapeAtPoint(r)}function getTranslateCroppedImageChange(e,t,r){if(!t)throw Error("Needs to translate a cropped shape!");let{crop:n}=t.props;if(!n)return;let i=e.inputs.shiftKey?Math.abs(r.x)<Math.abs(r.y)?"x":"y":null;"x"===i?r.x=0:"y"===i&&(r.y=0),r.rot(-t.rotation);let o=1/(n.bottomRight.x-n.topLeft.x)*t.props.w,a=1/(n.bottomRight.y-n.topLeft.y)*t.props.h,l=n.bottomRight.y-n.topLeft.y,d=n.bottomRight.x-n.topLeft.x,c=deepCopy(n);c.topLeft.x=Math.min(1-d,Math.max(0,c.topLeft.x-r.x/o)),c.topLeft.y=Math.min(1-l,Math.max(0,c.topLeft.y-r.y/a)),c.bottomRight.x=c.topLeft.x+d,c.bottomRight.y=c.topLeft.y+l;let u={id:t.id,type:t.type,props:{crop:c}};return u}let Crop_children_Idle_Idle=class Crop_children_Idle_Idle extends StateNode{static id="idle";onEnter=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});let{onlySelectedShape:e}=this.editor;this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.isMenuOpen){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.croppingShapeId){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break;default:this.cancel()}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||"up"!==e.phase||!this.editor.croppingShapeId)return;let t=this.editor.getShape(this.editor.croppingShapeId);if(!t)return;let r=this.editor.getShapeUtil(t);r&&"selection"===e.target&&r.onDoubleClickEdge?.(t)};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{"Enter"===e.code&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}cleanupCroppingState=()=>{this.editor.croppingShapeId||this.editor.setCurrentTool("select.idle",{})};nudgeCroppingImage(e=!1){let{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),n=new Vec2d_Vec2d(0,0);if(t.has("ArrowLeft")&&(n.x+=1),t.has("ArrowRight")&&(n.x-=1),t.has("ArrowUp")&&(n.y+=1),t.has("ArrowDown")&&(n.y-=1),n.equals(new Vec2d_Vec2d(0,0)))return;r&&n.mul(10);let i=this.editor.getShape(this.editor.croppingShapeId);if(!i)return;let o=getTranslateCroppedImageChange(this.editor,i,n);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}};let PointingCrop=class PointingCrop extends StateNode{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}};let TranslatingCrop=class TranslatingCrop extends StateNode{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":this.updateShapes();return}};onKeyUp=e=>{switch(e.key){case"Enter":this.complete();return;case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){let e=this.editor.onlySelectedShape;return{shape:e}}updateShapes(){let e=this.snapshot.shape;if(!e)return;let{originPagePoint:t,currentPagePoint:r}=this.editor.inputs,n=r.clone().sub(t),i=getTranslateCroppedImageChange(this.editor,e,n);i&&this.editor.updateShapes([i],{squashing:!0})}};let Crop=class Crop extends StateNode{static id="crop";static initial="idle";static children=()=>[Crop_children_Idle_Idle,TranslatingCrop,PointingCrop]};let a2={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};let PointingResizeHandle=class PointingResizeHandle extends StateNode{static id="pointing_resize_handle";info={};updateCursor(){let e=this.editor.selectedShapes,t=a2[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:1===e.length?e[0].rotation:0}})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{let e=this.editor.inputs.isDragging;e&&this.parent.transition("resizing",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}};let Cropping=class Cropping extends StateNode{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){let e=this.editor.selectedShapes[0];if(!e)return;let t=a2[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){let{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e)return;let r=this.editor.getShapeUtil("image");if(!r)return;let n=e.props,i=this.editor.inputs.currentPagePoint.clone().sub(t),o=this.editor.inputs.originPagePoint.clone().sub(t),a=i.clone().sub(o).rot(-e.rotation),l=n.crop??this.getDefaultCrop(),d=deepCopy(l),c=new Vec2d_Vec2d(e.x,e.y),u=new Vec2d_Vec2d(0,0),p=1/(l.bottomRight.x-l.topLeft.x)*n.w,h=1/(l.bottomRight.y-l.topLeft.y)*n.h,f=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(h<8)break;f=!0,d.topLeft.y=d.topLeft.y+a.y/h;let e=h*(d.bottomRight.y-d.topLeft.y);e<8?(d.topLeft.y=d.bottomRight.y-8/h,u.y=(d.topLeft.y-l.topLeft.y)*h):d.topLeft.y<=0?(d.topLeft.y=0,u.y=(d.topLeft.y-l.topLeft.y)*h):u.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(h<8)break;f=!0,d.bottomRight.y=Math.min(1,d.bottomRight.y+a.y/h);let e=h*(d.bottomRight.y-d.topLeft.y);e<8&&(d.bottomRight.y=d.topLeft.y+8/h)}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(p<8)break;f=!0,d.topLeft.x=d.topLeft.x+a.x/p;let e=p*(d.bottomRight.x-d.topLeft.x);e<8?(d.topLeft.x=d.bottomRight.x-8/p,u.x=(d.topLeft.x-l.topLeft.x)*p):d.topLeft.x<=0?(d.topLeft.x=0,u.x=(d.topLeft.x-l.topLeft.x)*p):u.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(p<8)break;f=!0,d.bottomRight.x=Math.min(1,d.bottomRight.x+a.x/p);let e=p*(d.bottomRight.x-d.topLeft.x);e<8&&(d.bottomRight.x=d.topLeft.x+8/p)}}if(!f)return;c.add(u.rot(e.rotation));let g={id:e.id,type:e.type,x:c.x,y:c.y,props:{crop:d,w:(d.bottomRight.x-d.topLeft.x)*p,h:(d.bottomRight.y-d.topLeft.y)*h}};this.editor.updateShapes([g],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}createSnapshot(){let{selectionRotation:e,inputs:{originPagePoint:t}}=this.editor,r=this.editor.onlySelectedShape,n=this.editor.selectionRotatedPageBounds,i=Vec2d_Vec2d.RotWith(n.getHandlePoint(this.info.handle),n.point,e),o=Vec2d_Vec2d.Sub(t,i);return{shape:r,cursorHandleOffset:o}}};let DraggingHandle=class DraggingHandle extends StateNode{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{let{shape:t,isCreating:r,handle:n}=e;this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.shapeId=t.id,this.markId=r?`creating:${t.id}`:"dragging handle",r||this.editor.mark(this.markId),this.initialHandle=deepCopy(n),this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:r?"cross":"grabbing",rotation:0}},{ephemeral:!0});let i=this.editor.getShapeHandles(t).sort(reordering_sortByIndex),o=i.findIndex(t=>t.id===e.handle.id);this.initialAdjacentHandle=null;for(let t=o+1;t<i.length;t++){let r=i[t];if("vertex"===r.type&&"middle"!==r.id&&r.id!==e.handle.id){this.initialAdjacentHandle=r;break}}if(!this.initialAdjacentHandle)for(let t=i.length-1;t>=0;t--){let r=i[t];if("vertex"===r.type&&"middle"!==r.id&&r.id!==e.handle.id){this.initialAdjacentHandle=r;break}}let a=t.props[e.handle.id];this.isPrecise=!1,a?.type==="binding"?(this.editor.setHintingShapes([a.boundShapeId]),this.isPrecise=!Vec2d_Vec2d.Equals(a.normalizedAnchor,{x:.5,y:.5}),this.isPrecise?this.isPreciseId=a.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.isActive&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.currentToolIdMask=void 0,this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};complete(){this.editor.snaps.clear();let{onInteractionEnd:e}=this.info;if(this.editor.instanceState.isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle",{})}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();let{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle",{})}update(){let{editor:e,shapeId:t,initialPagePoint:r}=this,{initialHandle:n,initialPageRotation:i,initialAdjacentHandle:o}=this,{user:{isSnapMode:a},hintingShapeIds:l,snaps:d,inputs:{currentPagePoint:c,shiftKey:u,ctrlKey:p,altKey:h,pointerVelocity:f}}=e,g=e.getShape(t);if(!g)return;let m=e.getShapeUtil(g),y=c.clone().sub(r).rot(-i).add(n);if(u&&o&&"middle"!==n.id){let e=Vec2d_Vec2d.Angle(o,y),t=snapAngle(e,24),r=t-e;y=Vec2d_Vec2d.RotWith(y,o,r)}if(e.snaps.clear(),n.canSnap&&(a?!p:p)){let t=e.getShapePageTransform(g.id);if(!t)throw Error("Expected a page transform");let r=e.getShapeHandles(g).filter(({type:e})=>"vertex"===e).sort(reordering_sortByIndex).findIndex(({index:e})=>n.index===e),i=m.getOutlineSegments(g).map(e=>Matrix2d.applyToPoints(t,e)).filter((e,t)=>t!==r-1&&t!==r),o=d.getSnappingHandleDelta({additionalSegments:i,handlePoint:Matrix2d.applyToPoint(t,y)});o&&(o.rot(-e.getShapeParentTransform(g).rotation()),y.add(o))}let b=m.onHandleChange?.(g,{handle:{...n,x:y.x,y:y.y},isPrecise:this.isPrecise||h}),v={...g,...b};if(n.canBind){let t=v.props[n.id];t?.type==="binding"?l[0]!==t.boundShapeId&&(e.setHintingShapes([t.boundShapeId]),this.pointingId=t.boundShapeId,this.isPrecise=.5>f.len()||h,this.isPreciseId=this.isPrecise?t.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}b&&e.updateShapes([v],{squashing:!0})}};let EditingShape=class EditingShape extends StateNode{static id="editing_shape";onEnter=()=>{let{editingShape:e}=this.editor;if(!e)throw Error("Entered editing state without an editing shape");updateHoveredId(this.editor),this.editor.select(e)};onExit=()=>{let{editingShapeId:e}=this.editor.currentPageState;if(!e)return;this.editor.setEditingShape(null);let t=this.editor.getShape(e),r=this.editor.getShapeUtil(t);r.onEditEnd?.(t),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)};onPointerMove=e=>{switch(e.target){case"shape":case"canvas":updateHoveredId(this.editor);return}};onPointerDown=e=>{switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}break}case"shape":{let{shape:t}=e,{editingShape:r}=this.editor;if(!r)throw Error("Expected an editing shape!");if(t.type===r.type){if(this.editor.isShapeOfType(t,"geo")||this.editor.isShapeOfType(t,"arrow")){let n=this.editor.getShapeUtil(t).getGeometry(t),i=n.children[1];if(i){let n=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(i.bounds.containsPoint(n)){if(t.id===r.id)return;this.parent.transition("pointing_shape",e);return}}}else{t.id===r.id?this.editor.isShapeOfType(t,"frame")&&this.editor.setEditingShape(null):this.parent.transition("pointing_shape",e);return}}}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}};function getShouldEnterCropMode(e){let{onlySelectedShape:t}=e;return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function selectOnCanvasPointerUp(e){let{selectedShapeIds:t}=e,{shiftKey:r,altKey:n,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:nv/e.zoomLevel,hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){let i=e.getOutermostSelectableShape(o);if(r&&!n)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let r;(r=i===o?o:i.id===e.focusedGroupId||t.includes(i.id)?o:i)&&!t.includes(r.id)&&(e.mark("selecting shape"),e.select(r.id))}}else{if(r)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());let{focusedGroupId:r}=e;if(isShapeId(r)){let t=e.getShape(r);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}let SelectTool_children_Idle_Idle=class SelectTool_children_Idle_Idle extends StateNode{static id="idle";onEnter=()=>{this.parent.currentToolIdMask=void 0,updateHoveredId(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{updateHoveredId(this.editor)};onPointerDown=e=>{if(this.editor.isMenuOpen)return;let t=e.ctrlKey&&getShouldEnterCropMode(this.editor);if(e.ctrlKey&&!t){if("shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}let{onlySelectedShape:r,selectedShapeIds:n,inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&isPointInRotatedSelectionBounds(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":if(this.editor.isShapeOrAncestorLocked(e.shape))break;this.parent.transition("pointing_shape",e);break;case"handle":if(this.editor.instanceState.isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{let{hoveredShape:t}=this.editor;if(t&&!this.editor.selectedShapeIds.includes(t.id)){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}};onDoubleClick=e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{let{hoveredShape:t}=this.editor,r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:nv/this.editor.zoomLevel,hitInside:!1}),{focusedGroupId:n}=this.editor;if(r){if(this.editor.isShapeOfType(r,"group")){selectOnCanvasPointerUp(this.editor);return}{let e=this.editor.getShape(r.parentId);if(e&&this.editor.isShapeOfType(e,"group")){if(n&&e.id===n);else{selectOnCanvasPointerUp(this.editor);return}}}this.onDoubleClick({...e,shape:r,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.instanceState.isReadonly)break;let{onlySelectedShape:t}=this.editor;if(t){let r=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let e=r.onDoubleClickEdge?.(t);if(e){this.editor.mark("double click edge"),this.editor.updateShapes([e]);return}}if(r.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}break}case"shape":{let{shape:t}=e,r=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.instanceState.isReadonly)break;if(r.onDoubleClick){let n=r.onDoubleClick?.(t);if(n){this.editor.updateShapes([n]);return}if(r.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(t)?this.startEditingShape(t,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.instanceState.isReadonly)break;let{shape:t,handle:r}=e,n=this.editor.getShapeUtil(t),i=n.onDoubleClickHandle?.(t,r);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}}};onRightClick=e=>{switch(e.target){case"canvas":{let{hoveredShape:t}=this.editor,r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:nv/this.editor.zoomLevel,hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}let{onlySelectedShape:n,selectedShapeIds:i,inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||n&&!this.editor.getShapeUtil(n).hideSelectionBoundsBg(n))&&isPointInRotatedSelectionBounds(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.currentPageState,{shape:r}=e,n=this.editor.getOutermostSelectableShape(r,e=>!t.includes(e.id));t.includes(n.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([n.id]))}}};onCancel=()=>{this.editor.focusedGroupId!==this.editor.currentPageId&&this.editor.selectedShapeIds.length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1)}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}};onKeyUp=e=>{if("Enter"===e.code){let{selectedShapes:t}=this.editor;if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let{onlySelectedShape:r}=this.editor;if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r});return}getShouldEnterCropMode(this.editor)&&this.parent.transition("crop",e)}};shouldStartEditingShape(e=this.editor.onlySelectedShape){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;handleDoubleClickOnCanvas(e){if(this.editor.instanceState.isReadonly)return;this.editor.mark("creating text shape");let t=createShapeId(),{x:r,y:n}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:n,props:{text:"",autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.instanceState.isReadonly||o.canEditInReadOnly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),n=new Vec2d_Vec2d(0,0);if(t.has("ArrowLeft")&&(n.x-=1),t.has("ArrowRight")&&(n.x+=1),t.has("ArrowUp")&&(n.y-=1),t.has("ArrowDown")&&(n.y+=1),n.equals(new Vec2d_Vec2d(0,0)))return;e||this.editor.mark("nudge shapes");let{gridSize:i}=this.editor.documentSettings,o=this.editor.instanceState.isGridMode?r?i*a4:i:r?a3:a5;this.editor.nudgeShapes(this.editor.selectedShapeIds,n.mul(o))}canInteractWithShapeInReadOnly(e){if(!this.editor.instanceState.isReadonly)return!0;let t=this.editor.getShapeUtil(e);return!!t.canEditInReadOnly(e)}};let a3=10,a5=1,a4=5;function isPointInRotatedSelectionBounds(e,t){let{selectionRotatedPageBounds:r}=e;if(!r)return!1;let{selectionRotation:n}=e;return n?pointInPolygon(t,r.corners.map(e=>Vec2d_Vec2d.RotWith(e,r.point,n))):r.containsPoint(t)}let PointingCanvas=class PointingCanvas extends StateNode{static id="pointing_canvas";onEnter=()=>{let{inputs:e}=this.editor;!e.shiftKey&&this.editor.selectedShapeIds.length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{selectOnCanvasPointerUp(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle",{})};complete(){this.parent.transition("idle",{})}};let PointingCropHandle=class PointingCropHandle extends StateNode{static id="pointing_crop_handle";info={};updateCursor(e){let t=a2[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}onEnter=e=>{this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd;let t=this.editor.selectedShapes[0];t&&(this.updateCursor(t),this.editor.setCroppingShape(t.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.currentToolIdMask=void 0};onPointerMove=()=>{let e=this.editor.inputs.isDragging;e&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})};onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle",{}))}};let PointingHandle=class PointingHandle extends StateNode{static id="pointing_handle";info={};onEnter=e=>{this.info=e;let t=e.shape.props[e.handle.id];t?.type==="binding"&&this.editor.setHintingShapes([t.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerUp=()=>{this.parent.transition("idle",this.info)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle",{})}};let PointingRotateHandle=class PointingRotateHandle extends StateNode{static id="pointing_rotate_handle";info={};updateCursor(){let{selectionRotation:e}=this.editor;this.editor.updateInstanceState({cursor:{type:a2[this.info.handle],rotation:e}})}onEnter=e=>{this.parent.currentToolIdMask=e.onInteractionEnd,this.info=e,this.updateCursor()};onExit=()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{let{isDragging:e}=this.editor.inputs;e&&this.parent.transition("rotating",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}};let PointingSelection=class PointingSelection extends StateNode{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{selectOnCanvasPointerUp(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.instanceState.isReadonly&&this.parent.transition("translating",e)};onDoubleClick=e=>{let{hoveredShape:t}=this.editor,r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(r){this.parent.transition("idle",{}),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(r)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle",{})}};let PointingShape=class PointingShape extends StateNode{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};didSelectOnEnter=!1;onEnter=e=>{let{selectedShapeIds:t,focusedGroupId:r,selectionRotatedPageBounds:n,inputs:{currentPagePoint:i,shiftKey:o,altKey:a}}=this.editor;this.hitShape=e.shape;let l=this.editor.getOutermostSelectableShape(e.shape);if(this.editor.getShapeUtil(e.shape).onClick||l.id===r||t.includes(l.id)||this.editor.isAncestorSelected(l.id)||t.length>1&&n?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=l;return}this.didSelectOnEnter=!0,o&&!a?(this.editor.cancelDoubleClick(),t.includes(l.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,l.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([l.id]))};onPointerUp=e=>{let{zoomLevel:t,focusedGroupId:r,selectedShapeIds:n,inputs:{currentPagePoint:i,shiftKey:o}}=this.editor,a=this.editor.getShapeAtPoint(i,{margin:nv/t,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){let t=this.editor.getShapeUtil(l);if(t.onClick){let r=t.onClick?.(l);if(r){this.editor.mark("shape on click"),this.editor.updateShapes([r]),this.parent.transition("idle",e);return}}if(l.id===r){n.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){let e=this.editor.getOutermostSelectableShape(a,e=>!n.includes(e.id));if(n.includes(e.id)){if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(n.includes(l.id)){if(1===n.length&&(this.editor.isShapeOfType(l,"geo")||this.editor.isShapeOfType(l,"arrow"))){let e=this.editor.getShapeGeometry(l),t=e.children[1];if(t){let e=this.editor.getPointInShapeSpace(l,i);if(t.bounds.containsPoint(e,0)&&t.hitTestPoint(e)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);let e=this.editor.getShapeUtil(l);(!this.editor.instanceState.isReadonly||e.canEditInReadOnly(l))&&(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l)}else if(o){let t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.selectedShapeIds.filter(e=>!t.find(t=>t.id===e)),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.instanceState.isReadonly&&this.parent.transition("translating",e)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle",{})}};let Resizing=class Resizing extends StateNode{static id="resizing";info={};markId="";creationCursorOffset={x:0,y:0};editAfterComplete=!1;snapshot={};onEnter=e=>{let{isCreating:t=!1,editAfterComplete:r=!1,creationCursorOffset:n={x:0,y:0}}=e;this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.editAfterComplete=r,this.creationCursorOffset=n,e.isCreating&&this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0}),this.snapshot=this._createSnapshot(),this.markId=t?`creating:${this.editor.onlySelectedShape.id}`:"starting resizing",t||this.editor.mark(this.markId),this.handleResizeStart(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}complete(){if(this.handleResizeEnd(),this.editAfterComplete&&this.editor.onlySelectedShape){this.editor.setEditingShape(this.editor.onlySelectedShape.id),this.editor.setCurrentTool("select.editing_shape");return}if(this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle",{})}handleResizeStart(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let r=this.editor.getShapeUtil(e),n=r.onResizeStart?.(e);n&&t.push(n)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let r=this.editor.getShape(e.id),n=this.editor.getShapeUtil(e),i=n.onResizeEnd?.(e,r);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{altKey:e,shiftKey:t}=this.editor.inputs,{shapeSnapshots:r,selectionBounds:n,cursorHandleOffset:i,selectedShapeIds:o,selectionRotation:a,canShapesDeform:l}=this.snapshot,d=t||!l,{ctrlKey:c}=this.editor.inputs,u=this.editor.inputs.currentPagePoint.clone().sub(i).sub(this.creationCursorOffset),p=this.editor.inputs.originPagePoint.clone().sub(i);if(this.editor.instanceState.isGridMode&&!c){let{gridSize:e}=this.editor.documentSettings;u.snapToGrid(e)}let h=this.info.handle,f=Resizing_rotateSelectionHandle(h,Math.PI);this.editor.snaps.clear();let g=this.editor.user.isSnapMode?!c:c;if(g&&a%r6==0){let{nudge:t}=this.editor.snaps.snapResize({dragDelta:Vec2d_Vec2d.Sub(u,p),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Resizing_rotateSelectionHandle(h,a),isAspectRatioLocked:d,isResizingFromCenter:e});u.add(t)}let m=Vec2d_Vec2d.RotWith(e?n.center:n.getHandlePoint(f),n.point,a),y=Vec2d_Vec2d.Sub(u,m).rot(-a),b=Vec2d_Vec2d.Sub(p,m).rot(-a),v=Vec2d_Vec2d.DivV(y,b);Number.isFinite(v.x)||(v.x=1),Number.isFinite(v.y)||(v.y=1);let S="top"===h||"bottom"===h,x="left"===h||"right"===h;for(let e of(d?x?v.y=Math.abs(v.x):S?v.x=Math.abs(v.y):Math.abs(v.x)>Math.abs(v.y)?v.y=Math.abs(v.x)*(v.y<0?-1:1):v.x=Math.abs(v.y)*(v.x<0?-1:1):(S&&(v.x=1),x&&(v.y=1)),this.info.isCreating||this.updateCursor({dragHandle:h,isFlippedX:v.x<0,isFlippedY:v.y<0,rotation:a}),r.keys())){let t=r.get(e);this.editor.resizeShape(e,v,{initialShape:t.shape,initialBounds:t.bounds,initialPageTransform:t.pageTransform,dragHandle:h,mode:1===o.length&&e===o[0]?"resize_bounds":"scale_shape",scaleOrigin:m,scaleAxisRotation:a})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:r,rotation:n}){let i={...this.editor.instanceState.cursor};switch(e){case"top_left":case"bottom_right":i.type="nwse-resize",t!==r&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",t!==r&&(i.type="nwse-resize")}i.rotation=n,this.editor.setCursor(i)}onExit=()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()};_createSnapshot=()=>{let{selectedShapeIds:e,selectionRotation:t,inputs:{originPagePoint:r}}=this.editor,n=this.editor.selectionRotatedPageBounds,i=Vec2d_Vec2d.RotWith(n.getHandlePoint(this.info.handle),n.point,t),o=Vec2d_Vec2d.Sub(r,i),a=new Map;e.forEach(t=>{let r=this.editor.getShape(t);if(r){if(a.set(r.id,this._createShapeSnapshot(r)),this.editor.isShapeOfType(r,"frame")&&1===e.length)return;this.editor.visitDescendants(r.id,e=>{let t=this.editor.getShape(e);if(t&&(a.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1})}});let l=![...a.values()].some(e=>!areAnglesCompatible(e.pageRotation,t)||e.isAspectRatioLocked);return{shapeSnapshots:a,selectionBounds:n,cursorHandleOffset:o,selectionRotation:t,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.selectionPageBounds}};_createShapeSnapshot=e=>{let t=this.editor.getShapePageTransform(e),r=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:Matrix2d.Decompose(t).rotation,isAspectRatioLocked:r.isAspectRatioLocked(e)}}};let a8=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Resizing_rotateSelectionHandle(e,t){t%=r9;let r=Math.round(t/(r8/4)),n=a8.indexOf(e);return a8[(n+r)%a8.length]}let Rotating=class Rotating extends StateNode{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.markId="rotate start",this.editor.mark(this.markId);let t=getRotationSnapshot({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t,this.handleStart()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.currentToolIdMask=void 0,this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});applyRotationToSnapshotShapes({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:a2[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{applyRotationToSnapshotShapes({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};handleStart(){let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});applyRotationToSnapshotShapes({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:a2[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:e}){let{selectionRotatedPageBounds:t,selectionRotation:r,inputs:{shiftKey:n,currentPagePoint:i}}=this.editor,{initialCursorAngle:o,initialSelectionRotation:a}=this.snapshot;if(!t)return a;let l=t.center.clone().rotWith(t.point,r),d=l.angle(i)-o,c=a+d;if(n)c=snapAngle(c,24);else if(e&&(c=Math.round(c/r7)*r7,this.editor.instanceState.isCoarsePointer)){let e=snapAngle(c,4),t=shortAngleDist(c,e);Math.abs(t)<degreesToRadians(5)&&(c=e)}return c-a}};let ScribbleBrushing=class ScribbleBrushing extends StateNode{static id="scribble_brushing";hits=new Set;size=0;scribble={};initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.selectedShapeIds:[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear(),this.startScribble(),this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})};onExit=()=>{this.scribble.stop()};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing",{})};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};startScribble=()=>{this.scribble.tick&&this.editor.off("tick",this.scribble?.tick),this.scribble=new ScribbleManager({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"selection-stroke",opacity:.32,size:12}),this.editor.on("tick",this.scribble.tick)};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(e,t)};onScribbleUpdate=e=>{this.editor.updateInstanceState({scribble:e})};onScribbleComplete=()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})};updateScribbleSelection(e){let t,r,n,i;let{zoomLevel:o,currentPageShapes:a,inputs:{shiftKey:l,originPagePoint:d,previousPagePoint:c,currentPagePoint:u}}=this.editor,{newlySelectedShapeIds:p,initialSelectedShapeIds:h}=this;e&&this.pushPointToScribble();for(let e=0,l=a.length;e<l;e++)if(t=a[e],r=this.editor.getShapeGeometry(t),!(this.editor.isShapeOfType(t,"group")||p.has(t.id)||this.editor.isShapeOrAncestorLocked(t))){if(this.editor.isShapeOfType(t,"frame")){let e=this.editor.getPointInShapeSpace(t,d);if(r.bounds.containsPoint(e))continue}if(n=this.editor.getPointInShapeSpace(t,c),i=this.editor.getPointInShapeSpace(t,u),r.hitTestLineSegment(n,i,nv/o)){let e=this.editor.getOutermostSelectableShape(t),r=this.editor.getShapeMask(e.id);if(r){let e=intersectLineSegmentPolyline(c,u,r);if(null!==e){let e=pointInPolygon(u,r);if(!e)continue}}p.add(e.id)}}this.editor.setSelectedShapes([...new Set(l?[...p,...h]:[...p])],{squashing:!0})}complete(){this.parent.transition("idle",{})}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle",{})}};let DragAndDropManager=class DragAndDropManager{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,t){this.first&&(this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,1e3,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){t=compact(t.map(e=>this.editor.getShape(e.id)));let n=this.editor.getDroppingOverShape(e,t)?.id??null;if(n===this.prevDroppingShapeId)return;let{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),a=n&&this.editor.getShape(n);if(o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,t),a){let e=this.editor.getShapeUtil(a).onDragShapesOver?.(a,t);e&&e.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);r?.(),this.prevDroppingShapeId=n}dropShapes(e){let{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){let r=this.editor.getShape(t);if(!r)return;this.editor.getShapeUtil(r).onDropShapesOver?.(r,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}};let Translating=class Translating extends StateNode{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;editAfterComplete=!1;dragAndDropManager=new DragAndDropManager(this.editor);onEnter=e=>{let{isCreating:t=!1,editAfterComplete:r=!1}=e;if(this.info=e,this.parent.currentToolIdMask=e.onInteractionEnd,this.isCreating=t,this.editAfterComplete=r,this.markId=t?`creating:${this.editor.onlySelectedShape.id}`:"translating",this.editor.mark(this.markId),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=getTranslatingSnapshot(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes(),this.editor.on("tick",this.updateParent)};onExit=()=>{this.parent.currentToolIdMask=void 0,this.editor.off("tick",this.updateParent),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.selectedShapeIds)),this.snapshot=getTranslatingSnapshot(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}updateParent=()=>{let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms)};reset(){this.editor.bailToMark(this.markId)}complete(){if(this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd)this.editor.setCurrentTool(this.info.onInteractionEnd);else if(this.editAfterComplete){let e=this.editor.onlySelectedShape;e&&(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape"))}else this.parent.transition("idle",{})}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let r=this.editor.getShapeUtil(e),n=r.onTranslateStart?.(e);n&&t.push(n)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let r=this.editor.getShape(e.id),n=this.editor.getShapeUtil(e),i=n.onTranslateEnd?.(e,r);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}handleChange(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let r=this.editor.getShape(e.id),n=this.editor.getShapeUtil(e),i=n.onTranslate?.(e,r);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),moveShapesToPoint({editor:this.editor,shapeSnapshots:e.shapeSnapshots,averagePagePoint:e.averagePagePoint,initialSelectionPageBounds:e.initialPageBounds,initialSelectionSnapPoints:e.initialSnapPoints}),this.handleChange()}updateParentTransforms=()=>{let{editor:e,snapshot:{shapeSnapshots:t}}=this,r=[];t.forEach(t=>{let n=e.getShape(t.shape.id);if(!n)return null;r.push(n);let i=isPageId(n.parentId)?null:Matrix2d.Inverse(e.getShapePageTransform(n.parentId));t.parentTransform=i})}};function getTranslatingSnapshot(e){let t=[],r=[],n=compact(e.selectedShapeIds.map(n=>{let i=e.getShape(n);if(!i)return null;t.push(i);let o=e.getShapePageTransform(n).point();if(!o)return null;r.push(o);let a=tp.isId(i.parentId)?null:Matrix2d.Inverse(e.getShapePageTransform(i.parentId));return{shape:i,pagePoint:o,parentTransform:a}}));return{averagePagePoint:Vec2d_Vec2d.Average(r),movingShapes:t,shapeSnapshots:n,initialPageBounds:e.selectionPageBounds,initialSnapPoints:1===e.selectedShapeIds.length?e.snaps.snapPointsCache.get(e.selectedShapeIds[0]):e.selectionPageBounds?e.selectionPageBounds.snapPoints.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})):[]}}function moveShapesToPoint({editor:e,shapeSnapshots:t,averagePagePoint:r,initialSelectionPageBounds:n,initialSelectionSnapPoints:i}){let{inputs:o,instanceState:{isGridMode:a},documentSettings:{gridSize:l}}=e,d=Vec2d_Vec2d.Sub(o.currentPagePoint,o.originPagePoint),c=e.inputs.shiftKey?Math.abs(d.x)<Math.abs(d.y)?"x":"y":null;"x"===c?d.x=0:"y"===c&&(d.y=0),e.snaps.clear();let u=(e.user.isSnapMode?!o.ctrlKey:o.ctrlKey)&&.5>e.inputs.pointerVelocity.len();if(u){let{nudge:t}=e.snaps.snapTranslate({dragDelta:d,initialSelectionPageBounds:n,lockedAxis:c,initialSelectionSnapPoints:i});d.add(t)}let p=Vec2d_Vec2d.Add(r,d);a&&!o.ctrlKey&&p.snapToGrid(l);let h=Vec2d_Vec2d.Sub(p,r);e.updateShapes(compact(t.map(({shape:e,pagePoint:t,parentTransform:r})=>{let n=Vec2d_Vec2d.Add(t,h),i=r?Matrix2d.applyToPoint(r,n):n;return{id:e.id,type:e.type,x:i.x,y:i.y}})),{squashing:!0})}let SelectTool=class SelectTool extends StateNode{static id="select";static initial="idle";static children=()=>[Crop,Cropping,SelectTool_children_Idle_Idle,PointingCanvas,PointingShape,Translating,Brushing,ScribbleBrushing,PointingCropHandle,PointingSelection,PointingResizeHandle,EditingShape,Resizing,Rotating,PointingRotateHandle,PointingHandle,DraggingHandle];onExit=()=>{this.editor.currentPageState.editingShapeId&&this.editor.setEditingShape(null)}};let ZoomTool_children_Idle_Idle=class ZoomTool_children_Idle_Idle extends StateNode{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}};let ZoomTool_children_Pointing_Pointing=class ZoomTool_children_Pointing_Pointing extends StateNode{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){let{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}};let ZoomBrushing=class ZoomBrushing extends StateNode{static id="zoom_brushing";info={};zoomBrush=new Box2d_Box2d;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(Box2d_Box2d.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.zoomLevel;if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220})}else{let t=this.editor.inputs.altKey?this.editor.zoomLevel/2:void 0;this.editor.zoomToBounds(e,t,{duration:220})}this.parent.transition("idle",this.info)}};let ZoomTool=class ZoomTool extends StateNode{static id="zoom";static initial="idle";static children=()=>[ZoomTool_children_Idle_Idle,ZoomBrushing,ZoomTool_children_Pointing_Pointing];info={};onEnter=e=>{this.info=e,this.currentToolIdMask=e.onInteractionEnd,this.updateCursor()};onExit=()=>{this.currentToolIdMask=void 0,this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.currentToolIdMask=void 0};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select",{})}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}};let a6=[EraserTool,HandTool,LaserTool,ZoomTool,SelectTool],a9=(0,T.forwardRef)((e,t)=>(0,T.createElement)(O.span,_extends({},e,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}))),a7="ToastProvider",[se,st,sr]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2("Toast"),[sn,si]=$c512c27ab02ef895$export$50c7b4e9d9f19c1("Toast",[sr]),[so,sa]=sn(a7),$054eb8030ebde76e$export$f5d03d415824e0e=e=>{let{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:a}=e,[l,d]=(0,T.useState)(null),[c,u]=(0,T.useState)(0),p=(0,T.useRef)(!1),h=(0,T.useRef)(!1);return(0,T.createElement)(se.Provider,{scope:t},(0,T.createElement)(so,{scope:t,label:r,duration:n,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:l,onViewportChange:d,onToastAdd:(0,T.useCallback)(()=>u(e=>e+1),[]),onToastRemove:(0,T.useCallback)(()=>u(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:h},a))};$054eb8030ebde76e$export$f5d03d415824e0e.propTypes={label(e){if(e.label&&"string"==typeof e.label&&!e.label.trim()){let e=`Invalid prop \`label\` supplied to \`${a7}\`. Expected non-empty \`string\`.`;return Error(e)}return null}};let ss=["F8"],sl="toast.viewportPause",sd="toast.viewportResume",sc=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,hotkey:n=ss,label:i="Notifications ({hotkey})",...o}=e,a=sa("ToastViewport",r),l=st(r),d=(0,T.useRef)(null),c=(0,T.useRef)(null),u=(0,T.useRef)(null),p=(0,T.useRef)(null),h=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,p,a.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=a.toastCount>0;(0,T.useEffect)(()=>{let handleKeyDown=e=>{var t;let r=n.every(t=>e[t]||e.code===t);r&&(null===(t=p.current)||void 0===t||t.focus())};return document.addEventListener("keydown",handleKeyDown),()=>document.removeEventListener("keydown",handleKeyDown)},[n]),(0,T.useEffect)(()=>{let e=d.current,t=p.current;if(g&&e&&t){let handlePause=()=>{if(!a.isClosePausedRef.current){let e=new CustomEvent(sl);t.dispatchEvent(e),a.isClosePausedRef.current=!0}},handleResume=()=>{if(a.isClosePausedRef.current){let e=new CustomEvent(sd);t.dispatchEvent(e),a.isClosePausedRef.current=!1}},handleFocusOutResume=t=>{let r=!e.contains(t.relatedTarget);r&&handleResume()},handlePointerLeaveResume=()=>{let t=e.contains(document.activeElement);t||handleResume()};return e.addEventListener("focusin",handlePause),e.addEventListener("focusout",handleFocusOutResume),e.addEventListener("pointermove",handlePause),e.addEventListener("pointerleave",handlePointerLeaveResume),window.addEventListener("blur",handlePause),window.addEventListener("focus",handleResume),()=>{e.removeEventListener("focusin",handlePause),e.removeEventListener("focusout",handleFocusOutResume),e.removeEventListener("pointermove",handlePause),e.removeEventListener("pointerleave",handlePointerLeaveResume),window.removeEventListener("blur",handlePause),window.removeEventListener("focus",handleResume)}}},[g,a.isClosePausedRef]);let m=(0,T.useCallback)(({tabbingDirection:e})=>{let t=l(),r=t.map(t=>{let r=t.ref.current,n=[r,...$054eb8030ebde76e$var$getTabbableCandidates(r)];return"forwards"===e?n:n.reverse()});return("forwards"===e?r.reverse():r).flat()},[l]);return(0,T.useEffect)(()=>{let e=p.current;if(e){let handleKeyDown=t=>{let r=t.altKey||t.ctrlKey||t.metaKey,n="Tab"===t.key&&!r;if(n){var i,o,a;let r=document.activeElement,n=t.shiftKey,l=t.target===e;if(l&&n){null===(i=c.current)||void 0===i||i.focus();return}let d=m({tabbingDirection:n?"backwards":"forwards"}),p=d.findIndex(e=>e===r);$054eb8030ebde76e$var$focusFirst(d.slice(p+1))?t.preventDefault():n?null===(o=c.current)||void 0===o||o.focus():null===(a=u.current)||void 0===a||a.focus()}};return e.addEventListener("keydown",handleKeyDown),()=>e.removeEventListener("keydown",handleKeyDown)}},[l,m]),(0,T.createElement)(z,{ref:d,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&(0,T.createElement)(su,{ref:c,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"forwards"});$054eb8030ebde76e$var$focusFirst(e)}}),(0,T.createElement)(se.Slot,{scope:r},(0,T.createElement)(O.ol,_extends({tabIndex:-1},o,{ref:h}))),g&&(0,T.createElement)(su,{ref:u,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"backwards"});$054eb8030ebde76e$var$focusFirst(e)}}))}),su=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,onFocusFromOutsideViewport:n,...i}=e,o=sa("ToastFocusProxy",r);return(0,T.createElement)(a9,_extends({"aria-hidden":!0,tabIndex:0},i,{ref:t,style:{position:"fixed"},onFocus:e=>{var t;let r=e.relatedTarget,i=!(null!==(t=o.viewport)&&void 0!==t&&t.contains(r));i&&n()}}))}),sp="Toast",sh=(0,T.forwardRef)((e,t)=>{let{forceMount:r,open:n,defaultOpen:i,onOpenChange:o,...a}=e,[l=!0,d]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:n,defaultProp:i,onChange:o});return(0,T.createElement)($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:r||l},(0,T.createElement)(sm,_extends({open:l},a,{ref:t,onClose:()=>d(!1),onPause:$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e.onPause),onResume:$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e.onResume),onSwipeStart:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onSwipeMove,e=>{let{x:t,y:r}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${r}px`)}),onSwipeCancel:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onSwipeEnd,e=>{let{x:t,y:r}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${r}px`),d(!1)})})))}),[sf,sg]=sn(sp,{onClose(){}}),sm=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,type:n="foreground",duration:i,open:o,onClose:a,onEscapeKeyDown:l,onPause:d,onResume:c,onSwipeStart:u,onSwipeMove:p,onSwipeCancel:h,onSwipeEnd:f,...g}=e,m=sa(sp,r),[y,b]=(0,T.useState)(null),v=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>b(e)),S=(0,T.useRef)(null),x=(0,T.useRef)(null),w=i||m.duration,_=(0,T.useRef)(0),P=(0,T.useRef)(w),E=(0,T.useRef)(0),{onToastAdd:C,onToastRemove:k}=m,I=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(()=>{var e;let t=null==y?void 0:y.contains(document.activeElement);t&&(null===(e=m.viewport)||void 0===e||e.focus()),a()}),A=(0,T.useCallback)(e=>{e&&e!==1/0&&(window.clearTimeout(E.current),_.current=new Date().getTime(),E.current=window.setTimeout(I,e))},[I]);(0,T.useEffect)(()=>{let e=m.viewport;if(e){let handleResume=()=>{A(P.current),null==c||c()},handlePause=()=>{let e=new Date().getTime()-_.current;P.current=P.current-e,window.clearTimeout(E.current),null==d||d()};return e.addEventListener(sl,handlePause),e.addEventListener(sd,handleResume),()=>{e.removeEventListener(sl,handlePause),e.removeEventListener(sd,handleResume)}}},[m.viewport,w,d,c,A]),(0,T.useEffect)(()=>{o&&!m.isClosePausedRef.current&&A(w)},[o,w,m.isClosePausedRef,A]),(0,T.useEffect)(()=>(C(),()=>k()),[C,k]);let $=(0,T.useMemo)(()=>y?$054eb8030ebde76e$var$getAnnounceTextContent(y):null,[y]);return m.viewport?(0,T.createElement)(T.Fragment,null,$&&(0,T.createElement)($054eb8030ebde76e$var$ToastAnnounce,{__scopeToast:r,role:"status","aria-live":"foreground"===n?"assertive":"polite","aria-atomic":!0},$),(0,T.createElement)(sf,{scope:r,onClose:I},(0,V.createPortal)((0,T.createElement)(se.ItemSlot,{scope:r},(0,T.createElement)(N,{asChild:!0,onEscapeKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(l,()=>{m.isFocusedToastEscapeKeyDownRef.current||I(),m.isFocusedToastEscapeKeyDownRef.current=!1})},(0,T.createElement)(O.li,_extends({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection},g,{ref:v,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{"Escape"!==e.key||(null==l||l(e.nativeEvent),e.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,I()))}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDown,e=>{0===e.button&&(S.current={x:e.clientX,y:e.clientY})}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,e=>{if(!S.current)return;let t=e.clientX-S.current.x,r=e.clientY-S.current.y,n=!!x.current,i=["left","right"].includes(m.swipeDirection),o=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,a=i?o(0,t):0,l=i?0:o(0,r),d="touch"===e.pointerType?10:2,c={x:a,y:l},h={originalEvent:e,delta:c};n?(x.current=c,$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeMove",p,h,{discrete:!1})):$054eb8030ebde76e$var$isDeltaInDirection(c,m.swipeDirection,d)?(x.current=c,$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeStart",u,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>d||Math.abs(r)>d)&&(S.current=null)}),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerUp,e=>{let t=x.current,r=e.target;if(r.hasPointerCapture(e.pointerId)&&r.releasePointerCapture(e.pointerId),x.current=null,S.current=null,t){let r=e.currentTarget,n={originalEvent:e,delta:t};$054eb8030ebde76e$var$isDeltaInDirection(t,m.swipeDirection,m.swipeThreshold)?$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeEnd",f,n,{discrete:!0}):$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeCancel",h,n,{discrete:!0}),r.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})))),m.viewport))):null});sm.propTypes={type(e){if(e.type&&!["foreground","background"].includes(e.type)){let e=`Invalid prop \`type\` supplied to \`${sp}\`. Expected \`foreground | background\`.`;return Error(e)}return null}};let $054eb8030ebde76e$var$ToastAnnounce=e=>{let{__scopeToast:t,children:r,...n}=e,i=sa(sp,t),[o,a]=(0,T.useState)(!1),[l,d]=(0,T.useState)(!1);return $054eb8030ebde76e$var$useNextFrame(()=>a(!0)),(0,T.useEffect)(()=>{let e=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(e)},[]),l?null:(0,T.createElement)(K,{asChild:!0},(0,T.createElement)(a9,n,o&&(0,T.createElement)(T.Fragment,null,i.label," ",r)))},sy=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,...n}=e;return(0,T.createElement)(O.div,_extends({},n,{ref:t}))}),sb=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,...n}=e;return(0,T.createElement)(O.div,_extends({},n,{ref:t}))}),sv=(0,T.forwardRef)((e,t)=>{let{altText:r,...n}=e;return r?(0,T.createElement)(sx,{altText:r,asChild:!0},(0,T.createElement)(sS,_extends({},n,{ref:t}))):null});sv.propTypes={altText:e=>e.altText?null:Error("Missing prop `altText` expected on `ToastAction`")};let sS=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,...n}=e,i=sg("ToastClose",r);return(0,T.createElement)(sx,{asChild:!0},(0,T.createElement)(O.button,_extends({type:"button"},n,{ref:t,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onClick,i.onClose)})))}),sx=(0,T.forwardRef)((e,t)=>{let{__scopeToast:r,altText:n,...i}=e;return(0,T.createElement)(O.div,_extends({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0},i,{ref:t}))});function $054eb8030ebde76e$var$getAnnounceTextContent(e){let t=[],r=Array.from(e.childNodes);return r.forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),$054eb8030ebde76e$var$isHTMLElement(e)){let r=e.ariaHidden||e.hidden||"none"===e.style.display,n=""===e.dataset.radixToastAnnounceExclude;if(!r){if(n){let r=e.dataset.radixToastAnnounceAlt;r&&t.push(r)}else t.push(...$054eb8030ebde76e$var$getAnnounceTextContent(e))}}}),t}function $054eb8030ebde76e$var$handleAndDispatchCustomEvent(e,t,r,{discrete:n}){let i=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),n?$8927f6f2acc4f386$export$6d1a0317bde7de7f(i,o):i.dispatchEvent(o)}let $054eb8030ebde76e$var$isDeltaInDirection=(e,t,r=0)=>{let n=Math.abs(e.x),i=Math.abs(e.y),o=n>i;return"left"===t||"right"===t?o&&n>r:!o&&i>r};function $054eb8030ebde76e$var$useNextFrame(e=()=>{}){let t=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e);$(()=>{let e=0,r=0;return e=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(r)}},[t])}function $054eb8030ebde76e$var$isHTMLElement(e){return e.nodeType===e.ELEMENT_NODE}function $054eb8030ebde76e$var$getTabbableCandidates(e){let t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function $054eb8030ebde76e$var$focusFirst(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let sw="2.0.0-alpha.17",s_={fonts:{draw:`https://unpkg.com/@tldraw/assets@${sw}/fonts/Shantell_Sans-Normal-SemiBold.woff2`,serif:`https://unpkg.com/@tldraw/assets@${sw}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${sw}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${sw}/fonts/IBMPlexMono-Medium.woff2`}};function setDefaultEditorAssetUrls(e){s_=e}function useDefaultEditorAssetsWithOverrides(e){return(0,T.useMemo)(()=>e?{fonts:{...s_.fonts,...e?.fonts}}:s_,[e])}let sP={...s_,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`https://unpkg.com/@tldraw/assets@${sw}/icons/icon/${e}.svg`])),translations:Object.fromEntries(rq.map(e=>[e.locale,`https://unpkg.com/@tldraw/assets@${sw}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(rp.map(e=>[e.type,`https://unpkg.com/@tldraw/assets@${sw}/embed-icons/${e.type}.png`]))};function setDefaultUiAssetUrls(e){sP=e}function useDefaultUiAssetUrlsWithOverrides(e){return e?{fonts:Object.assign({...sP.fonts},{...e?.fonts}),icons:Object.assign({...sP.icons},{...e?.icons}),embedIcons:Object.assign({...sP.embedIcons},{...e?.embedIcons}),translations:Object.assign({...sP.translations},{...e?.translations})}:sP}let sE=T.forwardRef(function({className:e,label:t,icon:r,iconLeft:n,autoselect:i=!1,autofocus:o=!1,defaultValue:a,placeholder:l,onComplete:d,onValueChange:c,onCancel:u,onBlur:p,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:f,value:g},m){let y=useEditor(),b=T.useRef(null);T.useImperativeHandle(m,()=>b.current);let v=useTranslation(),S=T.useRef(a??""),x=T.useRef(a??""),[w,_]=T.useState(!1),P=T.useCallback(e=>{_(!0);let t=e.currentTarget;x.current=t.value,requestAnimationFrame(()=>{i&&t.select()})},[i]),E=T.useCallback(e=>{let t=e.currentTarget.value;x.current=t,c?.(t)},[c]),C=T.useCallback(e=>{switch(e.key){case"Enter":e.currentTarget.blur(),stopEventPropagation(e),d?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=S.current,e.currentTarget.blur(),stopEventPropagation(e),u?.(e.currentTarget.value)}},[d,u]),k=T.useCallback(e=>{_(!1);let t=e.currentTarget.value;p?.(t)},[p]);return T.useEffect(()=>{if(!y.environment.isIos)return;let e=window.visualViewport;if(w&&h&&e){let onViewportChange=()=>{b.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",onViewportChange),e.addEventListener("scroll",onViewportChange),requestAnimationFrame(()=>{b.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",onViewportChange),e.removeEventListener("scroll",onViewportChange)}}},[y,w,h]),(0,I.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[f,t&&(0,I.jsx)("label",{children:v(t)}),n&&(0,I.jsx)(iN,{icon:n,className:"tlui-icon-left",small:!0}),(0,I.jsx)("input",{ref:b,className:eb("tlui-input",e),type:"text",defaultValue:a,onKeyUp:C,onChange:E,onFocus:P,onBlur:k,autoFocus:o,placeholder:l,value:g}),r&&(0,I.jsx)(iN,{icon:r,small:!!t})]})});function validateUrl(e){return isValidUrl(e)?{isValid:!0,hasProtocol:!0}:isValidUrl("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let sC=track(function({onClose:e}){let t=useEditor(),r=t.onlySelectedShape;return r&&"url"in r.props&&"string"==typeof r.props.url?(0,I.jsx)(sk,{onClose:e,selectedShape:r}):null}),sk=track(function({onClose:e,selectedShape:t}){let r=useEditor(),n=useTranslation(),i=(0,T.useRef)(null);(0,T.useEffect)(()=>{requestAnimationFrame(()=>i.current?.focus())},[]);let o=(0,T.useRef)(t.props.url),[a,l]=(0,T.useState)(()=>{let e=validateUrl(t.props.url),r=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:r,safe:r,valid:!0}}),d=(0,T.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),r=validateUrl(t),n=!0===r.isValid?r.hasProtocol?t:"https://"+t:"https://";l({actual:t,safe:n,valid:r.isValid})},[]),c=(0,T.useCallback)(()=>{let{onlySelectedShape:t}=r;t&&(r.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[r,e]),u=(0,T.useCallback)(()=>{let{onlySelectedShape:t}=r;t&&(t&&"url"in t.props&&t.props.url!==a.safe&&r.updateShapes([{id:t.id,type:t.type,props:{url:a.safe}}]),e())},[r,e,a]),p=(0,T.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let h=o.current&&!a.valid;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Header,{children:[(0,I.jsx)(Title,{children:n("edit-link-dialog.title")}),(0,I.jsx)(CloseButton,{})]}),(0,I.jsx)(Body,{children:(0,I.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,I.jsx)(sE,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:a.actual,onValueChange:d,onComplete:u,onCancel:p}),(0,I.jsx)("div",{children:n(a.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,I.jsxs)(Footer,{className:"tlui-dialog__footer__actions",children:[(0,I.jsx)(iH,{onClick:p,onTouchEnd:p,children:n("edit-link-dialog.cancel")}),h?(0,I.jsx)(iH,{type:"danger",onTouchEnd:c,onClick:c,children:n("edit-link-dialog.clear")}):(0,I.jsx)(iH,{type:"primary",disabled:!a.valid,onTouchEnd:u,onClick:u,children:n("edit-link-dialog.save")})]})]})}),sI=track(function({onClose:e}){let t=useEditor(),r=useTranslation(),n=useAssetUrls(),[i,o]=(0,T.useState)(null),[a,l]=(0,T.useState)(""),[d,c]=(0,T.useState)(null),[u,p]=(0,T.useState)(!1),h=(0,T.useRef)(-1);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Header,{children:[(0,I.jsx)(Title,{children:i?`${r("embed-dialog.title")} \u2014 ${i.title}`:r("embed-dialog.title")}),(0,I.jsx)(CloseButton,{})]}),i?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Body,{className:"tlui-embed-dialog__enter",children:[(0,I.jsx)(sE,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:e=>{l(e);let t=getEmbedInfo(e);c(t&&t.definition.type===i.type?t:null),p(!1),clearTimeout(h.current),h.current=setTimeout(()=>p(!t),320)}}),""===a?(0,I.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,I.jsx)("span",{children:r("embed-dialog.instruction")})," ",i.instructionLink&&(0,I.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,I.jsx)(iN,{icon:"external-link",small:!0})]})]}):(0,I.jsx)("div",{className:"tlui-embed-dialog__warning",children:u?r("embed-dialog.invalid-url"):"\xa0"})]}),(0,I.jsxs)(Footer,{className:"tlui-dialog__footer__actions",children:[(0,I.jsx)(iH,{onClick:()=>{o(null),c(null),l("")},label:"embed-dialog.back"}),(0,I.jsx)("div",{className:"tlui-embed__spacer"}),(0,I.jsx)(iH,{label:"embed-dialog.cancel",onClick:e}),(0,I.jsx)(iH,{type:"primary",disabled:!d,label:"embed-dialog.create",onClick:()=>{d&&(t.putExternalContent({type:"embed",url:a,point:t.viewportPageCenter,embed:d.definition}),e())}})]})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Body,{className:"tlui-embed-dialog__list",children:rp.map(e=>(0,I.jsxs)("button",{className:"tlui-embed-dialog__item",onClick:()=>o(e),children:[(0,I.jsx)("div",{className:"tlui-embed-dialog__item__image",children:(0,I.jsx)("div",{className:"tlui-embed-dialog__item__image__img",style:{backgroundImage:`url(${n.embedIcons[e.type]})`}})}),(0,I.jsx)("div",{className:"tlui-embed-dialog__item__title",children:e.title})]},e.type))}),(0,I.jsx)("div",{className:"tlui-dialog__scrim"})]})]})});var sT=r(776);async function pasteExcalidrawContent(e,t,r){let{elements:n,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},a=new Map,l=new Map,{currentPageId:d}=e,c=new Map,u=[],p=new Set;n.forEach(e=>{if(c.set(e.id,createShapeId()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&p.add(t.id)});let h="a1";for(let e of n){if(p.has(e.id))continue;let t=c.get(e.id),r={id:t,typeName:"shape",parentId:d,index:h,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:getOpacity(e.opacity),meta:{}};switch(0!==e.angle&&l.set(t,e.angle),e.groupIds&&e.groupIds.length>0?a.has(e.groupIds[0])?a.get(e.groupIds[0])?.push(t):a.set(e.groupIds[0],[t]):u.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let r of e.boundElements)if("text"===r.type){let e=n.find(e=>e.id===r.id);e&&(t=e.text,i=sj[e.textAlign])}}let a="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...r,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:sA[e.strokeWidth]??"draw",color:sD[a]??"black",text:t,align:i,dash:getDash(e),fill:getFill(e)}});break}case"freedraw":o.shapes.push({...r,type:"draw",props:{dash:getDash(e),size:sA[e.strokeWidth],color:sD[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,r=.5])=>({x:e,y:t,z:r}))}]}});break;case"line":{let t=e.points[0],n=e.points[e.points.length-1],i=getIndices(e.points.length);o.shapes.push({...r,type:"line",props:{dash:getDash(e),size:sA[e.strokeWidth],color:sD[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:i[0],x:t[0],y:t[1]},end:{id:"end",type:"vertex",index:i[i.length-1],x:n[0],y:n[1]},...Object.fromEntries(e.points.slice(1,-1).map(([e,t],r)=>{let n=uniqueId();return[n,{id:n,type:"vertex",index:i[r+1],x:e,y:t}]}))}}});break}case"arrow":{let t="";if(null!==e.boundElements){for(let r of e.boundElements)if("text"===r.type){let e=n.find(e=>e.id===r.id);e&&(t=e.text)}}let i=e.points[0],a=e.points[e.points.length-1],l=c.get(e.startBinding?.elementId),d=c.get(e.endBinding?.elementId);o.shapes.push({...r,type:"arrow",props:{text:t,bend:getBend(e,i,a),dash:getDash(e),size:sA[e.strokeWidth]??"m",color:sD[e.strokeColor]??"black",start:l?{type:"binding",boundShapeId:l,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:i[0],y:i[1]},end:d?{type:"binding",boundShapeId:d,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:a[0],y:a[1]},arrowheadEnd:sO[e.endArrowhead]??"none",arrowheadStart:sO[e.startArrowhead]??"none"}});break}case"text":{let{size:t,scale:n}=getFontSizeAndScale(e.fontSize);o.shapes.push({...r,type:"text",props:{size:t,scale:n,font:sM[e.fontFamily]??"draw",color:sD[e.strokeColor]??"black",text:e.text,align:sj[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let n=tK.createId();o.assets.push({id:n,typeName:"asset",type:"image",props:{w:e.width,h:e.height,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...r,type:"image",props:{w:e.width,h:e.height,assetId:n}})}}h=getIndexAbove(h)}let f=r??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.mark("paste"),e.putContentOntoCurrentPage(o,{point:f,select:!1,preserveIds:!0}),a.values()))if(t.length>1){e.groupShapes(t);let r=e.getShape(t[0]);r?.parentId&&isShapeId(r.parentId)&&u.push(r.parentId)}for(let[t,r]of l)e.select(t),e.rotateShapesBy([t],r);let g=compact(u.map(t=>e.getShape(t))),m=Box2d_Box2d.Common(g.map(t=>e.getShapePageBounds(t))),y=e.viewportPageBounds.center;e.updateShapes(g.map(e=>{let t={x:(e.x??0)-(m.x+m.w/2),y:(e.y??0)-(m.y+m.h/2)};return{id:e.id,type:e.type,x:y.x+t.x,y:y.y+t.y}})),e.setSelectedShapes(u)}let getOpacity=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},sA={1:"s",2:"m",3:"l",4:"xl"},s$={16:"s",20:"m",28:"l",36:"xl"};function getFontSizeAndScale(e){let t=s$[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}let sM={1:"draw",2:"sans",3:"mono"},sD={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},sV={solid:"draw",dashed:"dashed",dotted:"dotted"},sR={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},sj={left:"start",center:"middle",right:"end"},sO={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function getBend(e,t,r){let n=0;if(e.points.length>2){let i=new Vec2d_Vec2d(t[0],t[1]),o=new Vec2d_Vec2d(r[0],r[1]),a=new Vec2d_Vec2d(e.points[1][0],e.points[1][1]),l=Vec2d_Vec2d.Sub(o,i),d=Vec2d_Vec2d.Per(l),c=Vec2d_Vec2d.Med(o,i),u=Vec2d_Vec2d.Sub(c,d),p=Vec2d_Vec2d.Add(c,d),h=Vec2d_Vec2d.NearestPointOnLineSegment(u,p,a,!1);n=Vec2d_Vec2d.Dist(h,c),Vec2d_Vec2d.Clockwise(h,o,c)&&(n*=-1)}return n}let getDash=e=>{let t=sV[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},getFill=e=>"transparent"===e.backgroundColor?"none":sR[e.fillStyle]??"solid";async function pasteFiles(e,t,r,n){let i=await Promise.all(t.map(async e=>await (await fetch(e)).blob())),o=i.map(e=>new File([e],"tldrawFile",{type:e.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:o,point:r,ignoreParent:!1,sources:n}),t.forEach(e=>URL.revokeObjectURL(e))}function pasteTldrawContent(e,t,r){let n=r??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(t,{point:n,select:!0})}async function pasteUrl(e,t,r,n){try{let r=await fetch(t);if(r.headers.get("content-type")?.match(/^image\//)){e.mark("paste"),pasteFiles(e,[t]);return}}catch(e){"Failed to fetch"!==e.message&&console.error(e)}return e.mark("paste"),await e.putExternalContent({type:"url",point:r,url:t,sources:n})}function stripHtml(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}let isValidHttpURL=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},getValidHttpURLList=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch(e){return}return nk(t)},isSvgText=e=>/^<svg/.test(e),sL=["input","select","textarea"];function disallowClipboardEvents(e){let{activeElement:t}=document;return e.isMenuOpen||t&&(t.getAttribute("contenteditable")||sL.indexOf(t.tagName.toLowerCase())>-1)}async function blobAsString(e){return new Promise((t,r)=>{let n=new FileReader;n.addEventListener("loadend",()=>{let e=n.result;t(e)}),n.addEventListener("error",()=>{r(n.error)}),n.readAsText(e)})}let isFile=e=>e.types.find(e=>e.match(/^image\//)),handleText=(e,t,r,n)=>{let i=getValidHttpURLList(t);if(i)for(let t of i)pasteUrl(e,t,r);else isValidHttpURL(t)?pasteUrl(e,t,r):isSvgText(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:r,sources:n})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:r,sources:n}))},handlePasteFromEventClipboardData=async(e,t,r)=>{if(null!==e.editingShapeId)return;if(!t)throw Error("No clipboard data");let n=[];for(let e of Object.values(t.items))switch(e.kind){case"file":n.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?n.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?n.push({type:"text",source:new Promise(t=>e.getAsString(t))}):n.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}handleClipboardThings(e,n,r)},handlePasteFromClipboardApi=async(e,t,r)=>{let n=[];for(let e of t){if(isFile(e))for(let t of e.types)t.match(/^image\//)&&n.push({type:"blob",source:e.getType(t)});e.types.includes("text/html")&&n.push({type:"html",source:new Promise(t=>e.getType("text/html").then(e=>blobAsString(e).then(t)))}),e.types.includes("text/uri-list")&&n.push({type:"url",source:new Promise(t=>e.getType("text/uri-list").then(e=>blobAsString(e).then(t)))}),e.types.includes("text/plain")&&n.push({type:"text",source:new Promise(t=>e.getType("text/plain").then(e=>blobAsString(e).then(t)))})}return await handleClipboardThings(e,n,r)};async function handleClipboardThings(e,t,r){let n=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(n.length){let t=await Promise.all(n.map(e=>e.source)),i=t.filter(Boolean).map(e=>URL.createObjectURL(e));return await pasteFiles(e,i,r)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(r=>{let n=r.match(/<tldraw[^>]*>(.*)<\/tldraw>/)?.[1];if(n)try{let e=(0,sT.decompressFromBase64)(n);if(null===e){t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});return}{let r=JSON.parse(e);if("application/tldraw"!==r.type&&t({type:"error",data:r,reason:`found tldraw data comment but JSON was of a different type: ${r.type}`}),"string"==typeof r.data){t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:r.data});return}}catch(e){t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:r,subtype:"html"});return}if("url"===e.type){t({type:"text",data:r,subtype:"url"});return}try{let e=JSON.parse(r);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:r,subtype:"json"});return}catch(e){t({type:"text",data:r,subtype:"text"});return}}t({type:"error",data:r,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){pasteTldrawContent(e,t.data,r);return}for(let t of i)if("excalidraw"===t.type){pasteExcalidrawContent(e,t.data,r);return}for(let t of i)if("text"===t.type&&"html"===t.subtype){let n=new DOMParser().parseFromString(t.data,"text/html"),o=n.querySelector("body"),a=o&&1===Array.from(o.children).filter(e=>1===e.nodeType).length&&o.firstElementChild&&"A"===o.firstElementChild.tagName&&o.firstElementChild.hasAttribute("href")&&""!==o.firstElementChild.getAttribute("href");if(a){let t=o.firstElementChild.getAttribute("href");handleText(e,t,r,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){handleText(e,stripHtml(t.data),r,i);return}}for(let t of i)if("text"===t.type&&"url"===t.subtype){pasteUrl(e,t.data,r,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){handleText(e,t.data,r,i);return}}let handleNativeOrMenuCopy=e=>{let t=e.getContentFromCurrentPage(e.selectedShapeIds);if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let r=(0,sT.compressToBase64)(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!=typeof navigator){let n=t.shapes.map(t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null).filter(isNonNull);if(navigator.clipboard?.write){let e=new Blob([`<tldraw>${r}</tldraw>`],{type:"text/html"}),t=n.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${r}</tldraw>`)}};function useMenuClipboardEvents(){let e=useEditor(),t=useUiEvents(),r=(0,T.useCallback)(function(r){0!==e.selectedShapeIds.length&&(handleNativeOrMenuCopy(e),t("copy",{source:r}))},[e,t]),n=(0,T.useCallback)(function(r){0!==e.selectedShapeIds.length&&(handleNativeOrMenuCopy(e),e.deleteShapes(e.selectedShapeIds),t("cut",{source:r}))},[e,t]),i=(0,T.useCallback)(async function(r,n,o){null!==e.editingShapeId||disallowClipboardEvents(e)||(Array.isArray(r)&&r[0]instanceof ClipboardItem?(handlePasteFromClipboardApi(e,r,o),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,n,o)}))},[e,t]);return{copy:r,cut:n,paste:i}}function useNativeClipboardEvents(){let e=useEditor(),t=useUiEvents(),r=useValue("editor.isFocused",()=>e.instanceState.isFocused,[e]);(0,T.useEffect)(()=>{if(!r)return;let copy=()=>{0===e.selectedShapeIds.length||null!==e.editingShapeId||disallowClipboardEvents(e)||(handleNativeOrMenuCopy(e),t("copy",{source:"kbd"}))};function cut(){0===e.selectedShapeIds.length||null!==e.editingShapeId||disallowClipboardEvents(e)||(handleNativeOrMenuCopy(e),e.deleteShapes(e.selectedShapeIds),t("cut",{source:"kbd"}))}let n=!1,pointerUpHandler=e=>{1===e.button&&(n=!0,requestAnimationFrame(()=>{n=!1}))},paste=r=>{if(n){r.stopPropagation();return}null!==e.editingShapeId||disallowClipboardEvents(e)||(r.clipboardData&&!e.inputs.shiftKey?handlePasteFromEventClipboardData(e,r.clipboardData):navigator.clipboard.read().then(t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&handlePasteFromClipboardApi(e,t,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",copy),document.addEventListener("cut",cut),document.addEventListener("paste",paste),document.addEventListener("pointerup",pointerUpHandler),()=>{document.removeEventListener("copy",copy),document.removeEventListener("cut",cut),document.removeEventListener("paste",paste),document.removeEventListener("pointerup",pointerUpHandler)}},[e,t,r])}function getSvgAsString(e){let t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");let r=new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1");return r}async function getSvgAsImage(e,t){let{type:r,quality:n,scale:i}=t,o=+e.getAttribute("width"),a=+e.getAttribute("height"),l=o*i,d=a*i,c=await getSvgAsDataUrl(e),u=await getBrowserCanvasMaxSize();if(o>u.maxWidth&&(d=(l=u.maxWidth)/o*a),a>u.maxHeight&&(l=(d=u.maxHeight)/a*o),l*d>u.maxArea){let e=Math.sqrt(u.maxArea/(l*d));l*=e,d*=e}l=Math.floor(l),d=Math.floor(d);let p=l/o,h=await new Promise(e=>{let t=new Image;t.crossOrigin="anonymous",t.onload=async()=>{await new Promise(e=>setTimeout(e,250));let r=document.createElement("canvas"),n=r.getContext("2d");r.width=l,r.height=d,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(t,0,0,l,d),URL.revokeObjectURL(c),e(r)},t.onerror=()=>{e(null)},t.src=c});if(!h)return null;let f=await new Promise(e=>h.toBlob(t=>{(!t||rZ.throwToBlob.value)&&e(null),e(t)},"image/"+r,n));if(!f)return null;let g=new DataView(await f.arrayBuffer());return PngHelpers.setPhysChunk(g,p,{type:"image/"+r})}async function getSvgAsDataUrl(e){let t=e.cloneNode(!0);t.setAttribute("encoding",'UTF-8"');let r=new FileReader,n=Array.from(t.querySelectorAll("image"));for(let e of n){let t=e.getAttribute("xlink:href");if(t&&!t.startsWith("data:")){let n=await (await fetch(t)).blob(),i=await new Promise((e,t)=>{r.onload=()=>e(r.result),r.onerror=()=>t(r.error),r.readAsDataURL(n)});e.setAttribute("xlink:href",i)}}return getSvgAsDataUrlSync(t)}function getSvgAsDataUrlSync(e){let t=new XMLSerializer().serializeToString(e),r=window.btoa(unescape(encodeURIComponent(t)));return`data:image/svg+xml;base64,${r}`}function downloadDataURLAsFile(e,t){let r=document.createElement("a");r.href=e,r.download=t,r.click()}let sF=(0,T.createContext)({});function ToastsProvider({children:e}){let[t,r]=(0,T.useState)([]),n=(0,T.useCallback)(e=>{let t=e.id??uniqueId();return r(r=>[...r.filter(t=>t.id!==e.id),{...e,id:t}]),t},[]),i=(0,T.useCallback)(e=>(r(t=>t.filter(t=>t.id!==e)),e),[]),o=(0,T.useCallback)(()=>{r(()=>[])},[]);return(0,I.jsx)(sF.Provider,{value:{toasts:t,addToast:n,removeToast:i,clearToasts:o},children:e})}function useToasts(){let e=(0,T.useContext)(sF);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}function useCopyAs(){let e=useEditor(),{addToast:t}=useToasts(),r=useTranslation();return(0,T.useCallback)(function(n=e.selectedShapeIds,i="svg"){if(0===n.length&&(n=[...e.currentPageShapeIds]),0!==n.length)switch(i){case"svg":window.navigator.clipboard&&(window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":getExportedSvgBlob(e,n)})]):fallbackWriteTextAsync(async()=>getSvgAsString(await getExportSvgElement(e,n))));break;case"jpeg":case"png":{let o="jpeg"===i?"image/jpeg":"image/png",a=getExportedImageBlob(e,n,i).then(e=>{if(e){if(window.navigator.clipboard)return e;throw Error("Copy not supported")}throw t({id:"copy-fail",icon:"warning-triangle",title:r("toast.error.copy-fail.title"),description:r("toast.error.copy-fail.desc")}),Error("Copy not possible")});window.navigator.clipboard.write([new ClipboardItem({[o]:a})]).catch(e=>{e.toString().match(/^TypeError: DOMString not supported/)||console.error(e),a.then(e=>{window.navigator.clipboard.write([new ClipboardItem({[o]:e})])})});break}case"json":{let t=e.getContentFromCurrentPage(n);if(window.navigator.clipboard){let e=JSON.stringify(t);window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([e],{type:"text/plain"})})]):fallbackWriteTextAsync(async()=>e)}break}default:throw Error(`Copy type ${i} not supported.`)}},[e,t,r])}async function getExportSvgElement(e,t){let r=await e.getSvg(t,{scale:1,background:e.instanceState.exportBackground});if(!r)throw Error("Could not construct SVG.");return r}async function getExportedSvgBlob(e,t){return new Blob([getSvgAsString(await getExportSvgElement(e,t))],{type:"text/plain"})}async function getExportedImageBlob(e,t,r){return await getSvgAsImage(await getExportSvgElement(e,t),{type:r,quality:1,scale:2})}async function fallbackWriteTextAsync(e){navigator&&navigator.clipboard&&navigator.clipboard.writeText(await e())}let sN=(0,T.createContext)({});function DialogsProvider({children:e}){let t=useEditor(),r=useUiEvents(),[n,i]=(0,T.useState)([]),o=(0,T.useCallback)(e=>{let n=e.id??uniqueId();return i(t=>[...t.filter(t=>t.id!==e.id),{...e,id:n}]),r("open-menu",{source:"dialog",id:n}),t.addOpenMenu(n),n},[t,r]),a=(0,T.useCallback)((e,n)=>(i(t=>t.map(t=>t.id===e?{...t,...n}:t)),r("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e),[t,r]),l=(0,T.useCallback)(e=>(i(t=>t.filter(t=>t.id!==e||(t.onClose?.(),!1))),r("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e),[t,r]),d=(0,T.useCallback)(()=>{i(e=>(e.forEach(e=>{e.onClose?.(),r("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)}),[]))},[t,r]);return(0,I.jsx)(sN.Provider,{value:{dialogs:n,addDialog:o,removeDialog:l,clearDialogs:d,updateDialog:a},children:e})}function useDialogs(){let e=(0,T.useContext)(sN);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}function useExportAs(){let e=useEditor(),{addToast:t}=useToasts(),r=useTranslation();return(0,T.useCallback)(async function(n=e.selectedShapeIds,i="png"){if(0===n.length&&(n=[...e.currentPageShapeIds]),0===n.length)return;let o=await e.getSvg(n,{scale:1,background:e.instanceState.exportBackground});if(!o)throw Error("Could not construct SVG.");let a="shapes"+getTimestamp();if(1===n.length){let t=e.getShape(n[0]);a=e.isShapeOfType(t,"frame")?t.props.name??"frame":t.id.replace(/:/,"_")}switch(i){case"svg":{let e=await getSvgAsDataUrl(o);downloadDataURLAsFile(e,`${a}.svg`);return}case"webp":case"png":{let e=await getSvgAsImage(o,{type:i,quality:1,scale:2});if(!e){t({id:"export-fail",title:r("toast.error.export-fail.title"),description:r("toast.error.export-fail.desc")});return}let n=URL.createObjectURL(e);downloadDataURLAsFile(n,`${a}.${i}`),URL.revokeObjectURL(n);return}case"json":{let t=e.getContentFromCurrentPage(n),r=URL.createObjectURL(new Blob([JSON.stringify(t,null,4)],{type:"application/json"}));downloadDataURLAsFile(r,`${a||"shapes"}.json`),URL.revokeObjectURL(r);return}default:throw Error(`Export type ${i} not supported.`)}},[e,t,r])}function getTimestamp(){let e=new Date,t=String(e.getFullYear()).slice(2),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return` at ${t}-${r}-${n} ${i}.${o}.${a}`}function useInsertMedia(){let e=useEditor(),t=(0,T.useRef)();return(0,T.useEffect)(()=>{let r=window.document.createElement("input");async function onchange(t){let n=t.target.files;n&&0!==n.length&&(await e.putExternalContent({type:"files",files:Array.from(n),point:e.viewportPageBounds.center,ignoreParent:!1}),r.value="")}return r.type="file",r.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",r.multiple=!0,t.current=r,r.addEventListener("change",onchange),()=>{t.current=void 0,r.removeEventListener("change",onchange)}},[e]),(0,T.useCallback)(()=>{t.current?.click()},[t])}function usePrint(){let e=useEditor(),t=(0,T.useRef)(null),r=(0,T.useRef)(null);return(0,T.useCallback)(async function(){let n=document.createElement("div"),i=document.createElement("style"),clearElements=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};clearElements(t.current,r.current),t.current=n,r.current=i;let o=`tl-print-surface-${uniqueId()}`;n.className=o,i.innerHTML=`
			.${o} {
				display: none;
			}

			.${o} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.${o} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${o}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${o}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${o}__item__header {
					display: none;
				}

				.${o}__item__footer {
					display: none;
					text-align: right;
				}

				.${o}__item__footer__hide {
					display: none;
				}

				
			}

		`;let beforePrintHandler=()=>{document.head.appendChild(i),document.body.appendChild(n)},afterPrintHandler=()=>{e.once("change-history",()=>{clearElements(n,i)})};function addPageToPrint(e,t,r){try{n.innerHTML+=`<div class="${o}__item">
        <div class="${o}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${o}__item__main">
          ${r.outerHTML}
        </div>
        <div class="${o}__item__footer ${o}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function triggerPrint(){e.environment.isChromeForIos?(beforePrintHandler(),window.print()):e.environment.isSafari?(beforePrintHandler(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",beforePrintHandler),window.addEventListener("afterprint",afterPrintHandler);let{pages:a,currentPageId:l,selectedShapeIds:d}=e,c={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.selectedShapeIds.length>0){let t=await e.getSvg(d,c);if(t){let e=a.find(e=>e.id===l);addPageToPrint(`tldraw \u2014 ${e?.name}`,null,t),triggerPrint()}}else{let t=e.currentPage,r=await e.getSvg(e.getSortedChildIdsForParent(t.id),c);r&&(addPageToPrint(`tldraw \u2014 ${t.name}`,null,r),triggerPrint())}window.removeEventListener("beforeprint",beforePrintHandler),window.removeEventListener("afterprint",afterPrintHandler)},[e])}let sz=T.createContext({});function makeActions(e){return Object.fromEntries(e.map(e=>[e.id,e]))}function ActionsProvider({overrides:e,children:t}){let r=useEditor(),{addDialog:n,clearDialogs:i}=useDialogs(),{clearToasts:o}=useToasts(),a=useInsertMedia(),l=usePrint(),{cut:d,copy:c,paste:u}=useMenuClipboardEvents(),p=useCopyAs(),h=useExportAs(),f=useUiEvents(),g=T.useMemo(()=>{function mustGoBackToSelectToolFirst(){return r.isIn("select")||(r.complete(),r.setCurrentTool("select")),!1}function hasSelectedShapes(){return r.selectedShapeIds.length>0}let t=makeActions([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("edit-link",{source:e}),r.mark("edit-link"),n({component:sC})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(e){f("insert-embed",{source:e}),n({component:sI})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(e){f("insert-media",{source:e}),a()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(e){f("undo",{source:e}),r.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(e){f("redo",{source:e}),r.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(e){f("export-as",{format:"svg",source:e}),h(r.selectedShapeIds,"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(e){f("export-as",{format:"png",source:e}),h(r.selectedShapeIds,"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(e){f("export-as",{format:"json",source:e}),h(r.selectedShapeIds,"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(e){f("copy-as",{format:"svg",source:e}),p(r.selectedShapeIds,"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(e){f("copy-as",{format:"png",source:e}),p(r.selectedShapeIds,"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(e){f("copy-as",{format:"json",source:e}),p(r.selectedShapeIds,"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("toggle-auto-size",{source:e}),r.mark("toggling auto size"),r.updateShapes(r.selectedShapes.filter(e=>r.isShapeOfType(e,"text")&&!1===e.props.autoSize).map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){f("open-embed-link",{source:e});let t=r.selectedShapeIds,n="No embed shapes selected";if(1!==t.length){console.error(n);return}let i=r.getShape(t[0]);if(!i||!r.isShapeOfType(i,"embed")){console.error(n);return}openWindow(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(r.root.current.value?.id!=="zoom"&&(f("zoom-tool",{source:e}),!(r.inputs.shiftKey||r.inputs.ctrlKey))){let e=r.root.current.value;e&&e.current.value?.id==="idle"&&r.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||r.batch(()=>{f("convert-to-bookmark",{source:e});let t=r.selectedShapes,n=[],i=[];for(let e of t){if(!e||!r.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new Vec2d_Vec2d(e.x,e.y);t.rot(-e.rotation),t.add(new Vec2d_Vec2d(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:createShapeId(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};n.push(o),i.push(e.id)}r.mark("convert shapes to bookmark"),r.deleteShapes(i),r.createShapes(n)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("convert-to-embed",{source:e}),r.batch(()=>{let e=r.selectedShapeIds,t=compact(e.map(e=>r.getShape(e))),n=[],i=[];for(let e of t){if(!r.isShapeOfType(e,"bookmark"))continue;let{url:t}=e.props,o=getEmbedInfo(e.props.url);if(!o||!o.definition)continue;let{width:a,height:l}=o.definition,d=new Vec2d_Vec2d(e.x,e.y);d.rot(-e.rotation),d.add(new Vec2d_Vec2d(e.props.w/2-a/2,e.props.h/2-l/2)),d.rot(e.rotation);let c={id:createShapeId(),type:"embed",x:d.x,y:d.y,rotation:e.rotation,props:{url:t,w:a,h:l}};n.push(c),i.push(e.id)}r.mark("convert shapes to embed"),r.deleteShapes(i),r.createShapes(n)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(e){if(!hasSelectedShapes()||mustGoBackToSelectToolFirst())return;f("duplicate-shapes",{source:e});let t=r.selectedShapeIds,n=Box2d_Box2d.Common(compact(t.map(e=>r.getShapePageBounds(e)))),i=r.instanceState.canMoveCamera?{x:n.width+10,y:0}:{x:16/r.zoomLevel,y:16/r.zoomLevel};r.mark("duplicate shapes"),r.duplicateShapes(t,i)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("ungroup-shapes",{source:e}),r.mark("ungroup"),r.ungroupShapes(r.selectedShapeIds)))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(e){if(!hasSelectedShapes()||mustGoBackToSelectToolFirst())return;f("group-shapes",{source:e});let{onlySelectedShape:t}=r;t&&r.isShapeOfType(t,"group")?(r.mark("ungroup"),r.ungroupShapes(r.selectedShapeIds)):(r.mark("group"),r.groupShapes(r.selectedShapeIds))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"left",source:e}),r.mark("align left"),r.alignShapes(r.selectedShapeIds,"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"center-horizontal",source:e}),r.mark("align center horizontal"),r.alignShapes(r.selectedShapeIds,"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"right",source:e}),r.mark("align right"),r.alignShapes(r.selectedShapeIds,"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"center-vertical",source:e}),r.mark("align center vertical"),r.alignShapes(r.selectedShapeIds,"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"top",source:e}),r.mark("align top"),r.alignShapes(r.selectedShapeIds,"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("align-shapes",{operation:"bottom",source:e}),r.mark("align bottom"),r.alignShapes(r.selectedShapeIds,"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("distribute-shapes",{operation:"horizontal",source:e}),r.mark("distribute horizontal"),r.distributeShapes(r.selectedShapeIds,"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("distribute-shapes",{operation:"vertical",source:e}),r.mark("distribute vertical"),r.distributeShapes(r.selectedShapeIds,"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("stretch-shapes",{operation:"horizontal",source:e}),r.mark("stretch horizontal"),r.stretchShapes(r.selectedShapeIds,"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("stretch-shapes",{operation:"vertical",source:e}),r.mark("stretch vertical"),r.stretchShapes(r.selectedShapeIds,"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("flip-shapes",{operation:"horizontal",source:e}),r.mark("flip horizontal"),r.flipShapes(r.selectedShapeIds,"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("flip-shapes",{operation:"vertical",source:e}),r.mark("flip vertical"),r.flipShapes(r.selectedShapeIds,"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("pack-shapes",{source:e}),r.mark("pack"),r.packShapes(r.selectedShapeIds,16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("stack-shapes",{operation:"vertical",source:e}),r.mark("stack-vertical"),r.stackShapes(r.selectedShapeIds,"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("stack-shapes",{operation:"horizontal",source:e}),r.mark("stack-horizontal"),r.stackShapes(r.selectedShapeIds,"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("reorder-shapes",{operation:"toFront",source:e}),r.mark("bring to front"),r.bringToFront(r.selectedShapeIds)))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("reorder-shapes",{operation:"forward",source:e}),r.mark("bring forward"),r.bringForward(r.selectedShapeIds)))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("reorder-shapes",{operation:"backward",source:e}),r.mark("send backward"),r.sendBackward(r.selectedShapeIds)))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("reorder-shapes",{operation:"toBack",source:e}),r.mark("send to back"),r.sendToBack(r.selectedShapeIds)))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(r.mark("cut"),d(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||c(e))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(e){navigator.clipboard?.read().then(t=>{u(t,e,"context-menu"===e?r.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){r.batch(()=>{mustGoBackToSelectToolFirst()||(f("select-all-shapes",{source:e}),r.mark("select all kbd"),r.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("select-none-shapes",{source:e}),r.mark("select none"),r.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",readonlyOk:!1,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("delete-shapes",{source:e}),r.mark("delete"),r.deleteShapes(r.selectedShapeIds)))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(e){if(!hasSelectedShapes()||mustGoBackToSelectToolFirst())return;f("rotate-cw",{source:e}),r.mark("rotate-cw");let t=r.selectionRotation%(r6/2),n=approximately(t,0)||approximately(t,r6/2);r.rotateShapesBy(r.selectedShapeIds,r6/2-(n?0:t))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(e){if(!hasSelectedShapes()||mustGoBackToSelectToolFirst())return;f("rotate-ccw",{source:e}),r.mark("rotate-ccw");let t=r.selectionRotation%(r6/2),n=approximately(t,0);r.rotateShapesBy(r.selectedShapeIds,n?-(r6/2):-t)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){f("zoom-in",{source:e}),r.zoomIn(r.viewportScreenCenter,{duration:na})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){f("zoom-out",{source:e}),r.zoomOut(r.viewportScreenCenter,{duration:na})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){f("reset-zoom",{source:e}),r.resetZoom(r.viewportScreenCenter,{duration:na})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){f("zoom-to-fit",{source:e}),r.zoomToFit({duration:na})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){hasSelectedShapes()&&(mustGoBackToSelectToolFirst()||(f("zoom-to-selection",{source:e}),r.zoomToSelection({duration:na})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(e){f("toggle-snap-mode",{source:e}),r.user.updateUserPreferences({isSnapMode:!r.user.isSnapMode})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(e){f("toggle-dark-mode",{source:e}),r.user.updateUserPreferences({isDarkMode:!r.user.isDarkMode})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(e){f("toggle-reduce-motion",{source:e}),r.user.updateUserPreferences({animationSpeed:0===r.user.animationSpeed?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(e){f("toggle-transparent",{source:e}),r.updateInstanceState({exportBackground:!r.instanceState.exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(e){f("toggle-tool-lock",{source:e}),r.updateInstanceState({isToolLocked:!r.instanceState.isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(e){f("unlock-all",{source:e});let t=[];for(let e of r.currentPageShapes)e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&r.updateShapes(t)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){requestAnimationFrame(()=>{r.batch(()=>{f("toggle-focus-mode",{source:e}),i(),o(),r.updateInstanceState({isFocusMode:!r.instanceState.isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(e){f("toggle-grid-mode",{source:e}),r.updateInstanceState({isGridMode:!r.instanceState.isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(e){f("toggle-debug-mode",{source:e}),r.updateInstanceState({isDebugMode:!r.instanceState.isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){f("print",{source:e}),l()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){f("exit-pen-mode",{source:e}),r.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){f("stop-following",{source:e}),r.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){f("zoom-to-content",{source:e}),r.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(e){r.mark("locking"),f("toggle-lock",{source:e}),r.toggleLock(r.selectedShapeIds)}}]);return e?e(r,t,void 0):t},[f,e,r,n,a,h,p,d,c,u,i,o,l]);return(0,I.jsx)(sz.Provider,{value:asActions(g),children:t})}function useActions(){let e=T.useContext(sz);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function asActions(e){return e}function compactMenuItems(e){return e.filter(e=>null!=e&&!1!==e)}function menuGroup(e,...t){let r=compactMenuItems(t);return 0===r.length?null:{id:e,type:"group",checkbox:r.every(e=>"item"===e.type&&e.actionItem.checkbox),disabled:r.every(e=>e.disabled),readonlyOk:r.some(e=>e.readonlyOk),children:r}}function menuSubmenu(e,t,...r){let n=compactMenuItems(r);return 0===n.length?null:{id:e,type:"submenu",label:t,children:n,disabled:n.every(e=>e.disabled),readonlyOk:n.some(e=>e.readonlyOk)}}function menuCustom(e,t={}){let{readonlyOk:r=!0,disabled:n=!1}=t;return{id:e,type:"custom",disabled:n,readonlyOk:r}}function menuItem(e,t={}){if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");let{checked:r=!1,disabled:n=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:n,checked:r,readonlyOk:e.readonlyOk}}function shapesWithUnboundArrows(e){let{selectedShapeIds:t}=e,r=t.map(t=>e.getShape(t));return r.filter(t=>!(!t||e.isShapeOfType(t,"arrow")&&"binding"===t.props.start.type||e.isShapeOfType(t,"arrow")&&"binding"===t.props.end.type))}let useThreeStackableItems=()=>{let e=useEditor();return useValue("threeStackableItems",()=>shapesWithUnboundArrows(e).length>2,[e])},useAllowGroup=()=>{let e=useEditor();return useValue("allowGroup",()=>shapesWithUnboundArrows(e).length>1,[e])},useAllowUngroup=()=>{let e=useEditor();return useValue("allowUngroup",()=>e.selectedShapeIds.some(t=>e.getShape(t)?.type==="group"),[])};function findMenuItem(e,t){let r=_findMenuItem(e,t);return eM(r,`Menu item ${t.join(" > ")} not found`),r}function _findMenuItem(e,t){let[r,...n]=t;if(!r)return null;let i=e.find(e=>e.id===r);if(!i)return null;switch(i.type){case"group":case"submenu":return 0===n.length?i:_findMenuItem(i.children,n);case"item":case"custom":return 0===n.length?i:null;default:exhaustiveSwitchError(i,"type")}}let sB="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,sU=[0,380,420,460,580,640,840,1023],sH=T.createContext(0);function BreakPointProvider({children:e}){let t=useEditor(),r=useValue("breakpoint",()=>{let{width:e}=t.viewportScreenBounds;for(let t=0;t<sU.length-1;t++)if(e>sU[t]&&e<=sU[t+1])return t;return sU.length},[t]);return(0,I.jsx)(sH.Provider,{value:r,children:e})}function useBreakpoint(){let e=(0,T.useContext)(sH),t=new URL(window.location.href).searchParams.get("layout");return"desktop"===t?e=7:"mobile"===t&&(e=1),e}function useHasLinkShapeSelected(){let e=useEditor();return useValue("hasLinkShapeSelected",()=>{let{selectedShapes:t}=e;return 1===t.length&&"url"in t[0].props&&"embed"!==t[0].type},[e])}let sG=T.createContext({}),sW=track(function({overrides:e,children:t}){let r=useEditor(),n=useActions(),i=r.selectedShapeIds.length,o=i>0,a=i>1,l=i>2,d=useThreeStackableItems(),c=useAllowGroup(),u=useAllowUngroup(),p=useHasLinkShapeSelected(),h=useBreakpoint(),f=1===r.zoomLevel,g=(0,T.useMemo)(()=>{let t=[menuItem(n["align-left"],{disabled:!a}),menuItem(n["align-center-horizontal"],{disabled:!a}),menuItem(n["align-right"],{disabled:!a}),menuItem(n["stretch-horizontal"],{disabled:!a}),menuItem(n["align-top"],{disabled:!a}),menuItem(n["align-center-vertical"],{disabled:!a}),menuItem(n["align-bottom"],{disabled:!a}),menuItem(n["stretch-vertical"],{disabled:!a}),menuItem(n["distribute-horizontal"],{disabled:!l}),menuItem(n["distribute-vertical"],{disabled:!l}),menuItem(n["stack-horizontal"],{disabled:!d}),menuItem(n["stack-vertical"],{disabled:!d}),menuItem(n["send-to-back"],{disabled:!o}),menuItem(n["send-backward"],{disabled:!o}),menuItem(n["bring-forward"],{disabled:!o}),menuItem(n["bring-to-front"],{disabled:!o}),h<5?menuItem(n["zoom-to-100"],{disabled:!!f}):menuItem(n["rotate-ccw"],{disabled:!o}),menuItem(n["rotate-cw"],{disabled:!o}),menuItem(n["edit-link"],{disabled:!p}),c?menuItem(n.group,{disabled:!a}):u?menuItem(n.ungroup):menuItem(n.group,{disabled:!a})];return e?e(r,t,{actions:n,oneSelected:o,twoSelected:a,threeSelected:l}):t},[r,f,c,e,n,o,a,l,d,u,p,h]);return(0,I.jsx)(sG.Provider,{value:g,children:t})});function useActionsMenuSchema(){let e=T.useContext(sG);if(!e)throw Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}function useOnlyFlippableShape(){let e=useEditor();return useValue("onlyFlippableShape",()=>{let{selectedShapes:t}=e;return 1===t.length&&t.every(t=>e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}function useShowAutoSizeToggle(){let e=useEditor();return useValue("showAutoSizeToggle",()=>{let{selectedShapes:t}=e;return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}let sK=T.createContext({}),sq=track(function({overrides:e,children:t}){let r=useEditor(),n=useActions(),i=useShowAutoSizeToggle(),o=useOnlyFlippableShape(),a=r.selectedShapeIds.length,l=a>0,d=a>1,c=a>2,u=useThreeStackableItems(),p=useValue("atLeastOneShapeOnPage",()=>r.currentPageShapeIds.size>0,[]),h=useValue("isTransparentBg",()=>r.instanceState.exportBackground,[]),f=useAllowGroup(),g=useAllowUngroup(),m=!!window.navigator.clipboard?.write,y=useHasLinkShapeSelected(),{onlySelectedShape:b}=r,v=b&&r.isShapeOrAncestorLocked(b),S=(0,T.useMemo)(()=>{let t=compactMenuItems([menuGroup("selection",i&&menuItem(n["toggle-auto-size"]),y&&!v&&menuItem(n["edit-link"]),l&&!v&&menuItem(n.duplicate),f&&!v&&menuItem(n.group),g&&!v&&menuItem(n.ungroup),l&&menuItem(n["toggle-lock"])),menuGroup("modify",(d||o)&&menuSubmenu("arrange","context-menu.arrange",d&&menuGroup("align",menuItem(n["align-left"]),menuItem(n["align-center-horizontal"]),menuItem(n["align-right"]),menuItem(n["align-top"]),menuItem(n["align-center-vertical"]),menuItem(n["align-bottom"])),c&&menuGroup("distribute",menuItem(n["distribute-horizontal"]),menuItem(n["distribute-vertical"])),d&&menuGroup("stretch",menuItem(n["stretch-horizontal"]),menuItem(n["stretch-vertical"])),o&&!v&&menuGroup("flip",menuItem(n["flip-horizontal"]),menuItem(n["flip-vertical"])),d&&menuGroup("order",menuItem(n.pack,{disabled:!d}),u&&menuItem(n["stack-vertical"]),u&&menuItem(n["stack-horizontal"]))),l&&!v&&menuSubmenu("reorder","context-menu.reorder",menuGroup("reorder",menuItem(n["bring-to-front"]),menuItem(n["bring-forward"]),menuItem(n["send-backward"]),menuItem(n["send-to-back"]))),l&&!v&&menuCustom("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),menuGroup("clipboard-group",l&&!v&&menuItem(n.cut),l&&menuItem(n.copy),sB&&menuItem(n.paste)),p&&menuGroup("conversions",menuSubmenu("copy-as","context-menu.copy-as",menuGroup("copy-as-group",menuItem(n["copy-as-svg"]),m&&menuItem(n["copy-as-png"]),menuItem(n["copy-as-json"])),menuGroup("export-bg",menuItem(n["toggle-transparent"],{checked:!h}))),menuSubmenu("export-as","context-menu.export-as",menuGroup("export-as-group",menuItem(n["export-as-svg"]),menuItem(n["export-as-png"]),menuItem(n["export-as-json"])),menuGroup("export-bg,",menuItem(n["toggle-transparent"],{checked:!h})))),p&&menuGroup("set-selection-group",menuItem(n["select-all"]),l&&menuItem(n["select-none"])),l&&!v&&menuGroup("delete-group",menuItem(n.delete))]);return e&&(t=e(r,t,{actions:n,oneSelected:l,twoSelected:d,threeSelected:c,showAutoSizeToggle:i,showUngroup:g,onlyFlippableShapeSelected:o})),t},[r,e,n,l,d,c,i,o,p,u,f,g,m,y,h,v]);return(0,I.jsx)(sK.Provider,{value:S,children:t})});function useContextMenuSchema(){let e=T.useContext(sK);if(!e)throw Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}let sY=T.createContext({});function ToolsProvider({overrides:e,children:t}){let r=useEditor(),n=useUiEvents(),{addDialog:i}=useDialogs(),o=useInsertMedia(),a=T.useMemo(()=>{let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){r.setCurrentTool("select"),n("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){r.setCurrentTool("hand"),n("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(e){r.setCurrentTool("eraser"),n("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(e){r.setCurrentTool("draw"),n("select-tool",{source:e,id:"draw"})}},...[...rx.values].map(e=>({id:e,label:`tool.${e}`,readonlyOk:!1,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){r.batch(()=>{r.updateInstanceState({stylesForNextShape:{...r.instanceState.stylesForNextShape,[rx.id]:e}},{ephemeral:!0}),r.setCurrentTool("geo"),n("select-tool",{source:t,id:`geo-${e}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(e){r.setCurrentTool("arrow"),n("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(e){r.setCurrentTool("line"),n("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(e){r.setCurrentTool("frame"),n("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(e){r.setCurrentTool("text"),n("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(e){o(),n("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(e){r.setCurrentTool("note"),n("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){r.setCurrentTool("laser"),n("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(e){i({component:sI}),n("select-tool",{source:e,id:"embed"})}}];t.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(e){r.setCurrentTool("highlight"),n("select-tool",{source:e,id:"highlight"})}});let a=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(r,a,{insertMedia:o}):a},[e,r,n,o,i]);return(0,I.jsx)(sY.Provider,{value:a,children:t})}function useTools(){let e=T.useContext(sY);if(!e)throw Error("useTools must be used within a ToolProvider");return e}let sX=T.createContext({}),sZ=track(function({overrides:e,children:t}){let r=useEditor(),n=useTools(),i=useActions(),o=(0,T.useMemo)(()=>{let t=compact([menuGroup("shortcuts-dialog.tools",menuItem(i["toggle-tool-lock"]),menuItem(n.select),menuItem(n.draw),menuItem(n.eraser),menuItem(n.hand),menuItem(n.rectangle),menuItem(n.ellipse),menuItem(n.arrow),menuItem(n.line),menuItem(n.text),menuItem(n.frame),menuItem(n.note),menuItem(n.laser)),menuGroup("shortcuts-dialog.file",menuItem(i["insert-media"]),menuItem(i.print)),menuGroup("shortcuts-dialog.preferences",menuItem(i["toggle-dark-mode"]),menuItem(i["toggle-focus-mode"]),menuItem(i["toggle-grid"])),menuGroup("shortcuts-dialog.edit",menuItem(i.undo),menuItem(i.redo),menuItem(i.cut),menuItem(i.copy),menuItem(i.paste),menuItem(i["select-all"]),menuItem(i.delete),menuItem(i.duplicate),menuItem(i["export-as-svg"]),menuItem(i["export-as-png"])),menuGroup("shortcuts-dialog.view",menuItem(i["zoom-in"]),menuItem(i["zoom-out"]),menuItem(i["zoom-to-100"]),menuItem(i["zoom-to-fit"]),menuItem(i["zoom-to-selection"])),menuGroup("shortcuts-dialog.transform",menuItem(i["bring-to-front"]),menuItem(i["bring-forward"]),menuItem(i["send-backward"]),menuItem(i["send-to-back"]),menuItem(i.group),menuItem(i.ungroup),menuItem(i["flip-horizontal"]),menuItem(i["flip-vertical"]),menuItem(i["align-top"]),menuItem(i["align-center-vertical"]),menuItem(i["align-bottom"]),menuItem(i["align-left"]),menuItem(i["align-center-horizontal"]),menuItem(i["align-right"]))]);return e?e(r,t,{tools:n,actions:i}):t},[r,e,i,n]);return(0,I.jsx)(sX.Provider,{value:o,children:t})});function useKeyboardShortcutsSchema(){let e=T.useContext(sX);if(!e)throw Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}let KeyboardShortcutsDialog=()=>{let e=useTranslation(),t=useReadonly(),r=useKeyboardShortcutsSchema();function getKeyboardShortcutItem(r){if(t&&!r.readonlyOk)return null;switch(r.type){case"group":return(0,I.jsxs)("div",{className:"tlui-shortcuts-dialog__group",children:[(0,I.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(r.id)}),(0,I.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:r.children.filter(e=>"item"===e.type&&e.actionItem.kbd).map(getKeyboardShortcutItem)})]},r.id);case"item":{let{id:t,label:n,shortcutsLabel:i,kbd:o}=r.actionItem;return(0,I.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair",children:[(0,I.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(i??n)}),(0,I.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,I.jsx)(Kbd,{children:o})})]},t)}}}return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Header,{className:"tlui-shortcuts-dialog__header",children:[(0,I.jsx)(Title,{children:e("shortcuts-dialog.title")}),(0,I.jsx)(CloseButton,{})]}),(0,I.jsx)(Body,{className:"tlui-shortcuts-dialog__body",children:r.map(getKeyboardShortcutItem)}),(0,I.jsx)("div",{className:"tlui-dialog__scrim"})]})};function useLanguages(){let e=useEditor();return{languages:rq,currentLanguage:e.user.locale}}let sQ=T.createContext({}),sJ=track(function({overrides:e,children:t}){let r=useEditor(),n=useActions(),i=r.selectedShapeIds.length,o=i>0,a=i>1,l=i>2,{languages:d,currentLanguage:c}=useLanguages(),{addDialog:u}=useDialogs(),p=(0,T.useMemo)(()=>{let t=compact([menuGroup("top",menuCustom("LANGUAGE_MENU",{readonlyOk:!0}),menuItem({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){u({component:KeyboardShortcutsDialog})}}))]);return e?e(r,t,{actions:n,currentLanguage:c,languages:d,oneSelected:o,twoSelected:a,threeSelected:l}):t},[r,e,d,n,o,a,l,c,u]);return(0,I.jsx)(sQ.Provider,{value:p,children:t})});function useHelpMenuSchema(){let e=T.useContext(sQ);if(!e)throw Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}function useCanRedo(){let e=useEditor();return useValue("useCanRedo",()=>e.canRedo,[e])}function useCanUndo(){let e=useEditor();return useValue("useCanUndo",()=>e.canUndo,[e])}let s0=T.createContext({});function TLUiMenuSchemaProvider({overrides:e,children:t}){let r=useEditor(),n=useActions(),i=useBreakpoint(),o=i<5,a=useValue("isDarkMode",()=>r.user.isDarkMode,[r]),l=useValue("animationSpeed",()=>r.user.animationSpeed,[r]),d=useValue("isGridMode",()=>r.instanceState.isGridMode,[r]),c=useValue("isSnapMode",()=>r.user.isSnapMode,[r]),u=useValue("isToolLock",()=>r.instanceState.isToolLocked,[r]),p=useValue("isFocusMode",()=>r.instanceState.isFocusMode,[r]),h=useValue("isDebugMode",()=>r.instanceState.isDebugMode,[r]),f=useValue("exportBackground",()=>r.instanceState.exportBackground,[r]),g=useValue("emptyPage",()=>0===r.currentPageShapeIds.size,[r]),m=useValue("selectedCount",()=>r.selectedShapeIds.length,[r]),y=0===m,b=m>0,v=m>1,S=m>2,x=!!window.navigator.clipboard?.write,w=useHasLinkShapeSelected(),_=useShowAutoSizeToggle(),P=useAllowGroup(),E=useAllowUngroup(),C=useCanUndo(),k=useCanRedo(),A=useValue("isZoomedTo100",()=>1===r.zoomLevel,[r]),$=useValue("oneEmbedSelected",()=>{let{onlySelectedShape:e}=r;return!!e&&!!(r.isShapeOfType(e,"embed")&&e.props.url&&!r.isShapeOrAncestorLocked(e))},[]),M=useValue("oneEmbeddableBookmarkSelected",()=>{let{onlySelectedShape:e}=r;return!!e&&!!(r.isShapeOfType(e,"bookmark")&&e.props.url&&getEmbedInfo(e.props.url)&&!r.isShapeOrAncestorLocked(e))},[]),D=(0,T.useMemo)(()=>{let t=compactMenuItems([menuGroup("menu",menuSubmenu("file","menu.file",menuGroup("print",menuItem(n.print,{disabled:g}))),menuSubmenu("edit","menu.edit",menuGroup("undo-actions",menuItem(n.undo,{disabled:!C}),menuItem(n.redo,{disabled:!k})),menuGroup("clipboard-actions",menuItem(n.cut,{disabled:y}),menuItem(n.copy,{disabled:y}),menuItem(n.paste,{disabled:!sB})),menuGroup("conversions",menuSubmenu("copy-as","menu.copy-as",menuGroup("copy-as-group",menuItem(n["copy-as-svg"],{disabled:g}),menuItem(n["copy-as-png"],{disabled:g||!x}),menuItem(n["copy-as-json"],{disabled:g})),menuGroup("export-bg",menuItem(n["toggle-transparent"],{checked:!f}))),menuSubmenu("export-as","menu.export-as",menuGroup("export-as-group",menuItem(n["export-as-svg"],{disabled:g}),menuItem(n["export-as-png"],{disabled:g}),menuItem(n["export-as-json"],{disabled:g})),menuGroup("export-bg",menuItem(n["toggle-transparent"],{checked:!f})))),menuGroup("set-selection-group",menuItem(n["select-all"],{disabled:g}),menuItem(n["select-none"],{disabled:!b})),menuGroup("selection",_&&menuItem(n["toggle-auto-size"]),w&&menuItem(n["edit-link"]),menuItem(n.duplicate,{disabled:!b}),P&&menuItem(n.group),E&&menuItem(n.ungroup),menuItem(n["unlock-all"],{disabled:g})),menuGroup("delete-group",menuItem(n.delete,{disabled:!b})),menuGroup("embeds",$&&menuItem(n["open-embed-link"]),$&&menuItem(n["convert-to-bookmark"]),M&&menuItem(n["convert-to-embed"]))),menuSubmenu("view","menu.view",menuGroup("view-actions",menuItem(n["zoom-in"]),menuItem(n["zoom-out"]),menuItem(n["zoom-to-100"],{disabled:A}),menuItem(n["zoom-to-fit"],{disabled:g}),menuItem(n["zoom-to-selection"],{disabled:g||!b})))),menuGroup("extras",menuItem(n["insert-embed"]),menuItem(n["insert-media"])),menuGroup("preferences",menuSubmenu("preferences","menu.preferences",menuGroup("preferences-actions",menuItem(n["toggle-snap-mode"],{checked:c}),menuItem(n["toggle-tool-lock"],{checked:u}),menuItem(n["toggle-grid"],{checked:d}),menuItem(n["toggle-dark-mode"],{checked:a}),menuItem(n["toggle-focus-mode"],{checked:p}),menuItem(n["toggle-reduce-motion"],{checked:0===l}),menuItem(n["toggle-debug-mode"],{checked:h}))),o&&menuCustom("LANGUAGE_MENU",{readonlyOk:!0}))]);return e?e(r,t,{actions:n,noneSelected:y,oneSelected:b,twoSelected:v,threeSelected:S}):t},[r,e,n,b,v,S,g,o,P,E,w,x,_,y,C,k,l,a,d,c,u,p,f,h,A,M,$]);return(0,I.jsx)(s0.Provider,{value:D,children:t})}function useMenuSchema(){let e=T.useContext(s0);if(!e)throw Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}function toolbarItem(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}let s1=T.createContext([]);function ToolbarSchemaProvider({overrides:e,children:t}){let r=useEditor(),n=useTools(),i=T.useMemo(()=>{let t=compact([toolbarItem(n.select),toolbarItem(n.hand),toolbarItem(n.draw),toolbarItem(n.eraser),toolbarItem(n.arrow),toolbarItem(n.text),toolbarItem(n.note),toolbarItem(n.asset),toolbarItem(n.rectangle),toolbarItem(n.ellipse),toolbarItem(n.diamond),toolbarItem(n.triangle),toolbarItem(n.trapezoid),toolbarItem(n.rhombus),toolbarItem(n.hexagon),toolbarItem(n.cloud),toolbarItem(n.star),toolbarItem(n.oval),toolbarItem(n["x-box"]),toolbarItem(n["check-box"]),toolbarItem(n["arrow-left"]),toolbarItem(n["arrow-up"]),toolbarItem(n["arrow-down"]),toolbarItem(n["arrow-right"]),toolbarItem(n.frame),toolbarItem(n.line),toolbarItem(n.highlight),toolbarItem(n.laser)]);return e?e(r,t,{tools:n}):t},[r,e,n]);return(0,I.jsx)(s1.Provider,{value:i,children:t})}function useToolbarSchema(){let e=T.useContext(s1);if(!e)throw Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function useDefaultHelpers(){let{addToast:e,removeToast:t,clearToasts:r}=useToasts(),{addDialog:n,clearDialogs:i,removeDialog:o,updateDialog:a}=useDialogs(),l=useBreakpoint(),d=l<5,c=useTranslation();return(0,T.useMemo)(()=>({addToast:e,removeToast:t,clearToasts:r,addDialog:n,clearDialogs:i,removeDialog:o,updateDialog:a,msg:c,isMobile:d}),[n,e,i,r,c,o,t,a,d])}function mergeOverrides(e,t){let r={};for(let t of e)if(t.translations)for(let[e,n]of objectMapEntries(t.translations)){let t=r[e];t||(t=r[e]={}),Object.assign(t,n)}return{actionsMenu:(r,n,i)=>{for(let o of e)o.actionsMenu&&(n=o.actionsMenu(r,n,{...t,...i}));return n},actions:(r,n)=>{for(let i of e)i.actions&&(n=i.actions(r,n,t));return n},contextMenu:(r,n,i)=>{for(let o of e)o.contextMenu&&(n=o.contextMenu(r,n,{...t,...i}));return n},helpMenu:(r,n,i)=>{for(let o of e)o.helpMenu&&(n=o.helpMenu(r,n,{...t,...i}));return n},menu:(r,n,i)=>{for(let o of e)o.menu&&(n=o.menu(r,n,{...t,...i}));return n},toolbar:(r,n,i)=>{for(let o of e)o.toolbar&&(n=o.toolbar(r,n,{...t,...i}));return n},keyboardShortcutsMenu:(r,n,i)=>{for(let o of e)o.keyboardShortcutsMenu&&(n=o.keyboardShortcutsMenu(r,n,{...t,...i}));return n},tools:(r,n,i)=>{for(let o of e)o.tools&&(n=o.tools(r,n,{...t,...i}));return n},translations:r}}function useShallowArrayEquality(e){return(0,T.useMemo)(()=>e,e)}function useMergedTranslationOverrides(e){let t=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,T.useMemo)(()=>{let e={};for(let r of t)if(r.translations)for(let[t,n]of objectMapEntries(r.translations)){let r=e[t];r||(r=e[t]={}),Object.assign(r,n)}return e},[t])}function useMergedOverrides(e){let t=useDefaultHelpers(),r=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,T.useMemo)(()=>mergeOverrides(r,t),[r,t])}function TldrawUiContextProvider({overrides:e,assetUrls:t,onUiEvent:r,children:n}){return(0,I.jsx)(AssetUrlsProvider,{assetUrls:useDefaultUiAssetUrlsWithOverrides(t),children:(0,I.jsx)(iF,{overrides:useMergedTranslationOverrides(e),children:(0,I.jsx)(UiEventsProvider,{onEvent:r,children:(0,I.jsx)(ToastsProvider,{children:(0,I.jsx)(DialogsProvider,{children:(0,I.jsx)(BreakPointProvider,{children:(0,I.jsx)(InternalProviders,{overrides:e,children:n})})})})})})})}function InternalProviders({overrides:e,children:t}){let r=useMergedOverrides(e);return(0,I.jsx)(ActionsProvider,{overrides:r.actions,children:(0,I.jsx)(ToolsProvider,{overrides:r.tools,children:(0,I.jsx)(ToolbarSchemaProvider,{overrides:r.toolbar,children:(0,I.jsx)(sW,{overrides:r.actionsMenu,children:(0,I.jsx)(sZ,{overrides:r.keyboardShortcutsMenu,children:(0,I.jsx)(sq,{overrides:r.contextMenu,children:(0,I.jsx)(sJ,{overrides:r.helpMenu,children:(0,I.jsx)(TLUiMenuSchemaProvider,{overrides:r.menu,children:t})})})})})})})})}function BackToContent(){let e=useEditor(),t=useActions(),r=t["back-to-content"],[n,i]=(0,T.useState)(!1);return((0,T.useEffect)(()=>{let t=!1,r=setInterval(()=>{let{renderingShapes:r,renderingBounds:n}=e,o=r.filter(e=>e.maskedPageBounds&&n.includes(e.maskedPageBounds)),a=0===o.length&&e.currentPageShapes.length>0;t!==a&&(i(a),t=a)},1e3);return()=>{clearInterval(r)}},[e]),n)?(0,I.jsx)(iH,{iconLeft:r.icon,label:r.label,onClick:()=>{r.onSelect("helper-buttons"),i(!1)}}):null}let s2=0;function createNShapes(e,t){let r=Array(t),n=Math.floor(Math.sqrt(t));for(let e=0;e<t;e++)s2++,r[e]={id:createShapeId("box"+s2),type:"geo",x:e%n*132,y:132*Math.floor(e/n)};e.batch(()=>{e.createShapes(r).setSelectedShapes(r.map(e=>e.id))})}let s3=T.memo(function({renderDebugMenuItems:e}){let t=useTranslation();return(0,I.jsxs)("div",{className:"tlui-debug-panel",children:[(0,I.jsx)(s5,{}),(0,I.jsx)(ShapeCount,{}),(0,I.jsxs)(Root,{id:"debug",children:[(0,I.jsx)(Trigger,{children:(0,I.jsx)(iH,{icon:"dots-horizontal",title:t("debug-panel.more")})}),(0,I.jsx)(Content,{side:"top",align:"end",alignOffset:0,children:(0,I.jsx)(s4,{renderDebugMenuItems:e})})]})]})}),s5=track(function(){let e=useEditor();return(0,I.jsx)("div",{className:"tlui-debug-panel__current-state",children:e.root.path.value})}),ShapeCount=function(){let e=useEditor(),t=useValue("rendering shapes count",()=>e.renderingShapes.length,[e]);return(0,I.jsxs)("div",{children:[t," Shapes"]})},s4=track(function({renderDebugMenuItems:e}){let t=useEditor(),{addToast:r}=useToasts(),{addDialog:n}=useDialogs(),[i,o]=T.useState(!1);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Group,{children:[(0,I.jsx)(Item,{onClick:()=>{r({id:uniqueId(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!"})},children:(0,I.jsx)("span",{children:"Show toast"})}),(0,I.jsx)(Item,{onClick:()=>{n({component:({onClose:e})=>(0,I.jsx)(ExampleDialog,{displayDontShowAgain:!0,onCancel:()=>{e()},onContinue:()=>{e()}}),onClose:()=>{}})},children:(0,I.jsx)("span",{children:"Show dialog"})}),(0,I.jsx)(Item,{onClick:()=>createNShapes(t,100),children:(0,I.jsx)("span",{children:"Create 100 shapes"})}),(0,I.jsx)(Item,{onClick:()=>{function countDescendants({children:e}){let t=0;if(!e.length)return 0;for(let r of[...e])t++,t+=countDescendants(r);return t}let{selectedShapes:e}=t,r=0===e.length?t.renderingShapes:e,n=r.map(e=>document.getElementById(e.id).parentElement),i=n.length;for(let e of n)i+=countDescendants(e);window.alert(`Shapes ${r.length}, DOM nodes:${i}`)},children:(0,I.jsx)("span",{children:"Count shapes and nodes"})}),(()=>{if(i)throw Error("oh no!")})(),(0,I.jsx)(Item,{onClick:()=>{o(!0)},children:(0,I.jsx)("span",{children:"Throw error"})}),(0,I.jsx)(Item,{onClick:()=>{hardResetEditor()},children:(0,I.jsx)("span",{children:"Hard reset"})})]}),(0,I.jsxs)(Group,{children:[(0,I.jsx)(s8,{flag:rZ.debugSvg}),(0,I.jsx)(s8,{flag:rZ.forceSrgb}),(0,I.jsx)(s8,{flag:rZ.debugGeometry}),(0,I.jsx)(s8,{flag:rZ.hideShapes})]}),(0,I.jsx)(Group,{children:Object.values(rX).map(e=>(0,I.jsx)(s8,{flag:e},e.name))}),e?.()]})});function Toggle({label:e,value:t,onChange:r}){return(0,I.jsx)(CheckboxItem,{title:e,checked:t,onSelect:()=>r(!t),children:e})}let s8=track(function({flag:e,onChange:t}){return(0,I.jsx)(Toggle,{label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),value:e.value,onChange:r=>{e.set(r),t?.(r)}})});function ExampleDialog({title:e="title",body:t="hello hello hello",cancel:r="Cancel",confirm:n="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:a}){let[l,d]=T.useState(!1);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Header,{children:[(0,I.jsx)(Title,{children:e}),(0,I.jsx)(CloseButton,{})]}),(0,I.jsx)(Body,{style:{maxWidth:350},children:t}),(0,I.jsxs)(Footer,{className:"tlui-dialog__footer__actions",children:[i&&(0,I.jsx)(iH,{onClick:()=>d(!l),iconLeft:l?"checkbox-checked":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),(0,I.jsx)(iH,{onClick:o,children:r}),(0,I.jsx)(iH,{type:"primary",onClick:async()=>a(),children:n})]})]})}let Dialog=({id:e,component:t,onClose:r})=>{let{removeDialog:n}=useDialogs(),i=useContainer(),o=(0,T.useCallback)(t=>{if(!t){if(r)try{r()}catch(e){console.warn(e)}n(e)}},[e,r,n]);return(0,I.jsx)($5d3850c4d0b4e6c7$export$be92b6f5f03c0fe9,{onOpenChange:o,defaultOpen:!0,children:(0,I.jsx)($5d3850c4d0b4e6c7$export$602eac185826482c,{container:i,children:(0,I.jsx)(ea,{dir:"ltr",className:"tlui-dialog__overlay",children:(0,I.jsx)(ed,{dir:"ltr",className:"tlui-dialog__content",children:(0,I.jsx)(t,{onClose:()=>o(!1)})})})})})};function _Dialogs(){let{dialogs:e}=useDialogs();return(0,I.jsx)(I.Fragment,{children:e.map(e=>(0,I.jsx)(Dialog,{...e},e.id))})}let s6=T.memo(_Dialogs);function FollowingIndicator(){let e=useEditor(),t=useValue("follow",()=>e.instanceState.followingUserId,[e]);return t?(0,I.jsx)(FollowingIndicatorInner,{userId:t}):null}function FollowingIndicatorInner({userId:e}){let t=usePresence(e);return t?(0,I.jsx)("div",{className:"tlui-following",style:{borderColor:t.color}}):null}function LanguageMenu(){let e=useEditor(),{languages:t,currentLanguage:r}=useLanguages(),n=(0,T.useCallback)(t=>e.user.updateUserPreferences({locale:t}),[e]);return(0,I.jsxs)(Sub,{id:"help menu language",children:[(0,I.jsx)(SubTrigger,{label:"menu.language","data-direction":"left"}),(0,I.jsx)(SubContent,{sideOffset:-4,children:(0,I.jsx)(Group,{children:t.map(({locale:e,label:t})=>(0,I.jsx)(RadioItem,{title:e,checked:e===r,onSelect:()=>n(e),children:(0,I.jsx)("span",{children:t})},e))})})]})}let s9=T.memo(function(){let e=useContainer(),t=useTranslation(),[r,n]=useMenuIsOpen("help menu");return(0,I.jsx)("div",{className:"tlui-help-menu",children:(0,I.jsxs)($d08ef79370b62062$export$be92b6f5f03c0fe9,{dir:"ltr",open:r,onOpenChange:n,modal:!1,children:[(0,I.jsx)(as,{className:"tlui-button tlui-help-menu__button",dir:"ltr",title:t("help-menu.title"),children:(0,I.jsx)(iN,{icon:"question-mark"})}),(0,I.jsx)($d08ef79370b62062$export$602eac185826482c,{container:e,dir:"ltr",children:(0,I.jsx)(al,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:(0,I.jsx)(HelpMenuContent,{})})})]})})});function HelpMenuContent(){let e=useHelpMenuSchema(),t=useReadonly();function getHelpMenuItem(e){if(t&&!e.readonlyOk)return null;switch(e.type){case"custom":if("LANGUAGE_MENU"===e.id)return(0,I.jsx)(LanguageMenu,{},"item");break;case"group":return(0,I.jsx)(Group,{size:"small",children:e.children.map(getHelpMenuItem)},e.id);case"submenu":return(0,I.jsxs)(Sub,{id:`help menu ${e.id}`,children:[(0,I.jsx)(SubTrigger,{label:e.label}),(0,I.jsx)(SubContent,{children:e.children.map(getHelpMenuItem)})]},e.id);case"item":{let{id:t,kbd:r,label:n,onSelect:i,icon:o}=e.actionItem;return(0,I.jsx)(Item,{kbd:r,label:n,onClick:()=>i("help-menu"),iconLeft:o},t)}}}return(0,I.jsx)(I.Fragment,{children:e.map(getHelpMenuItem)})}var s7=r(5302);let Popover=({id:e,children:t,onOpenChange:r})=>{let[n,i]=useMenuIsOpen(e,r);return(0,I.jsx)(s7.Root,{onOpenChange:i,open:n,children:(0,I.jsx)("div",{className:"tlui-popover",children:t})})},PopoverTrigger=({children:e,disabled:t,"data-testid":r})=>(0,I.jsx)(s7.Trigger,{"data-testid":r,disabled:t,asChild:!0,dir:"ltr",children:e}),PopoverContent=({side:e,children:t,align:r="center",sideOffset:n=8,alignOffset:i=0})=>{let o=useContainer();return(0,I.jsx)(s7.Portal,{dir:"ltr",container:o,children:(0,I.jsx)(s7.Content,{className:"tlui-popover__content",side:e,sideOffset:n,align:r,alignOffset:i,dir:"ltr",children:t})})},le=(0,T.memo)(function(){let e=useTranslation(),t=useContainer(),r=useActionsMenuSchema(),n=useReadonly();function getActionMenuItem(t){if(n&&!t.readonlyOk)return null;if("item"===t.type){let{id:r,icon:n,label:i,kbd:o,onSelect:a}=t.actionItem;return(0,I.jsx)(iH,{className:"tlui-button-grid__button","data-testid":`menu-item.${t.id}`,icon:n,title:i?o?`${e(i)} ${kbdStr(o)}`:`${e(i)}`:o?`${kbdStr(o)}`:"",onClick:()=>a("actions-menu"),disabled:t.disabled},r)}}return(0,I.jsxs)(Popover,{id:"actions menu",children:[(0,I.jsx)(PopoverTrigger,{children:(0,I.jsx)(iH,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),smallIcon:!0})}),(0,I.jsx)(s7.Portal,{dir:"ltr",container:t,children:(0,I.jsx)(s7.Content,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:(0,I.jsx)("div",{className:"tlui-actions-menu tlui-button-grid__four",children:r.map(getActionMenuItem)})})})]})}),lt=track(function(){let e=useEditor(),t=useActions(),r=useTranslation(),n=t.duplicate;return(0,I.jsx)(iH,{icon:n.icon,onClick:()=>n.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.selectedShapeIds.length>0),title:`${r(n.label)} ${kbdStr(n.kbd)}`,smallIcon:!0})}),lr=T.memo(function(){let e=useTranslation();return(0,I.jsxs)(Root,{id:"main menu",children:[(0,I.jsx)(Trigger,{children:(0,I.jsx)(iH,{className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu"})}),(0,I.jsx)(Content,{alignOffset:0,sideOffset:6,children:(0,I.jsx)(MenuContent,{})})]})});function MenuContent(){let e=useEditor(),t=useTranslation(),r=useMenuSchema(),n=useBreakpoint(),i=useReadonly();function getMenuItem(e,r,o,a){switch(r.type){case"custom":if(i&&!r.readonlyOk)return null;if("LANGUAGE_MENU"===r.id)return(0,I.jsx)(LanguageMenu,{},"item");return null;case"group":if(i&&!r.readonlyOk)return null;return(0,I.jsx)(Group,{size:a<=1?"medium":n<3||o?.type==="submenu"&&a>2?"tiny":"medium",children:r.children.map(t=>getMenuItem(e,t,r,a+1))},r.id);case"submenu":if(i&&!r.readonlyOk)return null;return(0,I.jsxs)(Sub,{id:`main menu ${o?o.id+" ":""}${r.id}`,children:[(0,I.jsx)(SubTrigger,{label:r.label,"data-testid":`menu-item.${r.id}`}),(0,I.jsx)(SubContent,{sideOffset:-4,alignOffset:-1,children:r.children.map(t=>getMenuItem(e,t,r,a+1))})]},r.id);case"item":{if(i&&!r.readonlyOk)return null;let{id:e,checkbox:n,menuLabel:o,label:a,onSelect:l,kbd:d}=r.actionItem,c=o??a,u=c?t(c):void 0;if(n)return(0,I.jsxs)(CheckboxItem,{onSelect:()=>l("menu"),title:u||"",checked:r.checked,disabled:r.disabled,children:[u&&(0,I.jsx)("span",{children:u}),d&&(0,I.jsx)(Kbd,{children:d})]},e);return(0,I.jsx)(Item,{"data-testid":`menu-item.${r.id}`,kbd:d,label:c,onClick:()=>l("menu"),disabled:r.disabled},e)}}}return(0,I.jsx)(I.Fragment,{children:r.map(t=>getMenuItem(e,t,null,0))})}let PageItemInput=function({name:e,id:t,isCurrentPage:r}){let n=useEditor(),i=(0,T.useRef)(null),o=(0,T.useCallback)(e=>{n.renamePage(t,e||"New Page",{ephemeral:!0})},[n,t]),a=(0,T.useCallback)(e=>{n.mark("rename page"),n.renamePage(t,e||"New Page",{ephemeral:!1})},[n,t]);return(0,I.jsx)(sE,{className:"tlui-page-menu__item__input",ref:e=>i.current=e,defaultValue:e,onValueChange:o,onComplete:a,onCancel:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:r,autoselect:!0})},onMovePage=(e,t,r,n)=>{let i;let o=e.pages,a=r>n?o[n-1]:o[n],l=r>n?o[n]:o[n+1];(i=a&&!l?getIndexAbove(a.index):!a&&l?getIndexBelow(o[0].index):getIndexBetween(a.index,l.index))!==o[r].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},ln=track(function({index:e,listSize:t,item:r,onRename:n}){let i=useEditor(),o=useTranslation(),a=i.pages,l=(0,T.useCallback)(()=>{i.mark("creating page");let e=tp.createId();i.duplicatePage(r.id,e)},[i,r]),d=(0,T.useCallback)(()=>{onMovePage(i,r.id,e,e-1)},[i,r,e]),c=(0,T.useCallback)(()=>{onMovePage(i,r.id,e,e+1)},[i,r,e]),u=(0,T.useCallback)(()=>{i.mark("deleting page"),i.deletePage(r.id)},[i,r]);return(0,I.jsxs)(Root,{id:`page item submenu ${e}`,children:[(0,I.jsx)(Trigger,{children:(0,I.jsx)(iH,{title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),(0,I.jsxs)(Content,{alignOffset:0,children:[(0,I.jsxs)(Group,{children:[n&&(0,I.jsx)(ac,{dir:"ltr",onSelect:n,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"page-menu.submenu.rename"})}),(0,I.jsx)(ac,{dir:"ltr",onSelect:l,disabled:a.length>=ni,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"page-menu.submenu.duplicate-page"})}),e>0&&(0,I.jsx)(ac,{dir:"ltr",onSelect:d,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"page-menu.submenu.move-up"})}),e<t-1&&(0,I.jsx)(ac,{dir:"ltr",onSelect:c,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"page-menu.submenu.move-down"})})]}),t>1&&(0,I.jsx)(Group,{children:(0,I.jsx)(ac,{dir:"ltr",onSelect:u,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"page-menu.submenu.delete"})})})]})]})}),PageMenu=function(){let e=useEditor(),t=useTranslation(),r=useBreakpoint(),n=(0,T.useCallback)(()=>m(!1),[]),[i,o]=useMenuIsOpen("page-menu",n),a=r<5?36:40,l=(0,T.useRef)(null),d=useValue("pages",()=>e.pages,[e]),c=useValue("currentPage",()=>e.currentPage,[e]),u=useValue("currentPageId",()=>e.currentPageId,[e]),p=useReadonly(),h=useValue("maxPageCountReached",()=>e.pages.length>=ni,[e]),f=useValue("isCoarsePointer",()=>e.instanceState.isCoarsePointer,[e]),[g,m]=(0,T.useState)(!1),y=(0,T.useCallback)(()=>{p||m(e=>!e)},[p]),b=(0,T.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[v,S]=(0,T.useState)(Object.fromEntries(d.map((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}])));(0,T.useLayoutEffect)(()=>{S(Object.fromEntries(d.map((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}])))},[a,d]),(0,T.useEffect)(()=>{i&&requestAnimationFrame(()=>{let e=document.querySelector(`[data-testid="page-menu-item-${u}"]`);if(e){let t=l.current;if(!t)return;let r=e.offsetTop,n=t.scrollTop;r<n&&t.scrollTo({top:r});let i=r+a,o=t.scrollTop+t.offsetHeight;i>o&&t.scrollTo({top:i-t.offsetHeight})}})},[a,u,i]);let x=(0,T.useCallback)(e=>{let{clientY:t,currentTarget:r}=e,{dataset:{id:n,index:i}}=r;if(!n||!i)return;let o=b.current;setPointerCapture(e.currentTarget,e),o.status="pointing",o.pointing={id:n,index:+i};let l=v[n],c=l.y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(c/a),d.length-1))},[a,d.length,v]),w=(0,T.useCallback)(e=>{let t=b.current;if("pointing"===t.status){let{clientY:r}=e,n=r-t.startY;Math.abs(n)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:r}=e,n=r-t.startY,i=v[t.pointing.id],{startIndex:o,pointing:l}=t,c=i.y+n,u=Math.max(0,Math.min(Math.round(c/a),d.length-1)),p={...v};if(p[l.id]={y:i.y,offsetY:n,isSelected:!0},u!==t.dragIndex){t.dragIndex=u;for(let e=0;e<d.length;e++){let r=d[e];if(r.id===t.pointing.id)continue;let{y:n}=p[r.id];u===o?n=e*a:u<o?n=u<=e&&e<o?(e+1)*a:e*a:u>o&&(n=u>=e&&e>o?(e-1)*a:e*a),n!==p[r.id].y&&(p[r.id]={y:n,offsetY:0,isSelected:!0})}}S(p)}},[a,d,v]),_=(0,T.useCallback)(t=>{let r=b.current;if("dragging"===r.status){let{id:t,index:n}=r.pointing;onMovePage(e,t,n,r.dragIndex)}releasePointerCapture(t.currentTarget,t),r.status="idle"},[e]),P=(0,T.useCallback)(e=>{let t=b.current;"Escape"===e.key&&("dragging"===t.status&&S(Object.fromEntries(d.map((e,t)=>[e.id,{y:t*a,offsetY:0,isSelected:!1}]))),t.status="idle")},[a,d]),E=(0,T.useCallback)(()=>{p||e.batch(()=>{e.mark("creating page");let r=tp.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:r}),e.setCurrentPage(r),m(!0)})},[e,t,p]);return(0,I.jsxs)(Popover,{id:"page menu",onOpenChange:o,open:i,children:[(0,I.jsx)(PopoverTrigger,{children:(0,I.jsx)(iH,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",title:c.name,children:(0,I.jsx)("div",{className:"tlui-page-menu__name",children:c.name})})}),(0,I.jsx)(PopoverContent,{side:"bottom",align:"start",sideOffset:6,children:(0,I.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,I.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,I.jsx)("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!p&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(iH,{"data-testid":"page-menu.edit",title:t(g?"page-menu.edit-done":"page-menu.edit-start"),icon:g?"check":"edit",onClick:y}),(0,I.jsx)(iH,{"data-testid":"page-menu.create",icon:"plus",title:t(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:E})]})]}),(0,I.jsx)("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:a*d.length+4},ref:l,children:d.map((n,i)=>{let o=v[n.id]??{position:40*i,offsetY:0};return g?(0,I.jsxs)("div",{"data-testid":`page-menu-item-${n.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:n.id===c.id?888:i,transform:`translate(0px, ${o.y+o.offsetY}px)`},children:[(0,I.jsx)(iH,{tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:x,onPointerUp:_,onPointerMove:w,onKeyDown:P,"data-id":n.id,"data-index":i}),r<5&&f?(0,I.jsx)(iH,{className:"tlui-page-menu__item__button",onClick:()=>{let t=window.prompt("Rename page",n.name);t&&t!==n.name&&e.renamePage(n.id,t)},onDoubleClick:y,isChecked:n.id===c.id,children:(0,I.jsx)("span",{children:n.name})}):(0,I.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:a},children:(0,I.jsx)(PageItemInput,{id:n.id,name:n.name,isCurrentPage:n.id===c.id})}),!p&&(0,I.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:(0,I.jsx)(ln,{index:i,item:n,listSize:d.length})})]},n.id+"_editing"):(0,I.jsxs)("div",{"data-testid":`page-menu-item-${n.id}`,className:"tlui-page-menu__item",children:[(0,I.jsxs)(iH,{className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage(n.id),onDoubleClick:y,isChecked:n.id===c.id,title:t("page-menu.go-to-page"),children:[(0,I.jsx)("div",{className:"tlui-page-menu__item__button__check",children:n.id===c.id&&(0,I.jsx)(iN,{icon:"check"})}),(0,I.jsx)("span",{children:n.name})]}),!p&&(0,I.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,I.jsx)(ln,{index:i,item:n,listSize:d.length,onRename:()=>{if(e.environment.isIos){let t=window.prompt("Rename page",n.name);t&&t!==n.name&&e.renamePage(n.id,t)}else e.batch(()=>{m(!0),e.setCurrentPage(n.id)})}})})]},n.id)})})]})})]})},li=(0,T.memo)(function(){let e=useTranslation(),t=useCanRedo(),r=useActions(),n=r.redo;return(0,I.jsx)(iH,{"data-testid":"main.redo",icon:n.icon,title:`${e(n.label)} ${kbdStr(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})}),lo=track(function(){let e=useEditor(),t=useActions(),r=useTranslation(),n=t.delete,i=useReadonly();return i?null:(0,I.jsx)(iH,{icon:n.icon,onClick:()=>n.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.selectedShapeIds.length>0),title:`${r(n.label)} ${kbdStr(n.kbd)}`,smallIcon:!0})}),la=(0,T.memo)(function(){let e=useTranslation(),t=useCanUndo(),r=useActions(),n=r.undo;return(0,I.jsx)(iH,{"data-testid":"main.undo",icon:n.icon,title:`${e(n.label)} ${kbdStr(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})}),ls=track(function(){let e=useEditor(),t=useBreakpoint(),r=useReadonly();return(0,I.jsx)("div",{className:"tlui-menu-zone",children:(0,I.jsxs)("div",{className:"tlui-menu-zone__controls",children:[(0,I.jsx)(lr,{}),(0,I.jsx)("div",{className:"tlui-menu-zone__divider"}),(0,I.jsx)(PageMenu,{}),t>=6&&!r&&!e.isInAny("hand","zoom")&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"tlui-menu-zone__divider"}),(0,I.jsx)(la,{}),(0,I.jsx)(li,{}),(0,I.jsx)(lo,{}),(0,I.jsx)(lt,{}),(0,I.jsx)(le,{})]})]})})});function useLocalStorageState(e,t){let[r,n]=T.useState(t);T.useLayoutEffect(()=>{let t=localStorage.getItem(e);if(t)try{n(JSON.parse(t))}catch(t){console.error(`Could not restore value ${e} from local storage.`)}},[e]);let i=T.useCallback(t=>{n(r=>{let n="function"==typeof t?t(r):t;return localStorage.setItem(e,JSON.stringify(n)),n})},[e]);return[r,i]}let MinimapManager=class MinimapManager{constructor(e){this.editor=e}dpr=1;colors={shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"};id=uniqueId();cvs=null;pageBounds=[];collaborators=[];canvasScreenBounds=new Box2d_Box2d;canvasPageBounds=new Box2d_Box2d;contentPageBounds=new Box2d_Box2d;contentScreenBounds=new Box2d_Box2d;originPagePoint=new Vec2d_Vec2d;originPageCenter=new Vec2d_Vec2d;isInViewport=!1;debug=!1;setDpr(e){this.dpr=+e.toFixed(2)}updateContentScreenBounds=()=>{let{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:r}=this,{x:n,y:i,w:o,h:a}=e;if(t.w>t.h){let e=r.w/(t.w/t.h);e>r.h?(n=(r.w-r.w*(r.h/e))/2,i=0,o=r.w*(r.h/e),a=r.h):(n=0,i=(r.h-e)/2,o=r.w,a=e)}else if(t.w<t.h){let e=r.h/(t.h/t.w);n=(r.w-e)/2,i=0,o=e,a=r.h}else n=r.h/2,i=0,o=r.h,a=r.h;e.set(n,i,o,a)};updateCanvasPageBounds=()=>{let{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:r,contentScreenBounds:n}=this;e.set(0,0,r.width/(n.width/t.width),r.height/(n.height/t.height)),e.center=r.center};getScreenPoint=(e,t)=>{let{canvasScreenBounds:r}=this,n=(e-r.minX)*this.dpr,i=(t-r.minY)*this.dpr;return{x:n,y:i}};getPagePoint=(e,t)=>{let{contentPageBounds:r,contentScreenBounds:n,canvasPageBounds:i}=this,{x:o,y:a}=this.getScreenPoint(e,t);return new Vec2d_Vec2d(i.minX+o*r.width/n.width,i.minY+a*r.height/n.height,1)};minimapScreenPointToPagePoint=(e,t,r=!1,n=!1)=>{let{editor:i}=this,{viewportPageBounds:o}=i,{x:a,y:l}=this.getPagePoint(e,t);if(n){let e=this.editor.currentPageBounds,t=(e?.minX??0)-o.width/2,r=(e?.maxX??0)+o.width/2,n=(e?.minY??0)-o.height/2,i=(e?.maxY??0)+o.height/2,d=Math.max(0,t+o.width-a),c=Math.max(0,-(r-o.width-a)),u=Math.max(0,n+o.height-l),p=Math.max(0,-(i-o.height-l)),h=Math.max(0,d-c),f=Math.max(0,c-d),g=Math.max(0,u-p),m=Math.max(0,p-u);h&&h>f?a+=h/2:f&&(a-=f/2),g&&g>m?l+=g/2:m&&(l-=m/2),a=clamp(a,t,r),l=clamp(l,n,i)}if(r){let{originPagePoint:e}=this,t=Math.abs(a-e.x),r=Math.abs(l-e.y);t>r?l=e.y:a=e.x}return new Vec2d_Vec2d(a,l)};render=()=>{let e,t;let{cvs:r,pageBounds:n}=this;this.updateCanvasPageBounds();let{editor:i,canvasScreenBounds:o,canvasPageBounds:a,contentPageBounds:l,contentScreenBounds:d}=this,{width:c,height:u}=o,{viewportPageBounds:p,selectedShapeIds:h}=i;if(!r||!n)return;let f=r.getContext("2d");if(!f)throw Error("Minimap (shapes): Could not get context");f.resetTransform(),f.globalAlpha=1,f.clearRect(0,0,c,u);let g=d.width/l.width,m=d.height/l.height;f.translate((c-d.width)/2,(u-d.height)/2),f.scale(g,m),f.translate(-l.minX,-l.minY);let y=8/g,b=8/g,v=1/g,S=1/g,x=y/4,w=b/4,_=new Path2D,P=new Path2D,{shapeFill:E,selectFill:C,viewportFill:k}=this.colors;for(let t=0,r=n.length;t<r;t++)e=n[t],MinimapManager.roundedRect(h.includes(e.id)?P:_,e.minX,e.minY,e.width,e.height,clamp(y,v,e.width/x),clamp(b,S,e.height/w));if(f.fillStyle=E,f.fill(_),f.fillStyle=C,f.fill(P),this.debug){let e=Box2d_Box2d.Common(n),{minX:t,minY:r,width:i,height:o}=e;f.strokeStyle="green",f.lineWidth=2/g,f.strokeRect(t+1/g,r+1/m,i-2/g,o-2/m)}{let{brush:e}=i.instanceState;if(e){let{x:t,y:r,w:n,h:i}=e;f.beginPath(),MinimapManager.sharpRect(f,t,r,n,i),f.closePath(),f.fillStyle=k,f.fill()}}{let{minX:e,minY:t,width:r,height:n}=p;f.beginPath();let i=12/g,o=12/g;MinimapManager.roundedRect(f,e,t,r,n,Math.min(r/4,i),Math.min(n/4,o)),f.closePath(),f.fillStyle=k,f.fill(),this.debug&&(f.strokeStyle="orange",f.strokeRect(e+1/g,t+1/m,r-2/g,n-2/m))}let I=2.5/g,T=2.5/m,{currentPageId:A}=i;for(let e=0;e<this.collaborators.length;e++)(t=this.collaborators[e]).currentPageId===A&&(f.beginPath(),f.ellipse(clamp(t.cursor.x,a.minX+I,a.maxX-I),clamp(t.cursor.y,a.minY+T,a.maxY-T),5/g,5/m,0,0,r9),f.fillStyle=t.color,f.fill());if(this.debug){f.lineWidth=2/g;{let{minX:e,minY:t,width:r,height:n}=l;f.strokeStyle="red",f.strokeRect(e+1/g,t+1/m,r-2/g,n-2/m)}{let{minX:e,minY:t,width:r,height:n}=a;f.strokeStyle="blue",f.strokeRect(e+1/g,t+1/m,r-2/g,n-2/m)}}};static roundedRect(e,t,r,n,i,o,a){if(o<1&&a<1){e.rect(t,r,n,i);return}e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+a),e.lineTo(t+n,r+i-a),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-a),e.lineTo(t,r+a),e.quadraticCurveTo(t,r,t+o,r)}static sharpRect(e,t,r,n,i,o,a){e.rect(t,r,n,i)}};function Minimap({shapeFill:e,selectFill:t,viewportFill:r}){let n=useEditor(),i=T.useRef(null),o=T.useRef(!1),a=useIsDarkMode(),l=useComputed("dpr",()=>n.instanceState.devicePixelRatio,[n]),d=T.useMemo(()=>n.store.query.records("instance_presence"),[n]),c=T.useMemo(()=>new MinimapManager(n),[n]);T.useEffect(()=>{let i=requestAnimationFrame(()=>{let i=getComputedStyle(n.getContainer());c.colors={shapeFill:i.getPropertyValue(e).trim(),selectFill:i.getPropertyValue(t).trim(),viewportFill:i.getPropertyValue(r).trim()},c.render()});return()=>{cancelAnimationFrame(i)}},[n,t,e,r,c,a]);let u=T.useCallback(e=>{if(!n.currentPageShapeIds.size)return;let t=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),r=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);c.originPagePoint.setTo(r),c.originPageCenter.setTo(n.viewportPageBounds.center),n.centerOnPoint(t,{duration:na})},[n,c]),p=T.useCallback(e=>{let t=e.currentTarget;if(setPointerCapture(t,e),!n.currentPageShapeIds.size)return;o.current=!0,c.isInViewport=!1;let r=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),i=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0),a=n.viewportPageBounds;if(c.isInViewport=a.containsPoint(i),c.isInViewport)c.originPagePoint.setTo(i),c.originPageCenter.setTo(a.center);else{let e=Vec2d_Vec2d.Sub(a.center,a.point),t=Vec2d_Vec2d.Add(r,e);c.originPagePoint.setTo(t),c.originPageCenter.setTo(r),n.centerOnPoint(r,{duration:na})}function release(e){t&&releasePointerCapture(t,e),o.current=!1,document.body.removeEventListener("pointerup",release)}document.body.addEventListener("pointerup",release)},[n,c]),h=T.useCallback(e=>{let t=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(o.current){if(c.isInViewport){let e=c.originPagePoint.clone().sub(c.originPageCenter);n.centerOnPoint(Vec2d_Vec2d.Sub(t,e));return}n.centerOnPoint(t)}let r=c.getPagePoint(e.clientX,e.clientY),i=n.pageToScreen(r),a={type:"pointer",target:"canvas",name:"pointer_move",...getPointerInfo(e),point:i,isPen:n.instanceState.isPenMode};n.dispatch(a)},[n,c]),f=T.useCallback(e=>{let t=normalizeWheel(e);n.dispatch({type:"wheel",name:"wheel",delta:t,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey})},[n]);return useQuickReactor("update when dpr changes",()=>{let e=l.value;c.setDpr(e);let t=i.current,r=t.getBoundingClientRect(),n=r.width*e,o=r.height*e;t.width=n,t.height=o,c.canvasScreenBounds.set(r.x,r.y,n,o),c.cvs=i.current},[l,c]),useQuickReactor("minimap render when pagebounds or collaborators changes",()=>{let{currentPageShapeIds:e,viewportPageBounds:t,currentPageBounds:r}=n;l.value,c.contentPageBounds=r?Box2d_Box2d.Expand(r,t):t,c.updateContentScreenBounds();let i=[];e.forEach(e=>{let t=n.getShapePageBounds(e);if(!t)return;let r=n.getShapeMask(e);if(r){let e=intersectPolygonPolygon(r,t.corners);if(!e)return;t=Box2d_Box2d.FromPoints(e)}t&&(t.id=e,i.push(t))}),c.pageBounds=i,c.collaborators=d.value,c.render()},[n,c]),(0,I.jsx)("div",{className:"tlui-minimap",children:(0,I.jsx)("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:h,onPointerDown:p,onWheel:f})})}let ll=track(function(){let e=useEditor(),t=useTranslation(),r=useBreakpoint(),n=e.zoomLevel,i=e.currentPageShapeIds.size>0,o=e.selectedShapeIds.length>0,a=1===e.zoomLevel,l=T.useCallback(()=>{e.resetZoom(e.viewportScreenCenter,{duration:na})},[e]);return(0,I.jsxs)(Root,{id:"zoom",children:[(0,I.jsx)(Trigger,{children:(0,I.jsx)(iH,{title:`${t("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:r<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,icon:r<4?"zoom-in":void 0,children:r<4?null:(0,I.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*n),"%"]})})}),(0,I.jsx)(Content,{side:"top",align:"start",alignOffset:0,children:(0,I.jsxs)(Group,{children:[(0,I.jsx)(ZoomMenuItem,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),(0,I.jsx)(ZoomMenuItem,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),(0,I.jsx)(ZoomMenuItem,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:a}),(0,I.jsx)(ZoomMenuItem,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),(0,I.jsx)(ZoomMenuItem,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function ZoomMenuItem(e){let{action:t,disabled:r=!1,noClose:n=!1}=e,i=useActions();return(0,I.jsx)(Item,{label:i[t].label,kbd:i[t].kbd,"data-testid":e["data-testid"],onClick:()=>i[t].onSelect("zoom-menu"),noClose:n,disabled:r})}let ld=(0,T.memo)(function(){let e=useActions(),t=useTranslation(),r=useBreakpoint(),[n,i]=useLocalStorageState("minimap",!0),o=(0,T.useCallback)(()=>{i(e=>!e)},[i]);return r<4?null:(0,I.jsxs)("div",{className:"tlui-navigation-zone",children:[(0,I.jsx)("div",{className:"tlui-navigation-zone__controls",children:r<6?(0,I.jsx)(ll,{}):n?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(ll,{}),(0,I.jsx)(iH,{title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle","data-testid":"minimap.toggle",onClick:o,icon:n?"chevrons-ne":"chevrons-sw"})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(iH,{icon:"minus","data-testid":"minimap.zoom-out",title:`${t(e["zoom-out"].label)} ${kbdStr(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),(0,I.jsx)(ll,{}),(0,I.jsx)(iH,{icon:"plus","data-testid":"minimap.zoom-in",title:`${t(e["zoom-in"].label)} ${kbdStr(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),(0,I.jsx)(iH,{title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o,icon:n?"chevrons-ne":"chevrons-sw"})]})}),r>=6&&!n&&(0,I.jsx)(Minimap,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),lc=track(function(){let e=useEditor(),t=e.instanceState.isPenMode,r=useActions();if(!t)return null;let n=r["exit-pen-mode"];return(0,I.jsx)(iH,{label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("helper-buttons")})}),lu=track(function(){let e=useEditor(),t=useActions();if(!e.instanceState.followingUserId)return null;let r=t["stop-following"];return(0,I.jsx)(iH,{label:r.label,iconLeft:r.icon,onClick:()=>r.onSelect("people-menu")})}),lp=[t0,t2,t3,t8];function useRelevantStyles(){let e=useEditor();return useValue("getRelevantStyles",()=>{let t=new SharedStyleMap(e.sharedStyles),r=e.selectedShapeIds.length>0||!!e.root.current.value?.shapeType;if(0===t.size&&e.isIn("select")&&0===e.selectedShapeIds.length)for(let r of lp)t.applyValue(r,e.getStyleForNextShape(r));return 0!==t.size||r?{styles:t,opacity:e.sharedOpacity}:null},[e])}function _ButtonPicker(e){let{uiType:t,items:r,title:n,style:i,value:o,columns:a=clamp(r.length,2,4),onValueChange:l}=e,d=useEditor(),c=useTranslation(),u=(0,T.useRef)(!1),{handleButtonClick:p,handleButtonPointerDown:h,handleButtonPointerEnter:f,handleButtonPointerUp:g}=T.useMemo(()=>{let handlePointerUp=()=>{u.current=!1,window.removeEventListener("pointerup",handlePointerUp)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(d.mark("point picker item"),l(i,t,!1))},handleButtonPointerDown:e=>{let{id:t}=e.currentTarget.dataset;d.mark("point picker item"),l(i,t,!0),u.current=!0,window.addEventListener("pointerup",handlePointerUp)},handleButtonPointerEnter:e=>{if(!u.current)return;let{id:t}=e.currentTarget.dataset;l(i,t,!0)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;l(i,t,!1)}}},[o,d,l,i]),m=useValue("theme",()=>getDefaultColorTheme({isDarkMode:d.user.isDarkMode}),[d]);return(0,I.jsx)("div",{className:eb("tlui-button-grid",{"tlui-button-grid__two":2===a,"tlui-button-grid__three":3===a,"tlui-button-grid__four":4===a}),children:r.map(e=>(0,I.jsx)(iH,{"data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===o.type&&o.value===e.value?"hinted":void 0,title:n+" — "+c(`${t}-style.${e.value}`),className:eb("tlui-button-grid__button"),style:i===t0?{color:m[e.value].solid}:void 0,onPointerEnter:f,onPointerDown:h,onPointerUp:g,onClick:p,icon:e.icon},e.value))})}let lh=T.memo(_ButtonPicker);function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(e,[t,r]){return Math.min(r,Math.max(t,e))}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(e){let t=(0,T.useRef)({value:e,previous:e});return(0,T.useMemo)(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}let lf=["PageUp","PageDown"],lg=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],lm={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ly="Slider",[lb,lv,lS]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2(ly),[lx,lw]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(ly,[lS]),[l_,lP]=lx(ly),lE=(0,T.forwardRef)((e,t)=>{let{name:r,min:n=0,max:i=100,step:o=1,orientation:a="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:c=[n],value:u,onValueChange:p=()=>{},onValueCommit:h=()=>{},inverted:f=!1,...g}=e,[m,y]=(0,T.useState)(null),b=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>y(e)),v=(0,T.useRef)(new Set),S=(0,T.useRef)(0),x=!m||!!m.closest("form"),w="horizontal"===a?lI:lT,[_=[],P]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:u,defaultProp:c,onChange:e=>{var t;let r=[...v.current];null===(t=r[S.current])||void 0===t||t.focus(),p(e)}}),E=(0,T.useRef)(_);function handleSlideStart(e){let t=$faa2e61a3361514f$var$getClosestValueIndex(_,e);updateValues(e,t)}function handleSlideMove(e){updateValues(e,S.current)}function handleSlideEnd(){let e=E.current[S.current],t=_[S.current];t!==e&&h(_)}function updateValues(e,t,{commit:r}={commit:!1}){let a=$faa2e61a3361514f$var$getDecimalCount(o),l=$faa2e61a3361514f$var$roundValue(Math.round((e-n)/o)*o+n,a),c=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(l,[n,i]);P((e=[])=>{let n=$faa2e61a3361514f$var$getNextSortedValues(e,c,t);if(!$faa2e61a3361514f$var$hasMinStepsBetweenValues(n,d*o))return e;{S.current=n.indexOf(c);let t=String(n)!==String(e);return t&&r&&h(n),t?n:e}})}return(0,T.createElement)(l_,{scope:e.__scopeSlider,disabled:l,min:n,max:i,valueIndexToChangeRef:S,thumbs:v.current,values:_,orientation:a},(0,T.createElement)(lb.Provider,{scope:e.__scopeSlider},(0,T.createElement)(lb.Slot,{scope:e.__scopeSlider},(0,T.createElement)(w,_extends({"aria-disabled":l,"data-disabled":l?"":void 0},g,{ref:b,onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(g.onPointerDown,()=>{l||(E.current=_)}),min:n,max:i,inverted:f,onSlideStart:l?void 0:handleSlideStart,onSlideMove:l?void 0:handleSlideMove,onSlideEnd:l?void 0:handleSlideEnd,onHomeKeyDown:()=>!l&&updateValues(n,0,{commit:!0}),onEndKeyDown:()=>!l&&updateValues(i,_.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){let r=lf.includes(e.key),n=r||e.shiftKey&&lg.includes(e.key),i=S.current,a=_[i],l=o*(n?10:1)*t;updateValues(a+l,i,{commit:!0})}}})))),x&&_.map((e,t)=>(0,T.createElement)($faa2e61a3361514f$var$BubbleInput,{key:t,name:r?r+(_.length>1?"[]":""):void 0,value:e})))}),[lC,lk]=lx(ly,{startEdge:"left",endEdge:"right",size:"width",direction:1}),lI=(0,T.forwardRef)((e,t)=>{let{min:r,max:n,dir:i,inverted:o,onSlideStart:a,onSlideMove:l,onSlideEnd:d,onStepKeyDown:c,...u}=e,[p,h]=(0,T.useState)(null),f=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>h(e)),g=(0,T.useRef)(),m=$f631663db3294ace$export$b39126d51d94e6f3(i),y="ltr"===m,b=y&&!o||!y&&o;function getValueFromPointer(e){let t=g.current||p.getBoundingClientRect(),i=[0,t.width],o=$faa2e61a3361514f$var$linearScale(i,b?[r,n]:[n,r]);return g.current=t,o(e-t.left)}return(0,T.createElement)(lC,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width"},(0,T.createElement)(lA,_extends({dir:m,"data-orientation":"horizontal"},u,{ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientX);null==a||a(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientX);null==l||l(t)},onSlideEnd:()=>{g.current=void 0,null==d||d()},onStepKeyDown:e=>{let t=lm[b?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})))}),lT=(0,T.forwardRef)((e,t)=>{let{min:r,max:n,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:d,...c}=e,u=(0,T.useRef)(null),p=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,u),h=(0,T.useRef)(),f=!i;function getValueFromPointer(e){let t=h.current||u.current.getBoundingClientRect(),i=[0,t.height],o=$faa2e61a3361514f$var$linearScale(i,f?[n,r]:[r,n]);return h.current=t,o(e-t.top)}return(0,T.createElement)(lC,{scope:e.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1},(0,T.createElement)(lA,_extends({"data-orientation":"vertical"},c,{ref:p,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientY);null==o||o(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientY);null==a||a(t)},onSlideEnd:()=>{h.current=void 0,null==l||l()},onStepKeyDown:e=>{let t=lm[f?"from-bottom":"from-top"].includes(e.key);null==d||d({event:e,direction:t?-1:1})}})))}),lA=(0,T.forwardRef)((e,t)=>{let{__scopeSlider:r,onSlideStart:n,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:a,onEndKeyDown:l,onStepKeyDown:d,...c}=e,u=lP(ly,r);return(0,T.createElement)(O.span,_extends({},c,{ref:t,onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onKeyDown,e=>{"Home"===e.key?(a(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):lf.concat(lg).includes(e.key)&&(d(e),e.preventDefault())}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():n(e)}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})}))}),l$=(0,T.forwardRef)((e,t)=>{let{__scopeSlider:r,...n}=e,i=lP("SliderTrack",r);return(0,T.createElement)(O.span,_extends({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},n,{ref:t}))}),lM="SliderRange",lD=(0,T.forwardRef)((e,t)=>{let{__scopeSlider:r,...n}=e,i=lP(lM,r),o=lk(lM,r),a=(0,T.useRef)(null),l=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,a),d=i.values.length,c=i.values.map(e=>$faa2e61a3361514f$var$convertValueToPercentage(e,i.min,i.max));return(0,T.createElement)(O.span,_extends({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},n,{ref:l,style:{...e.style,[o.startEdge]:(d>1?Math.min(...c):0)+"%",[o.endEdge]:100-Math.max(...c)+"%"}}))}),lV="SliderThumb",lR=(0,T.forwardRef)((e,t)=>{let r=lv(e.__scopeSlider),[n,i]=(0,T.useState)(null),o=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>i(e)),a=(0,T.useMemo)(()=>n?r().findIndex(e=>e.ref.current===n):-1,[r,n]);return(0,T.createElement)(lj,_extends({},e,{ref:o,index:a}))}),lj=(0,T.forwardRef)((e,t)=>{let{__scopeSlider:r,index:n,...i}=e,o=lP(lV,r),a=lk(lV,r),[l,d]=(0,T.useState)(null),c=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(t,e=>d(e)),u=$db6c3485150b8e66$export$1ab7ae714698c4b8(l),p=o.values[n],h=void 0===p?0:$faa2e61a3361514f$var$convertValueToPercentage(p,o.min,o.max),f=$faa2e61a3361514f$var$getLabel(n,o.values.length),g=null==u?void 0:u[a.size],m=g?$faa2e61a3361514f$var$getThumbInBoundsOffset(g,h,a.direction):0;return(0,T.useEffect)(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),(0,T.createElement)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${h}% + ${m}px)`}},(0,T.createElement)(lb.ItemSlot,{scope:e.__scopeSlider},(0,T.createElement)(O.span,_extends({role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:c,style:void 0===p?{display:"none"}:e.style,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onFocus,()=>{o.valueIndexToChangeRef.current=n})}))))}),$faa2e61a3361514f$var$BubbleInput=e=>{let{value:t,...r}=e,n=(0,T.useRef)(null),i=$010c2913dbd2fe3d$export$5cae361ad82dce8b(t);return(0,T.useEffect)(()=>{let e=n.current,r=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(r,"value"),a=o.set;if(i!==t&&a){let r=new Event("input",{bubbles:!0});a.call(e,t),e.dispatchEvent(r)}},[i,t]),(0,T.createElement)("input",_extends({style:{display:"none"}},r,{ref:n,defaultValue:t}))};function $faa2e61a3361514f$var$getNextSortedValues(e=[],t,r){let n=[...e];return n[r]=t,n.sort((e,t)=>e-t)}function $faa2e61a3361514f$var$convertValueToPercentage(e,t,r){return $ae6933e535247d3d$export$7d15b64cf5a3a4c4(100/(r-t)*(e-t),[0,100])}function $faa2e61a3361514f$var$getLabel(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}function $faa2e61a3361514f$var$getClosestValueIndex(e,t){if(1===e.length)return 0;let r=e.map(e=>Math.abs(e-t)),n=Math.min(...r);return r.indexOf(n)}function $faa2e61a3361514f$var$getThumbInBoundsOffset(e,t,r){let n=e/2,i=$faa2e61a3361514f$var$linearScale([0,50],[0,n]);return(n-i(t)*r)*r}function $faa2e61a3361514f$var$getStepsBetweenValues(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function $faa2e61a3361514f$var$hasMinStepsBetweenValues(e,t){if(t>0){let r=$faa2e61a3361514f$var$getStepsBetweenValues(e);return Math.min(...r)>=t}return!0}function $faa2e61a3361514f$var$linearScale(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function $faa2e61a3361514f$var$getDecimalCount(e){return(String(e).split(".")[1]||"").length}function $faa2e61a3361514f$var$roundValue(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}let lO=(0,T.memo)(function(e){let{title:t,steps:r,value:n,label:i,onValueChange:o}=e,a=useEditor(),l=useTranslation(),d=(0,T.useCallback)(e=>{o(e[0],!0)},[o]),c=(0,T.useCallback)(()=>{a.mark("click slider")},[a]),u=(0,T.useCallback)(()=>{n&&o(n,!1)},[n,o]);return(0,I.jsx)("div",{className:"tlui-slider__container",children:(0,I.jsxs)(lE,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:n?[n]:void 0,onPointerDown:c,onValueChange:d,onPointerUp:u,title:t+" — "+l(i),children:[(0,I.jsx)(l$,{className:"tlui-slider__track",dir:"ltr",children:null!==n&&(0,I.jsx)(lD,{className:"tlui-slider__range",dir:"ltr"})}),null!==n&&(0,I.jsx)(lR,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),lL=T.memo(function({label:e,uiTypeA:t,uiTypeB:r,labelA:n,labelB:i,itemsA:o,itemsB:a,styleA:l,styleB:d,valueA:c,valueB:u,onValueChange:p}){let h=useTranslation(),f=T.useMemo(()=>o.find(e=>"shared"===c.type&&c.value===e.value)?.icon??"mixed",[o,c]),g=T.useMemo(()=>a.find(e=>"shared"===u.type&&u.value===e.value)?.icon??"mixed",[a,u]);return void 0===c&&void 0===u?null:(0,I.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,I.jsx)("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),(0,I.jsxs)(Root,{id:`style panel ${t} A`,children:[(0,I.jsx)(as,{asChild:!0,onTouchEnd:e=>preventDefault(e),children:(0,I.jsx)(iH,{"data-testid":`style.${t}`,title:h(n)+" — "+(null===c?h("style-panel.mixed"):h(`${t}-style.${c}`)),icon:f,invertIcon:!0,smallIcon:!0})}),(0,I.jsx)(Content,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,I.jsx)("div",{className:eb("tlui-button-grid",{"tlui-button-grid__two":o.length<4,"tlui-button-grid__four":o.length>=4}),children:o.map(e=>(0,I.jsx)(Item,{className:"tlui-button-grid__button",title:h(n)+" — "+h(`${t}-style.${e.value}`),"data-testid":`style.${t}.${e.value}`,icon:e.icon,onClick:()=>p(l,e.value,!1),invertIcon:!0},e.value))})})]}),(0,I.jsxs)(Root,{id:`style panel ${r}`,children:[(0,I.jsx)(as,{asChild:!0,onTouchEnd:e=>preventDefault(e),children:(0,I.jsx)(iH,{"data-testid":`style.${r}`,title:h(i)+" — "+(null===u?h("style-panel.mixed"):h(`${r}-style.${u}`)),icon:g,smallIcon:!0})}),(0,I.jsx)(Content,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,I.jsx)("div",{className:eb("tlui-button-grid",{"tlui-button-grid__two":o.length<4,"tlui-button-grid__four":o.length>=4}),children:a.map(e=>(0,I.jsx)(Item,{className:"tlui-button-grid__button",title:h(i)+" — "+h(`${r}-style.${e.value}`),"data-testid":`style.${r}.${e.value}`,icon:e.icon,onClick:()=>p(d,e.value,!1)},e.value))})})]})]})}),lF=T.memo(function({id:e,label:t,uiType:r,style:n,items:i,value:o,onValueChange:a}){let l=useTranslation(),d=T.useMemo(()=>i.find(e=>"shared"===o.type&&e.value===o.value)?.icon,[i,o]);return(0,I.jsxs)(Root,{id:`style panel ${e}`,children:[(0,I.jsx)(as,{asChild:!0,onTouchEnd:e=>preventDefault(e),children:(0,I.jsx)(iH,{"data-testid":`style.${r}`,title:"mixed"===o.type?l("style-panel.mixed"):l(`${r}-style.${o.value}`),label:t,icon:d??"mixed"})}),(0,I.jsx)(Content,{side:"left",align:"center",alignOffset:0,children:(0,I.jsx)("div",{className:eb("tlui-button-grid",{"tlui-button-grid__two":i.length<3,"tlui-button-grid__three":3==i.length,"tlui-button-grid__four":i.length>=4}),children:i.map(e=>(0,I.jsx)(Item,{className:"tlui-button-grid__button","data-testid":`style.${r}.${e.value}`,title:l(`${r}-style.${e.value}`),icon:e.icon,onClick:()=>a(n,e.value,!1)},e.value))})})]})}),lN={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},StylePanel=function({isMobile:e}){let t=useEditor(),r=useRelevantStyles(),n=(0,T.useCallback)(()=>{e||t.updateInstanceState({isChangingStyle:!1})},[t,e]);if(!r)return null;let{styles:i,opacity:o}=r,a=i.get(rx),l=i.get(t7),d=i.get(t9),c=i.get(rR),u=i.get(t5);return(0,I.jsxs)("div",{className:"tlui-style-panel","data-ismobile":e,onPointerLeave:n,children:[(0,I.jsx)(CommonStylePickerSet,{styles:i,opacity:o}),void 0!==u&&(0,I.jsx)(TextStylePickerSet,{styles:i}),!(void 0===a&&void 0===l&&void 0===d&&void 0===c)&&(0,I.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,I.jsx)(GeoStylePickerSet,{styles:i}),(0,I.jsx)(ArrowheadStylePickerSet,{styles:i}),(0,I.jsx)(SplineStylePickerSet,{styles:i})]})]})};function useStyleChangeCallback(){let e=useEditor();return T.useMemo(()=>function(t,r,n){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(t,r,{squashing:n}),e.setStyleForNextShapes(t,r,{squashing:n}),e.updateInstanceState({isChangingStyle:!0})})},[e])}let lz=[.1,.25,.5,.75,1];function CommonStylePickerSet({styles:e,opacity:t}){let r=useEditor(),n=useTranslation(),i=useStyleChangeCallback(),o=T.useCallback((e,t)=>{let n=lz[e];r.batch(()=>{r.isIn("select")&&r.setOpacityForSelectedShapes(n,{ephemeral:t}),r.setOpacityForNextShapes(n,{ephemeral:t}),r.updateInstanceState({isChangingStyle:!0})})},[r]),a=e.get(t0),l=e.get(t3),d=e.get(t2),c=e.get(t8),u="mixed"===t.type?-1:lz.indexOf(minBy(lz,e=>Math.abs(e-t.value)));return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[void 0===a?null:(0,I.jsx)(lh,{title:n("style-panel.color"),uiType:"color",style:t0,items:lN.color,value:a,onValueChange:i}),void 0===t?null:(0,I.jsx)(lO,{"data-testid":"style.opacity",value:u>=0?u:lz.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:o,steps:lz.length-1,title:n("style-panel.opacity")})]}),(void 0!==l||void 0!==d||void 0!==c)&&(0,I.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===l?null:(0,I.jsx)(lh,{title:n("style-panel.fill"),uiType:"fill",style:t3,items:lN.fill,value:l,onValueChange:i}),void 0===d?null:(0,I.jsx)(lh,{title:n("style-panel.dash"),uiType:"dash",style:t2,items:lN.dash,value:d,onValueChange:i}),void 0===c?null:(0,I.jsx)(lh,{title:n("style-panel.size"),uiType:"size",style:t8,items:lN.size,value:c,onValueChange:i})]})]})}function TextStylePickerSet({styles:e}){let t=useTranslation(),r=useStyleChangeCallback(),n=e.get(t5),i=e.get(rv),o=e.get(rS);return void 0===n&&void 0===i?null:(0,I.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===n?null:(0,I.jsx)(lh,{title:t("style-panel.font"),uiType:"font",style:t5,items:lN.font,value:n,onValueChange:r}),void 0===i?null:(0,I.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,I.jsx)(lh,{title:t("style-panel.align"),uiType:"align",style:rv,items:lN.horizontalAlign,value:i,onValueChange:r}),void 0===o?(0,I.jsx)(iH,{title:t("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):(0,I.jsx)(lF,{id:"geo-vertical-alignment",uiType:"verticalAlign",style:rS,items:lN.verticalAlign,value:o,onValueChange:r})]})]})}function GeoStylePickerSet({styles:e}){let t=useStyleChangeCallback(),r=e.get(rx);return void 0===r?null:(0,I.jsx)(lF,{id:"geo",label:"style-panel.geo",uiType:"geo",style:rx,items:lN.geo,value:r,onValueChange:t})}function SplineStylePickerSet({styles:e}){let t=useStyleChangeCallback(),r=e.get(rR);return void 0===r?null:(0,I.jsx)(lF,{id:"spline",label:"style-panel.spline",uiType:"spline",style:rR,items:lN.spline,value:r,onValueChange:t})}function ArrowheadStylePickerSet({styles:e}){let t=useStyleChangeCallback(),r=e.get(t7),n=e.get(t9);return r&&n?(0,I.jsx)(lL,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:t9,itemsA:lN.arrowheadStart,valueA:n,uiTypeB:"arrowheadEnd",styleB:t7,itemsB:lN.arrowheadEnd,valueB:r,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}function Toast({toast:e}){let{removeToast:t}=useToasts(),r=useTranslation(),n=e.actions&&e.actions.length>0;return(0,I.jsxs)(sh,{onOpenChange:r=>{r||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&(0,I.jsx)("div",{className:"tlui-toast__icon",children:(0,I.jsx)(iN,{icon:e.icon})}),(0,I.jsxs)("div",{className:"tlui-toast__main",children:[(0,I.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,I.jsx)(sy,{className:"tlui-toast__title",children:e.title}),e.description&&(0,I.jsx)(sb,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,I.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,I.jsx)(sv,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,I.jsx)(iH,{className:"warn"===e.type?"tlui-button__warning":"tlui-button__primary",children:e.label})},t)),n&&(0,I.jsx)(sS,{asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-toast__close",style:{marginLeft:"auto"},children:e.closeLabel??r("toast.close")})})]})]}),!n&&(0,I.jsx)(sS,{asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-toast__close",children:e.closeLabel??r("toast.close")})})]})}function _Toasts(){let{toasts:e}=useToasts();return(0,I.jsx)(I.Fragment,{children:e.map(e=>(0,I.jsx)(Toast,{toast:e},e.id))})}let lB=T.memo(_Toasts);function ToastViewport(){let{toasts:e}=useToasts(),[t,r]=T.useState(!1);return(T.useEffect(()=>{let t=!1;return e.length?r(!0):setTimeout(()=>{t||r(!1)},1e3),()=>{t=!0}},[e.length,r]),t)?(0,I.jsx)(sc,{className:"tlui-toast__viewport"}):null}function useOpenMenuCloser(){let e=useEditor(),t=(0,T.useRef)(!1),r=(0,T.useCallback)(()=>{e.openMenus.length>0&&(e.updateInstanceState({openMenus:[]}),t.current=!0)},[e]),n=(0,T.useCallback)(e=>{t.current&&preventDefault(e),t.current=!1},[]);return{handlePointerDown:r,handleClick:n}}function MobileStylePanel(){let e=useEditor(),t=useTranslation(),r=useRelevantStyles(),n=r?.styles.get(t0),i=getDefaultColorTheme({isDarkMode:e.user.isDarkMode}),o=(n?.type==="shared"?i[n.value]:i.black).solid,a=useValue("isHandOrEraserToolActive",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),l=(0,T.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1})},[e]),d=useOpenMenuCloser();return(0,I.jsxs)(Popover,{id:"style menu",onOpenChange:l,children:[(0,I.jsx)(PopoverTrigger,{disabled:a,children:(0,I.jsx)(iH,{className:"tlui-toolbar__tools__button tlui-toolbar__styles__button","data-testid":"mobile.styles",style:{color:a?"var(--color-muted-1)":o},title:t("style-panel.title"),...d,children:(0,I.jsx)(iN,{icon:a?"blob":n?.type==="mixed"?"mixed":"blob"})})}),(0,I.jsx)(PopoverContent,{side:"top",align:"end",children:(0,I.jsx)(StylePanel,{isMobile:!0})})]})}let lU=["select","hand","draw","eraser","text","zoom","laser","highlight"];function ToggleToolLockedButton({activeToolId:e}){let t=useEditor(),r=useBreakpoint(),n=useTranslation(),i=useValue("is tool locked",()=>t.instanceState.isToolLocked,[t]);return!e||lU.includes(e)?null:(0,I.jsx)(iH,{title:n("action.toggle-tool-lock"),className:eb("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":r<5}),icon:i?"lock":"unlock",onClick:()=>t.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}let lH=(0,T.memo)(function(){let e=useEditor(),t=useTranslation(),r=useBreakpoint(),n=T.useRef(void 0),i=useReadonly(),o=useToolbarSchema(),a=o.find(e=>"laser"===e.toolItem.id),l=useValue("current tool id",()=>e.currentToolId,[e]),d=useValue("geo",()=>e.sharedStyles.getAsKnownValue(rx),[e]),getTitle=e=>e.label?`${t(e.label)} ${e.kbd?kbdStr(e.kbd):""}`:"",c=o.find(e=>isActiveTLUiToolItem(e.toolItem,l,d)),{itemsInPanel:u,itemsInDropdown:p,dropdownFirstItem:h}=T.useMemo(()=>{let e;let t=[],i=[],a=Math.min(8,5+r);for(let r=4;r<o.length;r++){let n=o[r];r<a?t.push(n):(n===c&&(e=n),i.push(n))}return e||(n.current||(n.current=i[0]),e=n.current,i.includes(e)||(e=i[0])),n.current=e,i.length<=2&&(t.push(...i),i.length=0),{itemsInPanel:t,itemsInDropdown:i,dropdownFirstItem:e}},[o,c,r]);return(0,I.jsx)("div",{className:"tlui-toolbar",children:(0,I.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,I.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,I.jsxs)("div",{className:"tlui-toolbar__extras",children:[r<6&&!("hand"===l||"zoom"===l)&&(0,I.jsxs)("div",{className:"tlui-toolbar__extras__controls",children:[(0,I.jsx)(la,{}),(0,I.jsx)(li,{}),(0,I.jsx)(lo,{}),(0,I.jsx)(lt,{}),(0,I.jsx)(le,{})]}),(0,I.jsx)(ToggleToolLockedButton,{activeToolId:l})]}),(0,I.jsxs)("div",{className:eb("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<5}),children:[o.slice(0,2).map(({toolItem:e})=>(0,I.jsx)(ToolbarButton,{item:e,title:getTitle(e),isSelected:isActiveTLUiToolItem(e,l,d)},e.id)),i&&a&&(0,I.jsx)(ToolbarButton,{item:a.toolItem,title:getTitle(a.toolItem),isSelected:isActiveTLUiToolItem(a.toolItem,l,d)},a.toolItem.id),!i&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"tlui-toolbar__divider"}),o.slice(2,4).map(({toolItem:e})=>(0,I.jsx)(ToolbarButton,{item:e,title:getTitle(e),isSelected:isActiveTLUiToolItem(e,l,d)},e.id)),(0,I.jsx)("div",{className:"tlui-toolbar__divider"}),u.map(({toolItem:e})=>(0,I.jsx)(ToolbarButton,{item:e,title:getTitle(e),isSelected:isActiveTLUiToolItem(e,l,d)},e.id)),p.length?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(ToolbarButton,{item:h.toolItem,title:getTitle(h.toolItem),isSelected:isActiveTLUiToolItem(h.toolItem,l,d)},h.toolItem.id),(0,I.jsxs)(Root,{id:"toolbar overflow",modal:!1,children:[(0,I.jsx)(Trigger,{children:(0,I.jsx)(iH,{className:"tlui-toolbar__tools__button tlui-toolbar__overflow",icon:"chevron-up","data-testid":"tools.more",title:t("tool-panel.more")})}),(0,I.jsx)(Content,{side:"top",align:"center",children:(0,I.jsx)(lG,{toolbarItems:p})})]})]}):null]})]})]}),r<5&&!i&&(0,I.jsx)("div",{className:"tlui-toolbar__tools",children:(0,I.jsx)(MobileStylePanel,{})})]})})}),lG=track(function({toolbarItems:e}){let t=useTranslation();return(0,I.jsx)("div",{className:"tlui-button-grid__four tlui-button-grid__reverse",children:e.map(({toolItem:{id:e,meta:r,kbd:n,label:i,onSelect:o,icon:a}})=>(0,I.jsx)(Item,{className:"tlui-button-grid__button","data-testid":`tools.${e}`,"data-tool":e,"data-geo":r?.geo??"","aria-label":i,onClick:()=>o("toolbar"),title:i?`${t(i)} ${n?kbdStr(n):""}`:"",icon:a},e))})});function ToolbarButton({item:e,title:t,isSelected:r}){return(0,I.jsx)(iH,{className:"tlui-toolbar__tools__button","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":e.meta?.geo??"","aria-label":e.label,title:t,icon:e.icon,"data-state":r?"selected":void 0,onClick:()=>e.onSelect("toolbar"),onTouchStart:t=>{preventDefault(t),e.onSelect("toolbar")}})}let isActiveTLUiToolItem=(e,t,r)=>e.meta?.geo?"geo"===t&&r===e.meta?.geo:t===e.id;function useEditorEvents(){let e=useEditor(),{addToast:t}=useToasts();(0,T.useEffect)(()=>{function handleMaxShapes({name:e,count:r}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${r}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",handleMaxShapes),()=>{e.removeListener("max-shapes",handleMaxShapes)}},[e,t])}var lW=r(9985);let lK=["copy","cut","paste","asset"];function useKeyboardShortcuts(){let e=useEditor(),t=useReadonly(),r=useActions(),n=useTools(),i=useValue("is focused",()=>e.instanceState.isFocused,[e]);(0,T.useEffect)(()=>{if(!i)return;let o=e.getContainer();lW.setScope(e.store.id);let hot=(t,r)=>{lW(t,{element:o,scope:e.store.id},r)},areShortcutsDisabled=()=>e.isMenuOpen||null!==e.editingShapeId||e.crashingError;for(let e of Object.values(r))e.kbd&&(!t||e.readonlyOk)&&(lK.includes(e.id)||hot(getHotkeysStringFromKbd(e.kbd),t=>{areShortcutsDisabled()||(preventDefault(t),e.onSelect("kbd"))}));for(let t of Object.values(n))t.kbd&&(t.readonlyOk||!e.instanceState.isReadonly)&&(lK.includes(t.id)||hot(getHotkeysStringFromKbd(t.kbd),e=>{areShortcutsDisabled()||(preventDefault(e),t.onSelect("kbd"))}));return()=>{lW.deleteScope(e.store.id)}},[r,n,t,e,i])}function getHotkeysStringFromKbd(e){return getKeys(e).map(e=>{let t=e.split("");return 1===t.length?t[0]:"!"===t[0]?`shift+${t[1]}`:"?"===t[0]?3===t.length&&"!"===t[1]?`alt+shift+${t[2]}`:`alt+${t[1]}`:"$"===t[0]?"!"===t[1]?`cmd+shift+${t[2]},ctrl+shift+${t[2]}`:"?"===t[1]?`cmd+\u2325+${t[2]},ctrl+alt+${t[2]}`:`cmd+${t[1]},ctrl+${t[1]}`:e}).join(",")}function getKeys(e){"string"!=typeof e&&(e=""),e=e.replace(/\s/g,"");let t=e.split(","),r=t.lastIndexOf("");for(;r>=0;)t[r-1]+=",",t.splice(r,1),r=t.lastIndexOf("");return t}let lq=T.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:r,children:n,hideUi:i,...o}){return(0,I.jsx)(TldrawUiContextProvider,{...o,children:(0,I.jsx)(lY,{hideUi:i,shareZone:e,topZone:t,renderDebugMenuItems:r,children:n})})}),lY=T.memo(function({children:e,hideUi:t,...r}){return(0,I.jsxs)(I.Fragment,{children:[e,t?null:(0,I.jsx)(lX,{...r})]})}),lX=T.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:r}){let n=useEditor(),i=useTranslation(),o=useBreakpoint(),a=useValue("isReadonlyMode",()=>n.instanceState.isReadonly,[n]),l=useValue("focus",()=>n.instanceState.isFocusMode,[n]),d=useValue("debug",()=>n.instanceState.isDebugMode,[n]);useKeyboardShortcuts(),useNativeClipboardEvents(),useEditorEvents();let{"toggle-focus-mode":c}=useActions();return(0,I.jsx)($054eb8030ebde76e$export$f5d03d415824e0e,{children:(0,I.jsxs)("div",{className:eb("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[l?(0,I.jsx)("div",{className:"tlui-layout__top",children:(0,I.jsx)(iH,{className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{className:"tlui-layout__top",children:[(0,I.jsxs)("div",{className:"tlui-layout__top__left",children:[(0,I.jsx)(ls,{}),(0,I.jsxs)("div",{className:"tlui-helper-buttons",children:[(0,I.jsx)(lc,{}),(0,I.jsx)(BackToContent,{}),(0,I.jsx)(lu,{})]})]}),(0,I.jsx)("div",{className:"tlui-layout__top__center",children:t}),(0,I.jsxs)("div",{className:"tlui-layout__top__right",children:[e,o>=5&&!a&&(0,I.jsx)("div",{className:"tlui-style-panel__wrapper",children:(0,I.jsx)(StylePanel,{})})]})]}),(0,I.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,I.jsxs)("div",{className:"tlui-layout__bottom__main",children:[(0,I.jsx)(ld,{}),(0,I.jsx)(lH,{}),o>=4&&(0,I.jsx)(s9,{})]}),d&&(0,I.jsx)(s3,{renderDebugMenuItems:r??null})]})]}),(0,I.jsx)(lB,{}),(0,I.jsx)(s6,{}),(0,I.jsx)(ToastViewport,{}),(0,I.jsx)(FollowingIndicator,{})]})})}),lZ="ContextMenu",[lQ,lJ]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(lZ,[oT]),l0=oT(),[l1,l2]=lQ(lZ),l3=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,disabled:n=!1,...i}=e,o=l2("ContextMenuTrigger",r),a=l0(r),l=(0,T.useRef)({x:0,y:0}),d=(0,T.useRef)({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),c=(0,T.useRef)(0),u=(0,T.useCallback)(()=>window.clearTimeout(c.current),[]),handleOpen=e=>{l.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return(0,T.useEffect)(()=>u,[u]),(0,T.useEffect)(()=>void(n&&u()),[n,u]),(0,T.createElement)(T.Fragment,null,(0,T.createElement)(oj,_extends({},a,{virtualRef:d})),(0,T.createElement)(O.span,_extends({"data-state":o.open?"open":"closed","data-disabled":n?"":void 0},i,{ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:n?e.onContextMenu:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onContextMenu,e=>{u(),handleOpen(e),e.preventDefault()}),onPointerDown:n?e.onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerDown,$1b0217ee4a91d156$var$whenTouchOrPen(e=>{u(),c.current=window.setTimeout(()=>handleOpen(e),700)})),onPointerMove:n?e.onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerMove,$1b0217ee4a91d156$var$whenTouchOrPen(u)),onPointerCancel:n?e.onPointerCancel:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerCancel,$1b0217ee4a91d156$var$whenTouchOrPen(u)),onPointerUp:n?e.onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(e.onPointerUp,$1b0217ee4a91d156$var$whenTouchOrPen(u))})))}),l5=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l2("ContextMenuContent",r),o=l0(r),a=(0,T.useRef)(!1);return(0,T.createElement)(oU,_extends({},o,n,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var r;null===(r=e.onCloseAutoFocus)||void 0===r||r.call(e,t),!t.defaultPrevented&&a.current&&t.preventDefault(),a.current=!1},onInteractOutside:t=>{var r;null===(r=e.onInteractOutside)||void 0===r||r.call(e,t),t.defaultPrevented||i.modal||(a.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),l4=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l0(r);return(0,T.createElement)(oK,_extends({},i,n,{ref:t}))}),l8=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l0(r);return(0,T.createElement)(oX,_extends({},i,n,{ref:t}))}),l6=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l0(r);return(0,T.createElement)(oQ,_extends({},i,n,{ref:t}))}),l9=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l0(r);return(0,T.createElement)(o7,_extends({},i,n,{ref:t}))}),l7=(0,T.forwardRef)((e,t)=>{let{__scopeContextMenu:r,...n}=e,i=l0(r);return(0,T.createElement)(ae,_extends({},i,n,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function $1b0217ee4a91d156$var$whenTouchOrPen(e){return t=>"mouse"!==t.pointerType?e(t):void 0}let $1b0217ee4a91d156$export$be92b6f5f03c0fe9=e=>{let{__scopeContextMenu:t,children:r,onOpenChange:n,dir:i,modal:o=!0}=e,[a,l]=(0,T.useState)(!1),d=l0(t),c=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(n),u=(0,T.useCallback)(e=>{l(e),c(e)},[c]);return(0,T.createElement)(l1,{scope:t,open:a,onOpenChange:u,modal:o},(0,T.createElement)($6cc32821e9371a1c$export$be92b6f5f03c0fe9,_extends({},d,{dir:i,open:a,onOpenChange:u,modal:o}),r))},$1b0217ee4a91d156$export$602eac185826482c=e=>{let{__scopeContextMenu:t,...r}=e,n=l0(t);return(0,T.createElement)($6cc32821e9371a1c$export$602eac185826482c,_extends({},n,r))},$1b0217ee4a91d156$export$d7a01e11500dfb6f=e=>{let{__scopeContextMenu:t,children:r,onOpenChange:n,open:i,defaultOpen:o}=e,a=l0(t),[l,d]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:i,defaultProp:o,onChange:n});return(0,T.createElement)($6cc32821e9371a1c$export$d7a01e11500dfb6f,_extends({},a,{open:l,onOpenChange:d}),r)},de=track(function(){let e=useEditor(),t=useContainer(),r=e.pages,n=e.currentPageId,i=useTranslation(),{addToast:o}=useToasts();return(0,I.jsxs)($1b0217ee4a91d156$export$d7a01e11500dfb6f,{children:[(0,I.jsx)(l9,{dir:"ltr",asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),(0,I.jsx)($1b0217ee4a91d156$export$602eac185826482c,{container:t,dir:"ltr",children:(0,I.jsxs)(l7,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[(0,I.jsx)(l4,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:r.map(t=>(0,I.jsx)(l8,{disabled:n===t.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.selectedShapeIds,t.id);let r=e.getPage(t.id);r&&o({title:"Changed Page",description:`Moved to ${r.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(n)}}]})},asChild:!0,children:(0,I.jsx)(iH,{title:t.name,className:"tlui-menu__button tlui-context-menu__move-to-page__name",children:(0,I.jsx)("span",{children:t.name})})},t.id))},"pages"),(0,I.jsx)(l4,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:(0,I.jsx)(l8,{onSelect:()=>{let t=tp.createId(),r=e.selectedShapeIds;e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:"Page",id:t}),e.moveShapesToPage(r,t)})},asChild:!0,children:(0,I.jsx)(iH,{title:i("context.pages.new-page"),className:"tlui-menu__button tlui-context-menu__move-to-page__name",children:i("context.pages.new-page")})},"new-page")},"new-page")]})})]})}),ContextMenu=function({children:e}){let t=useEditor(),r=useContextMenuSchema(),n=(0,T.useCallback)(e=>{if(e){if(t.instanceState.isCoarsePointer){let{selectedShapes:e,inputs:{currentPagePoint:r}}=t,n=t.getShapesAtPoint(r);if(!t.selectedShapes.length||!n.some(t=>e.includes(t))){let e=n.filter(e=>t.isShapeOrAncestorLocked(e));e.length&&t.select(...e.map(e=>e.id))}}}else{let{onlySelectedShape:e}=t;e&&t.isShapeOrAncestorLocked(e)&&t.setSelectedShapes([])}},[t]),i=useContainer(),[o,a]=useMenuIsOpen("context menu",n),l=useReadonly(),d=0===r.length||l&&r.every(e=>!e.readonlyOk),c=useValue("isSelectToolActive",()=>"select"===t.currentToolId,[t]),u=!c||d;return(0,I.jsxs)($1b0217ee4a91d156$export$be92b6f5f03c0fe9,{dir:"ltr",onOpenChange:a,children:[(0,I.jsx)(l3,{onContextMenu:u?preventDefault:void 0,dir:"ltr",disabled:u,children:e}),(0,I.jsx)($1b0217ee4a91d156$export$602eac185826482c,{container:i,children:(0,I.jsx)(ContextMenuContent,{})})]})};function ContextMenuContent(){let e=useEditor(),t=useTranslation(),r=useContextMenuSchema(),[n,i]=useMenuIsOpen("context menu sub"),o=useReadonly(),a=useBreakpoint(),l=useContainer(),[d,c]=(0,T.useState)(!1);function getContextMenuItem(e,r,n,u){if(o&&!r.readonlyOk)return null;switch(r.type){case"custom":if("MOVE_TO_PAGE_MENU"===r.id)return(0,I.jsx)(de,{},r.id);break;case"group":return(0,I.jsx)(l4,{dir:"ltr",className:eb("tlui-menu__group",{"tlui-menu__group__small":n?.type==="submenu"}),"data-testid":`menu-item.${r.id}`,children:r.children.map(t=>getContextMenuItem(e,t,r,u+1))},r.id);case"submenu":return(0,I.jsxs)($1b0217ee4a91d156$export$d7a01e11500dfb6f,{onOpenChange:i,children:[(0,I.jsx)(l9,{dir:"ltr",disabled:r.disabled,asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button",label:r.label,"data-testid":`menu-item.${r.id}`,icon:"chevron-right"})}),(0,I.jsx)($1b0217ee4a91d156$export$602eac185826482c,{container:l,dir:"ltr",children:(0,I.jsx)(l7,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:r.children.map(t=>getContextMenuItem(e,t,r,u+1))})})]},r.id);case"item":{if(o&&!r.readonlyOk)return null;let{id:e,checkbox:n,contextMenuLabel:i,label:l,onSelect:p,kbd:h,icon:f}=r.actionItem,g=i??l,m=g?t(g):void 0;if(n)return(0,I.jsxs)(l6,{className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",dir:"ltr",disabled:r.disabled,onSelect:e=>{p("context-menu"),preventDefault(e)},title:m||void 0,checked:r.checked,children:[(0,I.jsx)("div",{className:"tlui-menu__checkbox-item__check",style:{transformOrigin:"75% center",transform:`scale(${r.checked?1:.5})`,opacity:r.checked?1:.5},children:(0,I.jsx)(iN,{small:!0,icon:r.checked?"check":"checkbox-empty"})}),m&&(0,I.jsx)("span",{children:m}),h&&(0,I.jsx)(Kbd,{children:h})]},e);return(0,I.jsx)(l8,{dir:"ltr",asChild:!0,children:(0,I.jsx)(iH,{className:"tlui-menu__button","data-testid":`menu-item.${e}`,kbd:h,label:g,disabled:r.disabled,iconLeft:a<3&&u>2?f:void 0,onClick:()=>{d?c(!1):p("context-menu")}})},e)}}}return(0,I.jsx)($1b0217ee4a91d156$export$602eac185826482c,{dir:"ltr",container:l,children:(0,I.jsx)(l5,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:preventDefault,children:r.map(t=>getContextMenuItem(e,t,null,0))})})}var dt=((m=dt||{})[m.SUCCESS=0]="SUCCESS",m[m.FAILED=1]="FAILED",m[m.WAITING=2]="WAITING",m);let usePreloadFont=(e,t)=>{let[r,n]=(0,T.useState)(2);return(0,T.useEffect)(()=>{let{url:r,style:i="normal",weight:o="500",display:a,featureSettings:l,stretch:d,unicodeRange:c,variant:u}=t,p=!1;n(2);let h=new FontFace(e,`url(${r})`,{style:i,weight:o,display:a,featureSettings:l,stretch:d,unicodeRange:c,variant:u});return h.load().then(()=>{p||(document.fonts.add(h),n(0))}).catch(e=>{p||(console.error(e),n(1))}),h.$$_url=r,h.$$_fontface=`
@font-face {
	font-family: ${h.family};
	font-stretch: ${h.stretch};
	font-weight: ${h.weight};
	font-style: ${h.style};
	src: url("${r}") format("woff2")
}`,()=>{document.fonts.delete(h),p=!0}},[e,t]),r};function getTypefaces(e){return{draw:{url:e.fonts.draw},serif:{url:e.fonts.serif},sansSerif:{url:e.fonts.sansSerif},monospace:{url:e.fonts.monospace}}}function usePreloadAssets(e){let t=(0,T.useMemo)(()=>getTypefaces(e),[e]),r=[usePreloadFont("tldraw_draw",t.draw),usePreloadFont("tldraw_serif",t.serif),usePreloadFont("tldraw_sans",t.sansSerif),usePreloadFont("tldraw_mono",t.monospace)];return{error:r.some(e=>1===e),done:!r.some(e=>2===e)}}function Tldraw(e){let{children:t,maxImageDimension:r,maxAssetSize:n,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:a,...l}=e,d={initialState:"select",...l,components:(0,T.useMemo)(()=>({Scribble:TldrawScribble,CollaboratorScribble:TldrawScribble,SelectionForeground:aS,SelectionBackground:TldrawSelectionBackground,Handles:TldrawHandles,HoveredShapeIndicator:TldrawHoveredShapeIndicator,...l.components}),[l.components]),shapeUtils:(0,T.useMemo)(()=>[...a1,...l.shapeUtils??[]],[l.shapeUtils]),tools:(0,T.useMemo)(()=>[...a6,...aD,...l.tools??[]],[l.tools])},c=useDefaultEditorAssetsWithOverrides(l.assetUrls),{done:u,error:p}=usePreloadAssets(c);return p?(0,I.jsx)(ErrorScreen,{children:"Could not load assets. Please refresh the page."}):u?(0,I.jsx)(iM,{...d,children:(0,I.jsxs)(lq,{...d,children:[(0,I.jsx)(ContextMenu,{children:(0,I.jsx)(Canvas,{})}),(0,I.jsx)(InsideOfEditorContext,{maxImageDimension:r,maxAssetSize:n,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:a}),t]})}):(0,I.jsx)(LoadingScreen,{children:"Loading assets..."})}function InsideOfEditorContext({maxImageDimension:e=1e3,maxAssetSize:t=10485760,acceptedImageMimeTypes:r=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:n=["video/mp4","video/quicktime"],onMount:i}){let o=useEditor(),a=Tldraw_useEvent(o=>{let a=[];return a.push(...registerDefaultSideEffects(o)),registerDefaultExternalContentHandlers(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:n}),a.push(i?.(o)),()=>{a.forEach(e=>e?.())}});return(0,T.useLayoutEffect)(()=>{if(o)return a?.(o)},[o,a]),null}function Tldraw_useEvent(e){let t=(0,T.useRef)();return(0,T.useLayoutEffect)(()=>{t.current=e}),(0,T.useDebugValue)(e),(0,T.useCallback)((...e)=>{let r=t.current;return eM(r,"fn does not exist"),r(...e)},[])}function OfflineIndicator(){let e=useTranslation(),t=(0,T.useRef)(null);return(0,I.jsxs)("div",{className:eb("tlui-offline-indicator"),ref:t,children:[e("status.offline"),(0,I.jsx)(iN,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function buildFromV1Document(e,t){e.batch(()=>{t=buildFromV1Document_migrate(t,15.5),e.cancel().cancel().cancel().cancel();let r=e.pages[0].id;for(let t of(e.setCurrentPage(r),e.pages.slice(1)))e.deletePage(t.id);e.selectAll(),e.deleteShapes(e.selectedShapeIds);let n=new Map;Object.values(t.assets??{}).forEach(t=>{switch(t.type){case"image":{let r=tK.createId();n.set(t.id,r);let i={id:r,typeName:"asset",type:"image",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!1,mimeType:null,src:t.src},meta:{}};e.createAssets([i]),tryMigrateAsset(e,i);break}case"video":{let r=tK.createId();n.set(t.id,r),e.createAssets([{id:r,typeName:"asset",type:"video",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!0,mimeType:null,src:t.src},meta:{}}])}}});let i=new Map;Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach((t,r)=>{if(0===r)i.set(t.id,e.currentPageId);else{let r=tp.createId();i.set(t.id,r),e.createPage({name:t.name??"Page",id:r})}}),Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach(t=>{e.setCurrentPage(i.get(t.id));let r=new Map,o=new Map,a=Object.values(t.shapes??{}).sort((e,t)=>e.childIndex<t.childIndex?-1:1).slice(0,nn);function decideNotToCreateShape(e){r.delete(e.id);let t=o.has(e.parentId);if(t){let t=o.get(e.parentId).filter(t=>t!==e.id);o.set(e.parentId,t)}}a.forEach(e=>{if("group"!==e.type)return;let t=createShapeId();r.set(e.id,t),o.set(e.id,[])}),a.forEach(a=>{if("group"===a.type)return;let l=createShapeId();r.set(a.id,l),a.parentId!==t.id&&(o.has(a.parentId)?o.get(a.parentId).push(a.id):console.warn("parent does not exist",a));let d=i.get(t.id),c={id:l,parentId:d,x:coerceNumber(a.point[0]),y:coerceNumber(a.point[1]),rotation:0,isLocked:!!a.isLocked};switch(a.type){case"sticky":e.createShapes([{...c,type:"note",props:{text:a.text??"",color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),align:getV2Align(a.style.textAlign)}}]);break;case"rectangle":{e.createShapes([{...c,type:"geo",props:{geo:"rectangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),text:a.label??"",fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(c.id);if(e.updateShapes([{id:c.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(c.id),{growY:r}=t.props,n=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=n+r/2,a=i+r/2;e.updateShapes([{id:c.id,type:"geo",x:coerceNumber(t.x)-(o-n)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"triangle":{e.createShapes([{...c,type:"geo",props:{geo:"triangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(c.id);if(e.updateShapes([{id:c.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(c.id),{growY:r}=t.props,n=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=n+r/2,a=i+r/2;e.updateShapes([{id:c.id,type:"geo",x:coerceNumber(t.x)-(o-n)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"ellipse":{e.createShapes([{...c,type:"geo",props:{geo:"ellipse",w:2*coerceDimension(a.radius[0]),h:2*coerceDimension(a.radius[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(c.id);if(e.updateShapes([{id:c.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(c.id),{growY:r}=t.props,n=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=n+r/2,a=i+r/2;e.updateShapes([{id:c.id,type:"geo",x:coerceNumber(t.x)-(o-n)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"draw":if(0===a.points.length){decideNotToCreateShape(a);break}e.createShapes([{...c,type:"draw",props:{fill:getV2Fill(a.style.isFilled,a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),dash:getV2Dash(a.style.dash),isPen:!1,isComplete:a.isComplete,segments:[{type:"free",points:a.points.map(getV2Point)}]}}]);break;case"arrow":{let t=coerceNumber(a.bend),r=getV2Point(a.handles.start.point),n=getV2Point(a.handles.end.point),i=Vec2d_Vec2d.Dist(r,n);e.createShapes([{...c,type:"arrow",props:{text:a.label??"",color:getV2Color(a.style.color),labelColor:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),arrowheadStart:getV2Arrowhead(a.decorations?.start),arrowheadEnd:getV2Arrowhead(a.decorations?.end),start:{type:"point",x:coerceNumber(a.handles.start.point[0]),y:coerceNumber(a.handles.start.point[1])},end:{type:"point",x:coerceNumber(a.handles.end.point[0]),y:coerceNumber(a.handles.end.point[1])},bend:-(i*t)/2}}]);break}case"text":e.createShapes([{...c,type:"text",props:{text:a.text??" ",color:getV2Color(a.style.color),size:getV2TextSize(a.style.size),font:getV2Font(a.style.font),align:getV2Align(a.style.textAlign),scale:a.style.scale??1}}]);break;case"image":{let t=n.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...c,type:"image",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}]);break}case"video":{let t=n.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...c,type:"video",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}])}}let u=coerceNumber(a.rotation);0!==u&&(e.select(l),e.rotateShapesBy([l],u))}),o.forEach((n,i)=>{let o=n.map(e=>r.get(e)),a=r.get(i);e.groupShapes(o,a);let l=t.shapes[i],d=coerceNumber(l.rotation);0!==d&&(e.select(a),e.rotateShapesBy([a],d))}),a.forEach(n=>{if("arrow"!==n.type)return;let i=r.get(n.id),o=e.getShapeUtil("arrow");for(let a of(e.inputs.ctrlKey=!1,["start","end"])){let l=n.handles[a].bindingId;if(l){let n=t.bindings[l];if(!n)continue;let d=r.get(n.toId),c=e.getShape(d);if(!c)continue;if(d){let t=e.getShapePageBounds(d),r=e.getShape(i),l=clamp((coerceNumber(n.point[0])+.5)/2,.2,.8),c=clamp((coerceNumber(n.point[1])+.5)/2,.2,.8),u=e.getPointInShapeSpace(r,{x:t.minX+t.width*l,y:t.minY+t.height*c}),p=e.getShapeHandles(r),h=o.onHandleChange(r,{handle:{...p.find(e=>e.id===a),x:u.x,y:u.y},isPrecise:.5!==u.x||.5!==u.y});if(h){if(h.props?.[a]){let e=h.props?.[a];"binding"===e.type&&(e.isExact=0===n.distance,e.boundShapeId!==d&&(console.warn("Hit the wrong shape!"),e.boundShapeId=d,e.normalizedAnchor={x:.5,y:.5}))}e.updateShapes([h])}}}}})}),e.setCurrentPage(r),e.history.clear(),e.selectNone(),e.updateViewportScreenBounds();let o=e.currentPageBounds;o&&e.zoomToBounds(o,1)})}function coerceNumber(e){return"number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)?0:e}function coerceDimension(e){let t=coerceNumber(e);return t<=0?1:t}async function tryMigrateAsset(e,t){try{if("bookmark"===t.type||!t.props.src)return;let r=await fetch(t.props.src);if(!r.ok)return;let n=new File([await r.blob()],t.props.name,{type:r.headers.get("content-type")??t.props.mimeType??void 0}),i=await e.getAssetForExternalContent({type:"file",file:n});if(!i)throw Error("Could not get asset for external content");if("bookmark"===i.type)return;e.updateAssets([{id:t.id,type:t.type,props:{...i.props,name:t.props.name}}])}catch(e){}}function buildFromV1Document_migrate(e,t){let{version:r=0}=e;e.assets||(e.assets={});let n=new Set;return Object.values(e.pages).forEach(e=>Object.values(e.shapes).forEach(t=>{let{parentId:r,children:i,assetId:o}=t;o&&n.add(o),r===e.id||e.shapes[r]||(console.warn("Encountered a shape with a missing parent!"),t.parentId=e.id),"group"===t.type&&i&&i.forEach(r=>{e.shapes[r]||(console.warn("Encountered a parent with a missing child!",t.id,r),i?.splice(i.indexOf(r),1))})})),Object.keys(e.assets).forEach(t=>{n.has(t)||delete e.assets[t]}),r!==t&&(r<14&&Object.values(e.pages).forEach(e=>{Object.values(e.shapes).filter(e=>"text"===e.type).forEach(e=>{void 0===e.style.font&&e.style.font})}),r<=13&&Object.values(e.pages).forEach(e=>{Object.values(e.bindings).forEach(e=>{Object.assign(e,e.meta)}),Object.values(e.shapes).forEach(e=>{Object.entries(e.style).forEach(([t,r])=>{"string"==typeof r&&(e.style[t]=r.toLowerCase())}),"arrow"===e.type&&e.decorations&&Object.entries(e.decorations).forEach(([t,r])=>{"Arrow"===r&&(e.decorations={...e.decorations,[t]:"arrow"})})})}),r<=13.1&&null==e.name&&(e.name="New Document"),r<15&&null==e.assets&&(e.assets={}),Object.values(e.pages).forEach(e=>{Object.values(e.shapes).forEach(e=>{r<15.2&&("image"===e.type||"video"===e.type)&&null==e.style.isFilled&&(e.style.isFilled=!0),r<15.3&&("rectangle"===e.type||"triangle"===e.type||"ellipse"===e.type||"arrow"===e.type)&&("text"in e&&"string"==typeof e.text&&(e.label=e.text),e.label||(e.label=""),e.labelPoint||(e.labelPoint=[.5,.5]))})})),Object.values(e.pageStates).forEach(t=>{t.selectedIds=t.selectedIds.filter(r=>void 0!==e.pages[t.id].shapes[r]),t.bindingId=void 0,t.editingId=void 0,t.hoveredId=void 0,t.pointedId=void 0}),e.version=t,e}var dr=((y=dr||{}).Sticky="sticky",y.Ellipse="ellipse",y.Rectangle="rectangle",y.Triangle="triangle",y.Draw="draw",y.Arrow="arrow",y.Text="text",y.Group="group",y.Image="image",y.Video="video",y),dn=((b=dn||{}).White="white",b.LightGray="lightGray",b.Gray="gray",b.Black="black",b.Green="green",b.Cyan="cyan",b.Blue="blue",b.Indigo="indigo",b.Violet="violet",b.Red="red",b.Orange="orange",b.Yellow="yellow",b),di=((v=di||{}).Small="small",v.Medium="medium",v.Large="large",v),da=((S=da||{}).Draw="draw",S.Solid="solid",S.Dashed="dashed",S.Dotted="dotted",S),ds=((x=ds||{}).Start="start",x.Middle="middle",x.End="end",x.Justify="justify",x),dl=((w=dl||{}).Script="script",w.Sans="sans",w.Serif="serif",w.Mono="mono",w),dd=((_=dd||{}).Arrow="arrow",_),dc=((P=dc||{}).Image="image",P.Video="video",P);let du={white:"black",black:"black",lightGray:"grey",gray:"grey",green:"light-green",cyan:"green",blue:"light-blue",indigo:"blue",orange:"orange",yellow:"yellow",red:"red",violet:"light-violet"},dp={mono:"mono",sans:"sans",script:"draw",serif:"serif"},dh={start:"start",middle:"middle",end:"end",justify:"start"},df={small:"s",medium:"l",large:"xl"},dg={small:"m",medium:"l",large:"xl"},dm={solid:"solid",dashed:"dashed",dotted:"dotted",draw:"draw"};function getV2Color(e){return e?du[e]??"black":"black"}function getV2Font(e){return e?dp[e]??"draw":"draw"}function getV2Align(e){return e?dh[e]??"middle":"middle"}function getV2TextSize(e){return e?df[e]??"m":"m"}function getV2Size(e){return e?dg[e]??"l":"l"}function getV2Dash(e){return e?dm[e]??"draw":"draw"}function getV2Point(e){return{x:coerceNumber(e[0]),y:coerceNumber(e[1]),z:null==e[2]?.5:coerceNumber(e[2])}}function getV2Arrowhead(e){return"arrow"===e?"arrow":"none"}function getV2Fill(e,t){return e?"black"===t||"white"===t?"semi":"solid":"none"}let dy=".tldr",db=object({tldrawFileFormatVersion:eZ,schema:object({schemaVersion:eX,storeVersion:eX,recordVersions:dict(eH,object({version:eX,subTypeVersions:dict(eH,eX).optional(),subTypeKey:eH.optional()}))}),records:arrayOf(object({id:eH,typeName:eH}).allowUnknownProperties())});function isV1File(e){try{if(e.document?.version)return!0;return!1}catch(e){return!1}}function parseTldrawJsonFile({json:e,schema:t}){let r,n;try{r=db.validate(JSON.parse(e))}catch(t){try{if(r=JSON.parse(e),isV1File(r))return e$.err({type:"v1File",data:r})}catch(e){}return e$.err({type:"notATldrawFile",cause:t})}if(r.tldrawFileFormatVersion>1)return e$.err({type:"fileFormatVersionTooNew",version:r.tldrawFileFormatVersion});try{let e=Object.fromEntries(r.records.map(e=>[e.id,e]));n=t.migrateStoreSnapshot({store:e,schema:r.schema})}catch(e){return e$.err({type:"invalidRecords",cause:e})}if("error"===n.type)return e$.err({type:"migrationFailed",reason:n.reason});try{return e$.ok(createTLStore({initialData:n.value,schema:t}))}catch(e){return e$.err({type:"invalidRecords",cause:e})}}async function serializeTldrawJson(e){let t=[],r=new Set,n=[];for(let i of e.allRecords())switch(i.typeName){case"asset":if("bookmark"!==i.type&&i.props.src&&!i.props.src.startsWith("data:")){let e;try{e=await FileHelpers.fileToBase64(await (await fetch(i.props.src)).blob())}catch{e=i.props.src}n.push({...i,props:{...i.props,src:e}})}else n.push(i);break;case"shape":"assetId"in i.props&&r.add(i.props.assetId),t.push(i);break;default:t.push(i)}let i=t.concat(n.filter(e=>r.has(e.id)));return JSON.stringify({tldrawFileFormatVersion:1,schema:e.schema.serialize(),records:i})}async function serializeTldrawJsonBlob(e){return new Blob([await serializeTldrawJson(e)],{type:"application/vnd.tldraw+json"})}async function parseAndLoadDocument(e,t,r,n,i,o){let a=parseTldrawJsonFile({schema:e.store.schema,json:t});if(!a.ok){let t;switch(a.error.type){case"notATldrawFile":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=r("file-system.file-open-error.not-a-tldraw-file");break;case"fileFormatVersionTooNew":t=r("file-system.file-open-error.file-format-version-too-new");break;case"migrationFailed":t=r(a.error.reason===ez.TargetVersionTooNew?"file-system.file-open-error.file-format-version-too-new":"file-system.file-open-error.generic-corrupted-file");break;case"invalidRecords":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=r("file-system.file-open-error.generic-corrupted-file");break;case"v1File":buildFromV1Document(e,a.error.data.document),i?.();return;default:exhaustiveSwitchError(a.error,"type")}n({title:r("file-system.file-open-error.title"),description:t});return}transact(()=>{e.store.clear();let[t,r]=partition(a.value.allRecords(),e=>"shape"===e.typeName);e.store.put(r,"initialize"),e.store.ensureStoreIsUsable(),e.store.put(t,"initialize"),e.history.clear(),e.updateViewportScreenBounds(),e.updateRenderingBounds();let n=e.currentPageBounds;n&&e.zoomToBounds(n,1)}),o&&e.user.updateUserPreferences({isDarkMode:!0})}},2838:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>__addDisposableResource,__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldIn:()=>__classPrivateFieldIn,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>n,__decorate:()=>__decorate,__disposeResources:()=>__disposeResources,__esDecorate:()=>__esDecorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__propKey:()=>__propKey,__read:()=>__read,__rest:()=>__rest,__runInitializers:()=>__runInitializers,__setFunctionName:()=>__setFunctionName,__spread:()=>__spread,__spreadArray:()=>__spreadArray,__spreadArrays:()=>__spreadArrays,__values:()=>__values,default:()=>a});var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function __decorate(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function __param(e,t){return function(r,n){t(r,n,e)}}function __esDecorate(e,t,r,n,i,o){function accept(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var a,l=n.kind,d="getter"===l?"get":"setter"===l?"set":"value",c=!t&&e?n.static?e:e.prototype:null,u=t||(c?Object.getOwnPropertyDescriptor(c,n.name):{}),p=!1,h=r.length-1;h>=0;h--){var f={};for(var g in n)f[g]="access"===g?{}:n[g];for(var g in n.access)f.access[g]=n.access[g];f.addInitializer=function(e){if(p)throw TypeError("Cannot add initializers after decoration has completed");o.push(accept(e||null))};var m=(0,r[h])("accessor"===l?{get:u.get,set:u.set}:u[d],f);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw TypeError("Object expected");(a=accept(m.get))&&(u.get=a),(a=accept(m.set))&&(u.set=a),(a=accept(m.init))&&i.unshift(a)}else(a=accept(m))&&("field"===l?i.unshift(a):u[d]=a)}c&&Object.defineProperty(c,n.name,u),p=!0}function __runInitializers(e,t,r){for(var n=arguments.length>2,i=0;i<t.length;i++)r=n?t[i].call(e,r):t[i].call(e);return n?r:void 0}function __propKey(e){return"symbol"==typeof e?e:"".concat(e)}function __setFunctionName(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,i){function fulfilled(e){try{step(n.next(e))}catch(e){i(e)}}function rejected(e){try{step(n.throw(e))}catch(e){i(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var n=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function __exportStar(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __spreadArrays(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],a=0,l=o.length;a<l;a++,i++)n[i]=o[a];return n}function __spreadArray(e,t,r){if(r||2==arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},verb("next"),verb("throw"),verb("return"),n[Symbol.asyncIterator]=function(){return this},n;function verb(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||resume(e,t)})})}function resume(e,t){try{step(i[e](t))}catch(e){settle(o[0][3],e)}}function step(e){e.value instanceof __await?Promise.resolve(e.value.v).then(fulfill,reject):settle(o[0][2],e)}function fulfill(e){resume("next",e)}function reject(e){resume("throw",e)}function settle(e,t){e(t),o.shift(),o.length&&resume(o[0][0],o[0][1])}}function __asyncDelegator(e){var t,r;return t={},verb("next"),verb("throw",function(e){throw e}),verb("return"),t[Symbol.iterator]=function(){return this},t;function verb(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:__await(e[n](t)),done:!1}:i?i(t):t}:i}}function __asyncValues(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=__values(e),t={},verb("next"),verb("throw"),verb("return"),t[Symbol.asyncIterator]=function(){return this},t);function verb(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){settle(n,i,(t=e[r](t)).done,t.value)})}}function settle(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t}function __importDefault(e){return e&&e.__esModule?e:{default:e}}function __classPrivateFieldGet(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function __classPrivateFieldSet(e,t,r,n,i){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}function __classPrivateFieldIn(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function __addDisposableResource(e,t,r){if(null!=t){var n;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose]}if("function"!=typeof n)throw TypeError("Object not disposable.");e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var o="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function __disposeResources(e){function fail(t){e.error=e.hasError?new o(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}function next(){for(;e.stack.length;){var t=e.stack.pop();try{var r=t.dispose&&t.dispose.call(t.value);if(t.async)return Promise.resolve(r).then(next,function(e){return fail(e),next()})}catch(e){fail(e)}}if(e.hasError)throw e.error}return next()}let a={__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding:n,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources}}};